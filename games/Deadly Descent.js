window.game = "PCFET0NUWVBFIGh0bWw+Cgo8aHRtbCBsYW5nPSJlbi11cyI+CiAgICAKICAgIDxiYXNlIGhyZWYgPSAiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL1BvazEyZC90YUBtYWluL2RlYWRseWRlc2NlbnQvIj4KICAgIAo8aGVhZD4KICAgIAogICAgCjxtZXRhIGNoYXJzZXQ9InV0Zi04Ii8+CjxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ii8+Cjx0aXRsZT5EZWFkbHkgRGVzY2VudDwvdGl0bGU+CjxzdHlsZT4KICAgICAgICAgICAgaHRtbCwgYm9keSB7CiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBweDsKICAgICAgICAgICAgICAgIG1hcmdpbjogMHB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC5mdWxsc2NyZWVuIHsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICMyNDI0MjQ7CiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgICAgIHRvcDogMHB4OwogICAgICAgICAgICAgICAgbGVmdDogMHB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgICNsb2FkaW5nLW92ZXJsYXkgewogICAgICAgICAgICAgICAgZm9udC1zaXplOiAyMHB4OwogICAgICAgICAgICAgICAgei1pbmRleDogMTsKICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICB9CiAgICAgICAgICAgICNpY29uIHsKICAgICAgICAgICAgICAgIG1heC13aWR0aDogMTAwcHg7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDsKICAgICAgICAgICAgfQogICAgICAgICAgICAjcHJvZ3Jlc3MtYmFyIHsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDVweDsKICAgICAgICAgICAgICAgIHdpZHRoOiA5MCU7CiAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDI1MHB4OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAyMHB4OwogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogIzE4MTgxODsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDVweDsKICAgICAgICAgICAgfQogICAgICAgICAgICAjcHJvZ3Jlc3MtYmFyLWZpbGwgewogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogM3B4OwogICAgICAgICAgICAgICAgd2lkdGg6IDAlOwogICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogIzk3NDdGRjsKICAgICAgICAgICAgfQogICAgICAgIDwvc3R5bGU+CjwhLS0gWWFuZGV4Lk1ldHJpa2EgY291bnRlciAtLT4KPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgogICAoZnVuY3Rpb24obSxlLHQscixpLGssYSl7bVtpXT1tW2ldfHxmdW5jdGlvbigpeyhtW2ldLmE9bVtpXS5hfHxbXSkucHVzaChhcmd1bWVudHMpfTsKICAgbVtpXS5sPTEqbmV3IERhdGUoKTsKICAgZm9yICh2YXIgaiA9IDA7IGogPCBkb2N1bWVudC5zY3JpcHRzLmxlbmd0aDsgaisrKSB7aWYgKGRvY3VtZW50LnNjcmlwdHNbal0uc3JjID09PSByKSB7IHJldHVybjsgfX0KICAgaz1lLmNyZWF0ZUVsZW1lbnQodCksYT1lLmdldEVsZW1lbnRzQnlUYWdOYW1lKHQpWzBdLGsuYXN5bmM9MSxrLnNyYz1yLGEucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoayxhKX0pCiAgICh3aW5kb3csIGRvY3VtZW50LCAic2NyaXB0IiwgImh0dHBzOi8vbWMueWFuZGV4LnJ1L21ldHJpa2EvdGFnLmpzIiwgInltIik7CgogICB5bSgxMDAyODczNTQsICJpbml0IiwgewogICAgICAgIGNsaWNrbWFwOnRydWUsCiAgICAgICAgdHJhY2tMaW5rczp0cnVlLAogICAgICAgIGFjY3VyYXRlVHJhY2tCb3VuY2U6dHJ1ZQogICB9KTsKCiAgIC8vINCk0YPQvdC60YbQuNGPINC00LvRjyDQv9GA0LjRkdC80LAg0YHQvtCx0YvRgtC40Lkg0LjQtyBVbml0eQogICBmdW5jdGlvbiBzZW5kTWV0cmljRXZlbnQoZXZlbnROYW1lLCBwYXJhbXMpIHsKICAgICAgIHRyeSB7CiAgICAgICAgICAgeW0oMTAwMjg3MzU0LCAicmVhY2hHb2FsIiwgZXZlbnROYW1lLCBwYXJhbXMgPyBKU09OLnBhcnNlKHBhcmFtcykgOiB7fSk7CiAgICAgICAgICAgY29uc29sZS5sb2coItCh0L7QsdGL0YLQuNC1INC+0YLQv9GA0LDQstC70LXQvdC+INCyINCv0L3QtNC10LrRgS7QnNC10YLRgNC40LrRgzoiLCBldmVudE5hbWUsIHBhcmFtcyk7CiAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgY29uc29sZS5lcnJvcigi0J7RiNC40LHQutCwINC/0YDQuCDQvtGC0L/RgNCw0LLQutC1INGB0L7QsdGL0YLQuNGPINCyINCv0L3QtNC10LrRgS7QnNC10YLRgNC40LrRgzoiLCBlKTsKICAgICAgIH0KICAgfQo8L3NjcmlwdD4KPG5vc2NyaXB0PjxkaXY+PGltZyBzcmM9Imh0dHBzOi8vbWMueWFuZGV4LnJ1L3dhdGNoLzEwMDI4NzM1NCIgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlOyBsZWZ0Oi05OTk5cHg7IiBhbHQ9IiIvPjwvZGl2Pjwvbm9zY3JpcHQ+CjwhLS0gL1lhbmRleC5NZXRyaWthIGNvdW50ZXIgLS0+CjwvaGVhZD4KPGJvZHk+CjxjYW52YXMgaWQ9ImNhbnZhcyIgY2xhc3M9ImZ1bGxzY3JlZW4iPjwvY2FudmFzPgo8ZGl2IGlkPSJsb2FkaW5nLW92ZXJsYXkiIGNsYXNzPSJmdWxsc2NyZWVuIj4KPGltZyBpZD0iaWNvbiIgc3JjPSIuL2ljb24ucG5nIi8+CjxkaXYgaWQ9InByb2dyZXNzLWJhciI+PGRpdiBpZD0icHJvZ3Jlc3MtYmFyLWZpbGwiPjwvZGl2PjwvZGl2Pgo8L2Rpdj4KPHNjcmlwdCBzcmM9Ii4vcGxheWdhbWEuanMiPjwvc2NyaXB0Pgo8c2NyaXB0PgogICAgICAgICAgICBpZiAoL2lQaG9uZXxpUGFkfGlQb2R8QW5kcm9pZC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsKICAgICAgICAgICAgICAgIGxldCBtZXRhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbWV0YScpCiAgICAgICAgICAgICAgICBtZXRhLm5hbWUgPSAndmlld3BvcnQnCiAgICAgICAgICAgICAgICBtZXRhLmNvbnRlbnQgPSAnd2lkdGg9ZGV2aWNlLXdpZHRoLCBoZWlnaHQ9ZGV2aWNlLWhlaWdodCwgaW5pdGlhbC1zY2FsZT0xLjAsIHVzZXItc2NhbGFibGU9bm8sIHNocmluay10by1maXQ9eWVzJwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZChtZXRhKQogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpCiAgICAgICAgICAgIGxldCBsb2FkaW5nT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nLW92ZXJsYXknKQogICAgICAgICAgICBsZXQgcHJvZ3Jlc3NCYXJGaWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzLWJhci1maWxsJykKCiAgICAgICAgICAgIGNvbnN0IFNUT1JBR0VfREFUQV9TRVBBUkFUT1IgPSAne2JyaWRnZV9kYXRhX3NlcGFyYXRvcn0nCiAgICAgICAgICAgIGNvbnN0IFNUT1JBR0VfS0VZU19TRVBBUkFUT1IgPSAne2JyaWRnZV9rZXlzX3NlcGFyYXRvcn0nCiAgICAgICAgICAgIGNvbnN0IFNUT1JBR0VfVkFMVUVTX1NFUEFSQVRPUiA9ICd7YnJpZGdlX3ZhbHVlc19zZXBhcmF0b3J9JwogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHV0aWxzCiAgICAgICAgICAgIHdpbmRvdy51bml0eUluc3RhbmNlID0gbnVsbAogICAgICAgICAgICBsZXQgcHJvZ3Jlc3NCYXJGaWxsaW5nSW50ZXJ2YWwgPSBudWxsCiAgICAgICAgICAgIGxldCBwcm9ncmVzc0JhckNvbXBsZXRlRmlsbGluZ1N0YXJ0ZWQgPSBmYWxzZQoKICAgICAgICAgICAgZnVuY3Rpb24gc2VuZE1lc3NhZ2VUb1VuaXR5KG5hbWUsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LnVuaXR5SW5zdGFuY2UgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cudW5pdHlJbnN0YW5jZS5TZW5kTWVzc2FnZSgnUGxheWdhbWFCcmlkZ2UnLCBuYW1lLCB2YWx1ZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gb25Vbml0eUxvYWRpbmdQcm9ncmVzc0NoYW5nZWQocHJvZ3Jlc3MpIHsKICAgICAgICAgICAgICAgIGlmIChwcm9ncmVzcyA+PSAxICYmIHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChwcm9ncmVzc0JhckZpbGxpbmdJbnRlcnZhbCkKICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0JhckZpbGxpbmdJbnRlcnZhbCA9IG51bGwKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocHJvZ3Jlc3NCYXJDb21wbGV0ZUZpbGxpbmdTdGFydGVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzID49IDAuOSkgewogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyQ29tcGxldGVGaWxsaW5nU3RhcnRlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZVByb2dyZXNzQmFyRmlsbGluZygpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJGaWxsLnN0eWxlLndpZHRoID0gYCR7IHByb2dyZXNzICogMTAwIH0lYAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBjb21wbGV0ZVByb2dyZXNzQmFyRmlsbGluZygpIHsKICAgICAgICAgICAgICAgIGlmIChwcm9ncmVzc0JhckZpbGxpbmdJbnRlcnZhbCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGxldCBjdXJyZW50UGVyY2VudCA9IDkwCiAgICAgICAgICAgICAgICBwcm9ncmVzc0JhckZpbGwuc3R5bGUud2lkdGggPSBgJHsgY3VycmVudFBlcmNlbnQgfSVgCiAgICAgICAgICAgICAgICBwcm9ncmVzc0JhckZpbGxpbmdJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGVyY2VudCsrCiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRQZXJjZW50ID4gMTAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQZXJjZW50ID0gMTAwCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0JhckZpbGwuc3R5bGUud2lkdGggPSBgJHsgY3VycmVudFBlcmNlbnQgfSVgCgogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UGVyY2VudCA+PSAxMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChwcm9ncmVzc0JhckZpbGxpbmdJbnRlcnZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJGaWxsaW5nSW50ZXJ2YWwgPSBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEwMCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJkb3duJywgKCkgPT4gewogICAgICAgICAgICAgICAgd2luZG93LmZvY3VzKCkKICAgICAgICAgICAgICAgIGNhbnZhcy5mb2N1cygpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICAKICAgICAgICAgICAgLy8gaW5pdGlhbGl6YXRpb24KICAgICAgICAgICAgYnJpZGdlCiAgICAgICAgICAgICAgICAuaW5pdGlhbGl6ZSgpCiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgYnJpZGdlLmFkdmVydGlzZW1lbnQub24oJ2Jhbm5lcl9zdGF0ZV9jaGFuZ2VkJywgc3RhdGUgPT4gc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkJhbm5lclN0YXRlQ2hhbmdlZCcsIHN0YXRlKSkKICAgICAgICAgICAgICAgICAgICBicmlkZ2UuYWR2ZXJ0aXNlbWVudC5vbignaW50ZXJzdGl0aWFsX3N0YXRlX2NoYW5nZWQnLCBzdGF0ZSA9PiBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uSW50ZXJzdGl0aWFsU3RhdGVDaGFuZ2VkJywgc3RhdGUpKQogICAgICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50Lm9uKCdyZXdhcmRlZF9zdGF0ZV9jaGFuZ2VkJywgc3RhdGUgPT4gc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblJld2FyZGVkU3RhdGVDaGFuZ2VkJywgc3RhdGUpKQogICAgICAgICAgICAgICAgICAgIGJyaWRnZS5nYW1lLm9uKCd2aXNpYmlsaXR5X3N0YXRlX2NoYW5nZWQnLCBzdGF0ZSA9PiBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uVmlzaWJpbGl0eVN0YXRlQ2hhbmdlZCcsIHN0YXRlKSkKCiAgICAgICAgICAgICAgICAgICAgaWYgKGJyaWRnZS5wbGF0Zm9ybS5pZCA9PT0gYnJpZGdlLlBMQVRGT1JNX0lELkdBTUVfRElTVFJJQlVUSU9OIHx8IGJyaWRnZS5wbGF0Zm9ybS5pZCA9PT0gYnJpZGdlLlBMQVRGT1JNX0lELllBTkRFWCkgewogICAgICAgICAgICAgICAgICAgICAgICBicmlkZ2UuYWR2ZXJ0aXNlbWVudC5zaG93SW50ZXJzdGl0aWFsKCkKICAgICAgICAgICAgICAgICAgICB9CgoKZnVuY3Rpb24gbGF1bmNoRGVmYXVsdFVuaXR5QnVpbGQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB1bml0eUxvYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpCiAgICAgICAgICAgICAgICAgICAgdW5pdHlMb2FkZXIuc3JjID0gJ0J1aWxkL2J1aWxkbG9hZGVyci5qcycKICAgICAgICAgICAgICAgICAgICB1bml0eUxvYWRlci5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVVuaXR5SW5zdGFuY2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVVybDogJ0J1aWxkL2J1aWxkLmRhdGEudW5pdHl3ZWInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1ld29ya1VybDogJ0J1aWxkL2J1aWxkLmZyYW1ld29yay5qcy51bml0eXdlYicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZVVybDogJ0J1aWxkL2J1aWxkLndhc20udW5pdHl3ZWInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbWluZ0Fzc2V0c1VybDogJ1N0cmVhbWluZ0Fzc2V0cycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFueU5hbWU6ICdEZWZhdWx0Q29tcGFueScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdE5hbWU6ICdEZWFkbHkgRGVzY2VudCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdFZlcnNpb246ICc2NScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWF0Y2hXZWJHTFRvQ2FudmFzU2l6ZTogZmFsc2UsIC8vIFVuY29tbWVudCB0aGlzIHRvIHNlcGFyYXRlbHkgY29udHJvbCBXZWJHTCBjYW52YXMgcmVuZGVyIHNpemUgYW5kIERPTSBlbGVtZW50IHNpemUuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGV2aWNlUGl4ZWxSYXRpbzogMSwgLy8gVW5jb21tZW50IHRoaXMgdG8gb3ZlcnJpZGUgbG93IERQSSByZW5kZXJpbmcgb24gaGlnaCBEUEkgZGlzcGxheXMuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Vbml0eUxvYWRpbmdQcm9ncmVzc0NoYW5nZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigodW5pdHlJbnN0YW5jZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy51bml0eUluc3RhbmNlID0gdW5pdHlJbnN0YW5jZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdPdmVybGF5LnJlbW92ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzLmZvY3VzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodW5pdHlMb2FkZXIpCn0KCgogICAgICAgICAgICAgICAgICAgIGJyaWRnZS5yZW1vdGVDb25maWcuZ2V0KHt9CiAgICAgICAgICAgICAgICAgICAgICAgICkudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgndmVyc2lvbicgaW4gZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1aWxkRmxhZyA9IGRhdGEudmVyc2lvbjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkJ1aWxkIGZsYWcgdmFsdWU6IiwgYnVpbGRGbGFnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVuaXR5TG9hZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0eUxvYWRlci5zcmMgPSAnQnVpbGQvJyArIGJ1aWxkRmxhZyArICcubG9hZGVyLmpzJwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0eUxvYWRlci5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVVuaXR5SW5zdGFuY2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVVybDogJ0J1aWxkLycgKyBidWlsZEZsYWcgKyAnLmRhdGEudW5pdHl3ZWInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1ld29ya1VybDogJ0J1aWxkLycgKyBidWlsZEZsYWcgKyAnLmZyYW1ld29yay5qcy51bml0eXdlYicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZVVybDogJ0J1aWxkLycgKyBidWlsZEZsYWcgKyAnLndhc20udW5pdHl3ZWInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbWluZ0Fzc2V0c1VybDogJ1N0cmVhbWluZ0Fzc2V0cycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFueU5hbWU6ICdEZWZhdWx0Q29tcGFueScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdE5hbWU6ICdEZWFkbHkgRGVzY2VudCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdFZlcnNpb246ICc2NScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Vbml0eUxvYWRpbmdQcm9ncmVzc0NoYW5nZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigodW5pdHlJbnN0YW5jZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy51bml0eUluc3RhbmNlID0gdW5pdHlJbnN0YW5jZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdPdmVybGF5LnJlbW92ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzLmZvY3VzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXVuY2hEZWZhdWx0VW5pdHlCdWlsZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0eUxvYWRlci5vbmVycm9yID0gKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gbG9hZCBVbml0eSBsb2FkZXIgc2NyaXB0IGZvciBidWlsZDoiLCBidWlsZEZsYWcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXVuY2hEZWZhdWx0VW5pdHlCdWlsZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh1bml0eUxvYWRlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF1bmNoRGVmYXVsdFVuaXR5QnVpbGQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlJlbW90ZSBjb25maWcgZXJyb3I6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF1bmNoRGVmYXVsdFVuaXR5QnVpbGQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKGVycm9yKSkKICAgICAgICAgICAgCgogICAgICAgICAgICAvLyBwbGF0Zm9ybQogICAgICAgICAgICB3aW5kb3cuZ2V0UGxhdGZvcm1JZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5wbGF0Zm9ybS5pZAogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0UGxhdGZvcm1MYW5ndWFnZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5wbGF0Zm9ybS5sYW5ndWFnZQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0UGxhdGZvcm1QYXlsb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBsZXQgcGF5bG9hZCA9IGJyaWRnZS5wbGF0Zm9ybS5wYXlsb2FkCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBheWxvYWQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBheWxvYWQKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRQbGF0Zm9ybVRsZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgbGV0IHRsZCA9IGJyaWRnZS5wbGF0Zm9ybS50bGQKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGxkID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0bGQKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1BsYXRmb3JtR2V0QWxsR2FtZXNTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGxhdGZvcm0uaXNHZXRBbGxHYW1lc1N1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1BsYXRmb3JtR2V0R2FtZUJ5SWRTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGxhdGZvcm0uaXNHZXRHYW1lQnlJZFN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5zZW5kTWVzc2FnZVRvUGxhdGZvcm0gPSBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICBicmlkZ2UucGxhdGZvcm0uc2VuZE1lc3NhZ2UobWVzc2FnZSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldFNlcnZlclRpbWUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5wbGF0Zm9ybS5nZXRTZXJ2ZXJUaW1lKCkKICAgICAgICAgICAgICAgICAgICAudGhlbihyZXN1bHQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uR2V0U2VydmVyVGltZUNvbXBsZXRlZCcsIHJlc3VsdC50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkdldFNlcnZlclRpbWVDb21wbGV0ZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRBbGxHYW1lcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgYnJpZGdlLnBsYXRmb3JtLmdldEFsbEdhbWVzKCkKICAgICAgICAgICAgICAgICAgICAudGhlbihyZXN1bHQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uR2V0QWxsR2FtZXNDb21wbGV0ZWRTdWNjZXNzJywgSlNPTi5zdHJpbmdpZnkocmVzdWx0KSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25HZXRBbGxHYW1lc0NvbXBsZXRlZEZhaWxlZCcpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldEdhbWVCeUlkID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0geyB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJpZGdlLnBsYXRmb3JtLmdldEdhbWVCeUlkKG9wdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkdldEdhbWVCeUlkQ29tcGxldGVkU3VjY2VzcycsIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uR2V0R2FtZUJ5SWRDb21wbGV0ZWRGYWlsZWQnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRldmljZQogICAgICAgICAgICB3aW5kb3cuZ2V0RGV2aWNlVHlwZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5kZXZpY2UudHlwZQogICAgICAgICAgICB9CgoKICAgICAgICAgICAgLy8gcGxheWVyCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1BsYXllckF1dGhvcml6YXRpb25TdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGxheWVyLmlzQXV0aG9yaXphdGlvblN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1BsYXllckF1dGhvcml6ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGxheWVyLmlzQXV0aG9yaXplZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRQbGF5ZXJJZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKGJyaWRnZS5wbGF5ZXIuaWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnBsYXllci5pZC50b1N0cmluZygpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRQbGF5ZXJOYW1lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAoYnJpZGdlLnBsYXllci5uYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5wbGF5ZXIubmFtZS50b1N0cmluZygpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRQbGF5ZXJQaG90b3MgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGlmIChicmlkZ2UucGxheWVyLnBob3Rvcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGJyaWRnZS5wbGF5ZXIucGhvdG9zKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuYXV0aG9yaXplUGxheWVyID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5wbGF5ZXIuYXV0aG9yaXplKG9wdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQXV0aG9yaXplQ29tcGxldGVkJywgJ3RydWUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkF1dGhvcml6ZUNvbXBsZXRlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIGdhbWUKICAgICAgICAgICAgd2luZG93LmdldFZpc2liaWxpdHlTdGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5nYW1lLnZpc2liaWxpdHlTdGF0ZQogICAgICAgICAgICB9CgoKICAgICAgICAgICAgLy8gc3RvcmFnZQogICAgICAgICAgICB3aW5kb3cuZ2V0U3RvcmFnZURlZmF1bHRUeXBlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnN0b3JhZ2UuZGVmYXVsdFR5cGUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldElzU3RvcmFnZVN1cHBvcnRlZCA9IGZ1bmN0aW9uKHN0b3JhZ2VUeXBlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnN0b3JhZ2UuaXNTdXBwb3J0ZWQoc3RvcmFnZVR5cGUpLnRvU3RyaW5nKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldElzU3RvcmFnZUF2YWlsYWJsZSA9IGZ1bmN0aW9uKHN0b3JhZ2VUeXBlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnN0b3JhZ2UuaXNBdmFpbGFibGUoc3RvcmFnZVR5cGUpLnRvU3RyaW5nKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldFN0b3JhZ2VEYXRhID0gZnVuY3Rpb24oa2V5LCBzdG9yYWdlVHlwZSkgewogICAgICAgICAgICAgICAgbGV0IGtleXMgPSBrZXkuc3BsaXQoU1RPUkFHRV9LRVlTX1NFUEFSQVRPUikKCiAgICAgICAgICAgICAgICBicmlkZ2Uuc3RvcmFnZS5nZXQoa2V5cywgc3RvcmFnZVR5cGUsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWVzID0gW10KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSBkYXRhW2ldCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh2YWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCgnJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkdldFN0b3JhZ2VEYXRhU3VjY2VzcycsIGAke2tleX0ke1NUT1JBR0VfREFUQV9TRVBBUkFUT1J9JHt2YWx1ZXMuam9pbihTVE9SQUdFX1ZBTFVFU19TRVBBUkFUT1IpfWApCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVswXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YVswXSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGFbMF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uR2V0U3RvcmFnZURhdGFTdWNjZXNzJywgYCR7a2V5fSR7U1RPUkFHRV9EQVRBX1NFUEFSQVRPUn0ke2RhdGF9YCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkdldFN0b3JhZ2VEYXRhRmFpbGVkJywga2V5KQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5zZXRTdG9yYWdlRGF0YSA9IGZ1bmN0aW9uKGtleSwgdmFsdWUsIHN0b3JhZ2VUeXBlKSB7CiAgICAgICAgICAgICAgICBsZXQga2V5cyA9IGtleS5zcGxpdChTVE9SQUdFX0tFWVNfU0VQQVJBVE9SKQogICAgICAgICAgICAgICAgbGV0IHZhbHVlcyA9IHZhbHVlLnNwbGl0KFNUT1JBR0VfVkFMVUVTX1NFUEFSQVRPUikKCiAgICAgICAgICAgICAgICBicmlkZ2Uuc3RvcmFnZS5zZXQoa2V5cywgdmFsdWVzLCBzdG9yYWdlVHlwZSkKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25TZXRTdG9yYWdlRGF0YVN1Y2Nlc3MnLCBrZXkpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uU2V0U3RvcmFnZURhdGFGYWlsZWQnLCBrZXkpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmRlbGV0ZVN0b3JhZ2VEYXRhID0gZnVuY3Rpb24oa2V5LCBzdG9yYWdlVHlwZSkgewogICAgICAgICAgICAgICAgbGV0IGtleXMgPSBrZXkuc3BsaXQoU1RPUkFHRV9LRVlTX1NFUEFSQVRPUikKCiAgICAgICAgICAgICAgICBicmlkZ2Uuc3RvcmFnZS5kZWxldGUoa2V5cywgc3RvcmFnZVR5cGUpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uRGVsZXRlU3RvcmFnZURhdGFTdWNjZXNzJywga2V5KQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkRlbGV0ZVN0b3JhZ2VEYXRhRmFpbGVkJywga2V5KQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAvLyBhZHZlcnRpc2VtZW50CiAgICAgICAgICAgIHdpbmRvdy5nZXRJbnRlcnN0aXRpYWxTdGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKGJyaWRnZS5hZHZlcnRpc2VtZW50LmludGVyc3RpdGlhbFN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5hZHZlcnRpc2VtZW50LmludGVyc3RpdGlhbFN0YXRlCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0SXNCYW5uZXJTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UuYWR2ZXJ0aXNlbWVudC5pc0Jhbm5lclN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHdpbmRvdy5nZXRNaW5pbXVtRGVsYXlCZXR3ZWVuSW50ZXJzdGl0aWFsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLmFkdmVydGlzZW1lbnQubWluaW11bURlbGF5QmV0d2VlbkludGVyc3RpdGlhbC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5zZXRNaW5pbXVtRGVsYXlCZXR3ZWVuSW50ZXJzdGl0aWFsID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgYnJpZGdlLmFkdmVydGlzZW1lbnQuc2V0TWluaW11bURlbGF5QmV0d2VlbkludGVyc3RpdGlhbChvcHRpb25zKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuc2hvd0Jhbm5lciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHsgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LnNob3dCYW5uZXIob3B0aW9ucykKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmhpZGVCYW5uZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LmhpZGVCYW5uZXIoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuc2hvd0ludGVyc3RpdGlhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgYnJpZGdlLmFkdmVydGlzZW1lbnQuc2hvd0ludGVyc3RpdGlhbCgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5zaG93UmV3YXJkZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LnNob3dSZXdhcmRlZCgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5jaGVja0FkQmxvY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LmNoZWNrQWRCbG9jaygpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkNoZWNrQWRCbG9ja0NvbXBsZXRlZCcsIHJlc3VsdC50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkNoZWNrQWRCbG9ja0NvbXBsZXRlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIHNvY2lhbAogICAgICAgICAgICB3aW5kb3cuZ2V0SXNTaGFyZVN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zb2NpYWwuaXNTaGFyZVN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0ludml0ZUZyaWVuZHNTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzSW52aXRlRnJpZW5kc1N1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0pvaW5Db21tdW5pdHlTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzSm9pbkNvbW11bml0eVN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0NyZWF0ZVBvc3RTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzQ3JlYXRlUG9zdFN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0FkZFRvSG9tZVNjcmVlblN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zb2NpYWwuaXNBZGRUb0hvbWVTY3JlZW5TdXBwb3J0ZWQudG9TdHJpbmcoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0SXNBZGRUb0Zhdm9yaXRlc1N1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zb2NpYWwuaXNBZGRUb0Zhdm9yaXRlc1N1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1JhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzUmF0ZVN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0V4dGVybmFsTGlua3NBbGxvd2VkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnNvY2lhbC5pc0V4dGVybmFsTGlua3NBbGxvd2VkLnRvU3RyaW5nKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LnNoYXJlID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwuc2hhcmUob3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25TaGFyZUNvbXBsZXRlZCcsICd0cnVlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25TaGFyZUNvbXBsZXRlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93Lmludml0ZUZyaWVuZHMgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwuaW52aXRlRnJpZW5kcyhvcHRpb25zKQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkludml0ZUZyaWVuZHNDb21wbGV0ZWQnLCAndHJ1ZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uSW52aXRlRnJpZW5kc0NvbXBsZXRlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmpvaW5Db21tdW5pdHkgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJpZGdlLnNvY2lhbC5qb2luQ29tbXVuaXR5KG9wdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uSm9pbkNvbW11bml0eUNvbXBsZXRlZCcsICd0cnVlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25Kb2luQ29tbXVuaXR5Q29tcGxldGVkJywgJ2ZhbHNlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuY3JlYXRlUG9zdCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmlkZ2Uuc29jaWFsLmNyZWF0ZVBvc3Qob3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25DcmVhdGVQb3N0Q29tcGxldGVkJywgJ3RydWUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkNyZWF0ZVBvc3RDb21wbGV0ZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5hZGRUb0hvbWVTY3JlZW4gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwuYWRkVG9Ib21lU2NyZWVuKCkKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25BZGRUb0hvbWVTY3JlZW5Db21wbGV0ZWQnLCAndHJ1ZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQWRkVG9Ib21lU2NyZWVuQ29tcGxldGVkJywgJ2ZhbHNlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuYWRkVG9GYXZvcml0ZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwuYWRkVG9GYXZvcml0ZXMoKQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFkZFRvRmF2b3JpdGVzQ29tcGxldGVkJywgJ3RydWUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFkZFRvRmF2b3JpdGVzQ29tcGxldGVkJywgJ2ZhbHNlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cucmF0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgYnJpZGdlLnNvY2lhbC5yYXRlKCkKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25SYXRlQ29tcGxldGVkJywgJ3RydWUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblJhdGVDb21wbGV0ZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAvLyBsZWFkZXJib2FyZAogICAgICAgICAgICB3aW5kb3cuZ2V0SXNMZWFkZXJib2FyZFN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5sZWFkZXJib2FyZC5pc1N1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0xlYWRlcmJvYXJkTmF0aXZlUG9wdXBTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UubGVhZGVyYm9hcmQuaXNOYXRpdmVQb3B1cFN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0xlYWRlcmJvYXJkU2V0U2NvcmVTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UubGVhZGVyYm9hcmQuaXNTZXRTY29yZVN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0xlYWRlcmJvYXJkR2V0U2NvcmVTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UubGVhZGVyYm9hcmQuaXNHZXRTY29yZVN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0xlYWRlcmJvYXJkR2V0RW50cmllc1N1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5sZWFkZXJib2FyZC5pc0dldEVudHJpZXNTdXBwb3J0ZWQudG9TdHJpbmcoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cubGVhZGVyYm9hcmRTZXRTY29yZSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmlkZ2UubGVhZGVyYm9hcmQuc2V0U2NvcmUob3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZFNldFNjb3JlQ29tcGxldGVkJywgJ3RydWUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkU2V0U2NvcmVDb21wbGV0ZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5sZWFkZXJib2FyZEdldFNjb3JlID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5sZWFkZXJib2FyZC5nZXRTY29yZShvcHRpb25zKQogICAgICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZEdldFNjb3JlQ29tcGxldGVkJywgZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZEdldFNjb3JlQ29tcGxldGVkJywgJycpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZEdldFNjb3JlQ29tcGxldGVkJywgJ2ZhbHNlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cubGVhZGVyYm9hcmRHZXRFbnRyaWVzID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5sZWFkZXJib2FyZC5nZXRFbnRyaWVzKG9wdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uTGVhZGVyYm9hcmRHZXRFbnRyaWVzQ29tcGxldGVkU3VjY2VzcycsIEpTT04uc3RyaW5naWZ5KGRhdGEpKQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkR2V0RW50cmllc0NvbXBsZXRlZFN1Y2Nlc3MnLCAnJykKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkR2V0RW50cmllc0NvbXBsZXRlZEZhaWxlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmxlYWRlcmJvYXJkU2hvd05hdGl2ZVBvcHVwID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5sZWFkZXJib2FyZC5zaG93TmF0aXZlUG9wdXAob3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZFNob3dOYXRpdmVQb3B1cENvbXBsZXRlZCcsICd0cnVlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZFNob3dOYXRpdmVQb3B1cENvbXBsZXRlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldElzUGF5bWVudHNTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGF5bWVudHMuaXNTdXBwb3J0ZWQudG9TdHJpbmcoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cucGF5bWVudHNQdXJjaGFzZSA9IGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgICAgICAgICBicmlkZ2UucGF5bWVudHMucHVyY2hhc2UoaWQpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblBheW1lbnRzUHVyY2hhc2VDb21wbGV0ZWQnLCBkYXRhKQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblBheW1lbnRzUHVyY2hhc2VDb21wbGV0ZWQnLCAnJykKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblBheW1lbnRzUHVyY2hhc2VGYWlsZWQnLCAnJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cucGF5bWVudHNDb25zdW1lUHVyY2hhc2UgPSBmdW5jdGlvbihpZCkgewogICAgICAgICAgICAgICAgYnJpZGdlLnBheW1lbnRzLmNvbnN1bWVQdXJjaGFzZShpZCkKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25QYXltZW50c0NvbnN1bWVQdXJjaGFzZUNvbXBsZXRlZCcsICd0cnVlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25QYXltZW50c0NvbnN1bWVQdXJjaGFzZUNvbXBsZXRlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LnBheW1lbnRzR2V0Q2F0YWxvZyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgYnJpZGdlLnBheW1lbnRzLmdldENhdGFsb2coKQogICAgICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25QYXltZW50c0dldENhdGFsb2dDb21wbGV0ZWRTdWNjZXNzJywgZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25QYXltZW50c0dldENhdGFsb2dDb21wbGV0ZWRTdWNjZXNzJywgJycpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25QYXltZW50c0dldENhdGFsb2dDb21wbGV0ZWRGYWlsZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5wYXltZW50c0dldFB1cmNoYXNlcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgYnJpZGdlLnBheW1lbnRzLmdldFB1cmNoYXNlcygpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblBheW1lbnRzR2V0UHVyY2hhc2VzQ29tcGxldGVkU3VjY2VzcycsIGRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUGF5bWVudHNHZXRQdXJjaGFzZXNDb21wbGV0ZWRTdWNjZXNzJywgJycpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25QYXltZW50c0dldFB1cmNoYXNlc0NvbXBsZXRlZEZhaWxlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldElzUmVtb3RlQ29uZmlnU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnJlbW90ZUNvbmZpZy5pc1N1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5yZW1vdGVDb25maWdHZXQgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJpZGdlLnJlbW90ZUNvbmZpZy5nZXQob3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25SZW1vdGVDb25maWdHZXRTdWNjZXNzJywgZGF0YSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25SZW1vdGVDb25maWdHZXRGYWlsZWQnLCAnJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0SXNBY2hpZXZlbWVudHNTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UuYWNoaWV2ZW1lbnRzLmlzU3VwcG9ydGVkLnRvU3RyaW5nKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldElzR2V0QWNoaWV2ZW1lbnRzTGlzdFN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5hY2hpZXZlbWVudHMuaXNHZXRMaXN0U3VwcG9ydGVkLnRvU3RyaW5nKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldElzQWNoaWV2ZW1lbnRzTmF0aXZlUG9wdXBTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UuYWNoaWV2ZW1lbnRzLmlzTmF0aXZlUG9wdXBTdXBwb3J0ZWQudG9TdHJpbmcoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuYWNoaWV2ZW1lbnRzVW5sb2NrID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5hY2hpZXZlbWVudHMudW5sb2NrKG9wdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQWNoaWV2ZW1lbnRzVW5sb2NrQ29tcGxldGVkJywgJ3RydWUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFjaGlldmVtZW50c1VubG9ja0NvbXBsZXRlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmFjaGlldmVtZW50c1Nob3dOYXRpdmVQb3B1cCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYnJpZGdlLmFjaGlldmVtZW50cy5zaG93TmF0aXZlUG9wdXAob3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25BY2hpZXZlbWVudHNTaG93TmF0aXZlUG9wdXBDb21wbGV0ZWQnLCAndHJ1ZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQWNoaWV2ZW1lbnRzU2hvd05hdGl2ZVBvcHVwQ29tcGxldGVkJywgJ2ZhbHNlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuYWNoaWV2ZW1lbnRzR2V0TGlzdCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmlkZ2UuYWNoaWV2ZW1lbnRzLmdldExpc3Qob3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gSlNPTi5zdHJpbmdpZnkoZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQWNoaWV2ZW1lbnRzR2V0TGlzdENvbXBsZXRlZFN1Y2Nlc3MnLCBkYXRhKQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFjaGlldmVtZW50c0dldExpc3RDb21wbGV0ZWRTdWNjZXNzJywgJycpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25BY2hpZXZlbWVudHNHZXRMaXN0Q29tcGxldGVkRmFpbGVkJywgJ2ZhbHNlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPgo=";
