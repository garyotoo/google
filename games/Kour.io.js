window.game = "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuLXVzIiBpZD0ibWFpbmh0bWwiPgo8aGVhZD4KCgk8YmFzZSBocmVmID0gImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9Qb2sxMmQvdGFAbWFpbi9rb3VyLyI+CgoKCiAgICA8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPWVkZ2UiPgogICAgPCEtLSBLT1VSIFZBTklMTEErQ0cgVkVSU0lPTiAtLT4KICAgIDwhLS0gR29vZ2xlIHRhZyAoZ3RhZy5qcykgLS0+CiAgICA8c2NyaXB0IGFzeW5jIHNyYz0iaHR0cHM6Ly93d3cuZ29vZ2xldGFnbWFuYWdlci5jb20vZ3RhZy9qcz9pZD1HLVZHVlAwODVRTVMiPjwvc2NyaXB0PgogICAgPHNjcmlwdD4KICAgICAgICBjb25zdCBpc0Rpc2NvcmQgPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUuaW5jbHVkZXMoJ2Rpc2NvcmQnKTsKICAgICAgICBmdW5jdGlvbiBnZXRBc3NldFVybChwYXRoKSB7CiAgICAgICAgICAgIHJldHVybiBpc0Rpc2NvcmQgPyAnLy5wcm94eS9rb3VyLycgKyBwYXRoIDogJ2h0dHBzOi8va291ci5pby8nICsgcGF0aDsKICAgICAgICB9CiAgICAgICAgaWYgKGlzRGlzY29yZCkgewogICAgICAgICAgICBjb25zdCBpZHNUb1JlbW92ZSA9IFsnZGF0YS1saW5rJywgJ2ZyYW1ld29yay1saW5rJywgJ2NvZGUtbGluayddOwogICAgICAgICAgICBpZHNUb1JlbW92ZS5mb3JFYWNoKGlkID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgICAgICAgICAgaWYgKGVsKSB7CiAgICAgICAgICAgICAgICAgICAgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFJlbW92ZWQgcHJlbG9hZCB0YWc6ICR7aWR9YCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICB2YXIgdW5pdHlJbnN0YW5jZVdyYXBwZXIgPSB7CiAgICAgICAgICAgIHNlbmRNZXNzYWdlOiBmdW5jdGlvbihvYmplY3ROYW1lLCBtZXRob2ROYW1lLCBtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy51bml0eUluc3RhbmNlICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cudW5pdHlJbnN0YW5jZSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy51bml0eUluc3RhbmNlLlNlbmRNZXNzYWdlKG9iamVjdE5hbWUsIG1ldGhvZE5hbWUsIG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYGNhbm5vdCBjYWxsICR7bWV0aG9kTmFtZX1gKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gaGFzUXVlcnlQYXJhbShwYXJhbSkgewogICAgICAgICAgICBjb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpOwogICAgICAgICAgICByZXR1cm4gdXJsUGFyYW1zLmhhcyhwYXJhbSkgJiYgdXJsUGFyYW1zLmdldChwYXJhbSkgPT09ICd0cnVlJzsKICAgICAgICB9CiAgICAgICAgd2luZG93LnNka1ZlcnNpb24gPSBoYXNRdWVyeVBhcmFtKCdjZycpID8gJ0NyYXp5R2FtZXMnIDogJ1ZhbmlsbGEnOwogICAgICAgIGZ1bmN0aW9uIHBvc3REYXRhKHVybCwgZGF0YSwgYXN5bmMgPSB0cnVlKSB7CiAgICAgICAgICAgIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgICAgICB4aHIub3BlbignUE9TVCcsIHVybCwgYXN5bmMpOwogICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKICAgICAgICAgICAgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiByZXF1ZXN0TmV3VmVyc2lvbigpIHsKICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKHRydWUpOwogICAgICAgIH0KICAgICAgICB3aW5kb3cuYWxlcnQgPSBmdW5jdGlvbiAoKSB7IH07CiAgICAgICAgd2luZG93LmRhdGFMYXllciA9IHdpbmRvdy5kYXRhTGF5ZXIgfHwgW107CiAgICAgICAgZnVuY3Rpb24gZ3RhZygpIHsgZGF0YUxheWVyLnB1c2goYXJndW1lbnRzKTsgfQogICAgICAgIGd0YWcoJ2pzJywgbmV3IERhdGUoKSk7CiAgICAgICAgZ3RhZygnY29uZmlnJywgJ0ctVkdWUDA4NVFNUycpOwogICAgICAgIGZ1bmN0aW9uIHJlcG9ydExvYWRpbmdTdGFydCgpIHsKICAgICAgICAgICAgLy9mb3IgY2cgLSBzZGtHYW1lTG9hZGluZ1N0YXJ0IGlzIGNhbGxlZCByaWdodCBhZnRlciB0aGUgY2cgc2NyaXB0IGluaXRpYWxpemVzLgogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiByZXBvcnRWaWRlb0FkU291cmNlKHNvdXJjZSkge30KICAgICAgICBmdW5jdGlvbiByZXBvcnRMb2FkaW5nRmluaXNoZWQoKSB7CiAgICAgICAgICAgIHZhciBiYW5ycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmdWxsc2NyZWVuLWJhbnJzIik7CiAgICAgICAgICAgIGlmIChiYW5ycykKICAgICAgICAgICAgICAgIGJhbnJzLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5DcmF6eUdhbWVzLlNESy5nYW1lLmxvYWRpbmdTdG9wKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggeyB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJlcG9ydEN1c3RvbShyZXBvcnRFdmVudE5hbWUsIHNka1ZlcnNpb24pIHsKICAgICAgICAgICAgZ3RhZygnZXZlbnQnLCByZXBvcnRFdmVudE5hbWUsIHsKICAgICAgICAgICAgICAgICdldmVudF9jYXRlZ29yeSc6ICdpbnRlcmFjdGlvbicsCiAgICAgICAgICAgICAgICAnZXZlbnRfbGFiZWwnOiBzZGtWZXJzaW9uCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIDwvc2NyaXB0PgogICAgPGxpbmsgcmVsPSJtYW5pZmVzdCIgaHJlZj0ibWFuaWZlc3Qud2VibWFuaWZlc3QiPgogICAgCiAgICAKICAgIDxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+QGZvbnQtZmFjZSB7Zm9udC1mYW1pbHk6VlQzMjM7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC13ZWlnaHQ6NDAwO3NyYzp1cmwoL2NmLWZvbnRzL3MvdnQzMjMvNS4wLjExL2xhdGluLzQwMC9ub3JtYWwud29mZjIpO3VuaWNvZGUtcmFuZ2U6VSswMDAwLTAwRkYsVSswMTMxLFUrMDE1Mi0wMTUzLFUrMDJCQi0wMkJDLFUrMDJDNixVKzAyREEsVSswMkRDLFUrMDMwNCxVKzAzMDgsVSswMzI5LFUrMjAwMC0yMDZGLFUrMjA3NCxVKzIwQUMsVSsyMTIyLFUrMjE5MSxVKzIxOTMsVSsyMjEyLFUrMjIxNSxVK0ZFRkYsVStGRkZEO2ZvbnQtZGlzcGxheTpzd2FwO31AZm9udC1mYWNlIHtmb250LWZhbWlseTpWVDMyMztmb250LXN0eWxlOm5vcm1hbDtmb250LXdlaWdodDo0MDA7c3JjOnVybCgvY2YtZm9udHMvcy92dDMyMy81LjAuMTEvbGF0aW4tZXh0LzQwMC9ub3JtYWwud29mZjIpO3VuaWNvZGUtcmFuZ2U6VSswMTAwLTAyQUYsVSswMzA0LFUrMDMwOCxVKzAzMjksVSsxRTAwLTFFOUYsVSsxRUYyLTFFRkYsVSsyMDIwLFUrMjBBMC0yMEFCLFUrMjBBRC0yMENGLFUrMjExMyxVKzJDNjAtMkM3RixVK0E3MjAtQTdGRjtmb250LWRpc3BsYXk6c3dhcDt9QGZvbnQtZmFjZSB7Zm9udC1mYW1pbHk6VlQzMjM7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC13ZWlnaHQ6NDAwO3NyYzp1cmwoL2NmLWZvbnRzL3MvdnQzMjMvNS4wLjExL3ZpZXRuYW1lc2UvNDAwL25vcm1hbC53b2ZmMik7dW5pY29kZS1yYW5nZTpVKzAxMDItMDEwMyxVKzAxMTAtMDExMSxVKzAxMjgtMDEyOSxVKzAxNjgtMDE2OSxVKzAxQTAtMDFBMSxVKzAxQUYtMDFCMCxVKzAzMDAtMDMwMSxVKzAzMDMtMDMwNCxVKzAzMDgtMDMwOSxVKzAzMjMsVSswMzI5LFUrMUVBMC0xRUY5LFUrMjBBQjtmb250LWRpc3BsYXk6c3dhcDt9PC9zdHlsZT4KICAgIDxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ij4KICAgIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCB1c2VyLXNjYWxhYmxlPW5vIj4KICAgCiAgICAKICAgIDxzdHlsZT4KCWh0bWwgewogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKfQoqLCAqOmJlZm9yZSwgKjphZnRlciB7CiAgICBib3gtc2l6aW5nOiBpbmhlcml0Owp9Cmh0bWwsIGJvZHkgewogICAgaGVpZ2h0OiAxMDAlOwp9CmNhbnZhcyB7CiAgICBkaXNwbGF5OiBibG9jazsKfQpib2R5IHsKICAgIG1hcmdpbjogMDsKICAgIHBhZGRpbmc6IDA7CiAgICBvdmVyZmxvdzogaGlkZGVuOwp9CiN1bml0eS1jb250YWluZXIgewogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDEwMCU7Cn0KI3VuaXR5LWNhbnZhcyB7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogMTAwJTsKICAgIAp9CiNsb2FkaW5nLWNvdmVyIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsKICAgIGxlZnQ6IDA7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogMTAwJTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZDlhNTM0OwogICAgYmFja2dyb3VuZC1zaXplOiBjb3ZlcjsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKfQojbG9hZGluZy1jb3Zlci0yIHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAxMDAlOwogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCdiYWNrZ3JvdW5kMi53ZWJwJyk7CiAgICBiYWNrZ3JvdW5kLXNpemU6IGNvdmVyOwogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwogICAgb3BhY2l0eTogMDsKICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMXMgZWFzZS1pbi1vdXQsIHZpc2liaWxpdHkgMXMgZWFzZS1pbi1vdXQ7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7CiAgICBsZWZ0OiAwOwp9CiN1bml0eS1sb2FkaW5nLWJhciB7CiAgICBmbGV4OiAxIDEgYXV0bzsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBsZWZ0OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHdpZHRoOiA0MCU7CiAgICBib3R0b206IDQ1JTsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIG1hcmdpbjogMCBhdXRvOwp9CiN1bml0eS1sb2FkaW5nLWJhci1mYXN0IHsKICAgIGZsZXg6IDEgMSBhdXRvOwogICAgZGlzcGxheTogbm9uZTsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGxlZnQ7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgd2lkdGg6IDQwJTsKICAgIGJvdHRvbTogNDUlOwogICAgcG9zaXRpb246IGFic29sdXRlOwp9CgojdW5pdHktcHJvZ3Jlc3MtYmFyLWVtcHR5IHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAyNHB4OwogICAgLyptYXJnaW46IDEwcHggMjBweCAyMHB4IDEwcHg7Ki8KICAgIHRleHQtYWxpZ246IGxlZnQ7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNSk7CiAgICAvKmJvcmRlcjogMnB4IHNvbGlkICNmZmZmZmY7Ki8KICAgIC8qcGFkZGluZzogMnB4OyovCn0KI3VuaXR5LXByb2dyZXNzLWJhci1mdWxsIHsKICAgIHdpZHRoOiAwJTsKICAgIGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQ6ICNmZmZmZmY7Cn0KLnNwaW5uZXIsCi5zcGlubmVyOmFmdGVyIHsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgd2lkdGg6IDVlbTsKICBoZWlnaHQ6IDVlbTsKfQouc3Bpbm5lciB7CiAgbWFyZ2luOiAxMHB4OwogIGZvbnQtc2l6ZTogMTBweDsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgdGV4dC1pbmRlbnQ6IC05OTk5ZW07CiAgYm9yZGVyLXRvcDogMS4xZW0gc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpOwogIGJvcmRlci1yaWdodDogMS4xZW0gc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpOwogIGJvcmRlci1ib3R0b206IDEuMWVtIHNvbGlkIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yKTsKICBib3JkZXItbGVmdDogMS4xZW0gc29saWQgI2ZmZmZmZjsKICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVooMCk7CiAgYW5pbWF0aW9uOiBzcGlubmVyLXNwaW4gMS4xcyBpbmZpbml0ZSBsaW5lYXI7Cn0KQGtleWZyYW1lcyBzcGlubmVyLXNwaW4gewogIDAlIHsKICAgIHRyYW5zZm9ybTogcm90YXRlKDBkZWcpOwogIH0KICAxMDAlIHsKICAgIHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7CiAgfQp9CkBrZXlmcmFtZXMgc2hha2UgewogICAgMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMSwgMSk7CiAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMSk7IH0gICAKICAgIDUwJSB7IHRyYW5zZm9ybTogc2NhbGUoMSwgMS4xKTsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgtMSk7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMSwgMSk7IAogICAgICAgIHRyYW5zZm9ybTogcm90YXRlKC0xKTsgfQp9CgpAa2V5ZnJhbWVzIHRleHRjbGlwIHsKICB0byB7CiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAyMDAlIGNlbnRlcjsKICB9Cn0KLnJvdGF0ZS1tZXNzYWdlIHsKICAgIGRpc3BsYXk6IG5vbmU7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7CiAgICBsZWZ0OiAwOwogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuOCk7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICB6LWluZGV4OiA5OTk7Cn0KLnJvdGF0ZS1tZXNzYWdlIHAgewogICAgY29sb3I6IHdoaXRlOwogICAgZm9udC1zaXplOiAyNHB4OwogICAgbWFyZ2luLXRvcDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MCUpOwogICAgZm9udC1mYW1pbHk6ICdGamFsbGEgT25lJywgc2Fucy1zZXJpZjsKICAgIHVzZXItc2VsZWN0OiBub25lOwp9Ci5mYXN0LWxvYWRlciB7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogMjRweDsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC40KTsKICAgIG92ZXJmbG93OiBoaWRkZW47Cn0KCiAgICAuZmFzdC1sb2FkZXI6OmFmdGVyIHsKICAgICAgICBjb250ZW50OiAnJzsKICAgICAgICB3aWR0aDogMTkycHg7CiAgICAgICAgaGVpZ2h0OiAyNHB4OwogICAgICAgIGJhY2tncm91bmQ6ICNGRkY7CiAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgIHRvcDogMDsKICAgICAgICBsZWZ0OiAwOwogICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgICAgYW5pbWF0aW9uOiBhbmltRmFzdGxvYWRlciAxcyBsaW5lYXIgaW5maW5pdGU7CiAgICB9CgpAa2V5ZnJhbWVzIGFuaW1GYXN0bG9hZGVyIHsKICAgIDAlIHsKICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKC0xMDAlLCAwLCAwKTsKICAgIH0KCiAgICAxMDAlIHsKICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDYwMCUsIDAsIDApOwogICAgfQp9Ci5rb3VyVGl0bGUgewogICAgd2lkdGg6IDE5LjElOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiA0NSU7CiAgICBsZWZ0OiA1MCU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7CiAgICB0cmFuc2Zvcm0tb3JpZ2luOiA1MCUgMCU7CiAgICB1c2VyLXNlbGVjdDogbm9uZTsKfQojbG9hZGluZ1R4dCB7CiAgICBmb250LWZhbWlseTogJ0ZqYWxsYSBPbmUnLCBzYW5zLXNlcmlmOwogICAgZm9udC1zaXplOiAxLjM1ZW07CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IGNhbGMoNTAlICsgNDBweCk7CiAgICBsZWZ0OiA1MCU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7CiAgICBjb2xvcjogd2hpdGU7CiAgICB1c2VyLXNlbGVjdDogbm9uZTsKICAgIHRleHQtc2hhZG93OiAycHggMnB4IDRweCAjMDAwMDAwOwogICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKfQojbG9hZGluZ1R4dE1pbmltYWwgewogICAgb3BhY2l0eTogMC43ODsKICAgIGZvbnQtZmFtaWx5OiAnRmphbGxhIE9uZScsIHNhbnMtc2VyaWY7CiAgICBmb250LXNpemU6IDFlbTsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogY2FsYyg1MCUgKyA3N3B4KTsKICAgIGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHVzZXItc2VsZWN0OiBub25lOwogICAgdGV4dC1zaGFkb3c6IDJweCAycHggNHB4ICMwMDAwMDA7CiAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwp9CkBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkgewogICAgLmtvdXJUaXRsZSB7CiAgICAgICAgd2lkdGg6IDM4LjIlOwogICAgICAgIGJvdHRvbTogY2FsYyg0NSUgKyAxMHB4KTsKICAgIH0KCiAgICAjbG9hZGluZ1R4dCB7CiAgICAgICAgdG9wOiBjYWxjKDUwJSArIDMwcHgpOwogICAgfQoKICAgICNsb2FkaW5nVHh0TWluaW1hbCB7CiAgICAgICAgdG9wOiBjYWxjKDUwJSArIDcwcHgpOwogICAgfQp9CkBtZWRpYSAobWF4LWhlaWdodDogMzUwcHgpIHsKICAgIC5rb3VyVGl0bGUgewogICAgICAgIGJvdHRvbTogY2FsYyg0NSUgKyAxMHB4KTsKICAgIH0KCiAgICAjbG9hZGluZ1R4dCB7CiAgICAgICAgdG9wOiBjYWxjKDUwJSArIDVweCk7CiAgICB9CgogICAgI2xvYWRpbmdUeHRNaW5pbWFsIHsKICAgICAgICB0b3A6IGNhbGMoNTAlICsgNDVweCk7CiAgICB9Cn0KI3JlZnJlc2hJbWFnZSB7CiAgICB1c2VyLXNlbGVjdDogbm9uZTsKICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgIGJvdHRvbTogLTEwMCU7CiAgICBsZWZ0OiA1MCU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSkgc2NhbGUoMC45NSk7CiAgICB0cmFuc2l0aW9uOiBib3R0b20gMXM7CiAgICBjdXJzb3I6IHBvaW50ZXI7Cn0KQG1lZGlhIChtYXgtd2lkdGg6IDYwMHB4KSB7CiAgICAjcmVmcmVzaEltYWdlIHsKICAgICAgICAvKiBDb21iaW5lIHRyYW5zbGF0ZVggYW5kIHNjYWxlIGluIHRoZSBzYW1lIHRyYW5zZm9ybSBwcm9wZXJ0eSAqLwogICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKSBzY2FsZSgwLjYpOwogICAgICAgIHRyYW5zZm9ybS1vcmlnaW46IGNlbnRlcjsKICAgIH0KfQoKQGtleWZyYW1lcyBzbGlkZVVwIHsKICAgIGZyb20gewogICAgICAgIGJvdHRvbTogLTEwMCU7CiAgICB9CgogICAgdG8gewogICAgICAgIGJvdHRvbTogMDsKICAgIH0KfQpAa2V5ZnJhbWVzIHNsaWRlRG93biB7CiAgICBmcm9tIHsKICAgICAgICBib3R0b206IDA7CiAgICB9CgogICAgdG8gewogICAgICAgIGJvdHRvbTogLTEwMCU7CiAgICB9Cn0KLmZhZGUtaW4gewogICAgYW5pbWF0aW9uOiBmYWRlSW4gMC4wNXMgZWFzZS1pbi1vdXQgZm9yd2FyZHM7Cn0KCi5mYWRlLW91dCB7CiAgICBhbmltYXRpb246IGZhZGVPdXQgMC4wNXMgZWFzZS1pbi1vdXQgZm9yd2FyZHM7Cn0KCkBrZXlmcmFtZXMgZmFkZUluIHsKICAgIDAlIHsKICAgICAgICBvcGFjaXR5OiAwOwogICAgfQoKICAgIDEwMCUgewogICAgICAgIG9wYWNpdHk6IDE7CiAgICB9Cn0KCkBrZXlmcmFtZXMgZmFkZU91dCB7CiAgICAwJSB7CiAgICAgICAgb3BhY2l0eTogMTsKICAgIH0KCiAgICAxMDAlIHsKICAgICAgICBvcGFjaXR5OiAwOwogICAgfQp9CiN1c2VQb3J0cmFpdEJ0biB7CiAgICBmb250LWZhbWlseTogJ0ZqYWxsYSBPbmUnLCBzYW5zLXNlcmlmOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgei1pbmRleDogMTAwMDsgLyogRW5zdXJlIGl0J3MgYWJvdmUgb3RoZXIgZWxlbWVudHMgYnV0IHVuZGVyIHRoZSByb3RhdGUgbWVzc2FnZSAqLwogICAgYm90dG9tOiAyMCU7IC8qIEFkanVzdCBiYXNlZCBvbiB5b3VyIGxheW91dCAqLwogICAgbGVmdDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpOyAvKiBDZW50ZXIgaXQgaG9yaXpvbnRhbGx5ICovCiAgICBwYWRkaW5nOiAxMHB4IDIwcHg7CiAgICBmb250LXNpemU6IDE2cHg7CiAgICBjb2xvcjogI0ZGRjsgLyogV2hpdGUgdGV4dCAqLwogICAgYmFja2dyb3VuZC1jb2xvcjogIzQ1NGE1MjsgLyogQm9vdHN0cmFwIHByaW1hcnkgYmx1ZSwgY2hhbmdlIGFzIG5lZWRlZCAqLwogICAgYm9yZGVyOiBub25lOwogICAgYm9yZGVyLXJhZGl1czogNXB4OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAwLjFzIGVhc2U7Cn0KCiN1c2VQb3J0cmFpdEJ0bjpob3ZlciB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjN2U4MTg3OyAvKiBBIGRhcmtlciBzaGFkZSBvZiBibHVlIG9uIGhvdmVyICovCn0KCgoubW9yZWdhbWVpbmZvLXNoYXJlIHsKICAgIGRpc3BsYXk6IG5vbmU7CiAgICB1c2VyLXNlbGVjdDogbm9uZTsKICAgIHRleHQtc2hhZG93OiAxcHggMXB4IDJweCByZ2JhKDAsIDAsIDAsIDAuNSk7CiAgICBnYXA6IDJweDsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgYmFja2dyb3VuZC1jb2xvcjogcmdiKDAsIDE0NSwgMjU1KTsKICAgIGJvcmRlcjogdHJhbnNwYXJlbnQgc29saWQ7CiAgICB3aWR0aDogMTMwcHg7CiAgICBoZWlnaHQ6IDMwcHg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgcGFkZGluZy1sZWZ0OiA1cHg7CiAgICBwYWRkaW5nLXJpZ2h0OiA1cHg7CiAgICBib3JkZXItcmFkaXVzOiAxMDBweDsKICAgIGNvbG9yOiByZ2IoMjU1LCAyNTUsIDI1NSk7CiAgICB0cmFuc2l0aW9uOiBlYXNlLWluLW91dCAwLjE1czsKICAgIGZvbnQtZmFtaWx5OiAnRmphbGxhIE9uZScsIHNhbnMtc2VyaWY7CiAgICBmb250LXdlaWdodDogNTAwOwogICAgdHJhbnNmb3JtOiBzY2FsZSgxKTsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgLyogT3IgJ2ZpeGVkJyBkZXBlbmRpbmcgb24geW91ciBuZWVkcyAqLwogICAgdG9wOiAyMHB4OwogICAgbGVmdDogNTAlOyAvKiBNb3ZlIHRvIDUwJSBvZiB0aGUgcGFyZW50J3Mgd2lkdGggKi8KICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsgLyogT2Zmc2V0IGJ5IGhhbGYgb2YgaXRzIG93biB3aWR0aCB0byBjZW50ZXIgKi8KfQoKLm1vcmVnYW1laW5mby1zaGFyZTpob3ZlciB7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICBjb2xvcjogYmxhY2s7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjU1LCAyNTUsIDI1NSk7CiAgICBvdXRsaW5lOiBzb2xpZCAycHggcmdiKDI1NSwgMjU1LCAyNTUpOwogICAgb3V0bGluZS1vZmZzZXQ6IDNweDsKfQogICAgLm1vcmVnYW1laW5mby1zaGFyZSBpbWcgewogICAgICAgIGZpbHRlcjogZHJvcC1zaGFkb3coMXB4IDFweCAycHggcmdiYSgwLCAwLCAwLCAwLjUpKTsKICAgICAgICBtYXJnaW4tbGVmdDogNXB4OwogICAgICAgIHdpZHRoOiAyMHB4OwogICAgfQoubW9yZWdhbWVpbmZvLXNoYXJlOmhvdmVyIGltZyB7CiAgICBmaWx0ZXI6IGludmVydCgxMDAlKTsKfQoKQG1lZGlhIChtYXgtd2lkdGg6IDc2N3B4KSB7CiAgICAucWMtY21wMi1jb250YWluZXIgewogICAgICAgIGRpc3BsYXk6IG5vbmU7IC8qIEhpZGVzIHRoZSBDTVAgY29udGFpbmVyIG9uIG1vYmlsZSBkZXZpY2VzICovCiAgICB9Cn0KCTwvc3R5bGU+CiAgIAogICAgPG1ldGEgY29udGVudD0iVGVtcGxhdGVEYXRhL2JhY2tncm91bmQtb2cud2VicCIgcHJvcGVydHk9Im9nOmltYWdlIiAvPgogICAgPG1ldGEgcHJvcGVydHk9Im9nOnVybCIgY29udGVudD0iaHR0cHM6Ly9rb3VyLmlvIiAvPgogICAgPG1ldGEgcHJvcGVydHk9Im9nOnR5cGUiIGNvbnRlbnQ9IndlYnNpdGUiIC8+CiAgICA8bWV0YSBwcm9wZXJ0eT0ib2c6aW1hZ2U6d2lkdGgiIGNvbnRlbnQ9IjE5MiI+CiAgICA8bWV0YSBwcm9wZXJ0eT0ib2c6aW1hZ2U6aGVpZ2h0IiBjb250ZW50PSIxMDgiPgogICAgPG1ldGEgcHJvcGVydHk9Im9nOnNpdGVfbmFtZSIgY29udGVudD0iS291ci5pbyIgLz4KICAgIDxtZXRhIG5hbWU9InR3aXR0ZXI6Y2FyZCIgY29udGVudD0ic3VtbWFyeV9sYXJnZV9pbWFnZSI+CiAgICA8bWV0YSBuYW1lPSJ0d2l0dGVyOnRpdGxlIiBjb250ZW50PSJLb3VyLmlvIHwgRlBTICI+CiAgICA8bWV0YSBuYW1lPSJ0d2l0dGVyOmltYWdlIiBjb250ZW50PSJUZW1wbGF0ZURhdGEvYmFja2dyb3VuZC1vZy53ZWJwIj4KICAgIDxtZXRhIG5hbWU9InR3aXR0ZXI6dXJsIiBjb250ZW50PSJodHRwczovL2tvdXIuaW8iPgogICAgPG1ldGEgY29udGVudD0iI2ZmZDkwMCIgZGF0YS1yZWFjdC1oZWxtZXQ9InRydWUiIG5hbWU9InRoZW1lLWNvbG9yIiAvPgogICAgPHN0eWxlPgogICAgICAgIEBpbXBvcnQgdXJsKCdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PUZqYWxsYStPbmUmZGlzcGxheT1zd2FwJyk7CiAgICA8L3N0eWxlPgogICAgPG1ldGEgbmFtZT0iYXBwbGUtbW9iaWxlLXdlYi1hcHAtdGl0bGUiIGNvbnRlbnQ9IktvdXIuaW8iPgogICAgPG1ldGEgbmFtZT0iYXBwbGUtbW9iaWxlLXdlYi1hcHAtY2FwYWJsZSIgY29udGVudD0ieWVzIj4KICAgIDxtZXRhIG5hbWU9ImFwcGxlLW1vYmlsZS13ZWItYXBwLXN0YXR1cy1iYXItc3R5bGUiIGNvbnRlbnQ9ImJsYWNrLXRyYW5zbHVjZW50Ij4KICAgIDxsaW5rIHJlbD0icHJlbG9hZCIgaHJlZj0iVGVtcGxhdGVEYXRhL2JhY2tncm91bmQud2VicCIgYXM9ImltYWdlIj4KICAgIDxtZXRhIGl0ZW1wcm9wPSJpbWFnZSBwcmltYXJ5SW1hZ2VPZlBhZ2UiIGNvbnRlbnQ9IlRlbXBsYXRlRGF0YS9iYWNrZ3JvdW5kLndlYnAiPgogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2FwaS5qcyIgYXN5bmMgZGVmZXI+PC9zY3JpcHQ+CiAgICA8IS0tIFlvdXR1YmUgIFNjaGVtYSAtLT4KICAgIDxzY3JpcHQgdHlwZT0iYXBwbGljYXRpb24vbGQranNvbiI+CiAgICAgICAgewogICAgICAgICAgICAiQGNvbnRleHQiOiAiaHR0cDovL3NjaGVtYS5vcmciLAogICAgICAgICAgICAiQHR5cGUiOiJWaWRlb0dhbWUiLAogICAgICAgICAgICAicHVibGlzaGVyIjogIkxlZ2lvbiBQbGF0Zm9ybXMiLAogICAgICAgICAgICAibmFtZSI6WwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJAbGFuZ3VhZ2UiOiJlbiIsCiAgICAgICAgICAgICAgICAgICAgIkB2YWx1ZSI6IktvdXIuaW8iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6WwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJAbGFuZ3VhZ2UiOiJlbiIsCiAgICAgICAgICAgICAgICAgICAgIkB2YWx1ZSI6IktvdXIuaW8gaXMgYSBmcmVlIE11bHRpcGxheWVyIE9ubGluZSBGUFMgLiBObyBEb3dubG9hZCBuZWVkZWQhIEJlY29tZSB0aGUgIzEgS291ciBwbGF5ZXIgdG9kYXkgaW4gdGhpcyBmaXJzdC1wZXJzb24gc2hvb3RlciBJTyBLb3VyIC4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJhcHBsaWNhdGlvbkNhdGVnb3J5IjpbCiAgICAgICAgICAgICAgICAiR2FtZSIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgIm9wZXJhdGluZ1N5c3RlbSI6WwogICAgICAgICAgICAgICAgIldFQiIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgImdlbnJlIjpbCiAgICAgICAgICAgICAgICAiU2hvb3RlciIsCiAgICAgICAgICAgICAgICAiTXVsdGlwbGF5ZXIiCiAgICAgICAgICAgICAgICAiRlBTIiwKICAgICAgICAgICAgICAgICJDU0dPIiwKICAgICAgICAgICAgICAgICJCYXR0bGUgUm95YWxlIiwKICAgICAgICAgICAgICAgICJDb3VudGVyIFN0cmlrZSIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgInVybCI6Imh0dHBzOi8va291ci5pby8iLAogICAgICAgICAgICAiaW1hZ2UiOiJUZW1wbGF0ZURhdGEvYmFja2dyb3VuZC53ZWJwIiwKICAgICAgICAgICAgInNjcmVlbnNob3QiOiJUZW1wbGF0ZURhdGEvYmFja2dyb3VuZC53ZWJwIgogICAgICAgIH0KICAgIDwvc2NyaXB0Pgo8L2hlYWQ+Cjxib2R5IGNsYXNzPSJkYXJrIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogYmxhY2s7Ij4KCiAgICA8IS0tIER5bmFtaWMgRGlzY29yZCBTREsgTG9hZGVyIC0tPgogICAgPHNjcmlwdD4KICAgICAgICBjb25zdCB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgICB2YXIgdW5pdHlMb2FkaW5nSXNTREtEZXBlbmRhbnQgPSBmYWxzZTsKCiAgICAgICAgaWYgKHVybC5pbmNsdWRlcygiZGlzY29yZCIpKSB7CiAgICAgICAgICAgIHVuaXR5TG9hZGluZ0lzU0RLRGVwZW5kYW50ID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3Qgc2RrU2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgICAgICAgICAgIHNka1NjcmlwdC5zcmMgPSAiZGlzY29yZF9zZGsuanMiOwogICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNka1NjcmlwdCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB3YWl0Rm9yU0RLVGhlblN0YXJ0KGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGNvbnN0IG1heFdhaXQgPSAxMDAwMDsKICAgICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSAxMDsKICAgICAgICAgICAgbGV0IHdhaXRlZCA9IDA7CgogICAgICAgICAgICBpZiAoIXVuaXR5TG9hZGluZ0lzU0RLRGVwZW5kYW50KSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBjaGVjayA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuU0RLICYmIHR5cGVvZiB3aW5kb3cuU0RLLmdldEJ1aWxkVVJMID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3YWl0ZWQgPj0gbWF4V2FpdCkgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJTREsgbm90IGF2YWlsYWJsZSBpbiB0aW1lLCBwcm9jZWVkaW5nIGFueXdheS4iKTsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgd2FpdGVkICs9IGludGVydmFsOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChjaGVjaywgaW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBjaGVjaygpOwogICAgICAgIH0KCiAgICA8L3NjcmlwdD4KICAgIDwhLS0gRW5kIER5bmFtaWMgU0RLIExvYWRlciAtLT4KCiAgICA8c2NyaXB0PgogICAgICAgIGlmICh3aW5kb3cuc2RrVmVyc2lvbiA9PT0gIkNyYXp5R2FtZXMiKSB7CiAgICAgICAgICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgICAgICAgICBzY3JpcHQuc3JjID0gJ2NyYXp5Z2FtZXMtc2RrLXYzLWRvbmUuanMnOwogICAgICAgICAgICBzY3JpcHQub25sb2FkID0gYXN5bmMgZnVuY3Rpb24oKSB7IC8vIE1ha2UgdGhpcyBmdW5jdGlvbiBhc3luYwogICAgICAgICAgICAgICAgLy8gT25jZSB0aGUgc2NyaXB0IGxvYWRzLCBpbml0aWFsaXplIHRoZSBTREsgYW5kIGNhbGwgc2RrR2FtZUxvYWRpbmdTdGFydAogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5DcmF6eUdhbWVzICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2Ygd2luZG93LkNyYXp5R2FtZXMuU0RLICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB3aW5kb3cuQ3JhenlHYW1lcy5TREsuaW5pdCgpOyAvLyBJbml0aWFsaXplIHRoZSBTREsgaGVyZQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuQ3JhenlHYW1lcy5TREsuZ2FtZS5sb2FkaW5nU3RhcnQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5DcmF6eUdhbWVzLlNESy51c2VyLmFkZEF1dGhMaXN0ZW5lcigoY3JhenlVc2VyKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiVXNlciBjaGFuZ2VkIiwgY3JhenlVc2VyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjcmF6eVVzZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmhhbmRsZUNyYXp5R2FtZXNVc2VyKGNyYXp5VXNlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJDcmF6eUdhbWVzIFNESyBpcyBub3QgZGVmaW5lZC4iKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGR1cmluZyBDcmF6eUdhbWVzIFNESyBpbml0aWFsaXphdGlvbjoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgICAgICB9CiAgICAgICAgZWxzZSAKICAgICAgICB7CiAgICAgICAgICAgIGNvbnN0IGFkaW5wbGF5U2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAgICAgICAgIGFkaW5wbGF5U2NyaXB0LnNyYyA9ICcvL2FwaS5hZGlucGxheS5jb20vbGlicy9haXB0YWcvcHViL0xHUC9rb3VyLmlvL3RhZy5taW4uanMnOwogICAgICAgICAgICBhZGlucGxheVNjcmlwdC5hc3luYyA9IHRydWU7CiAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoYWRpbnBsYXlTY3JpcHQpOwogICAgICAgICAgICBjb25zdCBhaXB0YWdTY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICAgICAgYWlwdGFnU2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsKICAgICAgICAgICAgYWlwdGFnU2NyaXB0LmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgIHdpbmRvdy5haXB0YWcgPSB3aW5kb3cuYWlwdGFnIHx8IHsgY21kOiBbXSB9OwogICAgICAgICAgICAgICAgYWlwdGFnLmNtZC5kaXNwbGF5ID0gYWlwdGFnLmNtZC5kaXNwbGF5IHx8IFtdOwogICAgICAgICAgICAgICAgYWlwdGFnLmNtZC5wbGF5ZXIgPSBhaXB0YWcuY21kLnBsYXllciB8fCBbXTsKICAgICAgICAgICAgICAgIGFpcHRhZy5jbXAgPSB7CiAgICAgICAgICAgICAgICAgICAgc2hvdzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJjZW50ZXJlZCIsCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBidXR0b25UZXh0OiAiUHJpdmFjeSBzZXR0aW5ncyIsCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uUG9zaXRpb246ICJib3R0b20tbGVmdCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGFpcHRhZy5jbWQucGxheWVyLnB1c2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGFpcHRhZy5hZHBsYXllciA9IG5ldyBhaXBQbGF5ZXIoewogICAgICAgICAgICAgICAgICAgICAgICBBRF9XSURUSDogOTYwLAogICAgICAgICAgICAgICAgICAgICAgICBBRF9IRUlHSFQ6IDU0MCwKICAgICAgICAgICAgICAgICAgICAgICAgQURfRElTUExBWTogJ2NlbnRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgIExPQURJTkdfVEVYVDogJ2xvYWRpbmcgYWR2ZXJ0aXNlbWVudCcsCiAgICAgICAgICAgICAgICAgICAgICAgIFBSRVJPTExfRUxFTTogZnVuY3Rpb24gKCkgeyByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZGVvYWQnKSB9LAogICAgICAgICAgICAgICAgICAgICAgICBBSVBfQ09NUExFVEU6IGZ1bmN0aW9uIChzdGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlZpZGVvIEFkIENvbXBsZXRlZDogIiArIHN0YXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBmYWlsdXJlIGNvbmRpdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvd2VyQ2FzZVN0YXRlID0gc3RhdGUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb3dlckNhc2VTdGF0ZS5pbmNsdWRlcygiYWRibG9jayIpIHx8IGxvd2VyQ2FzZVN0YXRlLmluY2x1ZGVzKCJmYWlsZWQiKSB8fCBsb3dlckNhc2VTdGF0ZS5pbmNsdWRlcygiZXJyb3IiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJ0cmlnZ2VyaW5nIGZhbGxiYWNrVG9TdGFyLi4uIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImFkaW5wbGF5IGZhaWxlZCwgd2lsbCB0cnkgY3Btc3RhciIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mYWxsYmFja1RvU3RhcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9hbGwgZ29vZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXR5SW5zdGFuY2VXcmFwcGVyLnNlbmRNZXNzYWdlKCdNYWluTWFuYWdlcicsICdPbkRhUmV2ZXJlc2VkRmluaXNoZWRKUycsIHN0YXRlLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgYDsKICAgICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChhaXB0YWdTY3JpcHQpOwogICAgICAgICAgICAvL2FkaW5wbGF5IGVuZC4KICAgICAgICAgICAgLy9jcG1zdGFyIHN0YXJ0CiAgICAgICAgICAgIC8vIDwhLS0gWk9ORVRBRyAtIFBMQUNFIElOVE8gSEVBRCBTRUNUSU9OIE9SIFJVTiBDT0RFIEFUIFNUQVJUVVAgLS0+CiAgICAgICAgICAgIChmdW5jdGlvbiAoem9uZWZpbGUpIHsKICAgICAgICAgICAgICAgIHZhciB5ID0gImNwbXN0YXJ4IjsKICAgICAgICAgICAgICAgIHZhciBkcnV0T2JqID0gd2luZG93W3ldID0gd2luZG93W3ldIHx8IHt9OwogICAgICAgICAgICAgICAgZnVuY3Rpb24gZmFpbENwbXN0YXJBUEkoKSB7IHZhciBmYWlsRm4gPSBmdW5jdGlvbiAobykgeyBvICYmIHR5cGVvZiAobykgPT09ICJvYmplY3QiICYmIG8uZmFpbCAmJiBvLmZhaWwoKTsgfTsgZHJ1dE9iaiAmJiBBcnJheS5pc0FycmF5KGRydXRPYmouY21kKSAmJiBkcnV0T2JqLmNtZC5mb3JFYWNoKGZhaWxGbikgJiYgKGRydXRPYmouY21kLmxlbmd0aCA9IDApOyB3aW5kb3cuY3Btc3RhckFQSSA9IHdpbmRvd1siXyIgKyB6b25lZmlsZV0gPSBmYWlsRm47IH0KICAgICAgICAgICAgICAgIHZhciBybmQgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiA5OTk5OTkpOwogICAgICAgICAgICAgICAgdmFyIHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgcy50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IHMuYXN5bmMgPSB0cnVlOyBzLm9uZXJyb3IgPSBmYWlsQ3Btc3RhckFQSTsKICAgICAgICAgICAgICAgIHZhciBwcm90byA9IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sOwogICAgICAgICAgICAgICAgdmFyIGhvc3QgPSAocHJvdG8gPT0gImh0dHBzOiIgfHwgcHJvdG8gPT0gImZpbGU6IikgPyAiaHR0cHM6Ly9zZXJ2ZXIiIDogIi8vY2RuIjsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaGFzaCA9PSAiI2NwbXN0YXJEZXYiKSBob3N0ID0gIi8vZGV2LnNlcnZlciI7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhhc2ggPT0gIiNjcG1zdGFyU3RhZ2luZyIpIGhvc3QgPSAiLy9zdGFnaW5nLnNlcnZlciI7CiAgICAgICAgICAgICAgICBzLnNyYyA9IGhvc3QgKyAiLmNwbXN0YXIuY29tL2NhY2hlZC96b25lZmlsZXMvIiArIHpvbmVmaWxlICsgIi5qcz9ybmQ9IiArIHJuZDsKICAgICAgICAgICAgICAgIHZhciBzMiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKVswXTsKICAgICAgICAgICAgICAgIHMyLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHMsIHMyKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5jcG1zdGFyQVBJID0gZnVuY3Rpb24gKG8pIHsgKGRydXRPYmouY21kID0gZHJ1dE9iai5jbWQgfHwgW10pLnB1c2gobyk7IH0KICAgICAgICAgICAgfSgnMTEzN181NDEwNV9nYW1lYXBpJykpOwogICAgICAgIH0KICAgIDwvc2NyaXB0PgogICAgPHNjcmlwdD4KCiAgICAgICAgd2luZG93LmlzTW91c2VMb2NrZWQgPSBmYWxzZTsKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIGlmICh3aW5kb3cuaXNNb3VzZUxvY2tlZCAmJiAoZXZlbnQua2V5Q29kZSA9PT0gMTE2IHx8IGV2ZW50LmtleUNvZGUgPT09IDgyICYmIGV2ZW50LmN0cmxLZXkpKSB7CiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgZnVuY3Rpb24gb3BlblBheW1lbnRTdGF0aW9uKHRva2VuKSB7CiAgICAgICAgICAgIC8vdmFyIHBheW1lbnRVcmwgPSBgaHR0cHM6Ly9zYW5kYm94LXNlY3VyZS54c29sbGEuY29tL3BheXN0YXRpb240Lz90b2tlbj0ke3Rva2VufWA7CiAgICAgICAgICAgIC8vd2luZG93Lm9wZW4ocGF5bWVudFVybCwgJ1BheW1lbnRTdGF0aW9uJywgJ3dpZHRoPTgwMCxoZWlnaHQ9NjAwJyk7CiAgICAgICAgICAgIHZhciBvcHRpb25zID0gewogICAgICAgICAgICAgICAgYWNjZXNzX3Rva2VuOiB0b2tlbgogICAgICAgICAgICAgICAgLy9zYW5kYm94OiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAgICAgICAgIHMudHlwZSA9ICJ0ZXh0L2phdmFzY3JpcHQiOwogICAgICAgICAgICBzLmFzeW5jID0gdHJ1ZTsKICAgICAgICAgICAgcy5zcmMgPSAiLy9jZG4ueHNvbGxhLm5ldC9lbWJlZC9wYXlzdGF0aW9uLzEuMi43L3dpZGdldC5taW4uanMiOwogICAgICAgICAgICBzLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coImluaXQgWFBheVN0YXRpb25XaWRnZXQiKTsKICAgICAgICAgICAgICAgIFhQYXlTdGF0aW9uV2lkZ2V0LmluaXQob3B0aW9ucyk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygib3BlbiBYUGF5U3RhdGlvbldpZGdldCIpOwogICAgICAgICAgICAgICAgWFBheVN0YXRpb25XaWRnZXQub3BlbigpOwoKICAgICAgICAgICAgICAgIFhQYXlTdGF0aW9uV2lkZ2V0Lm9uKFhQYXlTdGF0aW9uV2lkZ2V0LmV2ZW50VHlwZXMuU1RBVFVTLCBmdW5jdGlvbiAoZXZlbnQsIGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcGF5bWVudEluZm9Bc1N0cmluZyA9IEpTT04uc3RyaW5naWZ5KGRhdGEucGF5bWVudEluZm8pOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJqczogcGF5bWVudEluZm9Bc1N0cmluZzogIiArIHBheW1lbnRJbmZvQXNTdHJpbmcpOwogICAgICAgICAgICAgICAgICAgIHVuaXR5SW5zdGFuY2VXcmFwcGVyLnNlbmRNZXNzYWdlKCdYc29sbGFQYXltZW50cycsICdPblhzb2xsYVdpbmRvd1VwZGF0ZScsIHBheW1lbnRJbmZvQXNTdHJpbmcpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgWFBheVN0YXRpb25XaWRnZXQub24oWFBheVN0YXRpb25XaWRnZXQuZXZlbnRUeXBlcy5DTE9TRSwgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgdW5pdHlJbnN0YW5jZVdyYXBwZXIuc2VuZE1lc3NhZ2UoJ1hzb2xsYVBheW1lbnRzJywgJ09uWHNvbGxhV2luZG93VXBkYXRlJywgImNsb3NlZCIpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB9LCBmYWxzZSk7CiAgICAgICAgICAgIHZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTsKICAgICAgICAgICAgaGVhZC5hcHBlbmRDaGlsZChzKTsKICAgICAgICB9CiAgICA8L3NjcmlwdD4KICAgIDxkaXYgaWQ9InZpZGVvYWQiPjwvZGl2PgogICAgPGRpdiBpZD0iZnVsbHNjcmVlbi1iYW5ycyIgc3R5bGU9InBvaW50ZXItZXZlbnRzOiBhbGw7IGRpc3BsYXk6IG5vbmU7IHVzZXItc2VsZWN0OiBub25lOyBwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogMDsgcmlnaHQ6IDA7IGJvdHRvbTogMDsgbGVmdDogMDsiPgogICAgICAgIDxkaXYgaWQ9J2tvdXItaW9fMzAweDI1MC1wYXJlbnQnIHN0eWxlPSJwb2ludGVyLWV2ZW50czogYWxsOyBkaXNwbGF5OiBub25lOyBwb3NpdGlvbjogYWJzb2x1dGU7IHRyYW5zZm9ybS1vcmlnaW46IHRvcCByaWdodDsgdG9wOiAyMCU7IHJpZ2h0OiAyJTsgei1pbmRleDogOTk5OTsgd2lkdGg6IDMxMHB4OyBoZWlnaHQ6IDI2MHB4OyBwYWRkaW5nOiA1cHg7ICI+CiAgICAgICAgICAgIDxkaXYgaWQ9J2tvdXItaW9fMzAweDI1MCcgc3R5bGU9InVzZXItc2VsZWN0OiBub25lOyB3aWR0aDogMzAwcHg7IGhlaWdodDogMjUwcHg7Ij4KICAgICAgICAgICAgICAgIDwhLS0gYWQgLS0+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgaWQ9J2tvdXItaW9fNzI4eDkwLXBhcmVudCcgc3R5bGU9InBvaW50ZXItZXZlbnRzOiBhbGw7IGRpc3BsYXk6IG5vbmU7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdHJhbnNmb3JtLW9yaWdpbjogYm90dG9tIGNlbnRlcjsgYm90dG9tOiAxJTsgbGVmdDogMHB4OyByaWdodDogMHB4OyBtYXJnaW4tbGVmdDogYXV0bzsgbWFyZ2luLXJpZ2h0OiBhdXRvOyB6LWluZGV4OiA5OTk5OyB3aWR0aDogNzM4cHg7IGhlaWdodDogMTAwcHg7IHBhZGRpbmc6IDVweDsgIj4KICAgICAgICAgICAgPGRpdiBpZD0na291ci1pb183Mjh4OTAnIHN0eWxlPSJ1c2VyLXNlbGVjdDogbm9uZTsgd2lkdGg6IDcyOHB4OyBoZWlnaHQ6IDkwcHg7Ij4KICAgICAgICAgICAgICAgIDwhLS0gYWQgLS0+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgaWQ9J2tvdXItaW9fMzAweDYwMC1wYXJlbnQnIHN0eWxlPSJwb2ludGVyLWV2ZW50czogYWxsOyBkaXNwbGF5OiBub25lOyBwb3NpdGlvbjogYWJzb2x1dGU7IHRyYW5zZm9ybS1vcmlnaW46IHRvcCBsZWZ0OyB0b3A6IDIwJTsgbGVmdDogMSU7IHotaW5kZXg6IDk5OTk7IHdpZHRoOiAzMTBweDsgaGVpZ2h0OiA2MTBweDsgcGFkZGluZzogNXB4OyAiPgogICAgICAgICAgICA8ZGl2IGlkPSdrb3VyLWlvXzMwMHg2MDAnIHN0eWxlPSJ1c2VyLXNlbGVjdDogbm9uZTsgd2lkdGg6IDMwMHB4OyBoZWlnaHQ6IDYwMHB4OyI+CiAgICAgICAgICAgICAgICA8IS0tIGFkIC0tPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgogICAgPGRpdiBpZD0icm90YXRlTWVzc2FnZSIgY2xhc3M9InJvdGF0ZS1tZXNzYWdlIj4KICAgICAgICA8cD5Sb3RhdGUgdG8gbGFuZHNjYXBlIG1vZGUhPC9wPgogICAgICAgIDxpbWcgc3JjPSJyb3RhdGUud2VicCIgYWx0PSJyb3RhdGUgeW91ciBkZXZpY2UgdG8gbGFuZHNjYXBlIG1vZGUhIiBzdHlsZT0id2lkdGg6IDUwJTsiIC8+CiAgICAgICAgPGJ1dHRvbiBpZD0idXNlUG9ydHJhaXRCdG4iPiAgVXNlIFBvcnRyYWl0IE1vZGUgIDwvYnV0dG9uPgogICAgPC9kaXY+CiAgICA8c2NyaXB0IHNyYz0icm90YXRlRGV2aWNlLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQ+CiAgICAgICAgbGV0IHByZXZlbnRVbmxvYWRBY3RpdmUgPSBmYWxzZTsKCiAgICAgICAgdmFyIGJlZm9yZVVubG9hZGVkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgLy8gVGhlIGZvbGxvd2luZyB0ZXh0IHdpbGwgYmUgc2hvd24gaW4gYSBzdGFuZGFyZCBicm93c2VyIGRpYWxvZwogICAgICAgICAgICBpZiAocHJldmVudFVubG9hZEFjdGl2ZSkgewogICAgICAgICAgICAgICAgY29uc3QgY29uZmlybWF0aW9uTWVzc2FnZSA9ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gbGVhdmUga291ci5pbz8nOwogICAgICAgICAgICAgICAgZS5yZXR1cm5WYWx1ZSA9IGNvbmZpcm1hdGlvbk1lc3NhZ2U7IC8vIExlZ2FjeSBtZXRob2QgZm9yIGNyb3NzLWJyb3dzZXIgY29tcGF0aWJpbGl0eQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1hdGlvbk1lc3NhZ2U7IC8vIFNvbWUgYnJvd3NlcnMgcmVxdWlyZSB0aGlzIHRvIHdvcmsgY29ycmVjdGx5CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgYmVmb3JlVW5sb2FkZWQpOwoKICAgICAgICBmdW5jdGlvbiBQcmV2ZW50Q3RybFcoKSB7CiAgICAgICAgICAgIHByZXZlbnRVbmxvYWRBY3RpdmUgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gQWxsb3dDdHJsVygpIHsKICAgICAgICAgICAgLy93aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgcHJldmVudFVubG9hZCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdvRGVlcEZ1bGxzY3JlZW4oKSB7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHNob3dDcmF6eUdhbWVzQXV0aFByb21wdCgpewogICAgICAgICAgICB3aW5kb3cuc2hvd0NyYXp5R2FtZXNBdXRoUHJvbXB0KCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZUNyYXp5R2FtZXNVc2VyKCl7CiAgICAgICAgICAgIHdpbmRvdy5oYW5kbGVDcmF6eUdhbWVzVXNlcigpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnb0Z1bGxzY3JlZW5Nb2JpbGUoKSB7CiAgICAgICAgICAgIHZhciBlbGVtID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgICAgICAgICBpZiAoZWxlbS5yZXF1ZXN0RnVsbHNjcmVlbikgewogICAgICAgICAgICAgICAgZWxlbS5yZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW0ubW96UmVxdWVzdEZ1bGxTY3JlZW4pIHsgLy8gRmlyZWZveAogICAgICAgICAgICAgICAgZWxlbS5tb3pSZXF1ZXN0RnVsbFNjcmVlbigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW0ud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4pIHsgLy8gQ2hyb21lLCBTYWZhcmkgYW5kIE9wZXJhCiAgICAgICAgICAgICAgICBlbGVtLndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbS5tc1JlcXVlc3RGdWxsc2NyZWVuKSB7IC8vIElFL0VkZ2UKICAgICAgICAgICAgICAgIGVsZW0ubXNSZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzY3JlZW4ub3JpZW50YXRpb24gJiYgc2NyZWVuLm9yaWVudGF0aW9uLmxvY2spIHsKICAgICAgICAgICAgICAgIHNjcmVlbi5vcmllbnRhdGlvbi5sb2NrKCdsYW5kc2NhcGUnKS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIGVycm9ycyBmb3IgdW5zdXBwb3J0ZWQgYnJvd3NlcnMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAxKTsKICAgICAgICAgICAgfSwgMTAwKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY29weUN1cnJlbnRVUkwoKSB7CiAgICAgICAgICAgIGxldCBjdXJyZW50VXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTsKICAgICAgICAgICAgZWwudmFsdWUgPSBjdXJyZW50VXJsOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsKTsKICAgICAgICAgICAgZWwuc2VsZWN0KCk7CiAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5Jyk7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWwpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjb3B5U3RyaW5nKHgpIHsKICAgICAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpOwogICAgICAgICAgICBlbC52YWx1ZSA9IHg7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWwpOwogICAgICAgICAgICBlbC5zZWxlY3QoKTsKICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2NvcHknKTsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFNldEN1cnNvcih4KSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJTZXRDdXJzb3IgLSAiICsgeCk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtYWluaHRtbCIpLnN0eWxlLmN1cnNvciA9IHg7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJlbG9hZCgpIHsKICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHNldEN1cnNvcihjdXJzb3JTdHlsZSkgewogICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VuaXR5LWNhbnZhcycpOwogICAgICAgICAgICBjYW52YXMuc3R5bGUuY3Vyc29yID0gY3Vyc29yU3R5bGU7CiAgICAgICAgfQogICAgPC9zY3JpcHQ+CiAgICA8ZGl2IGlkPSJ1bml0eS1jb250YWluZXIiIHN0eWxlPSJwb3NpdGlvbjogYWJzb2x1dGU7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCUiPgogICAgICAgIDxjYW52YXMgaWQ9InVuaXR5LWNhbnZhcyIgd2lkdGg9MTkyMCBoZWlnaHQ9MTA4MCBzdHlsZT0id2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsgdXNlci1zZWxlY3Q6IG5vbmU7IC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7Ij48L2NhbnZhcz4KICAgIDwvZGl2PgogICAgPGRpdiBpZD0ibG9hZGluZy1jb3ZlciIgc3R5bGU9ImRpc3BsYXk6IGJsb2NrOyIgZGF0YS1iZz0iVGVtcGxhdGVEYXRhL2JhY2tncm91bmQud2VicCI+CiAgICAgICAgPGRpdiBpZD0ibG9hZGluZy1jb3Zlci0yIj48L2Rpdj4KICAgICAgICA8aW1nIGNsYXNzPSJrb3VyVGl0bGUiIGRhdGEtc3JjPSJrb3VyLXRpdGxlLndlYnAiIC8+CiAgICAgICAgPHAgaWQ9ImxvYWRpbmdUeHQiPkxvYWRpbmcgS291ciBFc3NlbnRpYWxzLi4uPC9wPgogICAgICAgIDxwIGlkPSJsb2FkaW5nVHh0TWluaW1hbCI+PC9wPgogICAgICAgIDxkaXYgaWQ9InVuaXR5LWxvYWRpbmctYmFyIiBzdHlsZT0idXNlci1zZWxlY3Q6IG5vbmU7IGxlZnQ6IDA7IHJpZ2h0OiAwOyI+CiAgICAgICAgICAgIDxkaXYgaWQ9InVuaXR5LXByb2dyZXNzLWJhci1lbXB0eSIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7IG1hcmdpbi10b3A6IDBweDsiPgogICAgICAgICAgICAgICAgPGRpdiBpZD0idW5pdHktcHJvZ3Jlc3MtYmFyLWZ1bGwiPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0idG9wOiAyOHB4OyIgY2xhc3M9InNwaW5uZXIiPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgaWQ9InVuaXR5LWxvYWRpbmctYmFyLWZhc3QiIHN0eWxlPSJ1c2VyLXNlbGVjdDogbm9uZTsgZGlzcGxheTogbm9uZTsgbWFyZ2luLXRvcDogMHB4OyI+CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmYXN0LWxvYWRlciI+PC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgICAgIDxpbWcgaWQ9InJlZnJlc2hJbWFnZSIgc3JjPSJyZWZyZXNoMS53ZWJwIiBhbHQ9IlBsZWFzZSB3YWl0IGZvciB0aGUgZ2FtZSB0byBsb2FkLiI+CiAgICAgICAgPHNjcmlwdD4KICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLXNyY10iKS5mb3JFYWNoKGVsID0+IHsKICAgICAgICAgICAgICAgICAgICBlbC5zcmMgPSBnZXRBc3NldFVybChlbC5kYXRhc2V0LnNyYyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2FkaW5nLWNvdmVyIikuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgnJHtnZXRBc3NldFVybChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibG9hZGluZy1jb3ZlciIpLmRhdGFzZXQuYmcpfScpYDsKICAgICAgICAgICAgICAgIG9uV2luZG93UmVzaXplKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpc2lPUyA9IC9pUGFkfGlQaG9uZXxpUG9kLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpICYmICF3aW5kb3cuTVNTdHJlYW07CiAgICAgICAgICAgICAgICBpZiAoaXNpT1MpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdtZXRhW25hbWU9InRoZW1lLWNvbG9yIl0nKS5zZXRBdHRyaWJ1dGUoImNvbnRlbnQiLCAiIzFmMWYxZiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGxvYWRpbmdDb3ZlcjIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZy1jb3Zlci0yJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRpbmdDb3ZlcjIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ0NvdmVyMi5zdHlsZS5vcGFjaXR5ID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nQ292ZXIyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nQ292ZXIyLnN0eWxlLm9wYWNpdHkgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgMTc1MDApOwogICAgICAgICAgICAgICAgfSwgMTUwMDApOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlZnJlc2hJbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVmcmVzaEltYWdlJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZnJlc2hJbWcgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaEltZy5zdHlsZS5hbmltYXRpb24gPSAnc2xpZGVVcCAxLjBzIGZvcndhcmRzJzsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaEltZy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGluZ0luZm9NZXNzYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoSW1nLmFkZEV2ZW50TGlzdGVuZXIoInRvdWNoc3RhcnQiLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGluZ0luZm9NZXNzYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBzaG93TG9hZGluZ0luZm9NZXNzYWdlKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1JldHJ5UG9wdXAoIkxvYWRpbmcgaXMgQUxNT1NUIGRvbmUuIEtvdXIuaW8gaXMgYSBmaXJzdCBwZXJzb24gc2hvb3Rlciwgc28gaWYgeW91IGxpa2Ugc2hvb3RpbmcgZ3Vuc+KApiB3YWl0IGEgbGl0dGxlIGJpdCBtb3JlITxicj5DbGljayB0byBjbG9zZSIsIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoSW1nLnN0eWxlLmFuaW1hdGlvbiA9ICdzbGlkZURvd24gMS4wcyBmb3J3YXJkcyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoSW1nLnNyYyA9ICdyZWZyZXNoMi53ZWJwJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaEltZy5zcmMgPSAncmVmcmVzaDIud2VicCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hJbWcuc3R5bGUuYW5pbWF0aW9uID0gJ3NsaWRlVXAgMS4wcyBmb3J3YXJkcyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgNDAwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDE3NTAwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMDAwMCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIDwvc2NyaXB0PgogICAgPC9kaXY+CiAgICA8c2NyaXB0PgogICAgICAgIC8vIEZ1bmN0aW9uIHRvIGVhc2Ugb3V0IHByb2dyZXNzIHBlcmNlbnRhZ2UKICAgICAgICBmdW5jdGlvbiBlYXNlT3V0UXVhZFBlcmNlbnRhZ2UocGVyY2VudCkgewogICAgICAgICAgICB2YXIgdCA9IHBlcmNlbnQgLyAxMDA7CiAgICAgICAgICAgIHJldHVybiAoMSAtIE1hdGgucG93KDEgLSB0LCAzKSkgKiAxMDAuMDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlcikgewogICAgICAgICAgICBpZiAobnVtYmVyIDwgMTAwMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlci50b1N0cmluZygpOyAvLyBSZXR1cm4gdGhlIG9yaWdpbmFsIG51bWJlciBpZiBsZXNzIHRoYW4gMTAwMAogICAgICAgICAgICB9IGVsc2UgaWYgKG51bWJlciA8IDEwMDAwMDApIHsKICAgICAgICAgICAgICAgIHJldHVybiAobnVtYmVyIC8gMTAwMCkudG9GaXhlZCgyKSArICdrJzsgLy8gQ29udmVydCB0byAnaycgZm9ybWF0IGZvciB0aG91c2FuZHMKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAobnVtYmVyIC8gMTAwMDAwMCkudG9GaXhlZCgyKSArICdNJzsgLy8gQ29udmVydCB0byAnTScgZm9ybWF0IGZvciBtaWxsaW9ucwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG9uV2luZG93UmVzaXplKCkgewogICAgICAgICAgICBpZiAod2luZG93LnNka1ZlcnNpb24gPT09ICJDcmF6eUdhbWVzIikKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgdmFyIG5ld1NjYWxlID0gTWF0aC5taW4od2luZG93LmlubmVyV2lkdGggLyAxOTIwLjAsIHdpbmRvdy5pbm5lckhlaWdodCAvIDk2MC4wKTsKICAgICAgICAgICAgdmFyIGFkMSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJrb3VyLWlvXzMwMHgyNTAtcGFyZW50Iik7CiAgICAgICAgICAgIHZhciBhZDIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgia291ci1pb183Mjh4OTAtcGFyZW50Iik7CiAgICAgICAgICAgIHZhciBhZDMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgia291ci1pb18zMDB4NjAwLXBhcmVudCIpOwogICAgICAgICAgICBpZiAoYWQxKSBhZDEuc3R5bGUudHJhbnNmb3JtID0gInNjYWxlKCIgKyAobmV3U2NhbGUgKiAxLjMpICsgIikiOwogICAgICAgICAgICBpZiAoYWQyKSBhZDIuc3R5bGUudHJhbnNmb3JtID0gInNjYWxlKCIgKyAobmV3U2NhbGUgKiAxLjA3KSArICIpIjsKICAgICAgICAgICAgaWYgKGFkMykgYWQzLnN0eWxlLnRyYW5zZm9ybSA9ICJzY2FsZSgiICsgKG5ld1NjYWxlICogMS4yKSArICIpIjsKICAgICAgICB9OwogICAgICAgIG9uV2luZG93UmVzaXplKCk7CiAgICAgICAgd2luZG93Lm9ucmVzaXplID0gb25XaW5kb3dSZXNpemU7CiAgICAgICAgd2luZG93Lm9ubG9hZCA9IG9uV2luZG93UmVzaXplOwoKICAgICAgICAvLyBGdW5jdGlvbiB0byByZWZyZXNoIGFuIGFkIGJhbm5lciBpZiBpdCBpcyB2aXNpYmxlCiAgICAgICAgZnVuY3Rpb24gcmVmcmVzaEFkQmFubmVyKHRhZ2FkKSB7CiAgICAgICAgICAgIHZhciBhZEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHt0YWdhZH0tcGFyZW50YCk7CiAgICAgICAgICAgIGlmIChhZEVsZW1lbnQgJiYgYWRFbGVtZW50LnN0eWxlLmRpc3BsYXkgIT09ICJub25lIikgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhaXB0YWcgIT09ICd1bmRlZmluZWQnICYmIGFpcHRhZy5jbWQgJiYgdHlwZW9mIGFpcERpc3BsYXlUYWcgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgYWlwRGlzcGxheVRhZy5kaXNwbGF5KGAke3RhZ2FkfWApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdhaXB0YWcgb3IgYWlwRGlzcGxheVRhZyBpcyBub3QgZGVmaW5lZC4nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBTZXRBZHMocHJlc2V0TmFtZTcyODkwLCBwcmVzZXROYW1lMzAwNjAwLCBwcmVzZXROYW1lMzAwMjUwKSB7CiAgICAgICAgICAgIHZhciBhZDEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgia291ci1pb183Mjh4OTAtcGFyZW50Iik7CiAgICAgICAgICAgIHZhciBhZDIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgia291ci1pb18zMDB4NjAwLXBhcmVudCIpOwogICAgICAgICAgICB2YXIgYWQzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImtvdXItaW9fMzAweDI1MC1wYXJlbnQiKTsKICAgICAgICAgICAgdmFyIGlzQ2cgPSB3aW5kb3cuc2RrVmVyc2lvbiA9PT0gIkNyYXp5R2FtZXMiOwogICAgICAgICAgICBpZiAod2luZG93LmlzTW9iaWxlKXsKICAgICAgICAgICAgICAgIC8vbm8gYWRzIGZvciBtb2JpbGUsIG92ZXJyaWRlOgogICAgICAgICAgICAgICAgcHJlc2V0TmFtZTcyODkwID0gImhpZGRlbiI7CiAgICAgICAgICAgICAgICBwcmVzZXROYW1lMzAwNjAwID0gImhpZGRlbiI7CiAgICAgICAgICAgICAgICBwcmVzZXROYW1lMzAwMjUwID0gImhpZGRlbiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFkMSkgewogICAgICAgICAgICAgICAgaWYgKHByZXNldE5hbWU3Mjg5MCA9PT0gImhpZGRlbiIpIHsKICAgICAgICAgICAgICAgICAgICBhZDEuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNDZyl7d2luZG93LkNyYXp5R2FtZXMuU0RLLmJhbm5lci5jbGVhckJhbm5lcigia291ci1pb183Mjh4OTAiKTt9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChwcmVzZXROYW1lNzI4OTAgPT09ICJib3R0b20iKSB7CiAgICAgICAgICAgICAgICAgICAgYWQxLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICAgICAgICAgIGlmIChpc0NnKXt3aW5kb3cuQ3JhenlHYW1lcy5TREsuYmFubmVyLnJlcXVlc3RSZXNwb25zaXZlQmFubmVyKCJrb3VyLWlvXzcyOHg5MCIpO30KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWQyKSB7CiAgICAgICAgICAgICAgICBpZiAocHJlc2V0TmFtZTMwMDYwMCA9PT0gImhpZGRlbiIpIHsKICAgICAgICAgICAgICAgICAgICBhZDIuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgICAgICAvL2lmIChpc0NnKXt3aW5kb3cuQ3JhenlHYW1lcy5TREsuYmFubmVyLmNsZWFyQmFubmVyKCJrb3VyLWlvXzMwMHg2MDAiKTt9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByZXNldE5hbWUzMDA2MDAgPT09ICJsZWZ0IikgewogICAgICAgICAgICAgICAgICAgIGFkMi5zdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSAidG9wIGxlZnQiOwogICAgICAgICAgICAgICAgICAgIGFkMi5zdHlsZS50b3AgPSAiMjAlIjsKICAgICAgICAgICAgICAgICAgICBhZDIuc3R5bGUubGVmdCA9ICIxJSI7CiAgICAgICAgICAgICAgICAgICAgYWQyLnN0eWxlLnJlbW92ZVByb3BlcnR5KCdyaWdodCcpOwogICAgICAgICAgICAgICAgICAgIC8vaWYgKGlzQ2cpe3dpbmRvdy5DcmF6eUdhbWVzLlNESy5iYW5uZXIucmVxdWVzdFJlc3BvbnNpdmVCYW5uZXIoImtvdXItaW9fMzAweDYwMCIpO30KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJlc2V0TmFtZTMwMDYwMCA9PT0gInJpZ2h0IikgewogICAgICAgICAgICAgICAgICAgIGFkMi5zdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSAidG9wIHJpZ2h0IjsKICAgICAgICAgICAgICAgICAgICBhZDIuc3R5bGUudG9wID0gIjIwJSI7CiAgICAgICAgICAgICAgICAgICAgYWQyLnN0eWxlLnJpZ2h0ID0gIjElIjsKICAgICAgICAgICAgICAgICAgICBhZDIuc3R5bGUucmVtb3ZlUHJvcGVydHkoJ2xlZnQnKTsKICAgICAgICAgICAgICAgICAgICBhZDIuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICAgICAgICAgICAgLy9pZiAoaXNDZyl7d2luZG93LkNyYXp5R2FtZXMuU0RLLmJhbm5lci5yZXF1ZXN0UmVzcG9uc2l2ZUJhbm5lcigia291ci1pb18zMDB4NjAwIik7fQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGlzQ2cpewogICAgICAgICAgICAgICAgICAgIC8vb3ZlcnJpZGUgdGhpcyBhbmQgaGlkZSBmb3IgQ0cgbm8gbWF0dGVyIHdoYXQuCiAgICAgICAgICAgICAgICAgICAgYWQyLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFkMykgewogICAgICAgICAgICAgICAgaWYgKHByZXNldE5hbWUzMDAyNTAgPT09ICJoaWRkZW4iKSB7CiAgICAgICAgICAgICAgICAgICAgYWQzLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ2cpe3dpbmRvdy5DcmF6eUdhbWVzLlNESy5iYW5uZXIuY2xlYXJCYW5uZXIoImtvdXItaW9fMzAweDI1MCIpO30KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJlc2V0TmFtZTMwMDI1MCA9PT0gImxlZnQiKSB7CiAgICAgICAgICAgICAgICAgICAgYWQzLnN0eWxlLnRyYW5zZm9ybU9yaWdpbiA9ICJ0b3AgbGVmdCI7CiAgICAgICAgICAgICAgICAgICAgYWQzLnN0eWxlLnRvcCA9ICIzMyUiOwogICAgICAgICAgICAgICAgICAgIGFkMy5zdHlsZS5sZWZ0ID0gIjYlIjsKICAgICAgICAgICAgICAgICAgICBhZDMuc3R5bGUucmVtb3ZlUHJvcGVydHkoJ3JpZ2h0Jyk7CiAgICAgICAgICAgICAgICAgICAgYWQzLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICAgICAgICAgIGlmIChpc0NnKXt3aW5kb3cuQ3JhenlHYW1lcy5TREsuYmFubmVyLnJlcXVlc3RSZXNwb25zaXZlQmFubmVyKCJrb3VyLWlvXzMwMHgyNTAiKTt9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByZXNldE5hbWUzMDAyNTAgPT09ICJyaWdodCIpIHsKICAgICAgICAgICAgICAgICAgICBhZDMuc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gInRvcCByaWdodCI7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ2cpewogICAgICAgICAgICAgICAgICAgICAgICBhZDMuc3R5bGUudG9wID0gIjEwJSI7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkMy5zdHlsZS5yaWdodCA9ICIwJSI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkMy5zdHlsZS50b3AgPSAiMjAlIjsKICAgICAgICAgICAgICAgICAgICAgICAgYWQzLnN0eWxlLnJpZ2h0ID0gIjIlIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYWQzLnN0eWxlLnJlbW92ZVByb3BlcnR5KCdsZWZ0Jyk7CiAgICAgICAgICAgICAgICAgICAgYWQzLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICAgICAgICAgIGlmIChpc0NnKXt3aW5kb3cuQ3JhenlHYW1lcy5TREsuYmFubmVyLnJlcXVlc3RSZXNwb25zaXZlQmFubmVyKCJrb3VyLWlvXzMwMHgyNTAiKTt9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByZXNldE5hbWUzMDAyNTAgPT09ICJ0b3BsZWZ0IikgewogICAgICAgICAgICAgICAgICAgIGFkMy5zdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSAidG9wIGxlZnQiOwogICAgICAgICAgICAgICAgICAgIGFkMy5zdHlsZS50b3AgPSAiMTAlIjsKICAgICAgICAgICAgICAgICAgICBhZDMuc3R5bGUubGVmdCA9ICIxJSI7CiAgICAgICAgICAgICAgICAgICAgYWQzLnN0eWxlLnJlbW92ZVByb3BlcnR5KCdyaWdodCcpOwogICAgICAgICAgICAgICAgICAgIGFkMy5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNDZyl7d2luZG93LkNyYXp5R2FtZXMuU0RLLmJhbm5lci5yZXF1ZXN0UmVzcG9uc2l2ZUJhbm5lcigia291ci1pb18zMDB4MjUwIik7fQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgPC9zY3JpcHQ+CiAgICA8c3R5bGU+CiAgICAgICAgI3dvcmRzIHsKICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdGamFsbGEgT25lJywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBsZWZ0OwogICAgICAgICAgICB1c2VyLXNlbGVjdDogbm9uZTsKICAgICAgICAgICAgZm9udC1zaXplOiAzN3B4OwogICAgICAgIH0KCiAgICAgICAgI3VuaXR5LWxvZ28gewogICAgICAgICAgICBtYXgtd2lkdGg6IDMwMHB4OwogICAgICAgIH0KCiAgICAgICAgQG1lZGlhIChtYXgtd2lkdGg6IDEyMDBweCkgewogICAgICAgICAgICAjd29yZHMgewogICAgICAgICAgICAgICAgZm9udC1zaXplOiAzMHB4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAjdW5pdHktbG9nbyB7CiAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDI1MHB4OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBAbWVkaWEgKG1heC13aWR0aDogOTkycHgpIHsKICAgICAgICAgICAgI3dvcmRzIHsKICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMjVweDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgI3VuaXR5LWxvZ28gewogICAgICAgICAgICAgICAgbWF4LXdpZHRoOiAyMDBweDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgQG1lZGlhIChtYXgtd2lkdGg6IDc2OHB4KSB7CiAgICAgICAgICAgICN3b3JkcyB7CiAgICAgICAgICAgICAgICBmb250LXNpemU6IDIwcHg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICN1bml0eS1sb2dvIHsKICAgICAgICAgICAgICAgIG1heC13aWR0aDogMTUwcHg7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiA1NzZweCkgewogICAgICAgICAgICAjd29yZHMgewogICAgICAgICAgICAgICAgZm9udC1zaXplOiAxNXB4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAjdW5pdHktbG9nbyB7CiAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDEwMHB4OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgPC9zdHlsZT4KCgoKICAgIAoKICAgICAgIDxzY3JpcHQgc3JjID0gImpzemlwLmpzIj48L3NjcmlwdD4KCTxzY3JpcHQ+ICAgIAoJCiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hBbmRDb21iaW5lWmlwKGJpblVybHMpIHsKICAgIGNvbnN0IHJlc3BvbnNlcyA9IGF3YWl0IFByb21pc2UuYWxsKGJpblVybHMubWFwKHVybCA9PiBmZXRjaCh1cmwpKSk7CiAgICBjb25zdCBidWZmZXJzID0gYXdhaXQgUHJvbWlzZS5hbGwocmVzcG9uc2VzLm1hcChyZXMgPT4gcmVzLmFycmF5QnVmZmVyKCkpKTsKICAgIGxldCB0b3RhbExlbmd0aCA9IGJ1ZmZlcnMucmVkdWNlKChhY2MsIGJ1ZikgPT4gYWNjICsgYnVmLmJ5dGVMZW5ndGgsIDApOwogICAgbGV0IGNvbWJpbmVkID0gbmV3IFVpbnQ4QXJyYXkodG90YWxMZW5ndGgpOwogICAgbGV0IG9mZnNldCA9IDA7CiAgICBmb3IgKGxldCBidWYgb2YgYnVmZmVycykgewogICAgICAgIGNvbWJpbmVkLnNldChuZXcgVWludDhBcnJheShidWYpLCBvZmZzZXQpOwogICAgICAgIG9mZnNldCArPSBidWYuYnl0ZUxlbmd0aDsKICAgIH0KICAgIHJldHVybiBjb21iaW5lZDsKfQoKYXN5bmMgZnVuY3Rpb24gdW56aXBXZWJwRnJvbUV4dGVybmFsQmlucyhiaW5VcmxzKSB7CiAgICBjb25zdCBibG9iVXJscyA9IHt9OwogICAgY29uc3QgYnl0ZXMgPSBhd2FpdCBmZXRjaEFuZENvbWJpbmVaaXAoYmluVXJscyk7CiAgICBjb25zdCB6aXAgPSBhd2FpdCBKU1ppcC5sb2FkQXN5bmMoYnl0ZXMpOwogICAgZm9yIChjb25zdCBbZmlsZW5hbWUsIGZpbGVdIG9mIE9iamVjdC5lbnRyaWVzKHppcC5maWxlcykpIHsKICAgICAgICBpZiAoIWZpbGUuZGlyKSB7CiAgICAgICAgICAgIGxldCBtaW1lID0gJyc7CiAgICAgICAgICAgIGlmIChmaWxlbmFtZS5lbmRzV2l0aCgnLmpzJykgfHwgZmlsZW5hbWUuZW5kc1dpdGgoJy5tanMnKSkgewogICAgICAgICAgICAgICAgbWltZSA9ICd0ZXh0L2phdmFzY3JpcHQnOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZpbGVuYW1lLmVuZHNXaXRoKCcuY3NzJykpIHsKICAgICAgICAgICAgICAgIG1pbWUgPSAndGV4dC9jc3MnOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZpbGVuYW1lLmVuZHNXaXRoKCcuaHRtbCcpKSB7CiAgICAgICAgICAgICAgICBtaW1lID0gJ3RleHQvaHRtbCc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZW5hbWUuaW5jbHVkZXMoJzFiZjlkNzM1NzhlN2NkMmI5Yjg3ZWE3MGQ4MGRlNjNmJykpIHsKICAgICAgICAgICAgICAgIG1pbWUgPSAnYXBwbGljYXRpb24vd2FzbSc7CiAgICAgICAgICAgIH0gCiAgICAgICAgICAgIGVsc2UgaWYgKGZpbGVuYW1lLmluY2x1ZGVzKCc5ZmFlMGYzY2E2NzljMmJhYmRlYzhlMzdiYWU0MmUxZScpKSB7CiAgICAgICAgICAgICAgICBtaW1lID0gJ2FwcGxpY2F0aW9uL2phdmFzY3JpcHQnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGZpbGVuYW1lLmVuZHNXaXRoKCcucG5nJykpIHsKICAgICAgICAgICAgICAgIG1pbWUgPSAnaW1hZ2UvcG5nJzsKICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlbmFtZS5lbmRzV2l0aCgnLmpwZycpIHx8IGZpbGVuYW1lLmVuZHNXaXRoKCcuanBlZycpKSB7CiAgICAgICAgICAgICAgICBtaW1lID0gJ2ltYWdlL2pwZWcnOwogICAgICAgICAgICB9CgkJCWVsc2UgaWYgKGZpbGVuYW1lLmVuZHNXaXRoKCcud2FzbScpICkgewogICAgICAgICAgICAgICAgbWltZSA9ICdhcHBsaWNhdGlvbi93YXNtJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCByYXdCbG9iID0gYXdhaXQgZmlsZS5hc3luYygiYmxvYiIpOwogICAgICAgICAgICBjb25zdCBibG9iID0gbWltZSA/IG5ldyBCbG9iKFtyYXdCbG9iXSwgeyB0eXBlOiBtaW1lIH0pIDogcmF3QmxvYjsKICAgICAgICAgICAgY29uc3QgYmxvYlVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJFeHRyYWN0ZWQ6IiwgZmlsZW5hbWUpOwogICAgICAgICAgICBibG9iVXJsc1tmaWxlbmFtZV0gPSBibG9iVXJsOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBibG9iVXJsczsKfQoKbGV0IGJsb2JVcmxzcyA9ICIiOwpsZXQgYmluUGFydHMgPSBbCiAgInBhcnRfMS5iaW4iLAogICJwYXJ0XzIuYmluIgpdOwoKdW56aXBXZWJwRnJvbUV4dGVybmFsQmlucyhiaW5QYXJ0cykudGhlbihibG9iVXJscyA9PiB7CgogICAgYmxvYlVybHNzID0gYmxvYlVybHM7CiAgICBjb25zdCBPUklHSU5BTF9DUkVBVEVfRUxFTUVOVCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQ7CiAgICBjb25zdCBPUklHSU5BTF9TRVRfQVRUUklCVVRFID0gRWxlbWVudC5wcm90b3R5cGUuc2V0QXR0cmlidXRlOwoKICAgIAogICAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCA9IGZ1bmN0aW9uKHRhZ05hbWUpIHsKICAgICAgICBjb25zdCBlbCA9IE9SSUdJTkFMX0NSRUFURV9FTEVNRU5ULmNhbGwodGhpcywgdGFnTmFtZSk7CgogICAgICAgIGlmICh0YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzY3JpcHQnKSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlbCwgJ3NyYycsIHsKICAgICAgICAgICAgICAgIHNldChuZXdTcmMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlbmFtZSA9IGV4dHJhY3RGaWxlbmFtZShuZXdTcmMpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcGxhY2VtZW50ID0gYmxvYlVybHNzW2ZpbGVuYW1lXTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVwbGFjZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIE9SSUdJTkFMX1NFVF9BVFRSSUJVVEUuY2FsbChlbCwgJ3NyYycsIHJlcGxhY2VtZW50KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBPUklHSU5BTF9TRVRfQVRUUklCVVRFLmNhbGwoZWwsICdzcmMnLCBuZXdTcmMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBnZXQoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsLmdldEF0dHJpYnV0ZSgnc3JjJyk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGVsOwogICAgfTsKCiAgICAKICAgIEVsZW1lbnQucHJvdG90eXBlLnNldEF0dHJpYnV0ZSA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgaWYgKHRoaXMudGFnTmFtZSA9PT0gJ1NDUklQVCcgJiYgbmFtZSA9PT0gJ3NyYycpIHsKICAgICAgICAgICAgY29uc3QgZmlsZW5hbWUgPSBleHRyYWN0RmlsZW5hbWUodmFsdWUpOwogICAgICAgICAgICBjb25zdCByZXBsYWNlbWVudCA9IGJsb2JVcmxzc1tmaWxlbmFtZV07CiAgICAgICAgICAgIGlmIChyZXBsYWNlbWVudCkgewogICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gT1JJR0lOQUxfU0VUX0FUVFJJQlVURS5jYWxsKHRoaXMsIG5hbWUsIHJlcGxhY2VtZW50KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIE9SSUdJTkFMX1NFVF9BVFRSSUJVVEUuY2FsbCh0aGlzLCBuYW1lLCB2YWx1ZSk7CiAgICB9OwoKICAgIGZ1bmN0aW9uIGV4dHJhY3RGaWxlbmFtZSh1cmwpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gbmV3IFVSTCh1cmwsIGxvY2F0aW9uLmhyZWYpLnBhdGhuYW1lLnNwbGl0KCcvJykucG9wKCk7CiAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgIHJldHVybiB1cmwuc3BsaXQoJy8nKS5wb3AoKTsgCiAgICAgICAgfQogICAgfQoKCmNvbnN0IGltYWdlU3JjRGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoSW1hZ2UucHJvdG90eXBlLCAnc3JjJyk7Ck9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbWFnZS5wcm90b3R5cGUsICdzcmMnLCB7CiAgc2V0KHZhbHVlKSB7CiAgICBjb25zdCBuZXdVUkwgPSByZXdyaXRlVVJMKHZhbHVlKTsKICAgIGltYWdlU3JjRGVzY3JpcHRvci5zZXQuY2FsbCh0aGlzLCBuZXdVUkwpOwogIH0sCiAgZ2V0OiBpbWFnZVNyY0Rlc2NyaXB0b3IuZ2V0LAogIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICBlbnVtZXJhYmxlOiB0cnVlLAp9KTsKCgpjb25zdCBzY3JpcHRTcmNEZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihIVE1MU2NyaXB0RWxlbWVudC5wcm90b3R5cGUsICdzcmMnKTsKT2JqZWN0LmRlZmluZVByb3BlcnR5KEhUTUxTY3JpcHRFbGVtZW50LnByb3RvdHlwZSwgJ3NyYycsIHsKICBzZXQodmFsdWUpIHsKICAgIGNvbnN0IG5ld1VSTCA9IHJld3JpdGVVUkwodmFsdWUpOwogICAgc2NyaXB0U3JjRGVzY3JpcHRvci5zZXQuY2FsbCh0aGlzLCBuZXdVUkwpOwogIH0sCiAgZ2V0OiBzY3JpcHRTcmNEZXNjcmlwdG9yLmdldCwKICBjb25maWd1cmFibGU6IHRydWUsCiAgZW51bWVyYWJsZTogdHJ1ZSwKfSk7CgoKY29uc3QgbGlua0hyZWZEZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihIVE1MTGlua0VsZW1lbnQucHJvdG90eXBlLCAnaHJlZicpOwpPYmplY3QuZGVmaW5lUHJvcGVydHkoSFRNTExpbmtFbGVtZW50LnByb3RvdHlwZSwgJ2hyZWYnLCB7CiAgc2V0KHZhbHVlKSB7CiAgICBjb25zdCBuZXdVUkwgPSByZXdyaXRlVVJMKHZhbHVlKTsKICAgIGxpbmtIcmVmRGVzY3JpcHRvci5zZXQuY2FsbCh0aGlzLCBuZXdVUkwpOwogIH0sCiAgZ2V0OiBsaW5rSHJlZkRlc2NyaXB0b3IuZ2V0LAogIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICBlbnVtZXJhYmxlOiB0cnVlLAp9KTsKCgpjb25zdCBtZWRpYVNyY0Rlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKEhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlLCAnc3JjJyk7Ck9iamVjdC5kZWZpbmVQcm9wZXJ0eShIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZSwgJ3NyYycsIHsKICBzZXQodmFsdWUpIHsKICAgIGNvbnN0IG5ld1VSTCA9IHJld3JpdGVVUkwodmFsdWUpOwogICAgbWVkaWFTcmNEZXNjcmlwdG9yLnNldC5jYWxsKHRoaXMsIG5ld1VSTCk7CiAgfSwKICBnZXQ6IG1lZGlhU3JjRGVzY3JpcHRvci5nZXQsCiAgY29uZmlndXJhYmxlOiB0cnVlLAogIGVudW1lcmFibGU6IHRydWUsCn0pOwoKLy8gZmV0Y2gKY29uc3Qgb3JpZ2luYWxGZXRjaCA9IHdpbmRvdy5mZXRjaDsKd2luZG93LmZldGNoID0gZnVuY3Rpb24ocmVzb3VyY2UsIGluaXQgPSB7fSkgewogIAogIGlmICh0eXBlb2YgcmVzb3VyY2UgPT09ICJzdHJpbmciKSB7CiAgICByZXNvdXJjZSA9IHJld3JpdGVVUkwocmVzb3VyY2UpOwogIH0gZWxzZSBpZiAocmVzb3VyY2UgaW5zdGFuY2VvZiBSZXF1ZXN0KSB7CiAgICByZXNvdXJjZSA9IG5ldyBSZXF1ZXN0KHJld3JpdGVVUkwocmVzb3VyY2UudXJsKSwgcmVzb3VyY2UpOwogIH0KCiAKICBpZiAoaW5pdC5oZWFkZXJzKSB7CiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoaW5pdC5oZWFkZXJzKTsKICAgIGhlYWRlcnMuZGVsZXRlKCdjYWNoZS1jb250cm9sJyk7CiAgICBoZWFkZXJzLmRlbGV0ZSgnQ2FjaGUtQ29udHJvbCcpOwogICAgaW5pdC5oZWFkZXJzID0gaGVhZGVyczsKICB9CgogCiAgaWYgKCFpbml0Lm1vZGUpIGluaXQubW9kZSA9ICdjb3JzJzsgCgogIHJldHVybiBvcmlnaW5hbEZldGNoLmNhbGwodGhpcywgcmVzb3VyY2UsIGluaXQpOwp9OwoKCi8vIFhNTEh0dHBSZXF1ZXN0CmNvbnN0IG9yaWdpbmFsT3BlbiA9IFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5vcGVuOwpYTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uKG1ldGhvZCwgdXJsLCAuLi5yZXN0KSB7CiAgY29uc3QgbmV3VVJMID0gcmV3cml0ZVVSTCh1cmwpOwogIHJldHVybiBvcmlnaW5hbE9wZW4uY2FsbCh0aGlzLCBtZXRob2QsIG5ld1VSTCwgLi4ucmVzdCk7Cn07CgoKY29uc3QgT3JpZ2luYWxBdWRpbyA9IHdpbmRvdy5BdWRpbzsKd2luZG93LkF1ZGlvID0gZnVuY3Rpb24oc3JjKSB7CiAgY29uc3QgYXVkaW8gPSBuZXcgT3JpZ2luYWxBdWRpbygpOwogIGlmIChzcmMpIHsKICAgIGF1ZGlvLnNyYyA9IHJld3JpdGVVUkwoc3JjKTsKICB9CiAgcmV0dXJuIGF1ZGlvOwp9Owp3aW5kb3cuQXVkaW8ucHJvdG90eXBlID0gT3JpZ2luYWxBdWRpby5wcm90b3R5cGU7CgoKZnVuY3Rpb24gcmV3cml0ZVVSTChvcmlnaW5hbCkgewoKaWYgKG9yaWdpbmFsLnN0YXJ0c1dpdGgoImh0dHBzOi8va291ci5pbyIpKSB7IApjb25zb2xlLmxvZyhvcmlnaW5hbCk7CnJldHVybiAiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL1BvazEyZC90YUBtYWluL2tvdXIvIiArIG9yaWdpbmFsLnNwbGl0KCJodHRwczovL2tvdXIuaW8vIilbMV19CgoKCgogIHZhciB0cmltbWVkID0gb3JpZ2luYWwuc3BsaXQoIi8iKS5wb3AoKTsKICAvL2NvbnNvbGUubG9nKHRyaW1tZWQpCiAgaWYgKHRyaW1tZWQuaW5jbHVkZXMoIj8iKSkgdHJpbW1lZCA9IHRyaW1tZWQuc3BsaXQoIj8iKVswXQogIHJldHVybiBibG9iVXJsc3NbdHJpbW1lZF0gfHwgb3JpZ2luYWw7Cn0KCQogICAgICAgIC8vIFNhZmUgYnVpbGQgVVJMCiAgICAgICAgZnVuY3Rpb24gZ2V0U2FmZUJ1aWxkVVJMKGlzTW9iaWxlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5TREs/LmdldEJ1aWxkVVJMID09PSAiZnVuY3Rpb24iKSAKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93LlNESy5nZXRCdWlsZFVSTChpc01vYmlsZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiU0RLLmdldEJ1aWxkVVJMIGZhaWxlZDoiLCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaXNNb2JpbGUgPyAibW9iaWxlL0J1aWxkIiA6ICJCdWlsZCI7IC8vIGZhbGxiYWNrCiAgICAgICAgfQoKICAgICAgICAvLyBTYWZlIFN0cmVhbWluZyBBc3NldHMgVVJMCiAgICAgICAgZnVuY3Rpb24gZ2V0U2FmZVN0cmVhbWluZ0Fzc2V0c1VybCgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93LlNESz8uZ2V0U3RyZWFtaW5nQXNzZXRzVXJsID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5TREsuZ2V0U3RyZWFtaW5nQXNzZXRzVXJsKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiU0RLLmdldFN0cmVhbWluZ0Fzc2V0c1VybCBmYWlsZWQ6IiwgZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICJTdHJlYW1pbmdBc3NldHMiOyAvLyBmYWxsYmFjawogICAgICAgIH0KCiAgICAgICAgLy8gU2FmZSBTdGF0aWMgUmVzb2x1dGlvbiBTY2FsZSBNdWx0aQogICAgICAgIGZ1bmN0aW9uIGdldFNhZmVTdGF0aWNSZXNvbHV0aW9uU2NhbGVNdWx0aSgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93LlNESz8uZ2V0U3RhdGljUmVzb2x1dGlvblNjYWxlTXVsdGkgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB3aW5kb3cuU0RLLmdldFN0YXRpY1Jlc29sdXRpb25TY2FsZU11bHRpKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiU0RLLmdldFN0YXRpY1Jlc29sdXRpb25TY2FsZU11bHRpIGZhaWxlZDoiLCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gMS4wMDsgLy8gZmFsbGJhY2sKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGlzVmlydHVhbENvbnRyb2xzKCkgewogICAgICAgICAgICB2YXIgdXNlckFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpOwoKICAgICAgICAgICAgaWYgKC93aW5kb3dzIG50Ly50ZXN0KHVzZXJBZ2VudCkgJiYgIS93aW5kb3dzIHBob25lLy50ZXN0KHVzZXJBZ2VudCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKC9Dck9TLy50ZXN0KHVzZXJBZ2VudCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKC9tb2JpbGUvLnRlc3QodXNlckFnZW50KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpc0lQYWQgPSAvaXBhZHxtYWNpbnRvc2gvLnRlc3QodXNlckFnZW50KSAmJiBuYXZpZ2F0b3IubWF4VG91Y2hQb2ludHMgJiYgbmF2aWdhdG9yLm1heFRvdWNoUG9pbnRzID4gMTsKICAgICAgICAgICAgdmFyIGlzQW5kcm9pZFRhYmxldCA9IC9hbmRyb2lkLy50ZXN0KHVzZXJBZ2VudCkgJiYgIS9tb2JpbGUvLnRlc3QodXNlckFnZW50KTsKICAgICAgICAgICAgaWYgKGlzSVBhZCB8fCBpc0FuZHJvaWRUYWJsZXQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB3aW5kb3cucmVjZWl2ZWRTZXJ2aWNlV29ya2VyTWVzc2FnZSA9IGZhbHNlOwogICAgICAgIGZ1bmN0aW9uIHByZXZlbnRab29tRHVyaW5nTG9hZGluZyhldmVudCkgewogICAgICAgICAgICBpZiAod2luZG93LmdhbWVMb2FkaW5nKSB7CiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBwcmV2ZW50Wm9vbUR1cmluZ0xvYWRpbmcsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgcHJldmVudFpvb21EdXJpbmdMb2FkaW5nLCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgICAgIGZ1bmN0aW9uIHBsYXllclByZWZzU2V0RmxvYXQoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlLnRvU3RyaW5nKCkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBwbGF5ZXJQcmVmc0dldEZsb2F0KGtleSwgZGVmYXVsdFZhbHVlID0gMC45KSB7CiAgICAgICAgICAgIGNvbnN0IHN0b3JlZFZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTsKICAgICAgICAgICAgY29uc3QgcGFyc2VkVmFsdWUgPSBzdG9yZWRWYWx1ZSA/IHBhcnNlRmxvYXQoc3RvcmVkVmFsdWUpIDogZGVmYXVsdFZhbHVlOwogICAgICAgICAgICByZXR1cm4gcGFyc2VkVmFsdWU7CiAgICAgICAgfQogICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjdW5pdHktY29udGFpbmVyIik7CiAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1jYW52YXMiKTsKICAgICAgICBjb25zdCBsb2FkaW5nQ292ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjbG9hZGluZy1jb3ZlciIpOwogICAgICAgIGNvbnN0IGZhc3RMb2FkaW5nQW5pbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1sb2FkaW5nLWJhci1mYXN0Iik7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3NCYXJFbXB0eSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1wcm9ncmVzcy1iYXItZW1wdHkiKTsKICAgICAgICBjb25zdCBsb2FkaW5nVHh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2xvYWRpbmdUeHQiKTsKICAgICAgICB2YXIgcHJvZ3Jlc3NCYXJGdWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3VuaXR5LXByb2dyZXNzLWJhci1mdWxsIik7CiAgICAgICAgdmFyIGlzTW9iaWxlID0gaXNWaXJ0dWFsQ29udHJvbHMoKTsKICAgICAgICB3aW5kb3cuaXNNb2JpbGUgPSBpc01vYmlsZTsKCgogICAgICAgIC8vIEZ1bmN0aW9uIHRvIGNoZWNrIGlmIGFuIGFkIGhhcyBiZWVuIGxvYWRlZAogICAgICAgIGZ1bmN0aW9uIGNoZWNrQWRMb2FkZWQoYWRDb250YWluZXJJZCkgewogICAgICAgICAgICBjb25zdCBhZENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGFkQ29udGFpbmVySWQpOwogICAgICAgICAgICBpZiAoYWRDb250YWluZXIgJiYgYWRDb250YWluZXIuc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAgICAvLyBBZCBpcyBsb2FkZWQgaWYgdGhlIGNvbnRhaW5lciBpcyBkaXNwbGF5ZWQKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIEZ1bmN0aW9uIHRvIGhpZGUgYWQgY29udGFpbmVycyBpZiBhZHMgZG8gbm90IGxvYWQgd2l0aGluIGEgdGltZW91dAogICAgICAgIGZ1bmN0aW9uIGhpZGVFbXB0eUFkQ29udGFpbmVycygpIHsKICAgICAgICAgICAgY29uc3QgYWRDb250YWluZXJzID0gWwogICAgICAgICAgICAgICAgJ2tvdXItaW9fMzAweDI1MC1wYXJlbnQnLAogICAgICAgICAgICAgICAgJ2tvdXItaW9fNzI4eDkwLXBhcmVudCcsCiAgICAgICAgICAgICAgICAna291ci1pb18zMDB4NjAwLXBhcmVudCcKICAgICAgICAgICAgXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGFkQ29udGFpbmVycy5mb3JFYWNoKChhZENvbnRhaW5lcklkKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWNoZWNrQWRMb2FkZWQoYWRDb250YWluZXJJZCkpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChhZENvbnRhaW5lcklkKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIEZ1bmN0aW9uIHRvIGxvYWQgYWQgYmFubmVycyBhbmQgc2V0IGEgdGltZW91dCB0byBjaGVjayBhZCBsb2FkaW5nIHN0YXR1cwogICAgICAgIGZ1bmN0aW9uIGxvYWRBZEJhbm5lclNjcmlwdCh0YWdhZCwgd2lkdGgsIGhlaWdodCkgewoKICAgICAgICAgICAgLy9sb2FkQWRCYW5uZXJTY3JpcHQgaXMgY2FsbGVkIHdoZW4gdGhlIGdhbWUgbG9hZHMuIHdlIHdhbnQgdG8gZW5zdXJlIHRoYXQgdGhlIGJhbm5lciBpcyBWSVNJQkxFLgoKICAgICAgICAgICAgdmFyIGFkQ2hpbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWdhZCk7CiAgICAgICAgICAgIHZhciBhZFBhcmVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke3RhZ2FkfS1wYXJlbnRgKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChhZENoaWxkKSB7CiAgICAgICAgICAgICAgICBhZENoaWxkLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICAgICAgYWRDaGlsZC5zdHlsZS53aWR0aCA9IGAke3dpZHRofXB4YDsKICAgICAgICAgICAgICAgIGFkQ2hpbGQuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0fXB4YDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWRQYXJlbnQpewogICAgICAgICAgICAgICAgLy9wYXJlbnQgaXMgMTBweCBiaWdnZXIKICAgICAgICAgICAgICAgIGFkUGFyZW50LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICAgICAgYWRQYXJlbnQuc3R5bGUud2lkdGggPSBgJHsod2lkdGgrMTApfXB4YDsKICAgICAgICAgICAgICAgIGFkUGFyZW50LnN0eWxlLmhlaWdodCA9IGAkeyhoZWlnaHQrMTApfXB4YDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc29sZS5sb2coYFtJTkZPXSBsb2FkQWRCYW5uZXJTY3JpcHQ6IHRhZ2FkOiR7dGFnYWR9LCB3aWR0aDoke3dpZHRofSwgaGVpZ2h0OiR7aGVpZ2h0fWApOwogICAgICAgICAgICAKICAgICAgICAgICAgbGV0IGFkTG9hZGVkID0gZmFsc2U7CgogICAgICAgICAgICBpZiAod2luZG93LnNka1ZlcnNpb24gPT09ICJDcmF6eUdhbWVzIikgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5DcmF6eUdhbWVzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhlaWdodCAhPT0gNjAwKSB7IC8vIGZvciBub3csIHdlIHdhbnQgdG8gRElTQUJMRSB0aGUgMzAweDYwMAogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuQ3JhenlHYW1lcy5TREsuYmFubmVyLnJlcXVlc3RSZXNwb25zaXZlQmFubmVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnYWQKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgYWRMb2FkZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ3JhenlHYW1lcyBTREsgaXMgbm90IGF2YWlsYWJsZS4nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYWlwdGFnICE9PSAndW5kZWZpbmVkJyAmJiBhaXB0YWcuY21kICYmIHR5cGVvZiBhaXBEaXNwbGF5VGFnICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgICAgIGFpcHRhZy5jbWQuZGlzcGxheS5wdXNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWlwRGlzcGxheVRhZy5kaXNwbGF5KGAke3RhZ2FkfWApOwogICAgICAgICAgICAgICAgICAgICAgICBhZExvYWRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2FpcHRhZyBvciBhaXBEaXNwbGF5VGFnIGlzIG5vdCBkZWZpbmVkLicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvKgogICAgICAgICAgICBpZiAoYWRMb2FkZWQpIHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoaGlkZUVtcHR5QWRDb250YWluZXJzLCA1MDAwKTsgLy8gQ2hlY2sgYWZ0ZXIgNSBzZWNvbmRzCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0eXBlb2YgcmVmcmVzaEFkQmFubmVyICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHJlZnJlc2hBZEJhbm5lcih0YWdhZCk7CiAgICAgICAgICAgICAgICB9LCAzMDAwMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdyZWZyZXNoQWRCYW5uZXIgZnVuY3Rpb24gaXMgbm90IGRlZmluZWQuJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgKi8KICAgICAgICB9CgogICAgICAgIHdpbmRvdy5vbkdhbWVMb2FkZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKGlzTW9iaWxlKSB7CiAgICAgICAgICAgICAgICAvLyBVbmNvbW1lbnQgYW5kIHNwZWNpZnkgd2lkdGggYW5kIGhlaWdodCBpZiBuZWVkZWQgZm9yIG1vYmlsZQogICAgICAgICAgICAgICAgLy8gbG9hZEFkQmFubmVyU2NyaXB0KCdrb3VyLWlvXzcyOHg5MCcsIDcyOCwgOTApOwogICAgICAgICAgICAgICAgLy8gbG9hZEFkQmFubmVyU2NyaXB0KCdrb3VyLWlvXzMwMHgyNTAnLCAzMDAsIDI1MCk7CiAgICAgICAgICAgICAgICAvLyBsb2FkQWRCYW5uZXJTY3JpcHQoJ2tvdXItaW9fMzAweDYwMCcsIDMwMCwgNjAwKTsKICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICBsb2FkQWRCYW5uZXJTY3JpcHQoJ2tvdXItaW9fMzAweDI1MCcsIDMwMCwgMjUwKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJ3aW5kb3cub25HYW1lTG9hZGVkLiB3aW5kb3cuc2RrVmVyc2lvbiBpcyAiICsgd2luZG93LnNka1ZlcnNpb24pOwoKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuc2RrVmVyc2lvbiA9PT0gIkNyYXp5R2FtZXMiKXsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiQ3JhenlHYW1lcy4iKTsKICAgICAgICAgICAgICAgICAgICBsb2FkQWRCYW5uZXJTY3JpcHQoJ2tvdXItaW9fNzI4eDkwJywgMzUwLCAxMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICBsb2FkQWRCYW5uZXJTY3JpcHQoJ2tvdXItaW9fNzI4eDkwJywgNzI4LCA5MCk7CiAgICAgICAgICAgICAgICAgICAgbG9hZEFkQmFubmVyU2NyaXB0KCdrb3VyLWlvXzMwMHg2MDAnLCAzMDAsIDYwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHdhaXRGb3JTREtUaGVuU3RhcnQoKCkgPT4gewogICAgICAgIAogICAgICAgICAgICBjb25zb2xlLmxvZygiW0lORk9dIGluZGV4Lmh0bWw6IHN0YXJ0aW5nIHRvIGxvYWQgIGZpbGVzIik7CgogICAgICAgICAgICB2YXIgYnVpbGRVcmwgPSBnZXRTYWZlQnVpbGRVUkwoaXNNb2JpbGUpOwoKICAgICAgICAgICAgdmFyIGxvYWRlclVybCA9IGJ1aWxkVXJsICsgIi8yZDlkYjcwMjY3MjZhNzMzMTMxZjhmNmQ5YWMxNjE2YS5sb2FkZXItZWRpdC5qcyI7CiAgICAgICAgICAgIHZhciBjb25maWcgPSB7CiAgICAgICAgICAgICAgICBkYXRhVXJsOiBidWlsZFVybCArICIvY2VhMDEzZDJiNTBhOTk1ZDExMWVjOGJmOGQxNzg3ODUuZGF0YS5iciIsCiAgICAgICAgICAgICAgICBmcmFtZXdvcmtVcmw6IGJ1aWxkVXJsICsgIi85ZmFlMGYzY2E2NzljMmJhYmRlYzhlMzdiYWU0MmUxZS5mcmFtZXdvcmsuanMuYnIiLAogICAgICAgICAgICAgICAgY29kZVVybDogYnVpbGRVcmwgKyAiLzFiZjlkNzM1NzhlN2NkMmI5Yjg3ZWE3MGQ4MGRlNjNmLndhc20uYnIiLAogICAgICAgICAgICAgICAgc3RyZWFtaW5nQXNzZXRzVXJsOiAiU3RyZWFtaW5nQXNzZXRzMiIsCiAgICAgICAgICAgICAgICBjb21wYW55TmFtZTogIkxFR2lPTlBsYXRmb3JtcyIsCiAgICAgICAgICAgICAgICBwcm9kdWN0TmFtZTogIktvdXIuaW8iLAogICAgICAgICAgICAgICAgcHJvZHVjdFZlcnNpb246ICI0LjIzIiwKICAgICAgICAgICAgICAgIGRldmljZVBpeGVsUmF0aW86IGdldFNhZmVTdGF0aWNSZXNvbHV0aW9uU2NhbGVNdWx0aSgpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChpc01vYmlsZSkgewogICAgICAgICAgICAgICAgdmFyIG1ldGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtZXRhJyk7CiAgICAgICAgICAgICAgICBtZXRhLm5hbWUgPSAndmlld3BvcnQnOwogICAgICAgICAgICAgICAgbWV0YS5jb250ZW50ID0gJ3dpZHRoPWRldmljZS13aWR0aCwgaGVpZ2h0PWRldmljZS1oZWlnaHQsIGluaXRpYWwtc2NhbGU9MS4wLCB1c2VyLXNjYWxhYmxlPW5vLCBzaHJpbmstdG8tZml0PXllcyc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKG1ldGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbmZpZy5kZXZpY2VQaXhlbFJhdGlvICo9IHBsYXllclByZWZzR2V0RmxvYXQoInJlbmRlclNjYWxlV2ViIiwgMC45MCk7CiAgICAgICAgICAgIHZhciB0aXBzID0gWwogICAgICAgICAgICAgICAgIkRvd25sb2FkaW5nIE1vZGVscyIsCiAgICAgICAgICAgICAgICAiSW5zdGFsbGluZyBNZW51IiwKICAgICAgICAgICAgICAgICJEb3dubG9hZGluZyBNYXBzIiwKICAgICAgICAgICAgICAgICJEb3dubG9hZGluZyBCdXR0b25zIiwKICAgICAgICAgICAgICAgICJJbnN0YWxsaW5nIDNEIE9iamVjdHMiLAogICAgICAgICAgICAgICAgIkRvd25sb2FkaW5nIENoYXJhY3RlcnMiLAogICAgICAgICAgICAgICAgIkluc3RhbGxpbmcgQW5pbWF0aW9ucyIsCiAgICAgICAgICAgICAgICAiRG93bmxvYWRpbmcgR3JhcGhpY3MiLAogICAgICAgICAgICAgICAgIkRvd25sb2FkaW5nIEdyYWRpZW50cyIsCiAgICAgICAgICAgICAgICAiSW5zdGFsbGluZyBTaG9wIiwKICAgICAgICAgICAgICAgICJJbnN0YWxsaW5nIFNlcnZlcnMiLAogICAgICAgICAgICAgICAgIkRvd25sb2FkaW5nIExvYmJpZXMiLAogICAgICAgICAgICAgICAgIkluc3RhbGxpbmcgU2hhZGVycyIsCiAgICAgICAgICAgICAgICAiRG93bmxvYWRpbmcgR2FtZSBNb2RlcyIsCiAgICAgICAgICAgICAgICAiRG93bmxvYWRpbmcgRW5lbXkgUHJvZmlsZXMiLAogICAgICAgICAgICAgICAgIkluc3RhbGxpbmcgV2VhcG9uIFVwZ3JhZGVzIiwKICAgICAgICAgICAgICAgICJEb3dubG9hZGluZyBBcm1vciBFbmhhbmNlbWVudHMiLAogICAgICAgICAgICAgICAgIkluc3RhbGxpbmcgU291bmR0cmFja3MiLAogICAgICAgICAgICAgICAgIkRvd25sb2FkaW5nIFZvaWNlIFBhY2tzIiwKICAgICAgICAgICAgICAgICJEb3dubG9hZGluZyBNdWx0aXBsYXllciBNb2RlcyIsCiAgICAgICAgICAgICAgICAiSW5zdGFsbGluZyBTcGVjaWFsIEVmZmVjdHMiLAogICAgICAgICAgICAgICAgIkRvd25sb2FkaW5nIEFjaGlldmVtZW50cyIsCiAgICAgICAgICAgICAgICAiRG93bmxvYWRpbmcgUmVwbGF5IERhdGEiLAogICAgICAgICAgICAgICAgIkRvd25sb2FkaW5nIExlYWRlcmJvYXJkIEluZm9ybWF0aW9uIiwKICAgICAgICAgICAgICAgICJJbnN0YWxsaW5nIEN1c3RvbSBTa2lucyIsCiAgICAgICAgICAgICAgICAiSW5zdGFsbGluZyBFbnZpcm9ubWVudGFsIERldGFpbHMiCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUxvYWRpbmdUZXh0V2l0aFRpcCgpIHsKICAgICAgICAgICAgICAgIHZhciByYW5kb21UaXAgPSB0aXBzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRpcHMubGVuZ3RoKV07CiAgICAgICAgICAgICAgICBpZiAoIXdpbmRvdy5yZWNlaXZlZFNlcnZpY2VXb3JrZXJNZXNzYWdlKQogICAgICAgICAgICAgICAgICAgIGxvYWRpbmdUeHQuaW5uZXJIVE1MID0gcmFuZG9tVGlwOwogICAgICAgICAgICAgICAgdmFyIGxvbmdlckR1cmF0aW9uID0gTWF0aC5yYW5kb20oKSA8IDAuMjsKICAgICAgICAgICAgICAgIHZhciBybmQyID0gTWF0aC5yYW5kb20oKSA8IDAuNTsKICAgICAgICAgICAgICAgIHZhciBuZXh0VGlwVGltZW91dCA9IGxvbmdlckR1cmF0aW9uID8gMTAwMCA6IChybmQyID8gMjUwIDogNTAwKTsKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aXBJbnRlcnZhbCk7CiAgICAgICAgICAgICAgICB0aXBJbnRlcnZhbCA9IHNldFRpbWVvdXQodXBkYXRlTG9hZGluZ1RleHRXaXRoVGlwLCBuZXh0VGlwVGltZW91dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCgoKICAgICAgICAgICAgICAgIC8vIEZ1bmN0aW9uIHRvIGNsYW1wIGEgbnVtYmVyIHdpdGhpbiBhIHJhbmdlCiAgICAgICAgICAgIGZ1bmN0aW9uIGNsYW1wKG51bSwgbWluLCBtYXgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudW0gPD0gbWluID8gbWluIDogbnVtID49IG1heCA/IG1heCA6IG51bTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2ltdWxhdGUgbG9hZGluZyBwcm9ncmVzcyBhZnRlciA4OSUKICAgICAgICAgICAgbGV0IHNpbXVsYXRlZFByb2dyZXNzID0gODk7CiAgICAgICAgICAgIGxldCBzaW11bGF0aW9uSW50ZXJ2YWw7CgogICAgICAgICAgICBmdW5jdGlvbiBzaW11bGF0ZVByb2dyZXNzKCkgewogICAgICAgICAgICAgICAgaWYgKHNpbXVsYXRlZFByb2dyZXNzIDwgMTAwKSB7CiAgICAgICAgICAgICAgICAgICAgc2ltdWxhdGVkUHJvZ3Jlc3MrKzsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVQcm9ncmVzc1VJKHNpbXVsYXRlZFByb2dyZXNzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChzaW11bGF0aW9uSW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGdW5jdGlvbiB0byB1cGRhdGUgdGhlIFVJIGJhc2VkIG9uIHByb2dyZXNzCiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVByb2dyZXNzVUkocGVyY2VudCkgewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy51bml0eUluc3RhbmNlKXsKICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHNpbXVsYXRpb25JbnRlcnZhbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3NCYXJFbXB0eSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1wcm9ncmVzcy1iYXItZW1wdHkiKTsKICAgICAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzQmFyRnVsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1wcm9ncmVzcy1iYXItZnVsbCIpOwogICAgICAgICAgICAgICAgY29uc3QgbG9hZGluZ1R4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNsb2FkaW5nVHh0Iik7CiAgICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nVHh0TWluaW1hbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNsb2FkaW5nVHh0TWluaW1hbCIpOwogICAgICAgICAgICAgICAgY29uc3QgZmFzdExvYWRpbmdBbmltID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3VuaXR5LWxvYWRpbmctYmFyLWZhc3QiKTsKCiAgICAgICAgICAgICAgICBpZiAocGVyY2VudCA8IDk5KSB7CiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJFbXB0eS5zdHlsZS5kaXNwbGF5ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJGdWxsLnN0eWxlLndpZHRoID0gYCR7cGVyY2VudH0lYDsKICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0JhckZ1bGwuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICAgICAgICAgICAgZmFzdExvYWRpbmdBbmltLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICAgICAgICAgICAgbG9hZGluZ1R4dE1pbmltYWwuaW5uZXJIVE1MID0gYExvYWRlZCAke3BlcmNlbnQudG9GaXhlZCgyKX0lYDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJFbXB0eS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRnVsbC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgICAgIGZhc3RMb2FkaW5nQW5pbS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgICAgICAgICAgICBsb2FkaW5nVHh0TWluaW1hbC5pbm5lckhUTUwgPSAiQWxtb3N0IFRoZXJlISAoRGVjb21wcmVzc2luZy4uLikiOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nVHh0KSB7CiAgICAgICAgICAgICAgICAgICAgbG9hZGluZ1R4dC5pbm5lckhUTUwgPSBgRG93bmxvYWRpbmcgRWR1Y2F0aW9uYWwgRmlsZXMgJHtwZXJjZW50LnRvRml4ZWQoMil9JWA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHN0YXJ0ZWRTaW11bGF0aW9uID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBpbml0aWFsQWxpdmVNZXNzYWdlID0gZmFsc2U7CiAgICAgICAgICAgIGZ1bmN0aW9uIG9uUHJvZ3Jlc3NVbml0eShwcm9ncmVzcykgewoKICAgICAgICAgICAgICAgIGlmICghaW5pdGlhbEFsaXZlTWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgIGluaXRpYWxBbGl2ZU1lc3NhZ2UgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3Bpbm5lcicpOwogICAgICAgICAgICAgICAgICAgIHNwaW5uZXIuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhcnRlZFNpbXVsYXRpb24pewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxldCBwZXJjZW50ID0gZWFzZU91dFF1YWRQZXJjZW50YWdlKHByb2dyZXNzICogMTAwKTsKICAgICAgICAgICAgICAgIGlmIChwZXJjZW50ID49IDg5KSB7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRlZFNpbXVsYXRpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoc2ltdWxhdGlvbkludGVydmFsKTsgLy8gU3RvcCBhbnkgb25nb2luZyBzaW11bGF0aW9uCiAgICAgICAgICAgICAgICAgICAgc2ltdWxhdGlvbkludGVydmFsID0gc2V0SW50ZXJ2YWwoc2ltdWxhdGVQcm9ncmVzcywgNjAwKTsgLy8gU3RhcnQgc2ltdWxhdGluZyBhZnRlciA4OSUKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlUHJvZ3Jlc3NVSShwZXJjZW50KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHRpcEludGVydmFsOwogICAgICAgICAgICBsb2FkaW5nQ292ZXIuc3R5bGUuZGlzcGxheSA9ICIiOwogICAgICAgICAgICBjb25zdCBfc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgICAgICAgICAgIF9zY3JpcHQudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOwogICAgICAgICAgICBfc2NyaXB0LnNyYyA9IGxvYWRlclVybDsKICAgICAgICAgICAgd2luZG93LmdhbWVMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgcmVwb3J0TG9hZGluZ1N0YXJ0KCk7CiAgICAgICAgICAgIHZhciByZWFjaGVkTGFzdExvYWRpbmdTdGVwID0gZmFsc2U7CiAgICAgICAgICAgIAogICAgICAgICAgICBfc2NyaXB0Lm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgICAgICBjcmVhdGVVbml0eUluc3RhbmNlKGNhbnZhcywgY29uZmlnLCAocHJvZ3Jlc3MpID0+IHsKICAgICAgICAgICAgICAgICAgb25Qcm9ncmVzc1VuaXR5KHByb2dyZXNzKTsKICAgICAgICAgICAgICB9KS50aGVuKCh1bml0eUluc3RhbmNlKSA9PiB7CiAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGlwSW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICB3aW5kb3cudW5pdHlJbnN0YW5jZSA9IHVuaXR5SW5zdGFuY2U7CiAgICAgICAgICAgICAgICAgIHdpbmRvdy5vbkdhbWVMb2FkZWQoKTsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgYW5pbUR1cmF0aW9uID0gMjAwOwogICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ0NvdmVyLmFuaW1hdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAgIHsgb3BhY2l0eTogJzEnIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgeyBvcGFjaXR5OiAnMCcgfQogICAgICAgICAgICAgICAgICAgICAgXSwgewogICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBhbmltRHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDogJ2ZvcndhcmRzJwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nQ292ZXIuYW5pbWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0cmFuc2Zvcm06ICdzY2FsZSgxKScsIG9wYWNpdHk6ICcxJyB9LAogICAgICAgICAgICAgICAgICAgICAgICAgIHsgdHJhbnNmb3JtOiAnc2NhbGUoMiknLCBvcGFjaXR5OiAnMCcgfQogICAgICAgICAgICAgICAgICAgICAgXSwgewogICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBhbmltRHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDogJ2ZvcndhcmRzJwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9hZGluZ0NvdmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdDb3Zlci5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9LCBhbmltRHVyYXRpb24pOwogICAgICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICAgICAgICB3aW5kb3cuZ2FtZUxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgcmVwb3J0TG9hZGluZ0ZpbmlzaGVkKCk7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCclY1dBUk5JTkc6IERvIG5vdCBwYXN0ZSBhbnkgc2NyaXB0cyBpbnRvIHRoaXMgY29uc29sZS4gUGFzdGluZyBzY3JpcHQvY29kZSBjYW4gY29tcHJvbWlzZSB5b3VyIGRldmljZSBhbmQgbWF5IGxlYWQgdG8gYSBiYW4uJywgJ2NvbG9yOiByZWQ7IGZvbnQtd2VpZ2h0OiBib2xkOycpOwogICAgICAgICAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID0gKGVycm9yLm1lc3NhZ2UgPyBlcnJvci5tZXNzYWdlIDogZXJyb3IudG9TdHJpbmcoKSkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgY3VzdG9tT25FcnJvcihlcnJvck1lc3NhZ2UpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwogICAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxDb25zb2xlRXJyb3IgPSBjb25zb2xlLmVycm9yOwogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvciA9IGZ1bmN0aW9uICguLi5hcmdzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYXJncy5qb2luKCcgJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yTWVzc2FnZS5pbmNsdWRlcygiZXh0cmEgd29yayIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY3VzdG9tT25FcnJvcihlcnJvck1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsQ29uc29sZUVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3MpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkoKTsKICAgICAgICAgICAgZnVuY3Rpb24gY3VzdG9tT25FcnJvcihtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICB2YXIgaXNGaWxlRG93bmxvYWRFcnJvciA9IG1lc3NhZ2UudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnZmFpbGVkIHRvIGRvd25sb2FkIGZpbGUnKSAmJiAobWVzc2FnZS5pbmNsdWRlcygnLmRhdGEnKSB8fCBtZXNzYWdlLmluY2x1ZGVzKCcud2FzbScpIHx8IG1lc3NhZ2UuaW5jbHVkZXMoJy5icicpKTsKICAgICAgICAgICAgICAgIHZhciBpc1dhc21FcnJvciA9IG1lc3NhZ2UudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnYm90aCBhc3luYyBhbmQgc3luYyBmZXRjaGluZyBvZiB0aGUgd2FzbSBmYWlsZWQnKTsKICAgICAgICAgICAgICAgIHZhciBpc1VuYWJsZVRvTG9hZEZpbGVFcnJvciA9IG1lc3NhZ2UudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygidW5hYmxlIHRvIGxvYWQgZmlsZSIpICYmIChtZXNzYWdlLmluY2x1ZGVzKCcuanMnKSB8fCBtZXNzYWdlLmluY2x1ZGVzKCcuYnInKSB8fCBtZXNzYWdlLmluY2x1ZGVzKCcuZnJhbWV3b3JrJykpOwogICAgICAgICAgICAgICAgaWYgKGlzRmlsZURvd25sb2FkRXJyb3IgfHwgaXNXYXNtRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBzaG93UmV0cnlQb3B1cCgiRmFpbGVkIERvd25sb2FkaW5nIEdhbWUgRmlsZXMuIDxicj5DbGljayB0byB0cnkgYWdhaW4uIiwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgZ3RhZygnZXZlbnQnLCAiZG93bmxvYWRHYW1lRmlsZXNGYWlsZWRFcnJvckNhdGNoZWQiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICdldmVudF9jYXRlZ29yeSc6ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgICdldmVudF9sYWJlbCc6IG1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzVW5hYmxlVG9Mb2FkRmlsZUVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgc2hvd1JldHJ5UG9wdXAoIkZhaWxlZCBEb3dubG9hZGluZyBHYW1lIEZpbGVzLiA8YnI+Q2xpY2sgdG8gdHJ5IGFnYWluLiIsIHRydWUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBndGFnKCdldmVudCcsICJkb3dubG9hZEdhbWVGaWxlc0ZhaWxlZEVycm9yQ2F0Y2hlZCIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2V2ZW50X2NhdGVnb3J5JzogJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2V2ZW50X2xhYmVsJzogbWVzc2FnZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvZmZsaW5lJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5nYW1lTG9hZGluZykKICAgICAgICAgICAgICAgICAgICBzaG93UmV0cnlQb3B1cCgiWW91IGFyZSBPZmZsaW5lLiBQbGVhc2UgQ29ubmVjdCB0byB0aGUgaW50ZXJuZXQuIDxicj5DbGljayB0byB0cnkgYWdhaW4iLCB0cnVlLCBmYWxzZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgdG90YWxSZXRyeVRpbWVzID0gMDsKICAgICAgICAgICAgY29uc3QgcmV0cnlVbml0eUxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiUmV0cnlpbmcgdG8gbG9hZCB0aGUgdW5pdHkgaW5zdGFuY2UgKHJldHJ5VW5pdHlMb2FkKSIpOwogICAgICAgICAgICAgICAgaWYgKCFuYXZpZ2F0b3Iub25MaW5lKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIllvdSBhcmUgbm90IG9ubGluZSEgQWJvcnQgcmV0cnlVbml0eUxvYWQuIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VuaXR5UmV0cnlQb3B1cCcpOwogICAgICAgICAgICAgICAgaWYgKHBvcHVwICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChwb3B1cCk7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LnVuaXR5SW5zdGFuY2UpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coInVuaXR5SW5zdGFuY2UgZXhpc3RzISBBYm9ydCByZXRyeVVuaXR5TG9hZC4iKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZW1vdmVTY3JpcHRCeVNyYyhsb2FkZXJVcmwpOwogICAgICAgICAgICAgICAgY29uc3QgX25ld1NjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICAgICAgICAgICAgX25ld1NjcmlwdC5zcmMgPSBsb2FkZXJVcmw7CiAgICAgICAgICAgICAgICB3aW5kb3cuZ2FtZUxvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgcmVwb3J0TG9hZGluZ1N0YXJ0KCk7CiAgICAgICAgICAgICAgICB2YXIgcmVhY2hlZExhc3RMb2FkaW5nU3RlcCA9IGZhbHNlOwogICAgICAgICAgICAgICAgX25ld1NjcmlwdC5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY3JlYXRlVW5pdHlJbnN0YW5jZShjYW52YXMsIGNvbmZpZywgKHByb2dyZXNzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9uUHJvZ3Jlc3NVbml0eShwcm9ncmVzcyk7CiAgICAgICAgICAgICAgICAgICAgfSkudGhlbigodW5pdHlJbnN0YW5jZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRpcEludGVydmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnVuaXR5SW5zdGFuY2UgPSB1bml0eUluc3RhbmNlOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub25HYW1lTG9hZGVkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFuaW1EdXJhdGlvbiA9IDIwMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdDb3Zlci5hbmltYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IG9wYWNpdHk6ICcxJyB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgb3BhY2l0eTogJzAnIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogYW5pbUR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGw6ICdmb3J3YXJkcycKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ0NvdmVyLmFuaW1hdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdHJhbnNmb3JtOiAnc2NhbGUoMSknLCBvcGFjaXR5OiAnMScgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHRyYW5zZm9ybTogJ3NjYWxlKDIpJywgb3BhY2l0eTogJzAnIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogYW5pbUR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGw6ICdmb3J3YXJkcycKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRpbmdDb3ZlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nQ292ZXIucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgYW5pbUR1cmF0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmdhbWVMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydExvYWRpbmdGaW5pc2hlZCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnJWNXQVJOSU5HOiBEbyBub3QgcGFzdGUgYW55IHNjcmlwdHMgaW50byB0aGlzIGNvbnNvbGUuIFBhc3Rpbmcgc2NyaXB0L2NvZGUgY2FuIGNvbXByb21pc2UgeW91ciBkZXZpY2UgYW5kIG1heSBsZWFkIHRvIGEgYmFuLicsICdjb2xvcjogcmVkOyBmb250LXdlaWdodDogYm9sZDsnKTsKICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9IChlcnJvci5tZXNzYWdlID8gZXJyb3IubWVzc2FnZSA6IGVycm9yLnRvU3RyaW5nKCkpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbU9uRXJyb3IoZXJyb3JNZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKF9uZXdTY3JpcHQpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBmdW5jdGlvbiBzaG93UmV0cnlQb3B1cChtZXNzYWdlLCByZXRyeSwgcmV0cnlSbikgewogICAgICAgICAgICAgICAgaWYgKCF3aW5kb3cuZ2FtZUxvYWRpbmcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy51bml0eUluc3RhbmNlKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGlmIChyZXRyeVJuICYmIHRvdGFsUmV0cnlUaW1lcyA8PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0cnlVbml0eUxvYWQoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgZXhpc3RpbmdQb3B1cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1bml0eVJldHJ5UG9wdXAnKTsKICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ1BvcHVwKSB7CiAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdQb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXAtY29udGVudCcpLmlubmVySFRNTCA9IG1lc3NhZ2U7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHBvcHVwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgICAgICBwb3B1cC5pZCA9ICd1bml0eVJldHJ5UG9wdXAnOwogICAgICAgICAgICAgICAgcG9wdXAuc3R5bGUucG9zaXRpb24gPSAiZml4ZWQiOwogICAgICAgICAgICAgICAgcG9wdXAuc3R5bGUubGVmdCA9ICIwIjsKICAgICAgICAgICAgICAgIHBvcHVwLnN0eWxlLnRvcCA9ICIwIjsKICAgICAgICAgICAgICAgIHBvcHVwLnN0eWxlLndpZHRoID0gIjEwMCUiOwogICAgICAgICAgICAgICAgcG9wdXAuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICAgICAgICAgICAgcG9wdXAuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gInJnYmEoMCwgMCwgMCwgMC45KSI7CiAgICAgICAgICAgICAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwogICAgICAgICAgICAgICAgcG9wdXAuc3R5bGUuYWxpZ25JdGVtcyA9ICJjZW50ZXIiOwogICAgICAgICAgICAgICAgcG9wdXAuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAiY2VudGVyIjsKICAgICAgICAgICAgICAgIHBvcHVwLnN0eWxlLnVzZXJTZWxlY3QgPSAibm9uZSI7CiAgICAgICAgICAgICAgICBwb3B1cC5zdHlsZS56SW5kZXggPSAiMTAwMCI7CiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICAgICAgY29udGVudC5zdHlsZS5wYWRkaW5nID0gIjIwcHgiOwogICAgICAgICAgICAgICAgY29udGVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiIzMzMyI7IC8vIERhcmsgYmFja2dyb3VuZCBmb3IgdGhlIGNvbnRlbnQKICAgICAgICAgICAgICAgIGNvbnRlbnQuc3R5bGUuY29sb3IgPSAiI2ZmZiI7IC8vIFdoaXRlIHRleHQgY29sb3IKICAgICAgICAgICAgICAgIGNvbnRlbnQuc3R5bGUuYm9yZGVyUmFkaXVzID0gIjE1cHgiOyAvLyBSb3VuZGVkIGNvcm5lcnMKICAgICAgICAgICAgICAgIGNvbnRlbnQuc3R5bGUudGV4dEFsaWduID0gImNlbnRlciI7CiAgICAgICAgICAgICAgICBjb250ZW50LnN0eWxlLm1heFdpZHRoID0gIjgwJSI7CiAgICAgICAgICAgICAgICBjb250ZW50LnN0eWxlLmZvbnRTaXplID0gIjE4cHgiOwogICAgICAgICAgICAgICAgY29udGVudC5pbm5lckhUTUwgPSBtZXNzYWdlOwogICAgICAgICAgICAgICAgY29udGVudC5zdHlsZS5mb250RmFtaWx5ID0gIidTZWdvZSBVSScsIFRhaG9tYSwgR2VuZXZhLCBWZXJkYW5hLCBzYW5zLXNlcmlmIjsKICAgICAgICAgICAgICAgIGNvbnRlbnQuc3R5bGUuYm94U2hhZG93ID0gIjAgMTBweCAxMHB4IHJnYmEoMCwgMCwgMCwgMC4yKSI7CiAgICAgICAgICAgICAgICBjb250ZW50LnN0eWxlLmN1cnNvciA9ICJwb2ludGVyIjsgLy8gQ2hhbmdlIGN1cnNvciBvbiBob3ZlcgogICAgICAgICAgICAgICAgY29udGVudC5zdHlsZS51c2VyU2VsZWN0ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgcG9wdXAuYXBwZW5kQ2hpbGQoY29udGVudCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBvcHVwKTsKICAgICAgICAgICAgICAgIGlmIChyZXRyeSkgewogICAgICAgICAgICAgICAgICAgIHBvcHVwLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgcmV0cnlVbml0eUxvYWQpOwogICAgICAgICAgICAgICAgICAgIHBvcHVwLmFkZEV2ZW50TGlzdGVuZXIoInRvdWNoc3RhcnQiLCByZXRyeVVuaXR5TG9hZCwgeyBwYXNzaXZlOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQocG9wdXApOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHBvcHVwLmFkZEV2ZW50TGlzdGVuZXIoInRvdWNoc3RhcnQiLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQocG9wdXApOwogICAgICAgICAgICAgICAgICAgIH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKF9zY3JpcHQpOwogICAgICAgICAgICBmdW5jdGlvbiByZW1vdmVTY3JpcHRCeVNyYyhzcmMpIHsKICAgICAgICAgICAgICAgIGxldCBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNjcmlwdHNbaV0uc3JjID09PSBzcmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0c1tpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNjcmlwdHNbaV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICB9KTsKCQkKCQl9KTsKICAgIDwvc2NyaXB0PgoJCgkKCQoJCgkKCQoJCiAgICA8c2NyaXB0PgogICAgICAgIC8vdjIKICAgICAgICBjb25zdCBmaXJlYmFzZUJhc2UgPSBpc0Rpc2NvcmQKICAgICAgICAgICAgPyAnLy5wcm94eS9nc3RhdGljL2ZpcmViYXNlanMvMTAuOC4wLycKICAgICAgICAgICAgOiAnaHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vZmlyZWJhc2Vqcy8xMC44LjAvJzsKCiAgICAgICAgY29uc3QgZmlyZWJhc2VTY3JpcHRzID0gWwogICAgICAgICAgICAnZmlyZWJhc2UtYXBwLWNvbXBhdC5qcycsICAgLy8gTVVTVCBjb21lIGZpcnN0CiAgICAgICAgICAgICdmaXJlYmFzZS1hdXRoLWNvbXBhdC5qcycsCiAgICAgICAgICAgICdmaXJlYmFzZS1kYXRhYmFzZS1jb21wYXQuanMnLAogICAgICAgICAgICAnZmlyZWJhc2UtZnVuY3Rpb25zLWNvbXBhdC5qcycKICAgICAgICBdOwoKICAgICAgICBmdW5jdGlvbiBsb2FkU2NyaXB0c1NlcXVlbnRpYWxseShpbmRleCA9IDAsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGlmIChpbmRleCA+PSBmaXJlYmFzZVNjcmlwdHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICAgICAgc2NyaXB0LnNyYyA9IGZpcmViYXNlQmFzZSArIGZpcmViYXNlU2NyaXB0c1tpbmRleF07CiAgICAgICAgICAgIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiBsb2FkU2NyaXB0c1NlcXVlbnRpYWxseShpbmRleCArIDEsIGNhbGxiYWNrKTsKICAgICAgICAgICAgc2NyaXB0Lm9uZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gbG9hZCBGaXJlYmFzZSBzY3JpcHQ6ICR7ZmlyZWJhc2VTY3JpcHRzW2luZGV4XX1gKTsKICAgICAgICAgICAgICAgIGxvYWRTY3JpcHRzU2VxdWVudGlhbGx5KGluZGV4ICsgMSwgY2FsbGJhY2spOwogICAgICAgICAgICB9OwogICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsb2FkRmlyZWJhc2UyKCkgewogICAgICAgICAgICBjb25zdCBmaXJlYmFzZTJTY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICAgICAgZmlyZWJhc2UyU2NyaXB0LnNyYyA9ICdmaXJlYmFzZTIuanMnOwogICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGZpcmViYXNlMlNjcmlwdCk7CiAgICAgICAgfQoKICAgICAgICAvLyBBbHdheXMgbG9hZCBzZXF1ZW50aWFsbHkgdG8gZW5zdXJlIGZpcmViYXNlLWFwcCBsb2FkcyBmaXJzdAogICAgICAgIGxvYWRTY3JpcHRzU2VxdWVudGlhbGx5KDAsIGxvYWRGaXJlYmFzZTIpOwogICAgPC9zY3JpcHQ+CiAgICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+CiAgICAgICAgZnVuY3Rpb24gdGVzdERldmljZSgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIG5hdmlnYXRvci5nZXRCYXR0ZXJ5KCkudGhlbihmdW5jdGlvbiAoYmF0dGVyeSkgewogICAgICAgICAgICAgICAgICAgIGlmIChiYXR0ZXJ5LmNoYXJnaW5nICYmIGJhdHRlcnkuY2hhcmdpbmdUaW1lID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXR5SW5zdGFuY2VXcmFwcGVyLnNlbmRNZXNzYWdlKCdNYWluTWFuYWdlcicsICdPbkdvdERldmljZScsICJEZXNrdG9wIik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW5pdHlJbnN0YW5jZVdyYXBwZXIuc2VuZE1lc3NhZ2UoJ01haW5NYW5hZ2VyJywgJ09uR290RGV2aWNlJywgIkxhcHRvcCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgIHVuaXR5SW5zdGFuY2VXcmFwcGVyLnNlbmRNZXNzYWdlKCdNYWluTWFuYWdlcicsICdPbkdvdERldmljZScsICJVbmtub3duIik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIHVuaXR5SW5zdGFuY2VXcmFwcGVyLnNlbmRNZXNzYWdlKCdNYWluTWFuYWdlcicsICdPbkdvdERldmljZScsICJVbmtub3duIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gU2V0UGF5cGFsUGF5bWVudFdpbmRvdyh4KSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXlwYWxQYXltZW50V2luZG93Jykuc3R5bGUuZGlzcGxheSA9IHg7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIENhbmNlbFBheXBhbFByb2Nlc3MoKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXlwYWxQYXltZW50V2luZG93Jykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgdW5pdHlJbnN0YW5jZVdyYXBwZXIuc2VuZE1lc3NhZ2UoJ1BheW1lbnRzJywgJ09uUGF5UGFsUHVyY2hhc2VGaW5pc2hlZCcsICIwIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFB1cmNoYXNlKGFtb3VudCkgewogICAgICAgICAgICB3aW5kb3cuY3VycmVudFBheW1lbnRQcmljZSA9IGFtb3VudDsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheXBhbFBheW1lbnRXaW5kb3cnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gU2V0VVJMKGFkZCkgewogICAgICAgICAgICB2YXIgY3VycmVudFVSTCA9IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICIvLyIgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArIGFkZDsKICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHsgcGF0aDogY3VycmVudFVSTCB9LCAnJywgY3VycmVudFVSTCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNvcHlDdXJyZW50VVJMKCkgewogICAgICAgICAgICB2YXIgdSA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICAgICAgICBzZXRDbGlwYm9hcmQodSk7CiAgICAgICAgfQoKCiAgICAgICAgLy92NAogICAgICAgIGZ1bmN0aW9uIExvY2tDdXJzb3IoZW5hYmxlQWNjZWxlcmF0aW9uKSB7CiAgICAgICAgICAgIC8vIENoZWNrIGZvciBBUEkgc3VwcG9ydAogICAgICAgICAgICBpZiAoIWNhbnZhcy5yZXF1ZXN0UG9pbnRlckxvY2spIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlBvaW50ZXIgTG9jayBBUEkgaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXIuIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERldGVybWluZSBpZiB1bmFkanVzdGVkIG1vdmVtZW50IHNob3VsZCBiZSB1c2VkCiAgICAgICAgICAgIGNvbnN0IHVzZVVuYWRqdXN0ZWRNb3ZlbWVudCA9IGVuYWJsZUFjY2VsZXJhdGlvbiA9PT0gIjAiOwogICAgICAgICAgICBjb25zb2xlLmxvZyhgTG9ja0N1cnNvciBjYWxsZWQgd2l0aCBlbmFibGVBY2NlbGVyYXRpb246ICR7ZW5hYmxlQWNjZWxlcmF0aW9ufWApOwogICAgICAgICAgICBjb25zb2xlLmxvZyhgdXNlVW5hZGp1c3RlZE1vdmVtZW50IHNldCB0bzogJHt1c2VVbmFkanVzdGVkTW92ZW1lbnR9YCk7CgogICAgICAgICAgICAvLyBBdHRlbXB0IHRvIGxvY2sgdGhlIHBvaW50ZXIgd2l0aCB0aGUgZGVzaXJlZCBzZXR0aW5ncwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgcHJvbWlzZSA9IGNhbnZhcy5yZXF1ZXN0UG9pbnRlckxvY2soeyB1bmFkanVzdGVkTW92ZW1lbnQ6IHVzZVVuYWRqdXN0ZWRNb3ZlbWVudCB9KTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJQb2ludGVyIGxvY2sgcmVxdWVzdCBpbml0aWF0ZWQuIik7CgogICAgICAgICAgICAgICAgLy8gSGFuZGxlIGJyb3dzZXJzIHRoYXQgcmV0dXJuIGEgcHJvbWlzZQogICAgICAgICAgICAgICAgaWYgKHByb21pc2UpIHsKICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiUG9pbnRlciBsb2NrIHN1Y2Nlc3NmdWxseSBhY3F1aXJlZC4iKTsKICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiUG9pbnRlciBsb2NrIHJlcXVlc3QgZmFpbGVkOiIsIGVycm9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLm5hbWUgPT09ICJOb3RTdXBwb3J0ZWRFcnJvciIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hZGp1c3RlZCBtb3ZlbWVudCBub3Qgc3VwcG9ydGVkOyBmYWxsaW5nIGJhY2sgdG8gc3RhbmRhcmQgcG9pbnRlciBsb2NrLiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzLnJlcXVlc3RQb2ludGVyTG9jaygpLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJTdGFuZGFyZCBwb2ludGVyIGxvY2sgc3VjY2Vzc2Z1bGx5IGFjcXVpcmVkLiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlN0YW5kYXJkIHBvaW50ZXIgbG9jayByZXF1ZXN0IGZhaWxlZDoiLCBlcnIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGR1cmluZyBwb2ludGVyIGxvY2sgcmVxdWVzdDoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBjYW52YXMucmVxdWVzdFBvaW50ZXJMb2NrKCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlN0YW5kYXJkIHBvaW50ZXIgbG9jayBzdWNjZXNzZnVsbHkgYWNxdWlyZWQgYWZ0ZXIgY2F0Y2hpbmcgZXJyb3IuIik7CiAgICAgICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiU3RhbmRhcmQgcG9pbnRlciBsb2NrIHJlcXVlc3QgZmFpbGVkIGFmdGVyIGNhdGNoaW5nIGVycm9yOiIsIGVycik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCgoKICAgICAgICBmdW5jdGlvbiBoYW5kbGVQb2ludGVyTG9ja0Vycm9yKGVycm9yKSB7CiAgICAgICAgICAgIGlmIChlcnJvci5uYW1lID09PSAiTm90U3VwcG9ydGVkRXJyb3IiKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJVbmFkanVzdGVkIG1vdmVtZW50IG5vdCBzdXBwb3J0ZWQsIGF0dGVtcHRpbmcgdG8gbG9jayBwb2ludGVyIHdpdGhvdXQgaXQuIik7CiAgICAgICAgICAgICAgICBjYW52YXMucmVxdWVzdFBvaW50ZXJMb2NrKCk7IC8vIEZhbGxiYWNrIHRvIGJhc2ljIHBvaW50ZXIgbG9jawogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRmFpbGVkIHRvIGxvY2sgcG9pbnRlcjoiLCBlcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFNldHVwIGV2ZW50IGxpc3RlbmVycyBmb3IgcG9pbnRlciBsb2NrIHN0YXRlIGNoYW5nZXMKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVybG9ja2NoYW5nZScsIGxvY2tDaGFuZ2VBbGVydCwgZmFsc2UpOwogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21venBvaW50ZXJsb2NrY2hhbmdlJywgbG9ja0NoYW5nZUFsZXJ0LCBmYWxzZSk7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignd2Via2l0cG9pbnRlcmxvY2tjaGFuZ2UnLCBsb2NrQ2hhbmdlQWxlcnQsIGZhbHNlKTsKCiAgICAgICAgZnVuY3Rpb24gbG9ja0NoYW5nZUFsZXJ0KCkgewogICAgICAgICAgICBpZiAoZG9jdW1lbnQucG9pbnRlckxvY2tFbGVtZW50ID09PSBjYW52YXMgfHwgZG9jdW1lbnQubW96UG9pbnRlckxvY2tFbGVtZW50ID09PSBjYW52YXMpIHsKICAgICAgICAgICAgICAgIC8vIFBvaW50ZXIgd2FzIHN1Y2Nlc3NmdWxseSBsb2NrZWQKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIlBvaW50ZXIgbG9ja2VkIHN1Y2Nlc3NmdWxseS4iKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5pc01vdXNlTG9ja2VkID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFBvaW50ZXIgd2FzIHVubG9ja2VkCiAgICAgICAgICAgICAgICB3aW5kb3cuaXNNb3VzZUxvY2tlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdW5pdHlJbnN0YW5jZVdyYXBwZXIuc2VuZE1lc3NhZ2UoJ01haW5NYW5hZ2VyJywgJ09uRXNjYXBlSlMnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCgogICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUZ1bGxzY3JlZW4oKSB7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgb3BlbkZ1bGxzY3JlZW4oKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBleGl0RnVsbHNjcmVlbigpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvcGVuRnVsbHNjcmVlbigpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnJlcXVlc3RGdWxsc2NyZWVuKCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGV4aXRGdWxsc2NyZWVuKCkgewogICAgICAgICAgICBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpOwogICAgICAgIH0KICAgICAgICBhc3luYyBmdW5jdGlvbiBzZXRDbGlwYm9hcmQoc3RyaW5nVG9TZXRBc0NsaXBib2FyZCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoc3RyaW5nVG9TZXRBc0NsaXBib2FyZCk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVGV4dCBjb3BpZWQgdG8gY2xpcGJvYXJkIHN1Y2Nlc3NmdWxseSEnKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY29weSB0ZXh0OiAnLCBlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldENsaXBib2FyZCgpIHsKICAgICAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC5yZWFkVGV4dCgpCiAgICAgICAgICAgICAgICAudGhlbigoY2xpcGJvYXJkQ29udGVudCkgPT4gewogICAgICAgICAgICAgICAgICAgIHVuaXR5SW5zdGFuY2VXcmFwcGVyLnNlbmRNZXNzYWdlKCdNYWluTWFuYWdlcicsICdPbkdvdENsaXBib2FyZCcsIGNsaXBib2FyZENvbnRlbnQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDbGlwYm9hcmQgYWNjZXNzIGVycm9yOicsIGVycm9yKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigid2ViZ2xjb250ZXh0bG9zdCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICByZXRyeVVuaXR5TG9hZCgpOwogICAgICAgIH0sIGZhbHNlKTsKICAgICAgICBjb25zdCBzY3JpcHRTcmMgPSB3aW5kb3cuc2RrVmVyc2lvbiA9PT0gIkNyYXp5R2FtZXMiID8gJ3Nka01hbmFnZXJfY2cuanMnIDogJ3Nka01hbmFnZXIuanMnOwogICAgICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgICAgIHNjcmlwdC5zcmMgPSBzY3JpcHRTcmM7CiAgICAgICAgc2NyaXB0LmRlZmVyID0gdHJ1ZTsKICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7CiAgICA8L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJtYXBNYW5hZ2VyLmpzIiBhc3luYz48L3NjcmlwdD4KPHNjcmlwdCBkZWZlciBzcmM9Imh0dHBzOi8vc3RhdGljLmNsb3VkZmxhcmVpbnNpZ2h0cy5jb20vYmVhY29uLm1pbi5qcy92Y2QxNWNiZTc3NzJmNDljMzk5YzZhNWJhYmYyMmMxMjQxNzE3Njg5MTc2MDE1IiBpbnRlZ3JpdHk9InNoYTUxMi1acHNPbWxSUVY2eTkwN1RJMGRLQkhxOU1kMjlubmFFSVBsa2Y4NHJuYUVSbnE2enZXdlBVcXIyZnQ4TTFhUzI4b043MlBkckN6U2pZNFU2VmFBdzFFUT09IiBkYXRhLWNmLWJlYWNvbj0neyJ2ZXJzaW9uIjoiMjAyNC4xMS4wIiwidG9rZW4iOiJlZWYwNTgzY2E5ODQ0ZThmYWI0YmFmZmM3ZmUwZGM0ZCIsInIiOjEsInNlcnZlcl90aW1pbmciOnsibmFtZSI6eyJjZkNhY2hlU3RhdHVzIjp0cnVlLCJjZkVkZ2UiOnRydWUsImNmRXh0UHJpIjp0cnVlLCJjZkw0Ijp0cnVlLCJjZk9yaWdpbiI6dHJ1ZSwiY2ZTcGVlZEJyYWluIjp0cnVlfSwibG9jYXRpb25fc3RhcnRzd2l0aCI6bnVsbH19JyBjcm9zc29yaWdpbj0iYW5vbnltb3VzIj48L3NjcmlwdD4KCgoKCjxzY3JpcHQ+CgovLyBQcmV2ZW50cyB0aGUgcGFnZSB1cmwgZnJvbSBiZWluZyBjaGFuZ2VkLiBSZW1vdmUgaWYgbmVjY2VzYXJ5LgoKaGlzdG9yeS5wdXNoU3RhdGU9aGlzdG9yeS5yZXBsYWNlU3RhdGU9KCk9Pnt9OyBsb2NhdGlvbi5hc3NpZ249bG9jYXRpb24ucmVwbGFjZT0oKT0+e307IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csJ2xvY2F0aW9uJyx7c2V0OigpPT57fSxnZXQ6KCk9PndpbmRvdy5sb2NhdGlvbn0pOwoKPC9zY3JpcHQ+CgoKCjwvYm9keT4KPC9odG1sPgo=";
