window.game = "PCFET0NUWVBFIGh0bWw+DQoNCg0KPCEtLSBVbHRpbWF0ZSBHYW1lIFN0YXNoIGZpbGUtLT4gDQo8IS0tIEZvciB0aGUgcmVndWxhcmx5IHVwZGF0aW5nIGRvYyBnbyB0byBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFfRm1IM0JsU0JRSTdGR2dBUUw1OS1aUGU4ZUN4czM1d2VsNkpVeVZhRzhRLyAtLT4NCg0KDQo8YmFzZSBocmVmPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvYnViYmxzL1VHUy1Bc3NldHNAZTRlZWY1MDM2MWQ5ZTU3NWJjN2NkODM0ZTE0Mzg4YzZlNjc1YTY3ZS9zdGVhbCUyMGJyYWlucm90LyI+DQo8aHRtbCBsYW5nPSJlbi11cyI+DQoNCjxoZWFkPg0KICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCIgLz4NCiAgPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiIC8+DQogIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCB1c2VyLXNjYWxhYmxlPW5vIiAvPg0KICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Ii4vc3R5bGUuY3NzIiAvPiANCiAgPCEtLSBZYW5kZXggR2FtZXMgU0RLIC0tPg0KICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2duLW1hdGgvYXNzZXRzQG1haW4veWFuZGV4LXNkay5qcz9sb2wiPjwvc2NyaXB0Pg0KICA8c3R5bGU+DQogICAgY2FudmFzOmZvY3VzIHsNCiAgICAgIG91dGxpbmU6IG5vbmU7DQogICAgfQ0KDQogICAgaHRtbCwNCiAgICBib2R5IHsNCiAgICAgIHBhZGRpbmc6IDA7DQogICAgICBtYXJnaW46IDA7DQogICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgLXdlYmtpdC10b3VjaC1jYWxsb3V0OiBub25lOw0KICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIC1raHRtbC11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIC1tb3otdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAtbXMtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICB1c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwKTsNCiAgICAgIGhlaWdodDogMTAwJTsNCiAgICB9DQogIDwvc3R5bGU+DQogIDwhLS0gQWRkaXRpb25hbCBoZWFkIG1vZHVsZXMgLS0+DQo8L2hlYWQ+DQoNCjxib2R5IGNsYXNzPSJkYXJrIj4NCiAgPGRpdiBpZD0idW5pdHktY29udGFpbmVyIiBjbGFzcz0idW5pdHktZGVza3RvcCI+DQogICAgPGNhbnZhcyBpZD0idW5pdHktY2FudmFzIiB0YWJpbmRleD0iLTEiPjwvY2FudmFzPg0KICA8L2Rpdj4NCiAgPGRpdiBpZD0ibG9hZGluZy1jb3ZlciIgc3R5bGU9ImRpc3BsYXk6IG5vbmUiPg0KICAgIDxkaXYgaWQ9InVuaXR5LWxvYWRpbmctYmFyIj4NCiAgICAgIDxkaXYgaWQ9InVuaXR5LWxvZ28iPjxpbWcgc3JjPSJJbWFnZXMvbG9nby5wbmciIC8+PC9kaXY+DQogICAgICA8ZGl2IGlkPSJ1bml0eS1wcm9ncmVzcy1iYXItZW1wdHkiIHN0eWxlPSJkaXNwbGF5OiBub25lIj4NCiAgICAgICAgPGRpdiBpZD0idW5pdHktcHJvZ3Jlc3MtYmFyLWZ1bGwiPjwvZGl2Pg0KICAgICAgPC9kaXY+DQogICAgICA8ZGl2IGNsYXNzPSJzcGlubmVyIj48L2Rpdj4NCiAgICA8L2Rpdj4NCiAgPC9kaXY+DQogIDwhLS0gQWRkaXRpb25hbCBib2R5IG1vZHVsZXMgLS0+DQogIDxzY3JpcHQ+DQogICAgICAgICAgICBmdW5jdGlvbiBtZXJnZUZpbGVzKGZpbGVQYXJ0cykgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgYnVmZmVycyA9IFtdOw0KDQogICAgICAgICAgICAgICAgZnVuY3Rpb24gZmV0Y2hQYXJ0KGluZGV4KSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSBmaWxlUGFydHMubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgbWVyZ2VkQmxvYiA9IG5ldyBCbG9iKGJ1ZmZlcnMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1lcmdlZEZpbGVVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKG1lcmdlZEJsb2IpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShtZXJnZWRGaWxlVXJsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBmZXRjaChmaWxlUGFydHNbaW5kZXhdKS50aGVuKChyZXNwb25zZSkgPT4gcmVzcG9uc2UuYXJyYXlCdWZmZXIoKSkudGhlbigoZGF0YSkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVycy5wdXNoKGRhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hQYXJ0KGluZGV4ICsgMSk7DQogICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKHJlamVjdCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGZldGNoUGFydCgwKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gZ2V0UGFydHMoZmlsZSwgc3RhcnQsIGVuZCkgew0KICAgICAgICAgICAgbGV0IHBhcnRzID0gW107DQogICAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPD0gZW5kOyBpKyspIHsNCiAgICAgICAgICAgICAgICBwYXJ0cy5wdXNoKGZpbGUgKyAiLnBhcnQiICsgaSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gcGFydHM7DQogICAgICAgIH0NCiAgICB2YXIgYnVpbGRVcmwgPSAiQnVpbGQiOw0KICAgIHZhciBsb2FkZXJVcmwgPSBidWlsZFVybCArICIvU3RlYWxCcmFpbnJvdC5sb2FkZXIuanMiOw0KICAgIHZhciBjb25maWcgPSBudWxsOw0KICAgIFByb21pc2UuYWxsKFsNCiAgICAgICAgbWVyZ2VGaWxlcyhnZXRQYXJ0cygiQnVpbGQvNjc2YmZlNjY1NzYzNDcwM2ZiN2FlNTA3N2JkNDJkOTMuZGF0YS5iciIsIDEsIDIpKSwNCiAgICAgICAgbWVyZ2VGaWxlcyhnZXRQYXJ0cygiQnVpbGQvMzIyMWI3ZTZhOWI2N2NjN2I1ODA5MjFjNTczZDUxZTkud2FzbS5iciIsIDEsIDMpKQ0KICAgIF0pLnRoZW4oKFtkYXRhVXJsLCB3YXNtVXJsXSkgPT4gew0KICAgICAgICBjb250YWluZXIuaGlkZGVuID0gZmFsc2U7DQogICAgICAgIGNvbnN0IGhpZGVGdWxsU2NyZWVuQnV0dG9uID0gIiI7DQogICAgICAgIGNvbmZpZyA9IHsNCiAgICAgICAgICBkYXRhVXJsOiBkYXRhVXJsLA0KICAgICAgICAgIGZyYW1ld29ya1VybDogIkJ1aWxkL2ZhZTZhNGM1ZjI3MTVkZDg1OTVkODM2YzRiNWY5Y2FhLmpzIiwNCiAgICAgICAgICBjb2RlVXJsOiB3YXNtVXJsLCANCiAgICAgICAgICBzdHJlYW1pbmdBc3NldHNVcmw6ICJTdHJlYW1pbmdBc3NldHMiLA0KICAgICAgICAgIGNvbXBhbnlOYW1lOiAiTmFnYW1pR2FtZXMiLA0KICAgICAgICAgIHByb2R1Y3ROYW1lOiAiQmlrZU9mSGVsbCIsDQogICAgICAgICAgcHJvZHVjdFZlcnNpb246ICIwLjEiLA0KICAgICAgICB9Ow0KICAgICAgICAvLyBFbnN1cmUgU3RhcnRVbml0eUluc3RhbmNlIGlzIGNhbGxlZCBvbmx5IGFmdGVyIGNvbmZpZyBpcyBzZXQNCiAgICAgICAgaWYgKElzTG9jYWxIb3N0KCkgfHwgc3luY0luaXQpIFN0YXJ0VW5pdHlJbnN0YW5jZV9JZlVubG9hZGVkKCk7DQogICAgfSk7DQoNCg0KICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1jb250YWluZXIiKTsNCiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjdW5pdHktY2FudmFzIik7DQogICAgY29uc3QgbG9hZGluZ0NvdmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2xvYWRpbmctY292ZXIiKTsNCiAgICBjb25zdCBwcm9ncmVzc0JhckVtcHR5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigNCiAgICAgICIjdW5pdHktcHJvZ3Jlc3MtYmFyLWVtcHR5Ig0KICAgICk7DQogICAgY29uc3QgcHJvZ3Jlc3NCYXJGdWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigNCiAgICAgICIjdW5pdHktcHJvZ3Jlc3MtYmFyLWZ1bGwiDQogICAgKTsNCiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnNwaW5uZXIiKTsNCg0KICAgIGNvbnN0IGNhbkZ1bGxzY3JlZW4gPSAoZnVuY3Rpb24oKSB7DQogICAgICBmb3IgKGNvbnN0IGtleSBvZiBbDQogICAgICAgICAgImV4aXRGdWxsc2NyZWVuIiwNCiAgICAgICAgICAid2Via2l0RXhpdEZ1bGxzY3JlZW4iLA0KICAgICAgICAgICJ3ZWJraXRDYW5jZWxGdWxsU2NyZWVuIiwNCiAgICAgICAgICAibW96Q2FuY2VsRnVsbFNjcmVlbiIsDQogICAgICAgICAgIm1zRXhpdEZ1bGxzY3JlZW4iLA0KICAgICAgICBdKSB7DQogICAgICAgIGlmIChrZXkgaW4gZG9jdW1lbnQpIHsNCiAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0pKCk7DQoNCiAgICBpZiAoL2lQaG9uZXxpUGFkfGlQb2R8QW5kcm9pZC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsNCiAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSAidW5pdHktbW9iaWxlIjsNCiAgICB9DQoNCiAgICAvLyBUaGUgYmFja2dyb3VuZCBpbWFnZSB3aGVuIGxvYWRpbmcgdGhlIGdhbWUuIFdoZW4gYnVpbGRpbmcgYSBidWlsZCwgdGhlIGNvZGUgY2hhbmdlcyBkZXBlbmRpbmcgb24gdGhlIHByb2plY3Qgc2V0dGluZ3MuDQoNCiAgICBsb2FkaW5nQ292ZXIuc3R5bGUuZGlzcGxheSA9ICIiOw0KDQogICAgbGV0IFN0YXJ0VW5pdHlJbnN0YW5jZTsNCiAgICBsZXQgeWdHYW1lSW5zdGFuY2UgPSBudWxsOw0KICAgIGxldCB5c2RrID0gbnVsbDsNCiAgICBsZXQgaW5pdFlTREsgPSBmYWxzZTsNCiAgICBsZXQgaW5pdEdhbWUgPSBmYWxzZTsNCiAgICBsZXQgc3luY0luaXQgPSBmYWxzZTsNCiAgICBsZXQgaXNWaXNpYmlsaXR5ID0gdHJ1ZTsNCiAgICBsZXQgaXNQYXVzZWRHYW1lID0gZmFsc2U7DQogICAgY29uc3QgTk9fREFUQSA9ICJubyBkYXRhIjsNCg0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNvbnRleHRtZW51IiwgKGV2ZW50KSA9Pg0KICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKQ0KICAgICk7DQogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigidmlzaWJpbGl0eWNoYW5nZSIsICgpID0+DQogICAgICBTZXRWaXNpYmlsaXR5KCFkb2N1bWVudC5oaWRkZW4pDQogICAgKTsNCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiYmx1ciIsICgpID0+IFNldFZpc2liaWxpdHkoZmFsc2UpKTsNCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiZm9jdXMiLCAoKSA9PiBTZXRWaXNpYmlsaXR5KHRydWUpKTsNCg0KICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsICgpID0+IHsNCiAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgU2V0VmlzaWJpbGl0eSh0cnVlKTsNCiAgICB9KTsNCg0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNhbnZhcyIpOw0KICAgICAgaWYgKGNhbnZhcyAmJiBjYW52YXMucmVxdWVzdFBvaW50ZXJMb2NrKSB7DQogICAgICAgIGNhbnZhcy5yZXF1ZXN0UG9pbnRlckxvY2soew0KICAgICAgICAgIHVuYWRqdXN0ZWRNb3ZlbWVudDogdHJ1ZQ0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9KTsNCg0KICAgIGZ1bmN0aW9uIEluc3RhbGxCbHVyRm9jdXNCbG9ja2VyKCkgew0KICAgICAgaWYgKCEoIm9uYmx1ciIgaW4gZG9jdW1lbnQpKSByZXR1cm47DQogICAgICBpZiAod2luZG93LmJsdXJGb2N1c0hhbmRsZXJzSW5zdGFsbGVkKSByZXR1cm47DQoNCiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJibHVyIiwgZnVuY3Rpb24oKSB7DQogICAgICAgIGxldCBibG9ja2VyQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7DQogICAgICAgIGJsb2NrZXJCdXR0b24uc3R5bGUucG9zaXRpb24gPSAiZml4ZWQiOw0KICAgICAgICBibG9ja2VyQnV0dG9uLnN0eWxlLnRvcCA9ICIwIjsNCiAgICAgICAgYmxvY2tlckJ1dHRvbi5zdHlsZS5sZWZ0ID0gIjAiOw0KICAgICAgICBibG9ja2VyQnV0dG9uLnN0eWxlLndpZHRoID0gIjEwMCUiOw0KICAgICAgICBibG9ja2VyQnV0dG9uLnN0eWxlLmhlaWdodCA9ICIxMDAlIjsNCiAgICAgICAgYmxvY2tlckJ1dHRvbi5zdHlsZS56SW5kZXggPSAiOTk5OSI7DQogICAgICAgIGJsb2NrZXJCdXR0b24uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gInJnYmEoMCwgMCwgMCwgMCkiOw0KICAgICAgICBibG9ja2VyQnV0dG9uLnN0eWxlLmJvcmRlciA9ICJub25lIjsNCiAgICAgICAgYmxvY2tlckJ1dHRvbi5zdHlsZS5jdXJzb3IgPSAiZGVmYXVsdCI7DQoNCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChibG9ja2VyQnV0dG9uKTsNCg0KICAgICAgICBmdW5jdGlvbiByZW1vdmVCbG9ja2VyKCkgew0KICAgICAgICAgIGlmIChibG9ja2VyQnV0dG9uICYmIGJsb2NrZXJCdXR0b24ucGFyZW50Tm9kZSkgew0KICAgICAgICAgICAgYmxvY2tlckJ1dHRvbi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGJsb2NrZXJCdXR0b24pOw0KICAgICAgICAgIH0NCiAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZm9jdXMiLCByZW1vdmVCbG9ja2VyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJmb2N1cyIsIHJlbW92ZUJsb2NrZXIpOw0KICAgICAgfSk7DQoNCiAgICAgIHdpbmRvdy5ibHVyRm9jdXNIYW5kbGVyc0luc3RhbGxlZCA9IHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gRm9jdXNHYW1lKCkgew0KICAgICAgY2FudmFzLmZvY3VzKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gU2V0VmlzaWJpbGl0eSh2aXNpYmlsaXR5KSB7DQogICAgICBpZiAoeXNkayAhPT0gbnVsbCAmJiBpbml0R2FtZSA9PT0gdHJ1ZSAmJiBpc1Zpc2liaWxpdHkgIT09IHZpc2liaWxpdHkpIHsNCiAgICAgICAgaXNWaXNpYmlsaXR5ID0gdmlzaWJpbGl0eTsNCiAgICAgICAgaWYgKCF2aXNpYmlsaXR5KSB7DQogICAgICAgICAgWUcySW5zdGFuY2UoIlNldEZvY3VzV2luZG93R2FtZSIsICJmYWxzZSIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIFlHMkluc3RhbmNlKCJTZXRGb2N1c1dpbmRvd0dhbWUiLCAidHJ1ZSIpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgY29uc3QgUGF1c2VDYWxsYmFjayA9ICgpID0+IHsNCiAgICAgIGlzUGF1c2VkR2FtZSA9IHRydWU7DQogICAgICBZRzJJbnN0YW5jZSgiU2V0UGF1c2VHYW1lIiwgInRydWUiKTsNCiAgICB9Ow0KDQogICAgY29uc3QgUmVzdW1lQ2FsbGJhY2sgPSAoKSA9PiB7DQogICAgICBpc1BhdXNlZEdhbWUgPSBmYWxzZTsNCiAgICAgIFlHMkluc3RhbmNlKCJTZXRQYXVzZUdhbWUiLCAiZmFsc2UiKTsNCiAgICB9Ow0KDQogICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7DQogICAgc2NyaXB0LnNyYyA9IGxvYWRlclVybDsNCiAgICBzY3JpcHQub25sb2FkID0gKCkgPT4gew0KICAgICAgU3RhcnRVbml0eUluc3RhbmNlID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGNyZWF0ZVVuaXR5SW5zdGFuY2UoY2FudmFzLCBjb25maWcsIChwcm9ncmVzcykgPT4gew0KICAgICAgICAgICAgc3Bpbm5lci5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgICAgICAgICAgcHJvZ3Jlc3NCYXJFbXB0eS5zdHlsZS5kaXNwbGF5ID0gIiI7DQogICAgICAgICAgICBjb25zdCBhZGp1c3RlZFByb2dyZXNzID0gTWF0aC5tYXgocHJvZ3Jlc3MsIDAuMDUpOw0KICAgICAgICAgICAgcHJvZ3Jlc3NCYXJGdWxsLnN0eWxlLndpZHRoID0gYCR7MTAwICogYWRqdXN0ZWRQcm9ncmVzc30lYDsNCiAgICAgICAgICB9KQ0KICAgICAgICAgIC50aGVuKCh1bml0eUluc3RhbmNlKSA9PiB7DQogICAgICAgICAgICB5Z0dhbWVJbnN0YW5jZSA9IHVuaXR5SW5zdGFuY2U7DQogICAgICAgICAgICBsb2FkaW5nQ292ZXIuc3R5bGUuYmFja2dyb3VuZCA9ICIiOw0KICAgICAgICAgICAgbG9hZGluZ0NvdmVyLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgICAgICAgICAvLyBGaWxsIEJhY2tncm91bmQgW0J1aWxkIE1vZGlmeV0NCiAgICAgICAgICB9KQ0KICAgICAgICAgIC5jYXRjaCgobWVzc2FnZSkgPT4gew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsNCiAgICAgICAgICB9KTsNCiAgICAgIH07DQoNCiAgICAgIEluc3RhbGxCbHVyRm9jdXNCbG9ja2VyKCk7DQogICAgICAvLyBSZW1vdmVkIGR1cGxpY2F0ZSBjYWxsLCBub3cgaGFuZGxlZCBhZnRlciBjb25maWcgaXMgc2V0DQoNCiAgICAgIGlmIChJc0xvY2FsSG9zdCgpIHx8IHN5bmNJbml0KSBTdGFydFVuaXR5SW5zdGFuY2VfSWZVbmxvYWRlZCgpOw0KICAgIH07DQoNCiAgICBmdW5jdGlvbiBTdGFydFVuaXR5SW5zdGFuY2VfSWZVbmxvYWRlZCgpIHsNCiAgICAgIGlmIChzcGlubmVyLnN0eWxlLmRpc3BsYXkgIT09ICJub25lIikgU3RhcnRVbml0eUluc3RhbmNlKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gSXNMb2NhbEhvc3QoKSB7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIHRyeSB7DQogICAgICAgIGlmICh3aW5kb3cudG9wICE9PSB3aW5kb3cpIHsNCiAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBjb25zdCBob3N0ID0gd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lOw0KICAgICAgICBpZiAoDQogICAgICAgICAgaG9zdCA9PT0gImxvY2FsaG9zdCIgfHwNCiAgICAgICAgICBob3N0ID09PSAiMTI3LjAuMC4xIiB8fA0KICAgICAgICAgIGhvc3QuZW5kc1dpdGgoIi5sb2NhbCIpDQogICAgICAgICkgew0KICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoIkxvY2FsIEhvc3QiKTsNCiAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgY2hlY2tpbmcgdGhlIGxvY2FsIGhvc3Q6IiwgZXJyb3IpOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gWUcySW5zdGFuY2UobWV0aG9kKSB7DQogICAgICBpZiAoeWdHYW1lSW5zdGFuY2UgPT0gbnVsbCkgcmV0dXJuOw0KDQogICAgICBpZiAoIWluaXRHYW1lKSB7DQogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgaWYgKHlnR2FtZUluc3RhbmNlKQ0KICAgICAgICAgICAgeWdHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoIllHMkluc3RhbmNlIiwgbWV0aG9kKTsNCiAgICAgICAgfSwgMTAwKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHlnR2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCJZRzJJbnN0YW5jZSIsIG1ldGhvZCk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gWUcySW5zdGFuY2UobWV0aG9kLCBhcmcpIHsNCiAgICAgIGlmICh5Z0dhbWVJbnN0YW5jZSA9PSBudWxsKSByZXR1cm47DQoNCiAgICAgIGlmICghaW5pdEdhbWUpIHsNCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgICB5Z0dhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgiWUcySW5zdGFuY2UiLCBtZXRob2QsIGFyZyk7DQogICAgICAgIH0sIDEwMCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB5Z0dhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgiWUcySW5zdGFuY2UiLCBtZXRob2QsIGFyZyk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gTG9nU3R5bGVkTWVzc2FnZShtZXNzYWdlLCBzdHlsZSkgew0KICAgICAgY29uc29sZS5sb2coIiVjIiArIG1lc3NhZ2UsIHN0eWxlKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBMb2dTdHlsZWRNZXNzYWdlKG1lc3NhZ2UpIHsNCiAgICAgIGNvbnNvbGUubG9nKA0KICAgICAgICAiJWMiICsgbWVzc2FnZSwNCiAgICAgICAgImNvbG9yOiAjRkZERjczOyBiYWNrZ3JvdW5kLWNvbG9yOiAjNDU0NTQ1Ig0KICAgICAgKTsNCiAgICB9DQoNCiAgICBhc3luYyBmdW5jdGlvbiBJbml0WVNESygpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGlmIChJc0xvY2FsSG9zdCgpKSByZXR1cm47DQoNCiAgICAgICAgeXNkayA9IGF3YWl0IFlhR2FtZXMuaW5pdCgpOw0KICAgICAgICB5c2RrLm9uKCJnYW1lX2FwaV9wYXVzZSIsIFBhdXNlQ2FsbGJhY2spOw0KICAgICAgICB5c2RrLm9uKCJnYW1lX2FwaV9yZXN1bWUiLCBSZXN1bWVDYWxsYmFjayk7DQoNCiAgICAgICAgLy8gQWRkaXRpb25hbCBpbml0MCBtb2R1bGVzDQogICAgICAgIGF3YWl0IFJlcXVlc3RpbmdFbnZpcm9ubWVudERhdGEoKTsNCiAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgiSW5pdCBFbnZpckRhdGEgeXNkayIpOw0KDQogICAgICAgIC8vIEFkZGl0aW9uYWwgaW5pdDEgbW9kdWxlcw0KDQogICAgICAgIC8vIEFkZGl0aW9uYWwgaW5pdDIgbW9kdWxlcw0KICAgICAgICBhd2FpdCBJbml0UGxheWVyKCk7DQogICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoIkluaXQgQXV0aG9yaXphdGlvbiB5c2RrIik7DQoNCiAgICAgICAgLy8gQWRkaXRpb25hbCBpbml0IG1vZHVsZXMNCiAgICAgICAgYXdhaXQgTG9hZENsb3VkKCk7DQogICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoIkluaXQgU3RvcmFnZSB5c2RrIik7DQoNCiAgICAgICAgYXdhaXQgSW5pdFBheW1lbnRzKCk7DQogICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoIkluaXQgUGF5bWVudHMgeXNkayIpOw0KDQogICAgICAgIGF3YWl0IEdldEZsYWdzKCk7DQogICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoIkluaXQgRmxhZ3MgeXNkayIpOw0KDQogICAgICAgIGluaXRZU0RLID0gdHJ1ZTsNCiAgICAgICAgaWYgKHlnR2FtZUluc3RhbmNlICE9IG51bGwpDQogICAgICAgICAgeWdHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoIllHMkluc3RhbmNlIiwgIkluaXRTREtDb21wbGV0ZSIpOw0KDQogICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoIkluaXQgWWFuZGV4U0RLIFN1Y2Nlc3MiKTsNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcigiQ1JBU0ggSW5pdGlhbGl6YXRpb24gU0RLOiAiLCBlKTsNCiAgICAgIH0NCg0KICAgICAgaWYgKCFJc0xvY2FsSG9zdCgpICYmICFzeW5jSW5pdCkgU3RhcnRVbml0eUluc3RhbmNlX0lmVW5sb2FkZWQoKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBJbml0R2FtZSgpIHsNCiAgICAgIGluaXRHYW1lID0gdHJ1ZTsNCg0KICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgaWYgKGlzUGF1c2VkR2FtZSA9PSB0cnVlKSBZRzJJbnN0YW5jZSgiU2V0UGF1c2VHYW1lIiwgInRydWUiKTsNCiAgICAgIH0sIDEwMCk7DQoNCiAgICAgIC8vIEFkZGl0aW9uYWwgc3RhcnQgbW9kdWxlcw0KICAgIH0NCg0KICAgIC8vIEFkZGl0aW9uYWwgc2NyaXB0IG1vZHVsZXMNCiAgICBMb2dTdHlsZWRNZXNzYWdlKCJQbHVnaW5ZRzIgdjIuMDA0MSAgYnVpbGQ6IDciKTsNCg0KICAgIHZhciBjbG91ZFNhdmVzID0gTk9fREFUQTsNCg0KICAgIGZ1bmN0aW9uIFNhdmVDbG91ZChqc29uRGF0YSwgZmx1c2gpIHsNCiAgICAgIGlmIChwbGF5ZXIgPT0gbnVsbCkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCJDUkFTSCBTYXZlIENsb3VkOiAiLCAiRGlkbnQgaGF2ZSB0aW1lIHRvIGxvYWQiKTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgdHJ5IHsNCiAgICAgICAgcGxheWVyLnNldERhdGEoew0KICAgICAgICAgICAgc2F2ZXM6IFtqc29uRGF0YV0sDQogICAgICAgICAgfSwNCiAgICAgICAgICBmbHVzaA0KICAgICAgICApOw0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCJDUkFTSCBTYXZlIENsb3VkOiAiLCBlLm1lc3NhZ2UpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIExvYWRDbG91ZCgpIHsNCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gew0KICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgRmluYWwoTk9fREFUQSk7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRyeSB7DQogICAgICAgICAgcGxheWVyDQogICAgICAgICAgICAuZ2V0RGF0YShbInNhdmVzIl0pDQogICAgICAgICAgICAudGhlbigoZGF0YSkgPT4gew0KICAgICAgICAgICAgICBpZiAoZGF0YS5zYXZlcykgew0KICAgICAgICAgICAgICAgIEZpbmFsKEpTT04uc3RyaW5naWZ5KGRhdGEuc2F2ZXMpKTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBGaW5hbChOT19EQVRBKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7DQogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkxvYWQgQ2xvdWQgRXJyb3IhIik7DQogICAgICAgICAgICAgIEZpbmFsKE5PX0RBVEEpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICBjb25zb2xlLmVycm9yKCJDUkFTSCBMb2FkIHNhdmVzIENsb3VkOiAiLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgIEZpbmFsKE5PX0RBVEEpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gRmluYWwocmVzKSB7DQogICAgICAgICAgY2xvdWRTYXZlcyA9IHJlczsNCiAgICAgICAgICBZRzJJbnN0YW5jZSgiU2V0TG9hZFNhdmVzIiwgcmVzKTsNCiAgICAgICAgICByZXNvbHZlKHJlcyk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIFN0aWNreUFkQWN0aXZpdHkoc2hvdykgew0KICAgICAgdHJ5IHsNCiAgICAgICAgeXNkay5hZHYNCiAgICAgICAgICAuZ2V0QmFubmVyQWR2U3RhdHVzKCkNCiAgICAgICAgICAudGhlbigoew0KICAgICAgICAgICAgc3RpY2t5QWR2SXNTaG93aW5nLA0KICAgICAgICAgICAgcmVhc29uDQogICAgICAgICAgfSkgPT4gew0KICAgICAgICAgICAgaWYgKHN0aWNreUFkdklzU2hvd2luZykgew0KICAgICAgICAgICAgICBpZiAoIXNob3cpIHsNCiAgICAgICAgICAgICAgICB5c2RrLmFkdi5oaWRlQmFubmVyQWR2KCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVhc29uKSB7DQogICAgICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoIlN0aWNreUFkdiBhcmUgbm90IHNob3duLiBSZWFzb246IiwgcmVhc29uKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2hvdykgew0KICAgICAgICAgICAgICB5c2RrLmFkdi5zaG93QmFubmVyQWR2KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIkNSQVNIIFN0aWNreUFkdiBhY3Rpdml0eTogIiwgZS5tZXNzYWdlKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBSZXdhcmRlZEFkdlNob3coaWQpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIHlzZGsuYWR2LnNob3dSZXdhcmRlZFZpZGVvKHsNCiAgICAgICAgICBjYWxsYmFja3M6IHsNCiAgICAgICAgICAgIG9uT3BlbjogKCkgPT4gew0KICAgICAgICAgICAgICBMb2dTdHlsZWRNZXNzYWdlKCJPcGVuZWQgUmV3YXJkZWQgQWR2Iik7DQogICAgICAgICAgICAgIFlHMkluc3RhbmNlKCJPcGVuUmV3YXJkZWRBZHYiKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBvbkNsb3NlOiAoKSA9PiB7DQogICAgICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoIkNsb3NlZCBSZXdhcmRlZCBBZHYiKTsNCiAgICAgICAgICAgICAgWUcySW5zdGFuY2UoIkNsb3NlUmV3YXJkZWRBZHYiKTsNCiAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgb25SZXdhcmRlZDogKCkgPT4gew0KICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgiUmV3YXJkQWR2IiwgaWQpOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIG9uRXJyb3I6IChlcnIpID0+IHsNCiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgUmV3YXJkZWQgQWR2IiwgZXJyKTsNCiAgICAgICAgICAgICAgWUcySW5zdGFuY2UoIkVycm9yUmV3YXJkZWRBZHYiKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwNCiAgICAgICAgfSk7DQogICAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcigiQ1JBU0ggUmV3YXJkZWQgQWR2IFNob3c6ICIsIGVyci5tZXNzYWdlKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICB2YXIgcGF5bWVudHNEYXRhID0gTk9fREFUQTsNCiAgICBsZXQgcGF5bWVudHMgPSBudWxsOw0KDQogICAgZnVuY3Rpb24gSW5pdFBheW1lbnRzKHNlbmRiYWNrKSB7DQogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgICBGaW5hbChOT19EQVRBKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICB5c2RrDQogICAgICAgICAgICAuZ2V0UGF5bWVudHMoKQ0KICAgICAgICAgICAgLnRoZW4oKF9wYXltZW50cykgPT4gew0KICAgICAgICAgICAgICBwYXltZW50cyA9IF9wYXltZW50czsNCg0KICAgICAgICAgICAgICBwYXltZW50cy5nZXRDYXRhbG9nKCkudGhlbigocHJvZHVjdHMpID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgcHJvZHVjdElEID0gW107DQogICAgICAgICAgICAgICAgbGV0IHRpdGxlID0gW107DQogICAgICAgICAgICAgICAgbGV0IGRlc2NyaXB0aW9uID0gW107DQogICAgICAgICAgICAgICAgbGV0IGltYWdlVVJJID0gW107DQogICAgICAgICAgICAgICAgbGV0IHByaWNlID0gW107DQogICAgICAgICAgICAgICAgbGV0IHByaWNlVmFsdWUgPSBbXTsNCiAgICAgICAgICAgICAgICBsZXQgcHJpY2VDdXJyZW5jeUNvZGUgPSBbXTsNCiAgICAgICAgICAgICAgICBsZXQgY3VycmVuY3lJbWFnZVVSTCA9IFtdOw0KICAgICAgICAgICAgICAgIGxldCBjb25zdW1lZCA9IFtdOw0KDQogICAgICAgICAgICAgICAgcGF5bWVudHMuZ2V0UHVyY2hhc2VzKCkudGhlbigocHVyY2hhc2VzKSA9PiB7DQogICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHByb2R1Y3RzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIHByb2R1Y3RJRFtpXSA9IHByb2R1Y3RzW2ldLmlkOw0KICAgICAgICAgICAgICAgICAgICB0aXRsZVtpXSA9IHByb2R1Y3RzW2ldLnRpdGxlOw0KICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbltpXSA9IHByb2R1Y3RzW2ldLmRlc2NyaXB0aW9uOw0KICAgICAgICAgICAgICAgICAgICBpbWFnZVVSSVtpXSA9IHByb2R1Y3RzW2ldLmltYWdlVVJJOw0KICAgICAgICAgICAgICAgICAgICBwcmljZVtpXSA9IHByb2R1Y3RzW2ldLnByaWNlOw0KICAgICAgICAgICAgICAgICAgICBwcmljZVZhbHVlW2ldID0gcHJvZHVjdHNbaV0ucHJpY2VWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgcHJpY2VDdXJyZW5jeUNvZGVbaV0gPSBwcm9kdWN0c1tpXS5wcmljZUN1cnJlbmN5Q29kZTsNCiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lJbWFnZVVSTFtpXSA9DQogICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdHNbaV0uZ2V0UHJpY2VDdXJyZW5jeUltYWdlKCJtZWRpdW0iKTsNCg0KICAgICAgICAgICAgICAgICAgICBjb25zdW1lZFtpXSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIGZvciAoaTIgPSAwOyBpMiA8IHB1cmNoYXNlcy5sZW5ndGg7IGkyKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAocHVyY2hhc2VzW2kyXS5wcm9kdWN0SUQgPT09IHByb2R1Y3RJRFtpXSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRbaV0gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICBsZXQganNvblBheW1lbnRzID0gew0KICAgICAgICAgICAgICAgICAgICBpZDogcHJvZHVjdElELA0KICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsDQogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgaW1hZ2VVUkk6IGltYWdlVVJJLA0KICAgICAgICAgICAgICAgICAgICBwcmljZTogcHJpY2UsDQogICAgICAgICAgICAgICAgICAgIHByaWNlVmFsdWU6IHByaWNlVmFsdWUsDQogICAgICAgICAgICAgICAgICAgIHByaWNlQ3VycmVuY3lDb2RlOiBwcmljZUN1cnJlbmN5Q29kZSwNCiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3lJbWFnZVVSTDogY3VycmVuY3lJbWFnZVVSTCwNCiAgICAgICAgICAgICAgICAgICAgY29uc3VtZWQ6IGNvbnN1bWVkLA0KICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogeXNkay5lbnZpcm9ubWVudC5pMThuLmxhbmcsDQogICAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgICAgICBGaW5hbChKU09OLnN0cmluZ2lmeShqc29uUGF5bWVudHMpKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoIlB1cmNoYXNlcyBhcmUgbm90IGF2YWlsYWJsZSIsIGUubWVzc2FnZSk7DQogICAgICAgICAgICAgIEZpbmFsKE5PX0RBVEEpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICBjb25zb2xlLmVycm9yKCJDUkFTSCBJbml0IFBheW1lbnRzOiAiLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgIEZpbmFsKE5PX0RBVEEpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gRmluYWwocmVzKSB7DQogICAgICAgICAgcGF5bWVudHNEYXRhID0gcmVzOw0KICAgICAgICAgIFlHMkluc3RhbmNlKCJQYXltZW50c0VudHJpZXMiLCByZXMpOw0KICAgICAgICAgIHJlc29sdmUocmVzKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gQnV5UGF5bWVudHMoaWQpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGlmIChwYXltZW50cyAhPSBudWxsKSB7DQogICAgICAgICAgcGF5bWVudHMNCiAgICAgICAgICAgIC5wdXJjaGFzZShpZCkNCiAgICAgICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgiUHVyY2hhc2UgU3VjY2VzcyIpOw0KICAgICAgICAgICAgICBDb25zdW1lUHVyY2hhc2UoaWQsIHRydWUpOw0KICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsNCiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiUHVyY2hhc2UgRmFpbGVkIiwgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgWUcySW5zdGFuY2UoIk9uUHVyY2hhc2VGYWlsZWQiLCBpZCk7DQogICAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgiUGF5bWVudHMgPT0gbnVsbCIpOw0KICAgICAgICAgIFlHMkluc3RhbmNlKCJPblB1cmNoYXNlRmFpbGVkIiwgaWQpOw0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIkNSQVNIIEJ1eSBQYXltZW50czogIiwgZS5tZXNzYWdlKTsNCiAgICAgICAgWUcySW5zdGFuY2UoIk9uUHVyY2hhc2VGYWlsZWQiLCBpZCk7DQogICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIENvbnN1bWVQdXJjaGFzZShpZCwgb25QdXJjaGFzZVN1Y2Nlc3MpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGlmIChwYXltZW50cyAhPSBudWxsKSB7DQogICAgICAgICAgcGF5bWVudHMuZ2V0UHVyY2hhc2VzKCkudGhlbigocHVyY2hhc2VzKSA9PiB7DQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcHVyY2hhc2VzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgIGlmIChwdXJjaGFzZXNbaV0ucHJvZHVjdElEID09PSBpZCkgew0KICAgICAgICAgICAgICAgIHBheW1lbnRzLmNvbnN1bWVQdXJjaGFzZShwdXJjaGFzZXNbaV0ucHVyY2hhc2VUb2tlbik7DQoNCiAgICAgICAgICAgICAgICBpZiAob25QdXJjaGFzZVN1Y2Nlc3MpIFlHMkluc3RhbmNlKCJPblB1cmNoYXNlU3VjY2VzcyIsIGlkKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoIkNvbnN1bWUgcHVyY2hhc2U6IHBheW1lbnRzIG51bGwiKTsNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCJDUkFTSCBDb25zdW1lIFB1cmNoYXNlOiAiLCBlLm1lc3NhZ2UpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIENvbnN1bWVQdXJjaGFzZXMob25QdXJjaGFzZVN1Y2Nlc3MpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGlmIChwYXltZW50cyAhPSBudWxsKSB7DQogICAgICAgICAgcGF5bWVudHMuZ2V0UHVyY2hhc2VzKCkudGhlbigocHVyY2hhc2VzKSA9PiB7DQogICAgICAgICAgICBMb2dTdHlsZWRNZXNzYWdlKCJVbnByb2Nlc3NlZCBwdXJjaGFzZXM6ICIsIHB1cmNoYXNlcy5sZW5ndGgpOw0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHB1cmNoYXNlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICBwYXltZW50cy5jb25zdW1lUHVyY2hhc2UocHVyY2hhc2VzW2ldLnB1cmNoYXNlVG9rZW4pOw0KDQogICAgICAgICAgICAgIGlmIChvblB1cmNoYXNlU3VjY2VzcykNCiAgICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgiT25QdXJjaGFzZVN1Y2Nlc3MiLCBwdXJjaGFzZXNbaV0ucHJvZHVjdElEKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBMb2dTdHlsZWRNZXNzYWdlKCJDb25zdW1lIHB1cmNoYXNlczogcGF5bWVudHMgbnVsbCIpOw0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIkNSQVNIIENvbnN1bWUgcHVyY2hhc2VzOiAiLCBlLm1lc3NhZ2UpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIFNldExlYWRlcmJvYXJkKG5hbWUsIHNjb3JlLCBleHRyYURhdGEpIHsNCiAgICAgIGlmICgheXNkaykgcmV0dXJuOw0KDQogICAgICB0cnkgew0KICAgICAgICB5c2RrLmxlYWRlcmJvYXJkcy5zZXRTY29yZShuYW1lLCBzY29yZSwgZXh0cmFEYXRhKTsNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcigiQ1JBU0ggU2V0IExlYWRlcmJvYXJkOiAiLCBlLm1lc3NhZ2UpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEdldExlYWRlcmJvYXJkKA0KICAgICAgbmFtZUxCLA0KICAgICAgcXVhbnRpdHlUb3AsDQogICAgICBxdWFudGl0eUFyb3VuZCwNCiAgICAgIHBob3RvU2l6ZSwNCiAgICAgIGF1dGgNCiAgICApIHsNCiAgICAgIGlmICgheXNkaykgcmV0dXJuOw0KDQogICAgICB2YXIganNvbkVudHJpZXMgPSB7DQogICAgICAgIHRlY2hub05hbWU6ICIiLA0KICAgICAgICBpc0RlZmF1bHQ6IGZhbHNlLA0KICAgICAgICBpc0ludmVydFNvcnRPcmRlcjogZmFsc2UsDQogICAgICAgIGRlY2ltYWxPZmZzZXQ6IDAsDQogICAgICAgIHR5cGU6ICIiLA0KICAgICAgfTsNCg0KICAgICAgeXNkay5sZWFkZXJib2FyZHMNCiAgICAgICAgLmdldERlc2NyaXB0aW9uKG5hbWVMQikNCiAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgIGpzb25FbnRyaWVzLnRlY2hub05hbWUgPSBuYW1lTEI7DQogICAgICAgICAganNvbkVudHJpZXMuaXNEZWZhdWx0ID0gcmVzLmRlZmF1bHQ7DQogICAgICAgICAganNvbkVudHJpZXMuaXNJbnZlcnRTb3J0T3JkZXIgPSByZXMuZGVzY3JpcHRpb24uaW52ZXJ0X3NvcnRfb3JkZXI7DQogICAgICAgICAganNvbkVudHJpZXMuZGVjaW1hbE9mZnNldCA9DQogICAgICAgICAgICByZXMuZGVzY3JpcHRpb24uc2NvcmVfZm9ybWF0Lm9wdGlvbnMuZGVjaW1hbF9vZmZzZXQ7DQogICAgICAgICAganNvbkVudHJpZXMudHlwZSA9IHJlcy5kZXNjcmlwdGlvbi50eXBlOw0KDQogICAgICAgICAgcmV0dXJuIHlzZGsubGVhZGVyYm9hcmRzLmdldEVudHJpZXMobmFtZUxCLCB7DQogICAgICAgICAgICBxdWFudGl0eVRvcDogcXVhbnRpdHlUb3AsDQogICAgICAgICAgICBpbmNsdWRlVXNlcjogYXV0aCwNCiAgICAgICAgICAgIHF1YW50aXR5QXJvdW5kOiBxdWFudGl0eUFyb3VuZCwNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSkNCiAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgIGxldCBqc29uUGxheWVycyA9IEVudHJpZXNMQihyZXMsIHBob3RvU2l6ZSk7DQogICAgICAgICAgbGV0IGNvbWJpbmVkSnNvbiA9IHsNCiAgICAgICAgICAgIC4uLmpzb25FbnRyaWVzLA0KICAgICAgICAgICAgLi4uanNvblBsYXllcnMNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgWUcySW5zdGFuY2UoIkxlYWRlcmJvYXJkRW50cmllcyIsIEpTT04uc3RyaW5naWZ5KGNvbWJpbmVkSnNvbikpOw0KICAgICAgICB9KQ0KICAgICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICAgIGlmIChlcnIuY29kZSA9PT0gIkxFQURFUkJPQVJEX1BMQVlFUl9OT1RfUFJFU0VOVCIpDQogICAgICAgICAgICBMb2dTdHlsZWRNZXNzYWdlKCJMZWFkZXJib2FyZCBwbGF5ZXIgbm90IHByZXNlbnQiKTsNCiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7DQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEVudHJpZXNMQihyZXMsIHBob3RvU2l6ZSkgew0KICAgICAgbGV0IExiZEVudHJpZXNUZXh0ID0gIiI7DQogICAgICBsZXQgcGxDb3VudCA9IHJlcy5lbnRyaWVzLmxlbmd0aDsNCg0KICAgICAgbGV0IHJhbmtzID0gbmV3IEFycmF5KHBsQ291bnQpOw0KICAgICAgbGV0IHBob3RvcyA9IG5ldyBBcnJheShwbENvdW50KTsNCiAgICAgIGxldCBuYW1lcyA9IG5ldyBBcnJheShwbENvdW50KTsNCiAgICAgIGxldCBzY29yZXMgPSBuZXcgQXJyYXkocGxDb3VudCk7DQogICAgICBsZXQgdW5pcXVlSURzID0gbmV3IEFycmF5KHBsQ291bnQpOw0KICAgICAgbGV0IGV4dHJhRGF0YUFycmF5ID0gbmV3IEFycmF5KHBsQ291bnQpOw0KDQogICAgICBmb3IgKGkgPSAwOyBpIDwgcGxDb3VudDsgaSsrKSB7DQogICAgICAgIHJhbmtzW2ldID0gcmVzLmVudHJpZXNbaV0ucmFuazsNCiAgICAgICAgc2NvcmVzW2ldID0gcmVzLmVudHJpZXNbaV0uc2NvcmU7DQogICAgICAgIHVuaXF1ZUlEc1tpXSA9IHJlcy5lbnRyaWVzW2ldLnBsYXllci51bmlxdWVJRDsNCiAgICAgICAgcGhvdG9zW2ldID0gcmVzLmVudHJpZXNbaV0ucGxheWVyLmdldEF2YXRhclNyYyhwaG90b1NpemUpOw0KDQogICAgICAgIGlmICgNCiAgICAgICAgICByZXMuZW50cmllc1tpXS5leHRyYURhdGEgPT0gIiIgfHwNCiAgICAgICAgICByZXMuZW50cmllc1tpXS5leHRyYURhdGEgPT0gbnVsbA0KICAgICAgICApDQogICAgICAgICAgZXh0cmFEYXRhQXJyYXlbaV0gPSBOT19EQVRBOw0KICAgICAgICBlbHNlIGV4dHJhRGF0YUFycmF5W2ldID0gcmVzLmVudHJpZXNbaV0uZXh0cmFEYXRhOw0KDQogICAgICAgIGlmIChyZXMuZW50cmllc1tpXS5wbGF5ZXIuc2NvcGVQZXJtaXNzaW9ucy5wdWJsaWNfbmFtZSAhPT0gImFsbG93IikNCiAgICAgICAgICBuYW1lc1tpXSA9ICJhbm9ueW1vdXMiOw0KICAgICAgICBlbHNlIG5hbWVzW2ldID0gcmVzLmVudHJpZXNbaV0ucGxheWVyLnB1YmxpY05hbWU7DQoNCiAgICAgICAgTGJkRW50cmllc1RleHQgKz0NCiAgICAgICAgICByYW5rc1tpXSArICIuICIgKyBuYW1lc1tpXSArICI6ICIgKyBzY29yZXNbaV0gKyAiXG4iOw0KICAgICAgfQ0KDQogICAgICBpZiAocGxDb3VudCA9PT0gMCkgew0KICAgICAgICBMYmRFbnRyaWVzVGV4dCA9ICJubyBkYXRhIjsNCiAgICAgIH0NCg0KICAgICAgbGV0IGpzb25QbGF5ZXJzID0gew0KICAgICAgICBlbnRyaWVzOiBMYmRFbnRyaWVzVGV4dCwNCiAgICAgICAgcmFua3M6IHJhbmtzLA0KICAgICAgICBwaG90b3M6IHBob3RvcywNCiAgICAgICAgbmFtZXM6IG5hbWVzLA0KICAgICAgICBzY29yZXM6IHNjb3JlcywNCiAgICAgICAgdW5pcXVlSURzOiB1bmlxdWVJRHMsDQogICAgICAgIGV4dHJhRGF0YUFycmF5OiBleHRyYURhdGFBcnJheSwNCiAgICAgIH07DQoNCiAgICAgIHJldHVybiBqc29uUGxheWVyczsNCiAgICB9DQoNCiAgICBsZXQgbm93RnVsbEFkT3BlbiA9IGZhbHNlOw0KDQogICAgZnVuY3Rpb24gSW50ZXJBZHZTaG93KCkgew0KICAgICAgWUcySW5zdGFuY2UoIkNsb3NlSW50ZXJBZHYiLCAidHJ1ZSIpOw0KICAgICAgRm9jdXNHYW1lKCk7DQogICAgICByZXR1cm47DQogICAgICB0cnkgew0KICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgiQ2FuY2VsIEludGVyQWR2U2hvdzogU0RLIGlzIG5vdCBpbml0aWFsaXplZCIpOw0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobm93RnVsbEFkT3BlbiA9PSB0cnVlKSB7DQogICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgNCiAgICAgICAgICAgICJDYW5jZWwgSW50ZXJBZHZTaG93OiBUaGUgYWR2ZXJ0aXNlbWVudCBpcyBhbHJlYWR5IG9wZW4iDQogICAgICAgICAgKTsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICB5c2RrLmFkdi5zaG93RnVsbHNjcmVlbkFkdih7DQogICAgICAgICAgY2FsbGJhY2tzOiB7DQogICAgICAgICAgICBvbk9wZW46ICgpID0+IHsNCiAgICAgICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgiT3BlbiBJbnRlcnN0aXRpYWwgQWR2Iik7DQogICAgICAgICAgICAgIG5vd0Z1bGxBZE9wZW4gPSB0cnVlOw0KICAgICAgICAgICAgICBpZiAoaW5pdEdhbWUgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgiT3BlbkludGVyQWR2Iik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBvbkNsb3NlOiAod2FzU2hvd24pID0+IHsNCiAgICAgICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgiQ2xvc2UgSW50ZXJzdGl0aWFsIEFkdiIpOw0KICAgICAgICAgICAgICBub3dGdWxsQWRPcGVuID0gZmFsc2U7DQogICAgICAgICAgICAgIGlmIChpbml0R2FtZSA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIGlmICh3YXNTaG93bikgew0KICAgICAgICAgICAgICAgICAgWUcySW5zdGFuY2UoIkNsb3NlSW50ZXJBZHYiLCAidHJ1ZSIpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgiQ2xvc2VJbnRlckFkdiIsICJmYWxzZSIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBvbkVycm9yOiAoZXJyb3IpID0+IHsNCiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgSW50ZXJzdGl0aWFsIEFkdiIsIGVycm9yKTsNCiAgICAgICAgICAgICAgbm93RnVsbEFkT3BlbiA9IGZhbHNlOw0KICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgiRXJyb3JJbnRlckFkdiIpOw0KICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwNCiAgICAgICAgfSk7DQogICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIkNSQVNIIEludGVyc3RpdGlhbCBBZHYgU2hvdzogIiwgZS5tZXNzYWdlKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBsZXQgZmxhc2dzRGF0YSA9IE5PX0RBVEE7DQoNCiAgICBmdW5jdGlvbiBHZXRGbGFncygpIHsNCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gew0KICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgRmluYWwoTk9fREFUQSk7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRyeSB7DQogICAgICAgICAgeXNkay5nZXRGbGFncygpLnRoZW4oKGZsYWdzKSA9PiB7DQogICAgICAgICAgICBsZXQgbmFtZXMgPSBbXTsNCiAgICAgICAgICAgIGxldCB2YWx1ZXMgPSBbXTsNCg0KICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIGZsYWdzKSB7DQogICAgICAgICAgICAgIGlmIChmbGFncy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQogICAgICAgICAgICAgICAgbmFtZXMucHVzaChrZXkpOw0KICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKGZsYWdzW2tleV0pOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxldCBqc29uRmxhZ3MgPSB7DQogICAgICAgICAgICAgIG5hbWVzOiBuYW1lcywNCiAgICAgICAgICAgICAgdmFsdWVzOiB2YWx1ZXMsDQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBGaW5hbChKU09OLnN0cmluZ2lmeShqc29uRmxhZ3MpKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkNSQVNIIEdldCBGbGFnczogIiwgZS5tZXNzYWdlKTsNCiAgICAgICAgICBGaW5hbChOT19EQVRBKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIEZpbmFsKHJlcykgew0KICAgICAgICAgIGZsYXNnc0RhdGEgPSByZXM7DQogICAgICAgICAgcmVzb2x2ZShyZXMpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQoNCiAgICB2YXIgZW52aXJvbm1lbnREYXRhID0gTk9fREFUQTsNCg0KICAgIGZ1bmN0aW9uIFJlcXVlc3RpbmdFbnZpcm9ubWVudERhdGEoKSB7DQogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsNCiAgICAgICAgaWYgKHlzZGsgPT0gbnVsbCkgew0KICAgICAgICAgIEZpbmFsKE5PX0RBVEEpOw0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0cnkgew0KICAgICAgICAgIHZhciBicm93c2VyID0gbmF2aWdhdG9yLnVzZXJBZ2VudDsNCiAgICAgICAgICBpZiAoDQogICAgICAgICAgICBicm93c2VyLmluY2x1ZGVzKCJZYUJyb3dzZXIiKSB8fA0KICAgICAgICAgICAgYnJvd3Nlci5pbmNsdWRlcygiWWFTZWFyY2hCcm93c2VyIikNCiAgICAgICAgICApDQogICAgICAgICAgICBicm93c2VyID0gIllhbmRleCI7DQogICAgICAgICAgZWxzZSBpZiAoYnJvd3Nlci5pbmNsdWRlcygiT3BlcmEiKSB8fCBicm93c2VyLmluY2x1ZGVzKCJPUFIiKSkNCiAgICAgICAgICAgIGJyb3dzZXIgPSAiT3BlcmEiOw0KICAgICAgICAgIGVsc2UgaWYgKGJyb3dzZXIuaW5jbHVkZXMoIkZpcmVmb3giKSkgYnJvd3NlciA9ICJGaXJlZm94IjsNCiAgICAgICAgICBlbHNlIGlmIChicm93c2VyLmluY2x1ZGVzKCJNU0lFIikpIGJyb3dzZXIgPSAiSUUiOw0KICAgICAgICAgIGVsc2UgaWYgKGJyb3dzZXIuaW5jbHVkZXMoIkVkZ2UiKSkgYnJvd3NlciA9ICJFZGdlIjsNCiAgICAgICAgICBlbHNlIGlmIChicm93c2VyLmluY2x1ZGVzKCJDaHJvbWUiKSkgYnJvd3NlciA9ICJDaHJvbWUiOw0KICAgICAgICAgIGVsc2UgaWYgKGJyb3dzZXIuaW5jbHVkZXMoIlNhZmFyaSIpKSBicm93c2VyID0gIlNhZmFyaSI7DQogICAgICAgICAgZWxzZSBicm93c2VyID0gIk90aGVyIjsNCg0KICAgICAgICAgIGxldCBqc29uRW52aXIgPSB7DQogICAgICAgICAgICBsYW5ndWFnZTogeXNkay5lbnZpcm9ubWVudC5pMThuLmxhbmcsDQogICAgICAgICAgICBkb21haW46IHlzZGsuZW52aXJvbm1lbnQuaTE4bi50bGQsDQogICAgICAgICAgICBkZXZpY2VUeXBlOiB5c2RrLmRldmljZUluZm8udHlwZSwNCiAgICAgICAgICAgIGlzTW9iaWxlOiB5c2RrLmRldmljZUluZm8uaXNNb2JpbGUoKSwNCiAgICAgICAgICAgIGlzRGVza3RvcDogeXNkay5kZXZpY2VJbmZvLmlzRGVza3RvcCgpLA0KICAgICAgICAgICAgaXNUYWJsZXQ6IHlzZGsuZGV2aWNlSW5mby5pc1RhYmxldCgpLA0KICAgICAgICAgICAgaXNUVjogeXNkay5kZXZpY2VJbmZvLmlzVFYoKSwNCiAgICAgICAgICAgIGFwcElEOiB5c2RrLmVudmlyb25tZW50LmFwcC5pZCwNCiAgICAgICAgICAgIGJyb3dzZXJMYW5nOiB5c2RrLmVudmlyb25tZW50LmJyb3dzZXIubGFuZywNCiAgICAgICAgICAgIHBheWxvYWQ6IHlzZGsuZW52aXJvbm1lbnQucGF5bG9hZCwNCiAgICAgICAgICAgIHBsYXRmb3JtOiBuYXZpZ2F0b3IucGxhdGZvcm0sDQogICAgICAgICAgICBicm93c2VyOiBicm93c2VyLA0KICAgICAgICAgIH07DQoNCiAgICAgICAgICBGaW5hbChKU09OLnN0cmluZ2lmeShqc29uRW52aXIpKTsNCiAgICAgICAgICBMb2dTdHlsZWRNZXNzYWdlKCJFbnZpcm9ubWVudCBEYXRhOiAiICsgSlNPTi5zdHJpbmdpZnkoanNvbkVudmlyKSk7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICBjb25zb2xlLmVycm9yKCJDUkFTSCBSZXF1ZXN0aW5nIEVudmlyb25tZW50IERhdGE6ICIsIGUubWVzc2FnZSk7DQogICAgICAgICAgRmluYWwoTk9fREFUQSk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBGaW5hbChyZXMpIHsNCiAgICAgICAgICBlbnZpcm9ubWVudERhdGEgPSByZXM7DQogICAgICAgICAgWUcySW5zdGFuY2UoIlNldEVudmlyRGF0YSIsIHJlcyk7DQogICAgICAgICAgcmVzb2x2ZShyZXMpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQoNCiAgICB2YXIgcGxheWVyRGF0YSA9IE5PX0RBVEE7DQogICAgbGV0IHBsYXllciA9IG51bGw7DQoNCiAgICBhc3luYyBmdW5jdGlvbiBJbml0UGxheWVyKCkgew0KICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlKSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgaWYgKCF5c2RrKSByZXR1cm4gRmluYWwoTm90QXV0aG9yaXplZChmYWxzZSkpOw0KDQogICAgICAgICAgcGxheWVyID0gYXdhaXQgeXNkay5nZXRQbGF5ZXIoKTsNCg0KICAgICAgICAgIGlmICghcGxheWVyLmlzQXV0aG9yaXplZCgpKSByZXR1cm4gRmluYWwoTm90QXV0aG9yaXplZCgpKTsNCg0KICAgICAgICAgIGNvbnN0IGF1dGhKc29uID0gew0KICAgICAgICAgICAgcGxheWVyQXV0aDogInJlc29sdmVkIiwNCiAgICAgICAgICAgIHBsYXllck5hbWU6IHBsYXllci5nZXROYW1lKCksDQogICAgICAgICAgICBwbGF5ZXJJZDogcGxheWVyLmdldFVuaXF1ZUlEKCksDQogICAgICAgICAgICBwbGF5ZXJQaG90bzogcGxheWVyLmdldFBob3RvKCJzbWFsbCIpLA0KICAgICAgICAgICAgcGF5aW5nU3RhdHVzOiBwbGF5ZXIuZ2V0UGF5aW5nU3RhdHVzKCksDQogICAgICAgICAgfTsNCg0KICAgICAgICAgIHJldHVybiBGaW5hbChKU09OLnN0cmluZ2lmeShhdXRoSnNvbikpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgY29uc29sZS5lcnJvcigiQ1JBU0ggaW5pdCBQbGF5ZXI6ICIsIGUubWVzc2FnZSk7DQogICAgICAgICAgcmV0dXJuIEZpbmFsKE5vdEF1dGhvcml6ZWQoZmFsc2UpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIEZpbmFsKHJlcykgew0KICAgICAgICAgIHBsYXllckRhdGEgPSByZXM7DQogICAgICAgICAgWUcySW5zdGFuY2UoIlNldEF1dGgiLCByZXMpOw0KICAgICAgICAgIHJlc29sdmUocmVzKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gTm90QXV0aG9yaXplZChpc0luaXRTREsgPSB0cnVlKSB7DQogICAgICBsZXQgYXV0aEpzb24gPSB7DQogICAgICAgIHBsYXllckF1dGg6ICJyZWplY3RlZCIsDQogICAgICAgIHBsYXllck5hbWU6ICJ1bmF1dGhvcml6ZWQiLA0KICAgICAgICBwbGF5ZXJJZDogaXNJbml0U0RLID8gcGxheWVyLmdldFVuaXF1ZUlEKCkgOiAidW5hdXRob3JpemVkIiwNCiAgICAgICAgcGxheWVyUGhvdG86ICJubyBkYXRhIiwNCiAgICAgICAgcGF5aW5nU3RhdHVzOiAidW5rbm93biIsDQogICAgICB9Ow0KICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGF1dGhKc29uKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBPcGVuQXV0aERpYWxvZygpIHsNCiAgICAgIGlmICh5c2RrICE9PSBudWxsKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgeXNkay5hdXRoLm9wZW5BdXRoRGlhbG9nKCkudGhlbigoKSA9PiB7DQogICAgICAgICAgICBJbml0UGxheWVyKCkudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgIFlHMkluc3RhbmNlKCJMb2dnZWRJbiIpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfSk7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICBMb2dTdHlsZWRNZXNzYWdlKCJDUkFTSCBPcGVuIEF1dGggRGlhbG9nOiAiLCBlLm1lc3NhZ2UpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICA8L3NjcmlwdD4NCjwvYm9keT4NCg0KPC9odG1sPg==";
