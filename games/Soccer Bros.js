window.game = "PCFET0NUWVBFIGh0bWw+DQoNCg0KPCEtLSBVbHRpbWF0ZSBHYW1lIFN0YXNoIGZpbGUtLT4gDQo8IS0tIEZvciB0aGUgcmVndWxhcmx5IHVwZGF0aW5nIGRvYyBnbyB0byBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFfRm1IM0JsU0JRSTdGR2dBUUw1OS1aUGU4ZUN4czM1d2VsNkpVeVZhRzhRLyAtLT4NCg0KDQoNCgk8aHRtbCBsYW5nPSJlbiI+DQoNCgk8aGVhZD4NCg0KCSAgPG1ldGEgY2hhcnNldD0idXRmLTgiPg0KICAgIDxiYXNlIGhyZWY9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9idWJibHMvVUdTLUFzc2V0c0A3NGQ0NzZiNzJkMjNlYTFjZWJjOWFmNDEzMDZiYWFiNDQyZmU2MzJjL3NvY2NlciUyMGJyb3MvIj4NCg0KCSAgPHRpdGxlPlNvY2NlciBCcm9zIHwgT2ZmaWNpYWwgU2l0ZTwvdGl0bGU+DQoNCgkgIDxtZXRhIG5hbWU9ImRlc2NyaXB0aW9uIiBjb250ZW50PSJPbmxpbmUgbXVsdGlwbGF5ZXIgc29jY2VyISBQVVQgVEhFIEJBTEwgSU4gVEhFIE5FVCEiIC8+DQoJICA8bWV0YSBpZD0idmlld3BvcnQiIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCBtYXhpbXVtLXNjYWxlPTEuMCwgdXNlci1zY2FsYWJsZT1ubyIgLz4NCgkgIDxsaW5rIHJlbD0ic2hvcnRjdXQgaWNvbiIgdHlwZT0iaW1hZ2UvcG5nIiBocmVmPSIuL2Zhdmljb24ucG5nIj4NCgkgIDxtZXRhIG5hbWU9IktleXdvcmRzIiBjb250ZW50PSJTb2NjZXIsIFBsYXksIEZyZWUsIE9ubGluZSwgTXVsdGlwbGF5ZXIsIEdhbWVzLCBJTywgU3BvcnRzLCBTY3JvbGxpbmcsIEZyaWVuZHMiPg0KCSAgPG1ldGEgbmFtZT0iYXV0aG9yIiBjb250ZW50PSJCbHVlIFdpemFyZCBEaWdpdGFsIj4NCg0KCSAgPGxpbmsgcmVsPSJtYW5pZmVzdCIgaHJlZj0ibWFuaWZlc3QuanNvbiI+DQoNCg0KCSAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iLi9Tb2NjZXJCcm9zLmpzIj48L3NjcmlwdD4NCg0KCSAgPHNjcmlwdD4NCgkgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInRvdWNobW92ZSIsIGZ1bmN0aW9uKGV2ZW50KSB7DQoJICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCgkgICAgfSwgew0KCSAgICAgIGNhcHR1cmU6IGZhbHNlLA0KCSAgICAgIHBhc3NpdmU6IGZhbHNlDQoJICAgIH0pOw0KCSAgICBpZiAodHlwZW9mIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvID4gMikgew0KCSAgICAgIHZhciBtZXRhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpZXdwb3J0Iik7DQoJICAgICAgbWV0YS5zZXRBdHRyaWJ1dGUoJ2NvbnRlbnQnLCAnd2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPScgKyAoMiAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKSArICcsIHVzZXItc2NhbGFibGU9bm8nKTsNCgkgICAgfQ0KCSAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHsNCgkgICAgICBpZiAoKGUua2V5Q29kZSA9PSAzMiB8fCBlLmtleUNvZGUgPT0gMzggfHwgZS5rZXlDb2RlID09IDQwKSAmJiBlLnRhcmdldCA9PSBkb2N1bWVudC5ib2R5KSB7DQoJICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQoJICAgICAgfQ0KCSAgICB9KTsNCgkgICAgdmFyIGFDbyA9ICdVUyc7DQoJICA8L3NjcmlwdD4NCg0KCSAgPHN0eWxlPg0KCSAgICBodG1sLA0KCSAgICBib2R5IHsNCgkgICAgICBtYXJnaW46IDA7DQoJICAgICAgcGFkZGluZzogMDsNCgkgICAgICBoZWlnaHQ6IDEwMCU7DQoJICAgICAgYmFja2dyb3VuZDogIzAwMDAwMDsNCgkgICAgICBjb2xvcjogb3JhbmdlOw0KCSAgICAgIGhlaWdodDogMTAwJTsNCgkgICAgICB3aWR0aDogMTAwJTsNCgkgICAgICBoZWlnaHQ6IDEwMHZoOw0KCSAgICAgIHdpZHRoOiAxMDB2dzsNCgkgICAgICBtYXJnaW46IDA7DQoJICAgICAgcGFkZGluZzogMDsNCgkgICAgfQ0KDQoJICAgIC5ib2R5Ojotd2Via2l0LXNjcm9sbGJhciB7DQoJICAgICAgLyogV2ViS2l0ICovDQoJICAgICAgd2lkdGg6IDBweDsNCgkgICAgfQ0KDQoJICAgICNvcGVuZmwtY29udGVudCB7DQoJICAgICAgYmFja2dyb3VuZDogIzAwMDAwMDsNCgkgICAgICB3aWR0aDogMTAwJTsNCgkgICAgICBoZWlnaHQ6IDEwMCU7DQoJICAgIH0NCg0KCSAgICAjc3Bpbm5lciB7DQoJICAgICAgLXdlYmtpdC10cmFuc2Zvcm0tb3JpZ2luOiA1MCUgNTAlOw0KCSAgICAgIC1tb3otdHJhbnNmb3JtLW9yaWdpbjogNTAlIDUwJTsNCgkgICAgICAtby10cmFuc2Zvcm0tb3JpZ2luOiA1MCUgNTAlOw0KCSAgICAgIHRyYW5zZm9ybS1vcmlnaW46IDUwJSA1MCU7DQoJICAgICAgd2lkdGg6IDgycHg7DQoJICAgICAgaGVpZ2h0OiA4MXB4Ow0KCSAgICAgIC13ZWJraXQtYW5pbWF0aW9uOiBzcGluMSAycyBpbmZpbml0ZSBsaW5lYXI7DQoJICAgICAgLW1vei1hbmltYXRpb246IHNwaW4xIDJzIGluZmluaXRlIGxpbmVhcjsNCgkgICAgICAtby1hbmltYXRpb246IHNwaW4xIDJzIGluZmluaXRlIGxpbmVhcjsNCgkgICAgICAtbXMtYW5pbWF0aW9uOiBzcGluMSAycyBpbmZpbml0ZSBsaW5lYXI7DQoJICAgICAgYW5pbWF0aW9uOiBzcGluMSAycyBpbmZpbml0ZSBsaW5lYXI7DQoJICAgIH0NCgkgIDwvc3R5bGU+DQoNCg0KCSAgPCEtLSBHb29nbGUgdGFnIChndGFnLmpzKSAtLT4NCgkgIDxzY3JpcHQgYXN5bmMgc3JjPSJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbS9ndGFnL2pzP2lkPUctOVNZWjBKWEJDVCI+PC9zY3JpcHQ+DQoJICA8c2NyaXB0Pg0KCSAgICB3aW5kb3cuZGF0YUxheWVyID0gd2luZG93LmRhdGFMYXllciB8fCBbXTsNCg0KCSAgICBmdW5jdGlvbiBndGFnKCkgew0KCSAgICAgIGRhdGFMYXllci5wdXNoKGFyZ3VtZW50cyk7DQoJICAgIH0NCgkgICAgZ3RhZygnanMnLCBuZXcgRGF0ZSgpKTsNCg0KCSAgICBndGFnKCdjb25maWcnLCAnRy05U1laMEpYQkNUJywgew0KCSAgICAgIGNvb2tpZV9mbGFnczogJ3NlY3VyZTtzYW1lc2l0ZT1ub25lJw0KCSAgICB9KTsNCgkgIDwvc2NyaXB0Pg0KDQoJICA8c2NyaXB0Pg0KCSAgICAvL0ludGVyc3RpdGlhbCBhZCBhdmFpbGFibGUgZXZlbnQNCgkgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiYWlwX2ludGVyc3RpdGlhbGFkYXZhaWxhYmxlIiwgZnVuY3Rpb24oZSkgew0KCSAgICAgIGNvbnNvbGUubG9nKCJBbiBpbnRlcnN0aXRpYWwgYWQgaXMgYXZhaWxhYmxlIik7DQoJICAgIH0pOw0KCSAgPC9zY3JpcHQ+DQoJICA8c2NyaXB0IHNyYz0idGFnLm1pbi5qcyI+PC9zY3JpcHQ+DQoNCgkgIDxzY3JpcHQ+DQoJICAgIHZhciBhaXB0YWcgPSBhaXB0YWcgfHwge307DQoJICAgIGFpcHRhZy5jbWQgPSBhaXB0YWcuY21kIHx8IFtdOw0KCSAgICBhaXB0YWcuY21kLmRpc3BsYXkgPSBhaXB0YWcuY21kLmRpc3BsYXkgfHwgW107DQoJICAgIGFpcHRhZy5jbWQucGxheWVyID0gYWlwdGFnLmNtZC5wbGF5ZXIgfHwgW107DQoJICAgIC8vIFNldHRpbmdzDQoJICAgIC8vYWlwdGFnLmNvbnNlbnRlZCA9IGZhbHNlOyAvLyBHRFBSIHNldHRpbmcsIHBsZWFzZSBzZXQgdGhpcyB2YWx1ZSB0byBmYWxzZSBpZiBhbiBFVSB1c2VyIGhhcyBkZWNsaW5lZCBvciBub3QgeWV0IGFjY2VwdGVkIG1hcmtldGluZyBjb29raWVzLCBmb3IgdXNlcnMgb3V0c2lkZSB0aGUgRVUgcGxlYXNlIHVzZSB0cnVlIGFuZCBmb3IgdXNlcnMgYWNjZXB0ZWQgdGhlIEdEUFIgYWxzbyB1c2UgdHJ1ZQ0KCSAgICAvL0NNUCB0b29sIHNldHRpbmdzDQoJICAgIGFpcHRhZy5jbXAgPSB7DQoJICAgICAgc2hvdzogdHJ1ZSwNCgkgICAgICBwb3NpdGlvbjogImNlbnRlcmVkIiwgLy9jZW50ZXJlZCBvciBib3R0b20NCgkgICAgICBidXR0b246IHRydWUsDQoJICAgICAgYnV0dG9uVGV4dDogIlByaXZhY3kgc2V0dGluZ3MiLA0KCSAgICAgIGJ1dHRvblBvc2l0aW9uOiAiYm90dG9tLWxlZnQiIC8vYm90dG9tLWxlZnQsIGJvdHRvbS1yaWdodCwgdG9wLWxlZnQsIHRvcC1yaWdodA0KCSAgICB9DQoNCg0KDQoNCg0KCSAgICBhaXB0YWcuY21kLnBsYXllci5wdXNoKGZ1bmN0aW9uKCkgew0KCSAgICAgIGFkcGxheWVyID0gbmV3IGFpcFBsYXllcih7DQoJICAgICAgICBBSVBfQURCUkVBS19DT01QTEVURTogZnVuY3Rpb24oKSB7DQoJICAgICAgICAgIGNvbnNvbGUubG9nKCJBZGJyZWFrIENvbXBsZXRlZCIpOw0KCSAgICAgICAgICBNYWluLkRvbmVJbnRlcnN0aXRpYWxBZChmYWxzZSk7DQoJICAgICAgICB9LA0KCSAgICAgICAgQURfV0lEVEg6IDk2MCwNCgkgICAgICAgIEFEX0hFSUdIVDogNTQwLA0KCSAgICAgICAgQURfRElTUExBWTogJ2RlZmF1bHQnLCAvL2RlZmF1bHQsIGZ1bGxzY3JlZW4sIGNlbnRlciwgZmlsbA0KCSAgICAgICAgVFJVU1RFRDogdHJ1ZSwNCgkgICAgICAgIExPQURJTkdfVEVYVDogJ2xvYWRpbmcgYWR2ZXJ0aXNlbWVudCcsDQoJICAgICAgICBQUkVST0xMX0VMRU06IGZ1bmN0aW9uKCkgew0KCSAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXJvbGwnKQ0KCSAgICAgICAgfSwNCgkgICAgICAgIEFJUF9DT01QTEVURTogZnVuY3Rpb24oc3RhdGUpIHsNCgkgICAgICAgICAgLyoqKioqKioqKioqKioqKioqKioNCgkgICAgICAgICAgICoqKioqIFdBUk5JTkcgKioqKioNCgkgICAgICAgICAgKioqKioqKioqKioqKioqKioqKg0KCSAgICAgICAgICBQbGVhc2UgZG8gbm90IHJlbW92ZSB0aGUgUFJFUk9MTF9FTEVNDQoJICAgICAgICAgIGZyb20gdGhlIHBhZ2UsIGl0IHdpbGwgYmUgaGlkZGVuIGF1dG9tYXRpY2x5Lg0KCSAgICAgICAgICBJZiB5b3UgZG8gd2FudCB0byByZW1vdmUgaXQgdXNlIHRoZSBBSVBfUkVNT1ZFIGNhbGxiYWNrLg0KCSAgICAgICAgICAqLw0KCSAgICAgICAgICBNYWluLkRvbmVWaWRlb0FkKCk7DQoJICAgICAgICAgIHdpbmRvdy5mb2N1cygpOw0KCSAgICAgICAgICB3aW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZW5mbC1jb250ZW50JykuZm9jdXMoKTsNCgkgICAgICAgICAgaWYgKHN0YXRlID09IG51bGwpIHN0YXRlID0gJ251bGwnOw0KCSAgICAgICAgICBjb25zb2xlLmxvZygnVmlkZW8gQWQgQ29tcGxldGU6ICcgKyBzdGF0ZSk7DQoJICAgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnZG9uZXZpZGVvLScgKyBsYXN0VW5pdFBsYXllZCArICItIiArIHN0YXRlKTsNCgkgICAgICAgIH0sDQoJICAgICAgICBBSVBfUkVNT1ZFOiBmdW5jdGlvbigpIHsNCgkgICAgICAgICAgLy8gSGVyZSBpdCdzIHNhZmUgdG8gcmVtb3ZlIHRoZSBQUkVST0xMX0VMRU0gZnJvbSB0aGUgcGFnZSBpZiB5b3Ugd2FudC4gQnV0IGl0J3Mgbm90IHJlY29tbWVuZC4NCgkgICAgICAgIH0NCgkgICAgICB9KTsNCgkgICAgfSk7DQoNCg0KCSAgICBmdW5jdGlvbiBTZXR1cE1TTm90aWZpY2F0aW9uKCkgew0KCSAgICAgIGNvbnNvbGUubG9nKCJub3RpZnlpbmciKTsNCgkgICAgICBpZiAodHlwZW9mICRtc3N0YXJ0ICE9PSAndW5kZWZpbmVkJykgew0KCSAgICAgICAgY29uc29sZS5sb2coIm5vdGlmeWluZzIiKTsNCgkgICAgICAgIHZhciBpZCA9IGJ0b2EoImgiKTsNCgkgICAgICAgICRtc3N0YXJ0LnNjaGVkdWxlTm90aWZpY2F0aW9uQXN5bmMoew0KCSAgICAgICAgICB0aXRsZTogJ1VubG9jayBuZXcgYnJvcyBub3chJywNCgkgICAgICAgICAgZGVzY3JpcHRpb246ICdZb3UgYXJlIGp1c3QgYWJvdXQgdG8gdW5sb2NrIGEgbmV3IEJybyEgV2hvIHdpbGwgaXQgYmU/JywNCgkgICAgICAgICAgdHlwZTogMSwNCgkgICAgICAgICAgbWluRGVsYXlJblNlY29uZHM6IDI0ICogNjAgKiA2MA0KCSAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7DQoJICAgICAgICAgIGNvbnNvbGUubG9nKCJub3RpZmljYXRpb24gcmVzcG9uc2U6ICIgKyByZXNwb25zZSk7DQoJICAgICAgICB9KTsNCgkgICAgICAgICRtc3N0YXJ0LnNjaGVkdWxlTm90aWZpY2F0aW9uQXN5bmMoew0KCSAgICAgICAgICB0aXRsZTogJ0dldCBtb3JlIGJyb3MhJywNCgkgICAgICAgICAgZGVzY3JpcHRpb246ICdOZXcgYnJvcyBqdXN0IHdhaXRpbmcgdG8gc2NvcmUgZ29hbHMgZm9yIHlvdSEnLA0KCSAgICAgICAgICB0eXBlOiAxLA0KCSAgICAgICAgICBtaW5EZWxheUluU2Vjb25kczogMjQgKiA3ICogNjAgKiA2MA0KCSAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7DQoJICAgICAgICAgIGNvbnNvbGUubG9nKCJub3RpZmljYXRpb24gcmVzcG9uc2U6ICIgKyByZXNwb25zZSk7DQoJICAgICAgICB9KTsNCg0KCSAgICAgIH0NCgkgICAgfQ0KDQoJICAgIHZhciBtc0FkSUQ7DQoNCgkgICAgZnVuY3Rpb24gTG9hZFZpZGVvKCkgew0KCSAgICAgIGlmICh0eXBlb2YgJG1zc3RhcnQgIT09ICd1bmRlZmluZWQnKSB7DQoJICAgICAgICAkbXNzdGFydC5sb2FkQWRzQXN5bmMoKS50aGVuKGFkSW5zdGFuY2UgPT4gew0KCSAgICAgICAgICAvLyBVc2UgdGhlIGFkSW5zdGFuY2UuaW5zdGFuY2VJZCB0byBtYWtlIGEgY2FsbCB0byBzaG93QWRzQXN5bmMNCgkgICAgICAgICAgbXNBZElEID0gYWRJbnN0YW5jZS5pbnN0YW5jZUlkOw0KCSAgICAgICAgfSk7DQoNCgkgICAgICAgIFNldHVwTVNOb3RpZmljYXRpb24oKTsNCgkgICAgICB9DQoJICAgIH0NCg0KCSAgICBmdW5jdGlvbiBTaG93VmlkZW8odGhlVW5pdE5hbWUgPSBudWxsLCBmb3JjZWFpcCA9IGZhbHNlKSB7DQoJICAgICAgY29uc29sZS5sb2coJ1NIT1dfVklERU8nKTsNCgkgICAgICB2YXIgYVVuaXROYW1lID0gIiI7DQoJICAgICAgaWYgKC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUGFkfGlQb2R8T3BlcmEgTWluaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsNCgkgICAgICAgIHZhciBsID0gd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmVyb2xsJyk7DQoJICAgICAgICBpZiAobCA9PSBudWxsKSByZXR1cm47DQoJICAgICAgICBsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQoJICAgICAgICBsLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsNCgkgICAgICAgIHdpbmRvdy5mb2N1cygpOw0KCSAgICAgICAgd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVuZmwtY29udGVudCcpLmZvY3VzKCk7DQoJICAgICAgICBNYWluLkRvbmVWaWRlb0FkKCk7DQoJICAgICAgICByZXR1cm47DQoJICAgICAgfQ0KDQoJICAgICAgaWYgKHR5cGVvZiAkbXNzdGFydCAhPT0gJ3VuZGVmaW5lZCcgJiYgZm9yY2VhaXAgPT0gZmFsc2UpIHsNCgkgICAgICAgICRtc3N0YXJ0LnNob3dBZHNBc3luYyhtc0FkSUQpLnRoZW4oYWRJbnN0YW5jZSA9PiB7DQoJICAgICAgICAgIC8vIFVzZSB0aGUgYWRJbnN0YW5jZS5zaG93QWRzQ29tcGxldGVkQXN5bmMgdG8gYmUgbm90aWZpZWQgb2YgdGhlIGNvbXBsZXRpb24gb2Ygc2hvd2luZyB0aGUgYWR2ZXJ0aXNlbWVudA0KCSAgICAgICAgICBhZEluc3RhbmNlLnNob3dBZHNDb21wbGV0ZWRBc3luYy50aGVuKCh2YWwpID0+IHsNCgkgICAgICAgICAgICBjb25zb2xlLmxvZygnTVMgVmlkZW8gQWQgQ29tcGxldGUnKTsNCgkgICAgICAgICAgICBNYWluLkRvbmVWaWRlb0FkKCk7DQoJICAgICAgICAgICAgd2luZG93LmZvY3VzKCk7DQoJICAgICAgICAgICAgd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVuZmwtY29udGVudCcpLmZvY3VzKCk7DQoJICAgICAgICAgICAgU2VuZEV2ZW50KCdldmVudCcsICdtc192aWRlb19zaG93bjInKTsNCgkgICAgICAgICAgICBMb2FkVmlkZW8oKTsNCgkgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4gew0KCSAgICAgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnbXNfdmlkZW9fbm90X2NvbXBsZXRlZCcpOw0KCSAgICAgICAgICAgIExvYWRWaWRlbygpOw0KCSAgICAgICAgICB9KTsNCgkgICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHsNCgkgICAgICAgICAgY29uc29sZS5sb2coJ01zIFZpZGVvIEFkIEVycm9yLCBzaG93aW5nIGFpcCcpOw0KCSAgICAgICAgICAvL01haW4uRG9uZVZpZGVvQWQoKTsNCgkgICAgICAgICAgd2luZG93LmZvY3VzKCk7DQoJICAgICAgICAgIHdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlbmZsLWNvbnRlbnQnKS5mb2N1cygpOw0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX3ZpZGVvX3Nob3dfZXJyb3IyJyk7DQoJICAgICAgICAgIExvYWRWaWRlbygpOw0KCSAgICAgICAgICBTaG93VmlkZW8odGhlVW5pdE5hbWUsIHRydWUpOw0KCSAgICAgICAgfSk7DQoJICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygd2luZG93LkNyYXp5R2FtZXMgIT09ICd1bmRlZmluZWQnKSB7DQoNCgkgICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IHsNCgkgICAgICAgICAgYWRGaW5pc2hlZDogKCkgPT4gTWFpbi5Eb25lVmlkZW9BZCgpLA0KCSAgICAgICAgICBhZEVycm9yOiAoZXJyb3IpID0+IE1haW4uRG9uZVZpZGVvQWQoKSwNCgkgICAgICAgICAgYWRTdGFydGVkOiAoKSA9PiBjb25zb2xlLmxvZygiU3RhcnQgbWlkZ2FtZSBhZCIpLA0KCSAgICAgICAgfTsNCgkgICAgICAgIHdpbmRvdy5DcmF6eUdhbWVzLlNESy5hZC5yZXF1ZXN0QWQoIm1pZGdhbWUiLCBjYWxsYmFja3MpOw0KDQoJICAgICAgICAvLwkJCXdpbmRvdy5DcmF6eUdhbWVzLlNESy5hZGRFdmVudExpc3RlbmVyKCJhZEZpbmlzaGVkIiwgTWFpbi5Eb25lVmlkZW9BZCk7IC8vIHJlZW5hYmxlIHNvdW5kLCBlbmFibGUgdWkNCgkgICAgICAgIC8vCQkJd2luZG93LkNyYXp5R2FtZXMuU0RLLmFkZEV2ZW50TGlzdGVuZXIoImFkRXJyb3IiLCBNYWluLkRvbmVWaWRlb0FkKTsgLy8gcmVlbmFibGUgc291bmQsIGVuYWJsZSB1aQ0KCSAgICAgICAgLy8JCQl3aW5kb3cuQ3JhenlHYW1lcy5TREsucmVxdWVzdEFkKCk7CQkNCgkgICAgICAgIGNvbnNvbGUubG9nKCdDR19BRF9SRVFVRVNURUQnKTsNCgkgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnY2d2aWRlbycpOw0KCSAgICAgICAgcmV0dXJuOw0KCSAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFkcGxheWVyID09PSAndW5kZWZpbmVkJykgew0KCSAgICAgICAgTWFpbi5Eb25lVmlkZW9BZCh0cnVlKTsNCgkgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAndmlkZW9fYWRibG9ja2VkJyk7DQoJICAgICAgICBjb25zb2xlLmxvZygnVklERU9fQURCTE9DS0VEJyk7DQoNCgkgICAgICB9IGVsc2Ugew0KCSAgICAgICAgdmFyIGFTdHIgPSAncHJlcm9sbCc7DQoJICAgICAgICBpZiAodGhlVW5pdE5hbWUgIT0gbnVsbCkgYVN0ciA9IHRoZVVuaXROYW1lOw0KCSAgICAgICAgbGFzdFVuaXRQbGF5ZWQgPSBhU3RyOw0KCSAgICAgICAgU2VuZEV2ZW50KCdldmVudCcsICdzdGFydHZpZGVvLScgKyBhU3RyKTsNCg0KDQoJICAgICAgICBhaXB0YWcuY21kLnBsYXllci5wdXNoKGZ1bmN0aW9uKCkgew0KCSAgICAgICAgICBhZHBsYXllci5zdGFydFByZVJvbGwodGhlVW5pdE5hbWUpOw0KCSAgICAgICAgfSk7DQoJICAgICAgfQ0KCSAgICB9DQoJICA8L3NjcmlwdD4NCg0KCSAgPCEtLSBGaXJlYmFzZSBBcHAgKHRoZSBjb3JlIEZpcmViYXNlIFNESykgLS0+DQoJICA8c2NyaXB0IHNyYz0iZmlyZWJhc2UtYXBwLmpzIj48L3NjcmlwdD4NCgkgIDwhLS0gRmlyZWJhc2UgQXV0aGVudGljYXRpb24gLS0+DQoJICA8c2NyaXB0IHNyYz0iZmlyZWJhc2UtYXV0aC5qcyI+PC9zY3JpcHQ+DQoJICA8IS0tIEZpcmViYXNlIEZpcmVzdG9yZSAoRGF0YWJhc2UpIC0tPg0KCSAgPHNjcmlwdCBzcmM9ImZpcmViYXNlLWZpcmVzdG9yZS5qcyI+PC9zY3JpcHQ+DQoNCgkgIDxzY3JpcHQ+DQoJICAgIC8vIFlvdXIgd2ViIGFwcCdzIEZpcmViYXNlIGNvbmZpZ3VyYXRpb24NCgkgICAgY29uc3QgZmlyZWJhc2VDb25maWcgPSB7DQoJICAgICAgYXBpS2V5OiAiQUl6YVN5QTR2bThxekFzbDkzUUI3YmYtZlIyOHVKNG0yQzY4WjFJIiwNCgkgICAgICBhdXRoRG9tYWluOiAic29jY2VyLWJyb3MtNmEwMjcuZmlyZWJhc2VhcHAuY29tIiwNCgkgICAgICBwcm9qZWN0SWQ6ICJzb2NjZXItYnJvcy02YTAyNyIsDQoJICAgICAgc3RvcmFnZUJ1Y2tldDogInNvY2Nlci1icm9zLTZhMDI3LmFwcHNwb3QuY29tIiwNCgkgICAgICBtZXNzYWdpbmdTZW5kZXJJZDogIjM0ODc4NDY4Mzc1NSIsDQoJICAgICAgYXBwSWQ6ICIxOjM0ODc4NDY4Mzc1NTp3ZWI6YThjZWI3YTMwM2JkZDVjMjY0NmNhZSINCgkgICAgfTsNCg0KCSAgICAvLyBJbml0aWFsaXplIEZpcmViYXNlDQoJICAgIGZpcmViYXNlLmluaXRpYWxpemVBcHAoZmlyZWJhc2VDb25maWcpOw0KCSAgICBjb25zdCBhdXRoID0gZmlyZWJhc2UuYXV0aCgpOw0KCSAgICBjb25zdCBkYiA9IGZpcmViYXNlLmZpcmVzdG9yZSgpOw0KCSAgICB2YXIgdXNlckRhdGEgPSAiIjsNCg0KCSAgICBmdW5jdGlvbiB0cmlnZ2VyU2lnbkluKCkgew0KCSAgICAgIHZhciBwcm92aWRlciA9IG5ldyBmaXJlYmFzZS5hdXRoLkdvb2dsZUF1dGhQcm92aWRlcigpOw0KCSAgICAgIGF1dGguc2lnbkluV2l0aFBvcHVwKHByb3ZpZGVyKTsNCgkgICAgfQ0KDQoJICAgIC8vIFNhdmUgZ2FtZSBkYXRhIGZ1bmN0aW9uDQoJICAgIGZ1bmN0aW9uIHNhdmVHYW1lRGF0YShnYW1lRGF0YSkgew0KCSAgICAgIGNvbnNvbGUubG9nKCdzYXZpbmcgZ2FtZWRhdGE6JyArIGdhbWVEYXRhKTsNCgkgICAgICB2YXIgdXNlcklkID0gYXV0aC5jdXJyZW50VXNlci51aWQ7DQoJICAgICAgdXNlckRhdGEgPSBnYW1lRGF0YTsNCgkgICAgICBkYi5jb2xsZWN0aW9uKCd1c2VycycpLmRvYyh1c2VySWQpLnNldCh7DQoJICAgICAgICBnYW1lRGF0YTogZ2FtZURhdGENCgkgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkgew0KCSAgICAgICAgY29uc29sZS5sb2coJ0dhbWUgZGF0YSBzYXZlZCcpOw0KCSAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7DQoJICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgZ2FtZSBkYXRhOicsIGVycm9yKTsNCgkgICAgICB9KTsNCgkgICAgfQ0KDQoJICAgIC8vIExvYWQgZ2FtZSBkYXRhIGZ1bmN0aW9uDQoJICAgIGZ1bmN0aW9uIGxvYWRHYW1lRGF0YSgpIHsNCgkgICAgICByZXR1cm4gdXNlckRhdGE7DQoJICAgIH0NCg0KCSAgICBmdW5jdGlvbiBsb2FkR2FtZURhdGFBc3luYygpIHsNCgkgICAgICB2YXIgdXNlcklkID0gYXV0aC5jdXJyZW50VXNlci51aWQ7DQoJICAgICAgZGIuY29sbGVjdGlvbigndXNlcnMnKS5kb2ModXNlcklkKS5nZXQoKS50aGVuKGZ1bmN0aW9uKGRvYykgew0KCSAgICAgICAgaWYgKGRvYy5leGlzdHMpIHsNCgkgICAgICAgICAgdXNlckRhdGEgPSBkb2MuZGF0YSgpLmdhbWVEYXRhOw0KCSAgICAgICAgICAvL01haW4uTG9hZEdsb2JhbHMoKTsNCgkgICAgICAgICAgY29uc29sZS5sb2coJ0dhbWUgZGF0YTonLCBkb2MuZGF0YSgpLmdhbWVEYXRhKTsNCgkgICAgICAgICAgaWYgKHR5cGVvZiBNYWluICE9ICJ1bmRlZmluZWQiKSB7DQoJICAgICAgICAgICAgTWFpbi5Mb2FkRGF0YUNvbXBsZXRlKCk7DQoJICAgICAgICAgIH0NCgkgICAgICAgICAgLy8gVXNlIHRoZSBnYW1lIGRhdGEgaW4geW91ciBnYW1lDQoJICAgICAgICB9IGVsc2Ugew0KCSAgICAgICAgICBjb25zb2xlLmxvZygnTm8gc3VjaCBkb2N1bWVudCEnKTsNCgkgICAgICAgIH0NCgkgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcikgew0KCSAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBnYW1lIGRhdGE6JywgZXJyb3IpOw0KCSAgICAgIH0pOw0KCSAgICB9DQoNCgkgICAgLy8gRmlyZWJhc2UgYXV0aCBzdGF0ZSBvYnNlcnZlcg0KCSAgICBhdXRoLm9uQXV0aFN0YXRlQ2hhbmdlZChmdW5jdGlvbih1c2VyKSB7DQoJICAgICAgaWYgKHVzZXIpIHsNCgkgICAgICAgIGxvYWRHYW1lRGF0YUFzeW5jKCk7DQoJICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ3NpZ25faW4nKTsNCgkgICAgICAgIGNvbnNvbGUubG9nKCd1c2VyIHNpZ25lZCBpbicpOw0KCSAgICAgIH0gZWxzZSB7DQoJICAgICAgICBjb25zb2xlLmxvZygnTm8gdXNlciBzaWduZWQgaW4nKTsNCgkgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnc2lnbl9vdXQnKTsNCgkgICAgICB9DQoJICAgIH0pOw0KDQoJICAgIGZ1bmN0aW9uIHNpZ25PdXQoKSB7DQoJICAgICAgYXV0aC5zaWduT3V0KCkudGhlbigoKSA9PiB7DQoJICAgICAgICBNYWluLlNpZ25PdXRDb21wbGV0ZSgpOw0KCSAgICAgICAgY29uc29sZS5sb2coJ3NpZ25lZCBvdXQnKTsNCgkgICAgICB9KTsNCgkgICAgfQ0KDQoJICAgIGZ1bmN0aW9uIGlzVXNlckxvZ2dlZEluKCkgew0KCSAgICAgIHJldHVybiBhdXRoLmN1cnJlbnRVc2VyICE9PSBudWxsOw0KCSAgICB9DQoJICA8L3NjcmlwdD4NCg0KCTwvaGVhZD4NCg0KCTxib2R5IHN0eWxlPSJvdmVyZmxvdzpoaWRkZW47Ij4NCgkgIDxub3NjcmlwdD5FbmFibGUgSmF2YVNjcmlwdCBicm8hPC9ub3NjcmlwdD4NCgkgIDxzY3JpcHQ+DQoJICAgIC8vYWxlcnQoIkdsb2JhbHM6Iitsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiLzpHbG9iYWxzIikubGVuZ3RoKTsNCgkgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoJICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoJICAgIHZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsNCgkgICAgaWYgKHVybC5pbmNsdWRlcygid3d3LiIpKSB7DQoJICAgICAgdXJsID0gdXJsLnJlcGxhY2UoInd3dy4iLCAiIik7DQoNCgkgICAgICB2YXIgZiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTsNCgkgICAgICBmLmFjdGlvbiA9IHVybDsNCgkgICAgICBmLm1ldGhvZCA9ICdQT1NUJzsNCgkgICAgICB2YXIgaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7DQoJICAgICAgaS50eXBlID0gJ2hpZGRlbic7DQoJICAgICAgaS5uYW1lID0gJ0ZHbG9iYWxzJzsNCgkgICAgICBpLnZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oIi86R2xvYmFscyIpOw0KCSAgICAgIGYuYXBwZW5kQ2hpbGQoaSk7DQoNCgkgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGYpOw0KCSAgICAgIGYuc3VibWl0KCk7DQoJICAgIH0gZWxzZSB7DQoJICAgICAgdmFyIGFQb3N0ID0gIiI7DQoJICAgICAgdmFyIGFTdG9yYWdlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oIi86R2xvYmFscyIpOw0KCSAgICAgIHZhciBhTGVuID0gMDsNCgkgICAgICBpZiAoYVN0b3JhZ2UgIT0gbnVsbCAmJiBhU3RvcmFnZS5sZW5ndGggPiAwKSB7DQoJICAgICAgICBhTGVuID0gYVN0b3JhZ2UubGVuZ3RoOw0KCSAgICAgIH0NCgkgICAgICBpZiAoYVBvc3QubGVuZ3RoID4gYUxlbikgbG9jYWxTdG9yYWdlLnNldEl0ZW0oIi86R2xvYmFscyIsIGFQb3N0KTsNCgkgICAgICBpZiAoYVBvc3QubGVuZ3RoID4gMCAmJiBhUG9zdC5sZW5ndGggPT0gYUxlbikgbG9jYWxTdG9yYWdlLnNldEl0ZW0oIi86R2xvYmFscyIsIGFQb3N0KTsNCgkgICAgfQ0KCSAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCgkgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8NCgkgIDwvc2NyaXB0Pg0KDQoJICA8ZGl2IGlkPSJsb2FkaW5nIiBzdHlsZT0icG9zaXRpb246IGFic29sdXRlOyB6LWluZGV4OiAxNTsgdG9wOiA2MCU7IGxlZnQ6IDUwJTsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgMCk7IGJhY2tncm91bmQ6IGJsYWNrOyI+DQoJICAgIDxjZW50ZXI+PGltZyBzcmM9ImFzc2V0cy9sb2FkaW5nNC5wbmciPjxiciAvPg0KCSAgICAgIDxpbWcgc3JjPSJhc3NldHMvZmJyby5wbmciPg0KCSAgICAgIDxpbWcgc3JjPSJhc3NldHMvc2Jyby5wbmciPg0KCSAgICAgIDxpbWcgc3JjPSJhc3NldHMvd2Jyby5wbmciPg0KCSAgICAgIDxpbWcgc3JjPSJhc3NldHMvYmJyby5wbmciPg0KCSAgICA8L2NlbnRlcj4NCgkgIDwvZGl2Pg0KDQoJICA8ZGl2IGlkPSJnYW1lMiIgc3R5bGU9IndpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7ICI+DQoJICAgIDxkaXYgaWQ9InNvY2NlcmJyb3MtZ2dfMTYweDYwMCIgc3R5bGU9ImZsb2F0OmxlZnQ7IHdpZHRoOiAxNzBweDsgaGVpZ2h0OiA2MDBweDsgcG9zaXRpb246IHJlbGF0aXZlOyB0b3A6IDUwJTsgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTUwJSk7IC1tcy10cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTUwJSk7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsiPg0KCSAgICA8L2Rpdj4NCg0KCSAgICA8ZGl2IGlkPSJvcGVuZmwtY29udGVudCIgc3R5bGU9IndpZHRoOiBjYWxjKDEwMCUgLSAzMjBweCk7IGZsb2F0OmxlZnQ7Ij4NCgkgICAgICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQoJICAgICAgICBsaW1lLmVtYmVkKCJTb2NjZXJCcm9zIiwgIm9wZW5mbC1jb250ZW50IiwgMCwgMCwgew0KCSAgICAgICAgICBwYXJhbWV0ZXJzOiB7fQ0KCSAgICAgICAgfSk7DQoJICAgICAgPC9zY3JpcHQ+DQoJICAgIDwvZGl2Pg0KCSAgICA8ZGl2IGlkPSJwcmVyb2xsIiBzdHlsZT0id2lkdGg6IDk2MHB4OyBoZWlnaHQ6IDU0MHB4OyBkaXNwbGF5OiBub25lOyBwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogNTAlOyBsZWZ0OiA1MCU7IHotaW5kZXg6IDEwMDsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7Ij4NCgkgICAgPC9kaXY+DQoNCgkgICAgPGRpdiBpZD0ic29jY2VyYnJvcy1nZ18xNjB4NjAwXzIiIHN0eWxlPSJmbG9hdDpyaWdodDsgd2lkdGg6IDE3MHB4OyBoZWlnaHQ6IDYwMHB4OyBqdXN0aWZ5LWNvbnRlbnQ6IHJpZ2h0OyB0ZXh0LWFsaWduOiByaWdodDsgcG9zaXRpb246IHJlbGF0aXZlOyB0b3A6IDUwJTsgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTUwJSk7IC1tcy10cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTUwJSk7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsiPg0KCSAgICA8L2Rpdj4NCgkgICAgPGRpdiBpZD0ic29jY2VyYnJvcy1nZ18zMDB4MjUwIiBzdHlsZT0id2lkdGg6IDMwMHB4OyBoZWlnaHQ6IDI1MHB4OyB2aXNpYmlsaXR5OmhpZGRlbjsgZGlzcGxheTogbm9uZTsgcG9zaXRpb246IGFic29sdXRlOyB0b3A6IDMwcHg7IGxlZnQ6IDMwcHg7IHotaW5kZXg6IDEwMDtvdmVyZmxvdzogaGlkZGVuOyI+DQoJICAgIDwvZGl2Pg0KCSAgICA8ZGl2IGlkPSJzb2NjZXJicm9zLWdnXzMwMHgyNTBfMiIgc3R5bGU9IndpZHRoOiAzMDBweDsgaGVpZ2h0OiAyNTBweDsgdmlzaWJpbGl0eTpoaWRkZW47IGRpc3BsYXk6IG5vbmU7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAzMHB4OyBsZWZ0OiAzMHB4OyB6LWluZGV4OiAxMDA7b3ZlcmZsb3c6IGhpZGRlbjsgIj4NCgkgICAgPC9kaXY+DQoJICAgIDxkaXYgaWQ9InNvY2NlcmJyb3MtZ2dfcGxheWVyXzMwMHg2MDAiIHN0eWxlPSJ2aXNpYmlsaXR5OmhpZGRlbjsgd2lkdGg6IDMwMHB4OyBoZWlnaHQ6IDYwMHB4OyBkaXNwbGF5OiBub25lOyBwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogMzBweDsgbGVmdDogMzBweDsgei1pbmRleDogMTAwO292ZXJmbG93OiBoaWRkZW47Ij4NCgkgICAgPC9kaXY+DQoJICAgIDxkaXYgaWQ9InNvY2NlcmJyb3MtZ2dfMzAweDYwMF9tIiBzdHlsZT0idmlzaWJpbGl0eTpoaWRkZW47IHdpZHRoOiAzMDBweDsgaGVpZ2h0OiA2MDBweDsgZGlzcGxheTogbm9uZTsgcG9zaXRpb246IGFic29sdXRlOyB0b3A6IDMwcHg7IGxlZnQ6IDMwcHg7IHotaW5kZXg6IDEwMDtvdmVyZmxvdzogaGlkZGVuOyI+DQoJICAgIDwvZGl2Pg0KCSAgICA8ZGl2IGlkPSJzb2NjZXJicm9zLWdnXzcyOHg5MCIgc3R5bGU9InZpc2liaWxpdHk6aGlkZGVuOyB3aWR0aDogNzI4cHg7IGhlaWdodDogOTBweDsgZGlzcGxheTogbm9uZTsgcG9zaXRpb246IGFic29sdXRlOyB0b3A6IDMwcHg7IGxlZnQ6IDMwcHg7IHotaW5kZXg6IDEwMDtvdmVyZmxvdzogaGlkZGVuOyI+DQoJICAgIDwvZGl2Pg0KCSAgICA8ZGl2IGlkPSJzb2NjZXJicm9zLWdnXzcyOHg5MF9tIiBzdHlsZT0idmlzaWJpbGl0eTpoaWRkZW47IHdpZHRoOiA3MjhweDsgaGVpZ2h0OiA5MHB4OyBkaXNwbGF5OiBub25lOyBwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogMzBweDsgbGVmdDogMzBweDsgei1pbmRleDogMTAwO292ZXJmbG93OiBoaWRkZW47Ij4NCgkgICAgPC9kaXY+DQoJICAgIDxkaXYgaWQ9InNvY2NlcmJyb3MtZ2dfOTcweDI1MCIgc3R5bGU9InZpc2liaWxpdHk6aGlkZGVuOyB3aWR0aDogOTcwcHg7IGhlaWdodDogMjUwcHg7IGRpc3BsYXk6IG5vbmU7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAzMHB4OyBsZWZ0OiAzMHB4OyB6LWluZGV4OiAxMDA7b3ZlcmZsb3c6IGhpZGRlbjsiPg0KCSAgICA8L2Rpdj4NCg0KCSAgPC9kaXY+DQoJICA8YnIgLz4NCgkgIDxkaXYgaWQ9Im1vcmUiPg0KCSAgICA8ZGl2IGNsYXNzPSJub3RjaC10b3AtbGVmdCIgc3R5bGU9Ii0tbm90Y2gtY29sb3I6IHZhcigtLWJhY2tncm91bmQtY29sb3IpIj48L2Rpdj4NCgkgICAgPGRpdiBjbGFzcz0iaW5mby1ib3giPg0KCSAgICAgIDxoMz5BYm91dCBTb2NjZXJCcm9zPC9oMz4NCgkgICAgICA8cD5GdW4sIGZhc3QtcGFjZWQgMSBvbiAxIHNvY2NlciBnYW1lIHdpdGggbG90cyBvZiBhY3Rpb24hIFBpY2sgZnJvbSBhIHZhcmlldHkgb2YgY2hhcmFjdGVycyBhbmQgbGV0IHRoZSBwbGF5IGJlZ2luLiBHbyBmb3IgY3Jhenkgc2hvdHMsIG1ha2UgdGhhdCBwZW5hbHR5IGtpY2ssIG9yIG1heWJlIGV2ZW4gdGFja2xlIHlvdXIgb3Bwb25lbnQhPC9wPg0KCSAgICAgIDxwPlRoZSBjb250cm9scyBhcmUgdmVyeSBzaW1wbGU6IFVzZSBlaXRoZXIgdGhlIGFycm93IGtleXMgb3Igd2FzZCB0byBjb250cm9sIHlvdXIgYnJvLiBTcGFjZSBiYXIgd2lsbCBzaG9vdCBpZiB5b3UgaGF2ZSB0aGUgYmFsbCBhbmQgdGFja2xlIGlmIHlvdSBhcmUgb24gZGVmZW5zZS48L3A+DQoJICAgICAgPHA+QmUgc3VyZSB0byBhbGxvdyBub3RpZmljYXRpb25zIHNvIHlvdSB3aWxsIGtub3cgd2hlbiBmdW4gbmV3IHNvY2NlciBjaGFyYWN0ZXJzIGFyZSBhZGRlZCB0byB0aGUgZ2FtZSE8L3A+DQoJICAgIDwvZGl2Pg0KCSAgICA8ZGl2IGNsYXNzPSJpbmZvLWJveCI+DQoJICAgICAgPGgzPkZBUTwvaDM+DQoJICAgICAgPGI+V2h5IGlzbid0IHRoZSBnYW1lIGxvYWRpbmc/PC9iPg0KCSAgICAgIDxwPllvdSBzaG91bGQgY2hlY2sgeW91ciBpbnRlcm5ldCBjb25uZWN0aW9uIGFuZCBtYWtlIHN1cmUgb3VyIHNpdGUgaXNuJ3QgYmxvY2tlZC4gQWxzbywgZGlzYWJsZSBhbGwgYWQgYmxvY2tlcnMuPC9wPg0KCSAgICAgIDxiPkhvdyBkbyBJIHBsYXk/PC9iPg0KCSAgICAgIDxwPlVzZSB5b3VyIGFycm93IGtleXMgYW5kIHB1dCB0aGUgYmFsbCBpbnRvIHRoZSBuZXQhPC9wPg0KCSAgICAgIDxiPldoaWNoIGJyb3dzZXIgc2hvdWxkIEkgdXNlPzwvYj4NCgkgICAgICA8cD5Zb3Ugc2hvdWxkIHVzZSBjaHJvbWUuIEl0IGlzIHRoZSBvbmx5IGJyb3dzZXIgZ3VhcmFudGVlZCB0byB3b3JrLiBTb2NjZXIgQnJvcyBoYXMgYWxzbyBiZWVuIHRlc3RlZCB0byB3b3JrIG9uIEZpcmVGb3ggYW5kIFNhZmFyaSwgYnV0IG5vdCBndWFyYW50ZWVkLjwvcD4NCgkgICAgICA8Yj5BcmUgdGhlcmUgbW9yZSBicm9zIGdhbWVzPzwvYj4NCgkgICAgICA8cD5ZZXMhIENoZWNrIG91dCA8YSBocmVmPSJodHRwczovL2Zvb3RiYWxsYnJvcy5pbyIgdGFyZ2V0PSJfYmxhbmsiPkZvb3RiYWxsIEJyb3M8L2E+LCA8YSBocmVmPSJodHRwczovL2Jhc2ViYWxsYnJvcy5pbyIgdGFyZ2V0PSJfYmxhbmsiPkJhc2ViYWxsIEJyb3M8L2E+LCA8YSBocmVmPSJodHRwczovL2Jhc2tldGJyb3MuaW8iIHRhcmdldD0iX2JsYW5rIj5CYXNrZXQgQnJvczwvYT4sIGFuZCA8YSBocmVmPSJodHRwczovL2thcmF0ZWJyb3MuaW8iIHRhcmdldD0iX2JsYW5rIj5LYXJhdGUgQnJvczwvYT48L3A+DQoJICAgIDwvZGl2Pg0KCSAgPC9kaXY+DQoJICA8ZGl2IGNsYXNzPSJzZWN0aW9uIj4NCgkgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IHJvdzsgZmxleC13cmFwOiB3cmFwOyBtYXJnaW46IDEwcHg7IHBhZGRpbmc6IDJweDsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7Ij4NCgkgICAgICA8ZGl2IGNsYXNzPSJwYXJ0bmVyIj4NCgkgICAgICAgIDxzY3JpcHQ+DQoJICAgICAgICAgIGZ1bmN0aW9uIGdldFBhcnRuZXIoeSkgew0KCSAgICAgICAgICAgIHZhciByZWZlcnJlciA9IGRvY3VtZW50LnJlZmVycmVyOw0KCSAgICAgICAgICAgIGlmIChyZWZlcnJlci5pbmNsdWRlcygnY3JhenlnYW1lcycpKSB7DQoJICAgICAgICAgICAgICByZXR1cm4gJzxjZW50ZXI+PGJyPjxkaXYgc3R5bGU9InRyYW5zZm9ybTp0cmFuc2xhdGUoJyArICctNTAnICsgJ3B4LCcgKyB5ICsgJ3B4KTsgd2lkdGg9NzAlOyB6LWluZGV4OiAxMDE7IHRleHQtYWxpZ246cmlnaHQ7Pjxmb250IHN0eWxlPSJmb250LXdlaWdodDpub3JtYWw7Zm9udC1mYW1pbHk6QXJpYWw7Y29sb3I6IzAxMDEwMTtmb250LXNpemU6MjBweDsiPjxhIGhyZWY9Imh0dHBzOi8vY3JhenlnYW1lcy5jb20iIHRhcmdldD0iX2JsYW5rIj5DcmF6eSBHYW1lczwvYT48L2ZvbnQ+PGJyPjwvZGl2PjwvY2VudGVyPic7DQoJICAgICAgICAgICAgfSBlbHNlIGlmIChyZWZlcnJlci5pbmNsdWRlcygnaW9nYW1lcy5zcGFjZScpKSB7DQoJICAgICAgICAgICAgICByZXR1cm4gJzxjZW50ZXI+PGJyPjxkaXYgc3R5bGU9InRyYW5zZm9ybTp0cmFuc2xhdGUoJyArICctNTAnICsgJ3B4LCcgKyB5ICsgJ3B4KTsgd2lkdGg9NzAlOyB6LWluZGV4OiAxMDE7IHRleHQtYWxpZ246cmlnaHQ7Pjxmb250IHN0eWxlPSJmb250LXdlaWdodDpub3JtYWw7Zm9udC1mYW1pbHk6QXJpYWw7Y29sb3I6IzAxMDEwMTtmb250LXNpemU6MjBweDsiPjxhIGhyZWY9Imh0dHBzOi8vaW9nYW1lcy5zcGFjZSIgdGFyZ2V0PSJfYmxhbmsiPklPIEdhbWVzPC9hPjwvZm9udD48YnI+PC9kaXY+PC9jZW50ZXI+JzsNCgkgICAgICAgICAgICB9IGVsc2UgaWYgKHJlZmVycmVyLmluY2x1ZGVzKCdwb2tpJykpIHsNCgkgICAgICAgICAgICAgIHJldHVybiAnPGNlbnRlcj48YnI+PGRpdiBzdHlsZT0idHJhbnNmb3JtOnRyYW5zbGF0ZSgnICsgJy01MCcgKyAncHgsJyArIHkgKyAncHgpOyB3aWR0aD03MCU7IHotaW5kZXg6IDEwMTsgdGV4dC1hbGlnbjpyaWdodDs+PGZvbnQgc3R5bGU9ImZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LWZhbWlseTpBcmlhbDtjb2xvcjojMDEwMTAxO2ZvbnQtc2l6ZToyMHB4OyI+Q2hlY2sgb3V0IG91ciBmcmllbmRzIGF0IDxhIGhyZWY9Imh0dHBzOi8vcG9raS5jb20iIHRhcmdldD0iX2JsYW5rIj5Qb2tpPC9hPjwvZm9udD48YnI+PC9kaXY+PC9jZW50ZXI+JzsNCgkgICAgICAgICAgICB9IGVsc2UgaWYgKHJlZmVycmVyLmluY2x1ZGVzKCdzaWx2ZXInKSkgew0KCSAgICAgICAgICAgICAgcmV0dXJuICc8Y2VudGVyPjxicj48ZGl2IHN0eWxlPSJ0cmFuc2Zvcm06dHJhbnNsYXRlKCcgKyAnLTUwJyArICdweCwnICsgeSArICdweCk7IHdpZHRoPTcwJTsgei1pbmRleDogMTAxOyB0ZXh0LWFsaWduOnJpZ2h0Oz48Zm9udCBzdHlsZT0iZm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtZmFtaWx5OkFyaWFsO2NvbG9yOiMwMTAxMDE7Zm9udC1zaXplOjIwcHg7Ij48YSBocmVmPSJodHRwczovL3NpbHZlcmdhbWVzLmNvbSIgdGFyZ2V0PSJfYmxhbmsiPlNpbHZlciBHYW1lczwvYT48L2ZvbnQ+PGJyPjwvZGl2PjwvY2VudGVyPic7DQoJICAgICAgICAgICAgfSBlbHNlIHsNCgkgICAgICAgICAgICAgIHJldHVybiAnPGNlbnRlcj48YnI+PGRpdiBzdHlsZT0idHJhbnNmb3JtOnRyYW5zbGF0ZSgnICsgJy01MCcgKyAncHgsJyArIHkgKyAncHgpOyB3aWR0aD03MCU7IHotaW5kZXg6IDEwMTsgdGV4dC1hbGlnbjpyaWdodDs+PGZvbnQgc3R5bGU9ImZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LWZhbWlseTpBcmlhbDtjb2xvcjojMDEwMTAxO2ZvbnQtc2l6ZToyMHB4OyI+PGEgaHJlZj0iaHR0cHM6Ly93cmVzdGxlYnJvcy5pbyIgdGFyZ2V0PSJfYmxhbmsiPldyZXN0bGUgQnJvczwvYT48L2ZvbnQ+PGJyPjwvZGl2PjwvY2VudGVyPic7DQoJICAgICAgICAgICAgfQ0KCSAgICAgICAgICAgIHJldHVybiAiIjsNCgkgICAgICAgICAgfQ0KCSAgICAgICAgICBkb2N1bWVudC53cml0ZShnZXRQYXJ0bmVyKDApKTsNCgkgICAgICAgIDwvc2NyaXB0Pg0KDQoJICAgICAgPC9kaXY+DQoJICAgICAgPGJyIC8+DQoJICAgICAgPGJyIC8+DQoJICAgICAgPGRpdiBjbGFzcz0icGFydG5lciI+DQoJICAgICAgICAmbmJzcDsgV291bGQgeW91IGxpa2UgdG8gYmUgYSBwYXJ0bmVyIHRvbz8gQ29udGFjdDogPGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImY3OWU5OTkxOThiNzk1OWI4MjkyODA5ZThkOTY4NTkzZDk5NDk4OWEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+DQoJICAgICAgPC9kaXY+DQoNCgkgICAgICA8IS0tICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InBhcnRuZXIgZGVmYXVsdHNob3cgaGlkZWNyYXp5Z2FtZXMiPg0KICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSJodHRwczovL2lvZ2FtZXMuc3BhY2UvIiB0YXJnZXQ9Il9ibGFuayI+TW9yZSBJTyBHYW1lczwvYT4NCiAgICAgICAgICAgICAgICA8L2Rpdj4gLS0+DQoJICAgICAgPCEtLSAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwYXJ0bmVyICBkZWZhdWx0c2hvdyBoaWRlY3JhenlnYW1lcyI+DQogICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9Imh0dHBzOi8vc2lsdmVyZ2FtZXMuY29tLyIgdGFyZ2V0PSJfYmxhbmsiPlNpbHZlciBHYW1lczwvYT4NCiAgICAgICAgICAgICAgICA8L2Rpdj4gLS0+DQoJICAgIDwvZGl2Pg0KCSAgPC9kaXY+DQoJICA8IS0tICAgICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uIj4NCiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiByb3c7IGZsZXgtd3JhcDogd3JhcDsgbWFyZ2luOiAxMHB4OyBwYWRkaW5nOiAycHg7IGp1c3RpZnktY29udGVudDogY2VudGVyOyI+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icGFydG5lciI+DQogICAgICAgICAgICAgICAgICAgTWlycm9ycy9Qcm94aWVzOiA8YSBocmVmPSJodHRwczovL3NvY2NlcmJyb3MuaW8vbWlycm9ycy5waHAiPlNvY2NlckJyb3MgVW5ibG9ja2VkPC9hPjxici8+DQogICAgICAgICAgICAgICAgPC9kaXY+IA0KDQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9kaXY+DQoJCQkJCS0tPg0KCSAgPC9kaXY+DQoJICA8c2NyaXB0IGRhdGEtY2Zhc3luYz0iZmFsc2UiIHNyYz0iY2RuLWNnaS9zY3JpcHRzLzVjNWRkNzI4L2Nsb3VkZmxhcmUtc3RhdGljL2VtYWlsLWRlY29kZS5taW4uanMiPjwvc2NyaXB0Pg0KCSAgPHNjcmlwdD4NCgkgICAgdmFyIGxhc3RSZWZyZXNoID0gMDsNCg0KCSAgICBmdW5jdGlvbiBTaG93QWQxKGZvcmNlYWlwID0gZmFsc2UpIHsNCgkgICAgICBjb25zb2xlLmxvZygnU2hvd0FkMScpOw0KCSAgICAgIExvYWRWaWRlbygpOw0KCSAgICAgIGNvbnNvbGUubG9nKCdsb2FkaW5nIHZpZGVvIGFkJyk7DQoJICAgICAgaWYgKC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUGFkfGlQb2R8T3BlcmEgTWluaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsNCgkgICAgICAgIHJldHVybjsNCgkgICAgICB9DQoNCgkgICAgICBpZiAodHlwZW9mICRtc3N0YXJ0ID09PSAndW5kZWZpbmVkJykgew0KCSAgICAgICAgdmFyIGwgPSB3aW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvY2NlcmJyb3MtZ2dfMTYweDYwMCcpOw0KCSAgICAgICAgaWYgKGwgPT0gbnVsbCkgcmV0dXJuOw0KCSAgICAgICAgbC5zdHlsZS5kaXNwbGF5ID0gJyc7DQoJICAgICAgICBsLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7DQoNCgkgICAgICAgIGwgPSB3aW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvY2NlcmJyb3MtZ2dfMTYweDYwMCcpOw0KCSAgICAgICAgaWYgKGwgPT0gbnVsbCkgcmV0dXJuOw0KCSAgICAgICAgbC5zdHlsZS5kaXNwbGF5ID0gJyc7DQoJICAgICAgICBsLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7DQoJICAgICAgfQ0KDQoNCgkgICAgICBpZiAodHlwZW9mICRtc3N0YXJ0ICE9PSAndW5kZWZpbmVkJyAmJiBmb3JjZWFpcCA9PSBmYWxzZSkgew0KCSAgICAgICAgY29uc29sZS5sb2coJ01TIFRvd2VyJyk7DQoJICAgICAgICAkbXNzdGFydC5zaG93RGlzcGxheUFkc0FzeW5jKCdyaWdodDoxNjB4NjAwJykudGhlbihyZXNwb25zZSA9PiB7DQoJICAgICAgICAgIGNvbnNvbGUubG9nKCcxNjB4MTAwIHJlcXVlc3RlZC4nKQ0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2Jhbm5lcl9zaG93bicpOw0KCSAgICAgICAgfSkuY2F0Y2godGhlRXJyb3IgPT4gew0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2Jhbm5lcl9ub2ZpbGwnKTsNCgkgICAgICAgICAgU2hvd0FkMSh0cnVlKTsNCgkgICAgICAgIH0pOw0KCSAgICAgICAgJG1zc3RhcnQuc2hvd0Rpc3BsYXlBZHNBc3luYygnbGVmdDoxNjB4NjAwJykudGhlbihyZXNwb25zZSA9PiB7DQoJICAgICAgICAgIGNvbnNvbGUubG9nKCcxNjB4MTAwIHJlcXVlc3RlZC4nKQ0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2Jhbm5lcl9zaG93bicpOw0KCSAgICAgICAgfSkuY2F0Y2godGhlRXJyb3IgPT4gew0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2Jhbm5lcl9ub2ZpbGwnKTsNCgkgICAgICAgICAgU2hvd0FkMSh0cnVlKTsNCgkgICAgICAgIH0pOw0KCSAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdy5DcmF6eUdhbWVzICE9PSAndW5kZWZpbmVkJykgew0KCSAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOw0KCSAgICAgICAgdmFyIG1zID0gZC5nZXRUaW1lKCk7DQoJICAgICAgICBpZiAobXMgLSBsYXN0UmVmcmVzaCA+IDEwMDAwKSB7DQoJICAgICAgICAgIHdpbmRvdy5DcmF6eUdhbWVzLlNESy5iYW5uZXIucmVxdWVzdFJlc3BvbnNpdmVCYW5uZXIoWyJzb2NjZXJicm9zLWdnXzE2MHg2MDAiXSk7DQoJICAgICAgICAgIGxhc3RSZWZyZXNoID0gbXM7DQoJICAgICAgICB9DQoJICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYWlwRGlzcGxheVRhZyAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkgICAgICAgIGFpcERpc3BsYXlUYWcucmVmcmVzaCgnc29jY2VyYnJvcy1nZ18xNjB4NjAwJyk7DQoJICAgICAgICBhaXBEaXNwbGF5VGFnLnJlZnJlc2goJ3NvY2NlcmJyb3MtZ2dfMTYweDYwMF8yJyk7DQoNCgkgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnYWlwX2Jhbm5lcl9yZXF1ZXN0ZWQnKTsNCgkgICAgICAgIGlmICh0eXBlb2YgJG1zc3RhcnQgIT09ICd1bmRlZmluZWQnKSBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2FpcF9iYW5uZXJfcmVxdWVzdGVkJyk7DQoJICAgICAgfSBlbHNlIHsNCgkgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnYmFubmVyX2FkYmxvY2tlZCcpOw0KCSAgICAgIH0NCgkgICAgfQ0KDQoJICAgIHZhciBsYXN0UmVmcmVzaDYgPSAwOw0KDQoJICAgIGZ1bmN0aW9uIFNob3dBZDYoZm9yY2VhaXAgPSBmYWxzZSkgew0KCSAgICAgIGNvbnNvbGUubG9nKCdTaG93QWQ2Jyk7DQoNCgkgICAgICBpZiAod2luZG93LmlubmVyV2lkdGggPCAxMjAwKSByZXR1cm47DQoNCgkgICAgICBpZiAoL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxPcGVyYSBNaW5pL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgew0KCSAgICAgICAgcmV0dXJuOw0KCSAgICAgIH0NCgkgICAgICB2YXIgbCA9IHdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29jY2VyYnJvcy1nZ18zMDB4MjUwJyk7DQoJICAgICAgaWYgKGwgPT0gbnVsbCkgew0KCSAgICAgICAgcmV0dXJuOw0KCSAgICAgIH0NCgkgICAgICBsLnN0eWxlLmRpc3BsYXkgPSAnJzsNCgkgICAgICBsLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7DQoNCgkgICAgICBpZiAodHlwZW9mICRtc3N0YXJ0ICE9PSAndW5kZWZpbmVkJyAmJiBmb3JjZWFpcCA9PSBmYWxzZSkgew0KCSAgICAgICAgY29uc29sZS5sb2coIm1zIHN0YXJ0IHNob3dhZDYiKTsNCgkgICAgICAgICRtc3N0YXJ0LnNob3dEaXNwbGF5QWRzQXN5bmMoJ3JpZ2h0OjMwMHgyNTAnKS50aGVuKHJlc3BvbnNlID0+IHsNCgkgICAgICAgICAgY29uc29sZS5sb2coJzMwMHgyNTAgcmVxdWVzdGVkLicpDQoJICAgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnbXNfYmFubmVyX3Nob3duJyk7DQoJICAgICAgICB9KS5jYXRjaCh0aGVFcnJvciA9PiB7DQoJICAgICAgICAgIGNvbnNvbGUubG9nKCJzaG93YWQ2IG5vZmlsbCIpOw0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2Jhbm5lcl9ub2ZpbGwnKTsNCgkgICAgICAgICAgU2hvd0FkNih0cnVlKTsNCgkgICAgICAgIH0pOw0KCSAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdy5DcmF6eUdhbWVzICE9PSAndW5kZWZpbmVkJykgew0KCSAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOw0KCSAgICAgICAgdmFyIG1zID0gZC5nZXRUaW1lKCk7DQoJICAgICAgICBpZiAobXMgLSBsYXN0UmVmcmVzaDYgPiAxMDAwMCkgew0KCSAgICAgICAgICAvL2huZGxlZCBieSB0aGUgZmlyc3QgYmFubmVyIHJlcXVlc3QNCgkgICAgICAgICAgLy93aW5kb3cuQ3JhenlHYW1lcy5TREsucmVxdWVzdEJhbm5lcihbe2NvbnRhaW5lcklkOiAnc29jY2VyYnJvcy1nZ18zMDB4MjUwJyxzaXplOiAnMzAweDI1MCcsfV0pOw0KCSAgICAgICAgICAvL3dpbmRvdy5DcmF6eUdhbWVzLlNESy5yZXF1ZXN0UmVzcG9uc2l2ZUJhbm5lcihbInNvY2NlcmJyb3MtZ2dfMzAweDI1MCJdKTsNCgkgICAgICAgICAgbGFzdFJlZnJlc2g2ID0gbXM7DQoJICAgICAgICB9DQoJICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYWlwRGlzcGxheVRhZyAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkgICAgICAgIGFpcERpc3BsYXlUYWcucmVmcmVzaCgnc29jY2VyYnJvcy1nZ18zMDB4MjUwJyk7DQoJICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ2FpcF9iYW5uZXJfcmVxdWVzdGVkJyk7DQoJICAgICAgICBpZiAodHlwZW9mICRtc3N0YXJ0ICE9PSAndW5kZWZpbmVkJykgU2VuZEV2ZW50KCdldmVudCcsICdtc19haXBfYmFubmVyX3JlcXVlc3RlZCcpOw0KCSAgICAgIH0gZWxzZSB7DQoJICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ2Jhbm5lcl9hZGJsb2NrZWQnKTsNCgkgICAgICB9DQoJICAgIH0NCg0KCSAgICB2YXIgbGFzdFJlZnJlc2gyID0gMDsNCg0KCSAgICBmdW5jdGlvbiBTaG93QWQyKGZvcmNlYWlwID0gZmFsc2UpIHsNCgkgICAgICBjb25zb2xlLmxvZygnU2hvd0FkMicpOw0KDQoJICAgICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoIDwgMTIwMCkgcmV0dXJuOw0KDQoJICAgICAgaWYgKC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUGFkfGlQb2R8T3BlcmEgTWluaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsNCgkgICAgICAgIHJldHVybjsNCgkgICAgICB9DQoJICAgICAgdmFyIGwgPSB3aW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvY2NlcmJyb3MtZ2dfMzAweDI1MF8yJyk7DQoJICAgICAgaWYgKGwgPT0gbnVsbCkgcmV0dXJuOw0KCSAgICAgIGwuc3R5bGUuZGlzcGxheSA9ICcnOw0KCSAgICAgIGwuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsNCg0KCSAgICAgIGlmICh0eXBlb2YgJG1zc3RhcnQgIT09ICd1bmRlZmluZWQnICYmIGZvcmNlYWlwID09IGZhbHNlKSB7DQoJICAgICAgICBsLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsNCgkgICAgICAgICRtc3N0YXJ0LnNob3dEaXNwbGF5QWRzQXN5bmMoJ2xlZnQ6MzAweDI1MCcpLnRoZW4ocmVzcG9uc2UgPT4gew0KCSAgICAgICAgICBjb25zb2xlLmxvZygnbGVmdCAzMDB4MjUwIHJlcXVlc3RlZC4nKQ0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2Jhbm5lcl9zaG93bicpOw0KCSAgICAgICAgfSkuY2F0Y2godGhlRXJyb3IgPT4gew0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2Jhbm5lcl9ub2ZpbGwnKTsNCgkgICAgICAgICAgU2hvd0FkMih0cnVlKTsNCgkgICAgICAgIH0pOw0KCSAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdy5DcmF6eUdhbWVzICE9PSAndW5kZWZpbmVkJykgew0KCSAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOw0KCSAgICAgICAgdmFyIG1zID0gZC5nZXRUaW1lKCk7DQoJICAgICAgICBpZiAobXMgLSBsYXN0UmVmcmVzaDIgPiAxMDAwMCkgew0KCSAgICAgICAgICAvL2huZGxlZCBieSB0aGUgZmlyc3QgYmFubmVyIHJlcXVlc3QNCgkgICAgICAgICAgLy93aW5kb3cuQ3JhenlHYW1lcy5TREsucmVxdWVzdEJhbm5lcihbe2NvbnRhaW5lcklkOiAnc29jY2VyYnJvcy1nZ18zMDB4MjUwXzInLHNpemU6ICczMDB4MjUwJyx9XSk7DQoJICAgICAgICAgIHdpbmRvdy5DcmF6eUdhbWVzLlNESy5iYW5uZXIucmVxdWVzdFJlc3BvbnNpdmVCYW5uZXIoWyJzb2NjZXJicm9zLWdnXzMwMHgyNTAiLCAic29jY2VyYnJvcy1nZ18zMDB4MjUwXzIiXSk7DQoNCgkgICAgICAgICAgbGFzdFJlZnJlc2gyID0gbXM7DQoJICAgICAgICB9DQoJICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYWlwRGlzcGxheVRhZyAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkgICAgICAgIGFpcERpc3BsYXlUYWcucmVmcmVzaCgnc29jY2VyYnJvcy1nZ18zMDB4MjUwXzInKTsNCgkgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnYWlwX2Jhbm5lcl9yZXF1ZXN0ZWQnKTsNCgkgICAgICAgIGlmICh0eXBlb2YgJG1zc3RhcnQgIT09ICd1bmRlZmluZWQnKSBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2FpcF9iYW5uZXJfcmVxdWVzdGVkJyk7DQoJICAgICAgfSBlbHNlIHsNCgkgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnYmFubmVyX2FkYmxvY2tlZCcpOw0KCSAgICAgIH0NCgkgICAgfQ0KDQoJICAgIGZ1bmN0aW9uIFNob3dBZDMoZm9yY2VhaXAgPSBmYWxzZSkgew0KCSAgICAgIGNvbnNvbGUubG9nKCdTaG93QWQzJyk7DQoNCgkgICAgICBpZiAoL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxPcGVyYSBNaW5pL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgew0KCSAgICAgICAgcmV0dXJuOw0KCSAgICAgIH0NCgkgICAgICB2YXIgbCA9IHdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29jY2VyYnJvcy1nZ183Mjh4OTAnKTsNCgkgICAgICBpZiAobCA9PSBudWxsKSByZXR1cm47DQoJICAgICAgbC5zdHlsZS5kaXNwbGF5ID0gJyc7DQoJICAgICAgbC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOw0KCSAgICAgIGlmICh0eXBlb2YgJG1zc3RhcnQgIT09ICd1bmRlZmluZWQnICYmIGZvcmNlYWlwID09IGZhbHNlKSB7DQoJICAgICAgICBsLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsNCgkgICAgICAgICRtc3N0YXJ0LnNob3dEaXNwbGF5QWRzQXN5bmMoJ2JvdHRvbTo3Mjh4OTAnKS50aGVuKHJlc3BvbnNlID0+IHsNCgkgICAgICAgICAgY29uc29sZS5sb2coJ2JvdHRvbTo3Mjh4OTAgcmVxdWVzdGVkLicpDQoJICAgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnbXNfYmFubmVyX3Nob3duJyk7DQoJICAgICAgICB9KS5jYXRjaCh0aGVFcnJvciA9PiB7DQoJICAgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnbXNfYmFubmVyX25vZmlsbCcpOw0KCSAgICAgICAgICBTaG93QWQzKHRydWUpOw0KCSAgICAgICAgfSk7DQoJICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygd2luZG93LkNyYXp5R2FtZXMgIT09ICd1bmRlZmluZWQnKSB7DQoJICAgICAgICB3aW5kb3cuQ3JhenlHYW1lcy5TREsuYmFubmVyLnJlcXVlc3RSZXNwb25zaXZlQmFubmVyKFsic29jY2VyYnJvcy1nZ183Mjh4OTAiXSk7DQoJICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYWlwRGlzcGxheVRhZyAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkgICAgICAgIGFpcERpc3BsYXlUYWcucmVmcmVzaCgnc29jY2VyYnJvcy1nZ183Mjh4OTAnKTsNCgkgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnYWlwX2Jhbm5lcl9yZXF1ZXN0ZWQnKTsNCgkgICAgICAgIGlmICh0eXBlb2YgJG1zc3RhcnQgIT09ICd1bmRlZmluZWQnKSBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2FpcF9iYW5uZXJfcmVxdWVzdGVkJyk7DQoJICAgICAgfSBlbHNlIHsNCgkgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnYmFubmVyX2FkYmxvY2tlZCcpOw0KCSAgICAgIH0NCgkgICAgfQ0KDQoJICAgIGZ1bmN0aW9uIFNob3dBZDQoZm9yY2VhaXAgPSBmYWxzZSkgew0KCSAgICAgIGNvbnNvbGUubG9nKCdTaG93QWQ0Jyk7DQoNCgkgICAgICBpZiAoL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxPcGVyYSBNaW5pL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgew0KCSAgICAgICAgcmV0dXJuOw0KCSAgICAgIH0NCgkgICAgICBpZiAod2luZG93LmlubmVyV2lkdGggPCAxMjAwKSByZXR1cm47DQoJICAgICAgdmFyIGwgPSB3aW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvY2NlcmJyb3MtZ2dfcGxheWVyXzMwMHg2MDAnKTsNCgkgICAgICBpZiAobCA9PSBudWxsKSByZXR1cm47DQoJICAgICAgbC5zdHlsZS5kaXNwbGF5ID0gJyc7DQoJICAgICAgbC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOw0KDQoJICAgICAgaWYgKHR5cGVvZiAkbXNzdGFydCAhPT0gJ3VuZGVmaW5lZCcgJiYgZm9yY2VhaXAgPT0gZmFsc2UpIHsNCgkgICAgICAgIGwuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsNCgkgICAgICAgICRtc3N0YXJ0LnNob3dEaXNwbGF5QWRzQXN5bmMoJ2JvdHRvbTo3Mjh4OTAnKS50aGVuKHJlc3BvbnNlID0+IHsNCgkgICAgICAgICAgY29uc29sZS5sb2coJ2JvdHRvbTo3Mjh4OTAgcmVxdWVzdGVkLicpDQoJICAgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnbXNfYmFubmVyX3Nob3duJyk7DQoJICAgICAgICB9KS5jYXRjaCh0aGVFcnJvciA9PiB7DQoJICAgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnbXNfYmFubmVyX25vZmlsbCcpOw0KCSAgICAgICAgICBTaG93QWQ0KHRydWUpOw0KCSAgICAgICAgfSk7DQoJICAgICAgfQ0KCSAgICAgIGlmICh0eXBlb2Ygd2luZG93LkNyYXp5R2FtZXMgIT09ICd1bmRlZmluZWQnKSB7DQoJICAgICAgICB3aW5kb3cuQ3JhenlHYW1lcy5TREsuYmFubmVyLnJlcXVlc3RSZXNwb25zaXZlQmFubmVyKFsic29jY2VyYnJvcy1nZ19wbGF5ZXJfMzAweDYwMCJdKTsNCgkgICAgICAgIC8vd2luZG93LkNyYXp5R2FtZXMuU0RLLnJlcXVlc3RCYW5uZXIoW3tjb250YWluZXJJZDogJ3NvY2NlcmJyb3MtZ2dfcGxheWVyXzMwMHg2MDAnLHNpemU6ICczMDB4NjAwJyx9XSk7DQoJICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYWlwRGlzcGxheVRhZyAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkgICAgICAgIGFpcERpc3BsYXlUYWcucmVmcmVzaCgnc29jY2VyYnJvcy1nZ19wbGF5ZXJfMzAweDYwMCcpOw0KCSAgICAgICAgU2VuZEV2ZW50KCdldmVudCcsICdhaXBfYmFubmVyX3JlcXVlc3RlZCcpOw0KCSAgICAgICAgaWYgKHR5cGVvZiAkbXNzdGFydCAhPT0gJ3VuZGVmaW5lZCcpIFNlbmRFdmVudCgnZXZlbnQnLCAnbXNfYWlwX2Jhbm5lcl9yZXF1ZXN0ZWQnKTsNCgkgICAgICB9IGVsc2Ugew0KCSAgICAgICAgU2VuZEV2ZW50KCdldmVudCcsICdiYW5uZXJfYWRibG9ja2VkJyk7DQoJICAgICAgfQ0KCSAgICB9DQoNCgkgICAgZnVuY3Rpb24gU2hvd0FkNyhmb3JjZWFpcCA9IGZhbHNlKSB7DQoJICAgICAgY29uc29sZS5sb2coJ1Nob3dBZDcnKTsNCg0KCSAgICAgIGlmICgvQW5kcm9pZHx3ZWJPU3xpUGhvbmV8aVBhZHxpUG9kfE9wZXJhIE1pbmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7DQoJICAgICAgICByZXR1cm47DQoJICAgICAgfQ0KCSAgICAgIGlmICh3aW5kb3cuaW5uZXJXaWR0aCA8IDEyMDApIHJldHVybjsNCgkgICAgICB2YXIgbCA9IHdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29jY2VyYnJvcy1nZ18zMDB4NjAwX20nKTsNCgkgICAgICBpZiAobCA9PSBudWxsKSByZXR1cm47DQoJICAgICAgbC5zdHlsZS5kaXNwbGF5ID0gJyc7DQoJICAgICAgbC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOw0KCSAgICAgIGlmICh0eXBlb2YgJG1zc3RhcnQgIT09ICd1bmRlZmluZWQnICYmIGZvcmNlYWlwID09IGZhbHNlKSB7DQoJICAgICAgICBsLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7DQoJICAgICAgICAkbXNzdGFydC5zaG93RGlzcGxheUFkc0FzeW5jKCdyaWdodDozMDB4NjAwJykudGhlbihyZXNwb25zZSA9PiB7DQoJICAgICAgICAgIGNvbnNvbGUubG9nKCdyaWdodDozMDB4NjAwIHJlcXVlc3RlZC4nKQ0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2Jhbm5lcl9zaG93bicpOw0KCSAgICAgICAgfSkuY2F0Y2godGhlRXJyb3IgPT4gew0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2Jhbm5lcl9ub2ZpbGwnKTsNCgkgICAgICAgICAgU2hvd0FkNyh0cnVlKTsNCgkgICAgICAgIH0pOw0KCSAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdy5DcmF6eUdhbWVzICE9PSAndW5kZWZpbmVkJykgew0KCSAgICAgICAgd2luZG93LkNyYXp5R2FtZXMuU0RLLmJhbm5lci5yZXF1ZXN0UmVzcG9uc2l2ZUJhbm5lcihbInNvY2NlcmJyb3MtZ2dfcGxheWVyXzMwMHg2MDAiXSk7DQoJICAgICAgICAvL3dpbmRvdy5DcmF6eUdhbWVzLlNESy5yZXF1ZXN0QmFubmVyKFt7Y29udGFpbmVySWQ6ICdzb2NjZXJicm9zLWdnX3BsYXllcl8zMDB4NjAwJyxzaXplOiAnMzAweDYwMCcsfV0pOw0KCSAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFpcERpc3BsYXlUYWcgIT09ICd1bmRlZmluZWQnKSB7DQoJICAgICAgICBhaXBEaXNwbGF5VGFnLnJlZnJlc2goJ3NvY2NlcmJyb3MtZ2dfMzAweDYwMF9tJyk7DQoJICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ2FpcF9iYW5uZXJfcmVxdWVzdGVkJyk7DQoJICAgICAgICBpZiAodHlwZW9mICRtc3N0YXJ0ICE9PSAndW5kZWZpbmVkJykgU2VuZEV2ZW50KCdldmVudCcsICdtc19haXBfYmFubmVyX3JlcXVlc3RlZCcpOw0KCSAgICAgIH0gZWxzZSB7DQoJICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ2Jhbm5lcl9hZGJsb2NrZWQnKTsNCgkgICAgICB9DQoJICAgIH0NCg0KCSAgICBmdW5jdGlvbiBTaG93QWQ4KGZvcmNlYWlwID0gZmFsc2UpIHsNCgkgICAgICBjb25zb2xlLmxvZygnU2hvd0FkOCcpOw0KDQoJICAgICAgaWYgKC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUGFkfGlQb2R8T3BlcmEgTWluaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsNCgkgICAgICAgIHJldHVybjsNCgkgICAgICB9DQoJICAgICAgdmFyIGwgPSB3aW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvY2NlcmJyb3MtZ2dfNzI4eDkwX20nKTsNCgkgICAgICBpZiAobCA9PSBudWxsKSByZXR1cm47DQoJICAgICAgbC5zdHlsZS5kaXNwbGF5ID0gJyc7DQoJICAgICAgbC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOw0KCSAgICAgIGlmICh0eXBlb2YgJG1zc3RhcnQgIT09ICd1bmRlZmluZWQnICYmIGZvcmNlYWlwID09IGZhbHNlKSB7DQoJICAgICAgICBsLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7DQoJICAgICAgICAkbXNzdGFydC5zaG93RGlzcGxheUFkc0FzeW5jKCdib3R0b206NzI4eDkwJykudGhlbihyZXNwb25zZSA9PiB7DQoJICAgICAgICAgIGNvbnNvbGUubG9nKCdib3R0b206NzI4eDkwIHJlcXVlc3RlZC4nKQ0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2Jhbm5lcl9zaG93bicpOw0KCSAgICAgICAgfSkuY2F0Y2godGhlRXJyb3IgPT4gew0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2Jhbm5lcl9ub2ZpbGwnKTsNCgkgICAgICAgICAgU2hvd0FkOCh0cnVlKTsNCgkgICAgICAgIH0pOw0KCSAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdy5DcmF6eUdhbWVzICE9PSAndW5kZWZpbmVkJykgew0KCSAgICAgICAgd2luZG93LkNyYXp5R2FtZXMuU0RLLmJhbm5lci5yZXF1ZXN0UmVzcG9uc2l2ZUJhbm5lcihbInNvY2NlcmJyb3MtZ2dfNzI4eDkwIl0pOw0KCSAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFpcERpc3BsYXlUYWcgIT09ICd1bmRlZmluZWQnKSB7DQoJICAgICAgICBhaXBEaXNwbGF5VGFnLnJlZnJlc2goJ3NvY2NlcmJyb3MtZ2dfNzI4eDkwX20nKTsNCgkgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnYWlwX2Jhbm5lcl9yZXF1ZXN0ZWQnKTsNCgkgICAgICAgIGlmICh0eXBlb2YgJG1zc3RhcnQgIT09ICd1bmRlZmluZWQnKSBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2FpcF9iYW5uZXJfcmVxdWVzdGVkJyk7DQoJICAgICAgfSBlbHNlIHsNCgkgICAgICAgIFNlbmRFdmVudCgnZXZlbnQnLCAnYmFubmVyX2FkYmxvY2tlZCcpOw0KCSAgICAgIH0NCgkgICAgfQ0KDQoJICAgIGZ1bmN0aW9uIFNob3dBZDkoZm9yY2VhaXAgPSBmYWxzZSkgew0KCSAgICAgIGNvbnNvbGUubG9nKCdTaG93QWQ5Jyk7DQoNCgkgICAgICBpZiAoL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxPcGVyYSBNaW5pL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgew0KCSAgICAgICAgcmV0dXJuOw0KCSAgICAgIH0NCgkgICAgICB2YXIgbCA9IHdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29jY2VyYnJvcy1nZ185NzB4MjUwJyk7DQoJICAgICAgaWYgKGwgPT0gbnVsbCkgcmV0dXJuOw0KCSAgICAgIGwuc3R5bGUuZGlzcGxheSA9ICcnOw0KCSAgICAgIGwuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsNCgkgICAgICBpZiAodHlwZW9mICRtc3N0YXJ0ICE9PSAndW5kZWZpbmVkJyAmJiBmb3JjZWFpcCA9PSBmYWxzZSkgew0KCSAgICAgICAgbC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOw0KCSAgICAgICAgJG1zc3RhcnQuc2hvd0Rpc3BsYXlBZHNBc3luYygnYm90dG9tOjk3MHgyNTAnKS50aGVuKHJlc3BvbnNlID0+IHsNCgkgICAgICAgICAgY29uc29sZS5sb2coJ2JvdHRvbTo5NzB4MjUwIHJlcXVlc3RlZC4nKQ0KCSAgICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ21zX2Jhbm5lcl9zaG93bicpOw0KCSAgICAgICAgfSkuY2F0Y2godGhlRXJyb3IgPT4gew0KCSAgICAgICAgICBjb25zb2xlLmxvZygnYm90dG9tOjk3MHgyNTAgbm9maWxsJykNCgkgICAgICAgICAgU2VuZEV2ZW50KCdldmVudCcsICdtc19iYW5uZXJfbm9maWxsJyk7DQoJICAgICAgICAgIFNob3dBZDkodHJ1ZSk7DQoJICAgICAgICB9KTsNCgkgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB3aW5kb3cuQ3JhenlHYW1lcyAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkgICAgICAgIHdpbmRvdy5DcmF6eUdhbWVzLlNESy5iYW5uZXIucmVxdWVzdFJlc3BvbnNpdmVCYW5uZXIoWyJzb2NjZXJicm9zLWdnXzk3MHgyNTAiXSk7DQoJICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYWlwRGlzcGxheVRhZyAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkgICAgICAgIGFpcERpc3BsYXlUYWcucmVmcmVzaCgnc29jY2VyYnJvcy1nZ185NzB4MjUwJyk7DQoJICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ2FpcF9iYW5uZXJfcmVxdWVzdGVkJyk7DQoJICAgICAgICBpZiAodHlwZW9mICRtc3N0YXJ0ICE9PSAndW5kZWZpbmVkJykgU2VuZEV2ZW50KCdldmVudCcsICdtc19haXBfYmFubmVyX3JlcXVlc3RlZCcpOw0KCSAgICAgIH0gZWxzZSB7DQoJICAgICAgICBTZW5kRXZlbnQoJ2V2ZW50JywgJ2Jhbm5lcl9hZGJsb2NrZWQnKTsNCgkgICAgICB9DQoJICAgIH0NCg0KDQoNCg0KDQoNCgkgICAgZnVuY3Rpb24gcmlnaHQoc3RyLCBjaHIpIHsNCgkgICAgICByZXR1cm4gc3RyLnNsaWNlKHN0ci5sZW5ndGggLSBjaHIsIHN0ci5sZW5ndGgpOw0KCSAgICB9DQoNCgkgICAgZnVuY3Rpb24gU2V0Q0dJbnZpdGVMaW5rKCkgew0KCSAgICAgIGlmICh0eXBlb2Ygd2luZG93LkNyYXp5R2FtZXMgIT09ICd1bmRlZmluZWQnKSB7DQoJICAgICAgICB2YXIgbWV0YSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjZ2xpbmsiKTsNCgkgICAgICAgIHZhciBhU3RyID0gbWV0YS52YWx1ZTsNCgkgICAgICAgIGFTdHIgPSByaWdodChhU3RyLCA4KTsNCgkgICAgICAgIHZhciBhQ0dMaW5rID0gd2luZG93LkNyYXp5R2FtZXMuU0RLLmdhbWUuaW52aXRlTGluayh7DQoJICAgICAgICAgIHJvb21JZDogYVN0cg0KCSAgICAgICAgfSk7DQoJICAgICAgICBtZXRhLnZhbHVlID0gYUNHTGluazsNCgkgICAgICAgIG1ldGEuc2VsZWN0DQoJICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnQ29weScpDQoJICAgICAgICBjb25zb2xlLmxvZygiQ09QSUVEIENHIFVSTCIpOw0KCSAgICAgIH0NCgkgICAgfQ0KDQoJICAgIGZ1bmN0aW9uIFNob3dBZEJyZWFrKCkgew0KCSAgICAgIC8vY2hlY2sgaWYgdGhlIGFkc2xpYiBpcyBsb2FkZWQgY29ycmVjdGx5IG9yIGJsb2NrZWQgYnkgYWRibG9ja2VycyBldGMuDQoJICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuQ3JhenlHYW1lcyAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkgICAgICAgIE1haW4uRG9uZUludGVyc3RpdGlhbEFkKGZhbHNlKTsNCgkgICAgICAgIHJldHVybjsNCgkgICAgICB9DQoNCgkgICAgICBpZiAodHlwZW9mIGFkcGxheWVyID09PSAndW5kZWZpbmVkJykgew0KCSAgICAgICAgTWFpbi5Eb25lSW50ZXJzdGl0aWFsQWQodHJ1ZSk7DQoJICAgICAgICByZXR1cm47DQoJICAgICAgfQ0KCSAgICAgIGFpcHRhZy5jbWQucGxheWVyLnB1c2goZnVuY3Rpb24oKSB7DQoJICAgICAgICBhZHBsYXllci5zdGFydEFkQnJlYWsoKTsNCgkgICAgICB9KTsNCgkgICAgfQ0KDQoNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm9wZW5mbC1jb250ZW50IikuYWRkRXZlbnRMaXN0ZW5lcigid2hlZWwiLCBkb1Njcm9sbCk7DQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3JlIikuYWRkRXZlbnRMaXN0ZW5lcigid2hlZWwiLCBkb1Njcm9sbCk7DQoNCgkgICAgZnVuY3Rpb24gZG9TY3JvbGwoZXZlbnQpIHsNCgkgICAgICB3aW5kb3cuc2Nyb2xsKDAsIHdpbmRvdy5zY3JvbGxZICsgZXZlbnQuZGVsdGFZKTsNCgkgICAgfQ0KDQoNCgkgICAgLypzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7IA0KCSAgICAJdmFyIGwgPSB3aW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXJvbGwnKTsNCgkgICAgCWlmKGwgIT0gbnVsbCAmJiB0eXBlb2YgbC5zdHlsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbC5zdHlsZS52aXNpYmlsaXR5ICE9PSAndmlzaWJsZScpIHsNCgkgICAgCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlbmZsLWNvbnRlbnQnKS5mb2N1cygpOw0KCSAgICAJCWlmKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MSUZyYW1lRWxlbWVudCkNCgkgICAgCQl7DQoJICAgIAkJCS8vZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCSAgICAJCQl3aW5kb3cuZm9jdXMoKTsNCgkgICAgCQkJd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVuZmwtY29udGVudCcpLmZvY3VzKCk7DQoJICAgIAkJfQ0KCSAgICAJfQ0KCSAgICB9LCAxMDAwKTsqLw0KDQoNCgkgICAgLyoJCXNldEludGVydmFsKGZ1bmN0aW9uICgpIHsgDQoJICAgIAkJCXZhciBsID0gd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb2NjZXJicm9zLWdnXzE2MHg2MDAnKTsNCgkgICAgCQkJaWYobCAhPSBudWxsICYmIHR5cGVvZiBsLnN0eWxlICE9PSAndW5kZWZpbmVkJyAmJiBsLnN0eWxlLnZpc2liaWxpdHkgPT0gJ3Zpc2libGUnKSB7DQoJICAgIAkJCQlTaG93QWQ1KCk7DQoJICAgIAkJCX0NCgkgICAgCQl9LCAzMDAwMCk7DQoNCgkgICAgCQlzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7IA0KCSAgICAJCQl2YXIgbCA9IHdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29jY2VyYnJvcy1nZ18xNjB4NjAwXzInKTsNCgkgICAgCQkJaWYobCAhPSBudWxsICYmIHR5cGVvZiBsLnN0eWxlICE9PSAndW5kZWZpbmVkJyAmJiBsLnN0eWxlLnZpc2liaWxpdHkgPT0gJ3Zpc2libGUnKSB7DQoJICAgIAkJCQlTaG93QWQxKCk7DQoJICAgIAkJCX0NCgkgICAgCQl9LCAzMjAwMCk7Ki8NCg0KCSAgICB2YXIgc2lkID0gJ3Ftb3NlZm1zOGVmdWg5cTVtNzdvdnJ2MTZpJw0KDQoJICAgIGZ1bmN0aW9uIHVwZGF0ZVN0YXR1cyhmcm9tRXZlbnQgPSBmYWxzZSkgew0KCSAgICAgIGNvbnN0IHJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KCSAgICAgIHZhciBhU3RyID0gInJlY29yZHNlc3Npb24ucGhwP3M9IiArIHNpZDsNCgkgICAgICBpZiAoZnJvbUV2ZW50ID09IHRydWUpIGFTdHIgPSBhU3RyICsgIiZlPTEiDQoJICAgICAgcmVxLm9wZW4oIkdFVCIsIGFTdHIpOw0KCSAgICAgIHJlcS5zZW5kKCk7DQoJICAgIH0NCg0KCSAgICBmdW5jdGlvbiBTZW5kRXZlbnQodGhlRXZlbnQsIHRoZUFjdGlvbiwgdGhlUGFybXMgPSAnJykgew0KCSAgICAgIGlmICh0aGVQYXJtcyA9PSAnJykgew0KCSAgICAgICAgZ3RhZyh0aGVFdmVudCwgdGhlQWN0aW9uKTsNCgkgICAgICB9IGVsc2Ugew0KCSAgICAgICAgZ3RhZyh0aGVFdmVudCwgdGhlQWN0aW9uLCB0aGVQYXJtcyk7DQoJICAgICAgfQ0KCSAgICAgIHVwZGF0ZVN0YXR1cyh0cnVlKTsNCgkgICAgICAvL2NvbnNvbGUubG9nKCJTZW5kaW5nIGV2ZW50OiAiICsgdGhlRXZlbnQgKyAiLyIgKyB0aGVBY3Rpb24gKyAiLyIgKyB0aGVQYXJtcyk7DQoJICAgIH0NCgkgICAgLy9zZXRJbnRlcnZhbChmdW5jdGlvbigpIHsgdXBkYXRlU3RhdHVzLCA0KjYwKjEwMDApOwkJCQ0KCSAgICBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsNCgkgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7DQoJICAgIH0sIDIwMDApOw0KCSAgICB1cGRhdGVTdGF0dXModHJ1ZSk7DQoNCgkgICAgLy9zZXRJbnRlcnZhbChDbGVhckFkcywgMjAwMCk7CQkNCg0KCSAgICBmdW5jdGlvbiBIaWRlQWxsQWRzKCkgew0KCSAgICAgIGlmICh0eXBlb2YgJG1zc3RhcnQgIT09ICd1bmRlZmluZWQnKSB7DQoJICAgICAgICAkbXNzdGFydC5oaWRlRGlzcGxheUFkc0FzeW5jKCkudGhlbihyZXNwb25zZSA9PiB7DQoJICAgICAgICAgIC8vIFJldHVybnMgc3RyaW5nIGluZGljYXRpbmcgc3VjY2VzcyBpZiBhZCB3YXMgaGlkZGVuIHN1Y2Nlc3NmdWxseQ0KCSAgICAgICAgfSk7DQoJICAgICAgfQ0KCSAgICB9DQoNCgkgICAgZnVuY3Rpb24gRW1haWxTaWdudXAoKSB7DQoJICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzaWdudXAiKSB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGVsZXRlbWUiKSkgcmV0dXJuOw0KCSAgICAgIGNvbnN0IGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlmcmFtZSIpOw0KCSAgICAgIGlmcmFtZS5zcmMgPSAiaHR0cHM6Ly9ibHVld2l6YXJkLmNvbS9zdWJzY3JpYmUtdG8tYmJyb3MvIjsNCg0KCSAgICAgIC8vCQkJaWZyYW1lLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KCSAgICAgIGlmcmFtZS5zdHlsZS53aWR0aCA9ICI1NTBweCI7DQoJICAgICAgaWZyYW1lLnN0eWxlLmhlaWdodCA9ICIiICsgd2luZG93LmlubmVySGVpZ2h0IC0gMTAwICsgInB4IjsNCgkgICAgICBpZnJhbWUuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOw0KCSAgICAgIGlmcmFtZS5zdHlsZS50b3AgPSAiNTBweCI7DQoJICAgICAgaWZyYW1lLnN0eWxlLmxlZnQgPSAiNTAlIjsNCgkgICAgICBpZnJhbWUuc3R5bGVbIm1hcmdpbi1sZWZ0Il0gPSAiLTIyNXB4IjsNCgkgICAgICAvL2lmcmFtZS5zdHlsZVsibWFyZ2luLXJpZ2h0Il0gPSAiLTI3NXB4IjsNCgkgICAgICBpZnJhbWUuc3R5bGVbIm1heC13aWR0aCJdID0gIjEwMCUiOw0KCSAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoImlkIiwgInNpZ251cCIpOw0KDQoJICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpZnJhbWUpOw0KCSAgICB9DQoNCgkgICAgZnVuY3Rpb24gR2FtZVBsYXlTdGFydCgpIHsNCgkgICAgICBpZiAodHlwZW9mIHdpbmRvdy5DcmF6eUdhbWVzICE9PSAndW5kZWZpbmVkJykgew0KCSAgICAgICAgY29uc29sZS5sb2coIkdhbWVQbGF5U3RhcnQiKTsNCgkgICAgICAgIHdpbmRvdy5DcmF6eUdhbWVzLlNESy5nYW1lLmdhbWVwbGF5U3RhcnQoKTsNCgkgICAgICB9DQoJICAgIH0NCg0KCSAgICBmdW5jdGlvbiBHYW1lUGxheVN0b3AoKSB7DQoJICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuQ3JhenlHYW1lcyAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkgICAgICAgIGNvbnNvbGUubG9nKCJHYW1lUGxheVN0b3AiKTsNCgkgICAgICAgIHdpbmRvdy5DcmF6eUdhbWVzLlNESy5nYW1lLmdhbWVwbGF5U3RvcCgpOw0KCSAgICAgIH0NCgkgICAgfQ0KDQoJICAgIGZ1bmN0aW9uIEhhcHB5VGltZSgpIHsNCgkgICAgICBpZiAodHlwZW9mIHdpbmRvdy5DcmF6eUdhbWVzICE9PSAndW5kZWZpbmVkJykgew0KCSAgICAgICAgY29uc29sZS5sb2coImhhcHB5dGltZSIpOw0KCSAgICAgICAgd2luZG93LkNyYXp5R2FtZXMuU0RLLmdhbWUuaGFwcHl0aW1lKCk7DQoJICAgICAgfQ0KCSAgICB9DQoJICA8L3NjcmlwdD4NCg0KDQoNCgk8L2JvZHk+DQoNCgk8L2h0bWw+";
