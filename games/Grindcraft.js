window.game = "PCFET0NUWVBFIGh0bWw+DQoNCg0KPCEtLSBVbHRpbWF0ZSBHYW1lIFN0YXNoIGZpbGUtLT4gDQo8IS0tIEZvciB0aGUgcmVndWxhcmx5IHVwZGF0aW5nIGRvYyBnbyB0byBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFfRm1IM0JsU0JRSTdGR2dBUUw1OS1aUGU4ZUN4czM1d2VsNkpVeVZhRzhRLyAtLT4NCg0KDQo8aHRtbCBsYW5nPSJlbiI+DQo8YmFzZSBocmVmPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvYnViYmxzL1VHUy1Bc3NldHNAMGUzODc0OGYxZDE1NDRkZDgyNDNiZGNjNzQzOTBjNjAyNzA1OTAzOC9ncmluZGNyYWZ0LyI+DQo8aGVhZD4NCiAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KICAgIC8vIEdvb2dsZSBUYWcgTWFuYWdlciBTdGFydA0KICAgIC8vR0EgZXZlbnQgaGVscGVyIGZ1bmN0aW9ucw0KICAgIGZ1bmN0aW9uIGdldENvb2tpZShrZXkpIHsNCiAgICAgIHZhciBrZXlWYWx1ZSA9IGRvY3VtZW50LmNvb2tpZS5tYXRjaCgiKF58OykgPyIgKyBrZXkgKyAiPShbXjtdKikoO3wkKSIpOw0KICAgICAgcmV0dXJuIGtleVZhbHVlID8ga2V5VmFsdWVbMl0gOiBudWxsOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHNldENvb2tpZTIoa2V5LCB2YWx1ZSwgZXhwdGltZSwgZG9tYWluKSB7DQogICAgICAvL2RvY3VtZW50LmNvb2tpZSA9IGtleSArICI9IiArIHZhbHVlICsgIjsiOw0KICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOw0KICAgICAgZC5zZXRUaW1lKGQuZ2V0VGltZSgpICsgZXhwdGltZSk7DQogICAgICB2YXIgZXhwaXJlcyA9ICJleHBpcmVzPSIgKyBkLnRvVVRDU3RyaW5nKCk7DQogICAgICBkb2N1bWVudC5jb29raWUgPSBrZXkgKyAiPSIgKyB2YWx1ZSArICI7ICIgKyBleHBpcmVzICsgIjsgcGF0aD0vOyBkb21haW49IiArIGRvbWFpbjsNCiAgICB9DQogICAgdmFyIGNtZ19nYTRfZ2Rwcl9jb3VudHJ5ID0gZ2V0Q29va2llKCJHRFBSIik7DQogICAgdmFyIGNtZ19nYTRfZ2Rwcl9hbGxvd2VkID0gZmFsc2U7DQogICAgaWYgKGNtZ19nYTRfZ2Rwcl9jb3VudHJ5ICE9IG51bGwgJiYgZ2V0Q29va2llKCJjbWdfZ2Rwcl91YWMiKSAhPSBudWxsICYmIGdldENvb2tpZSgiY21nX2dkcHJfdWFjIikgPT0gInRydWUiKSB7DQogICAgICBjbWdfZ2E0X2dkcHJfYWxsb3dlZCA9IHRydWU7DQogICAgfSBlbHNlIGlmIChjbWdfZ2E0X2dkcHJfY291bnRyeSAhPSBudWxsKSB7DQogICAgICBqUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAodHlwZW9mIF9fdGNmYXBpID09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICBjbWdfZ2E0X2dkcHJfbGlzdGVuZXIoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBfX3RjZmFwaSA9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgICAgIGNtZ19nYTRfZ2Rwcl9saXN0ZW5lcigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sIDIwMDApOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjbWdfZ2E0X2dkcHJfbGlzdGVuZXIoKSB7DQogICAgICBfX3RjZmFwaSgiYWRkRXZlbnRMaXN0ZW5lciIsIDIsIGZ1bmN0aW9uKHRjZGF0YSwgc3VjY2Vzcykgew0KICAgICAgICBpZiAoc3VjY2Vzcykgew0KICAgICAgICAgIGlmICh0Y2RhdGEuZXZlbnRTdGF0dXMgPT09ICJ1c2VyYWN0aW9uY29tcGxldGUiKSB7DQogICAgICAgICAgICAvLyBVc2VyIGFjdGlvbiBjb21wbGV0ZWQsIGhhbmRsZSBHQSBjb29raWUgYWNjb3JkaW5nbHkNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKHN1Y2Nlc3MsIHRjZGF0YSk7DQogICAgICAgICAgICBjbWdfZ2E0X2dkcHJfYWxsb3dlZCA9IHRydWU7DQogICAgICAgICAgICBzZXRDb29raWUoImNtZ19nZHByX3VhYyIsICJ0cnVlIiwgMzE1NTY5MjYgKiAxMDAwKTsNCiAgICAgICAgICAgIGNtZ19nYTRfaW5pdF9nYSgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY21nX2dhNF9pbml0X2dhKCkgew0KICAgICAgaWYgKGNtZ19nYTRfZ2Rwcl9jb3VudHJ5ID09IG51bGwgfHwgKGNtZ19nYTRfZ2Rwcl9jb3VudHJ5ICE9IG51bGwgJiYgY21nX2dhNF9nZHByX2FsbG93ZWQpKSB7DQogICAgICAgIChmdW5jdGlvbih3LCBkLCBzLCBsLCBpKSB7DQogICAgICAgICAgd1tsXSA9IHdbbF0gfHwgW107DQogICAgICAgICAgd1tsXS5wdXNoKHsNCiAgICAgICAgICAgICJndG0uc3RhcnQiOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSwNCiAgICAgICAgICAgIGV2ZW50OiAiZ3RtLmpzIg0KICAgICAgICAgIH0pOw0KICAgICAgICAgIHZhciBmID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZShzKVswXSwNCiAgICAgICAgICAgIGogPSBkLmNyZWF0ZUVsZW1lbnQocyksDQogICAgICAgICAgICBkbCA9IGwgIT0gImRhdGFMYXllciIgPyAiJmw9IiArIGwgOiAiIjsNCiAgICAgICAgICBqLmFzeW5jID0gdHJ1ZTsNCiAgICAgICAgICBqLnNyYyA9DQogICAgICAgICAgICAiaHR0cHM6Ly93d3cuZ29vZ2xldGFnbWFuYWdlci5jb20vZ3RtLmpzP2lkPSIgKyBpICsgZGw7DQogICAgICAgICAgZi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqLCBmKTsNCiAgICAgICAgfSkod2luZG93LCBkb2N1bWVudCwgInNjcmlwdCIsICJkYXRhTGF5ZXIiLCAiR1RNLVdLUlNOTjgiKTsNCiAgICAgIH0NCiAgICB9DQogICAgY21nX2dhNF9pbml0X2dhKCk7DQogICAgLy8gR29vZ2xlIFRhZyBNYW5hZ2VyIEVuZA0KICA8L3NjcmlwdD4NCg0KICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+DQoNCiAgPHRpdGxlPkdyaW5kQ3JhZnQ8L3RpdGxlPg0KDQogIDxtZXRhIGlkPSJ2aWV3cG9ydCIgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAsIG1heGltdW0tc2NhbGU9MS4wLCB1c2VyLXNjYWxhYmxlPW5vIiAvPg0KICA8bWV0YSBuYW1lPSJhcHBsZS1tb2JpbGUtd2ViLWFwcC1jYXBhYmxlIiBjb250ZW50PSJ5ZXMiPg0KDQoNCiAgPGxpbmsgcmVsPSJzaG9ydGN1dCBpY29uIiB0eXBlPSJpbWFnZS9wbmciIGhyZWY9Ii4vZmF2aWNvbi5wbmciPg0KDQoNCiAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iLi9HcmluZENyYWZ0LmpzIj48L3NjcmlwdD4NCiAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iLi9DTUcuanMiPjwvc2NyaXB0Pg0KDQogIDxzY3JpcHQ+DQogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInRvdWNobW92ZSIsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgIH0sIHsNCiAgICAgIGNhcHR1cmU6IGZhbHNlLA0KICAgICAgcGFzc2l2ZTogZmFsc2UNCiAgICB9KTsNCiAgICBpZiAodHlwZW9mIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvID4gMikgew0KICAgICAgdmFyIG1ldGEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld3BvcnQiKTsNCiAgICAgIG1ldGEuc2V0QXR0cmlidXRlKCdjb250ZW50JywgJ3dpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0nICsgKDIgLyB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbykgKyAnLCB1c2VyLXNjYWxhYmxlPW5vJyk7DQogICAgfQ0KICA8L3NjcmlwdD4NCg0KICA8c3R5bGU+DQogICAgaHRtbCwNCiAgICBib2R5IHsNCiAgICAgIG1hcmdpbjogMDsNCiAgICAgIHBhZGRpbmc6IDA7DQogICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIH0NCg0KICAgICNvcGVuZmwtY29udGVudCB7DQogICAgICBiYWNrZ3JvdW5kOiAjMDAwMDAwOw0KICAgICAgd2lkdGg6IDEwMCU7DQogICAgICBoZWlnaHQ6IDEwMCU7DQogICAgfQ0KDQogICAgQGZvbnQtZmFjZSB7DQogICAgICBmb250LWZhbWlseTogJ0FyaWFsJzsNCiAgICAgIHNyYzogdXJsKCdmb250cy9BUklBTC5lb3Q/I2llZml4JykgZm9ybWF0KCdlbWJlZGRlZC1vcGVudHlwZScpLA0KICAgICAgICB1cmwoJ2ZvbnRzL0FSSUFMLndvZmYnKSBmb3JtYXQoJ3dvZmYnKSwNCiAgICAgICAgdXJsKCdmb250cy9BUklBTC5UVEYnKSBmb3JtYXQoJ3RydWV0eXBlJyksDQogICAgICAgIHVybCgnZm9udHMvQVJJQUwuc3ZnI0FyaWFsJykgZm9ybWF0KCdzdmcnKTsNCiAgICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7DQogICAgICBmb250LXN0eWxlOiBub3JtYWw7DQogICAgfQ0KDQogICAgQGZvbnQtZmFjZSB7DQogICAgICBmb250LWZhbWlseTogJ01pbmVjcmFmdGlhIFJlZ3VsYXInOw0KICAgICAgc3JjOiB1cmwoJ2ZvbnRzL01pbmVjcmFmdGlhLmVvdD8jaWVmaXgnKSBmb3JtYXQoJ2VtYmVkZGVkLW9wZW50eXBlJyksDQogICAgICAgIHVybCgnZm9udHMvTWluZWNyYWZ0aWEud29mZicpIGZvcm1hdCgnd29mZicpLA0KICAgICAgICB1cmwoJ2ZvbnRzL01pbmVjcmFmdGlhLnR0ZicpIGZvcm1hdCgndHJ1ZXR5cGUnKSwNCiAgICAgICAgdXJsKCdmb250cy9NaW5lY3JhZnRpYS5zdmcjTWluZWNyYWZ0aWElMjBSZWd1bGFyJykgZm9ybWF0KCdzdmcnKTsNCiAgICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7DQogICAgICBmb250LXN0eWxlOiBub3JtYWw7DQogICAgfQ0KICA8L3N0eWxlPg0KDQoNCiAgPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCiAgICAubm8tc2VsZWN0IHsNCiAgICAgIC13ZWJraXQtdG91Y2gtY2FsbG91dDogbm9uZTsNCiAgICAgIC8qIGlPUyBTYWZhcmkgKi8NCiAgICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAvKiBTYWZhcmkgKi8NCiAgICAgIC1raHRtbC11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIC8qIEtvbnF1ZXJvciBIVE1MICovDQogICAgICAtbW96LXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgLyogT2xkIHZlcnNpb25zIG9mIEZpcmVmb3ggKi8NCiAgICAgIC1tcy11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIC8qIEludGVybmV0IEV4cGxvcmVyL0VkZ2UgKi8NCiAgICAgIHVzZXItc2VsZWN0OiBub25lOw0KICAgICAgLyogTm9uLXByZWZpeGVkIHZlcnNpb24sIGN1cnJlbnRseSBzdXBwb3J0ZWQgYnkgQ2hyb21lLCBFZGdlLCBPcGVyYSBhbmQgRmlyZWZveCAqLw0KICAgIH0NCiAgPC9zdHlsZT4NCg0KICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiY2FudmFzIikubGVuZ3RoKSB7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0uY2xhc3NMaXN0LmFkZCgibm8tc2VsZWN0IikNCiAgICAgIH0NCiAgICB9LCAyMDAwKTsNCiAgPC9zY3JpcHQ+DQogIDxzY3JpcHQgc3JjPSIvc2l0ZXMvZGVmYXVsdC9maWxlcy9jbWctaDVnYW1lYWRzLmpzP3YzIj48L3NjcmlwdD4NCiAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KICAgIGZ1bmN0aW9uIHJlY2VpdmVNZXNzYWdlKGUpIHsNCiAgICAgIGlmIChlLmRhdGEgPT0gImludm9rZUNNR0FkQnJlYWsiKSB7DQogICAgICAgIGNtZ0dvb2dsZUFkQnJlYWsoIm5leHQiLCBmdW5jdGlvbiBjbWdBZEJyZWFrQ29tcGxldGVkKCkgew0KICAgICAgICAgIGNvbnNvbGUubG9nKCJjbWdBZEJyZWFrQ29tcGxldGVkIGlzIGludm9rZWQgaW4gdGhlIGlmcmFtZS4gaW52b2tlIHRoZSBuZXh0IGdhbWUgZnVuY3Rpb25hbGl0eSBsaWtlIHJlc3VtZSBvciBwbGF5IG5leHQgbGV2ZWwgZXRjIik7DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0NCiAgICBhZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgcmVjZWl2ZU1lc3NhZ2UsIHRydWUpOw0KDQogICAgZnVuY3Rpb24gc2V0VXNlckFnZW50KHdpbmRvdywgdXNlckFnZW50KSB7DQogICAgICAvLyBXb3JrcyBvbiBGaXJlZm94LCBDaHJvbWUsIE9wZXJhIGFuZCBJRTkrDQogICAgICBpZiAobmF2aWdhdG9yLl9fZGVmaW5lR2V0dGVyX18pIHsNCiAgICAgICAgbmF2aWdhdG9yLl9fZGVmaW5lR2V0dGVyX18oInVzZXJBZ2VudCIsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHJldHVybiB1c2VyQWdlbnQ7DQogICAgICAgIH0pOw0KICAgICAgfSBlbHNlIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5hdmlnYXRvciwgInVzZXJBZ2VudCIsIHsNCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgcmV0dXJuIHVzZXJBZ2VudDsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgICAgLy8gV29ya3Mgb24gU2FmYXJpDQogICAgICBpZiAod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQgIT09IHVzZXJBZ2VudCkgew0KICAgICAgICB2YXIgdXNlckFnZW50UHJvcCA9IHsNCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgcmV0dXJuIHVzZXJBZ2VudDsNCiAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIHRyeSB7DQogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdy5uYXZpZ2F0b3IsICJ1c2VyQWdlbnQiLCB1c2VyQWdlbnRQcm9wKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgIHdpbmRvdy5uYXZpZ2F0b3IgPSBPYmplY3QuY3JlYXRlKG5hdmlnYXRvciwgew0KICAgICAgICAgICAgdXNlckFnZW50OiB1c2VyQWdlbnRQcm9wDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgaWYgKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlNhZmFyaSIpID49IDAgJiYgIm9udG91Y2hzdGFydCIgaW4gd2luZG93ICYmICEvaVBob25lfEFuZHJvaWQvLnRlc3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpKSB7DQogICAgICAvL3ZhciB1c2VyQWdlbnQgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5yZXBsYWNlKCJNYWNpbnRvc2giLCAiaVBhZCIpOw0KICAgICAgdmFyIHVzZXJBZ2VudCA9ICJNb3ppbGxhLzUuMCAoaVBhZDsgQ1BVIE9TIDEzXzFfMiBsaWtlIE1hYyBPUyBYKSBBcHBsZVdlYktpdC82MDUuMS4xNSAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vMTMuMC4xIE1vYmlsZS8xNUUxNDggU2FmYXJpLzYwNC4xIjsNCiAgICAgIHNldFVzZXJBZ2VudCh3aW5kb3csIHVzZXJBZ2VudCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY21nX2lzX21vYmlsZV9kZXZpY2UoKSB7DQogICAgICB2YXIgc1VzckFnID0gbmF2aWdhdG9yLnVzZXJBZ2VudDsNCiAgICAgIC8vaWYoL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxCbGFja0JlcnJ5fElFTW9iaWxlfE9wZXJhIE1pbmkvaS50ZXN0KHNVc3JBZykpew0KICAgICAgaWYgKC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUG9kfEJsYWNrQmVycnl8SUVNb2JpbGV8T3BlcmEgTWluaS9pLnRlc3Qoc1VzckFnKSkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlmIChuYXZpZ2F0b3IubWF4VG91Y2hQb2ludHMgPT0gNSkgew0KICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYgKHNVc3JBZy5pbmRleE9mKCJTYWZhcmkiKSA+PSAwICYmICJvbnRvdWNoc3RhcnQiIGluIHdpbmRvdyAmJiBzVXNyQWcuaW5kZXhPZigiaVBob25lIikgPT0gLTEpIHsNCiAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgIH0NCiAgICB2YXIgZW5hYmxlRGVidWcgPSBmYWxzZTsNCg0KICAgIGZ1bmN0aW9uIGRlYnVnT3V0KG1zZykgew0KICAgICAgaWYgKHR5cGVvZiBnZXRQYXJhbWV0ZXJCeU5hbWUgPT09ICJmdW5jdGlvbiIgJiYgZ2V0UGFyYW1ldGVyQnlOYW1lKCJkZWJ1ZyIpICE9PSAiIikgew0KICAgICAgICBlbmFibGVEZWJ1ZyA9IGdldFBhcmFtZXRlckJ5TmFtZSgiZGVidWciKTsNCiAgICAgIH0NCiAgICAgIGlmIChlbmFibGVEZWJ1Zykgew0KICAgICAgICBjb25zb2xlLmxvZyhtc2cpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldFBhcmFtZXRlckJ5TmFtZShuYW1lKSB7DQogICAgICB2YXIgcmVnZXhTID0gIltcPyZdIiArIG5hbWUgKyAiPShbXiYjXSopIjsNCiAgICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAocmVnZXhTKTsNCiAgICAgIHZhciByZXN1bHRzID0gcmVnZXguZXhlYyhsb2NhdGlvbi5ocmVmKTsNCiAgICAgIGlmIChyZXN1bHRzICE9PSBudWxsKSB7DQogICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1sxXS5yZXBsYWNlKC9cKy9nLCAiICIpKTsNCiAgICAgIH0NCiAgICAgIC8vQ2hlY2sgdGhlIHBhcmVudCB3aW5kb3cNCiAgICAgIHZhciByZXN1bHRzID0gcmVnZXguZXhlYyh3aW5kb3cudG9wLmxvY2F0aW9uLmhyZWYpOw0KICAgICAgaWYgKHJlc3VsdHMgPT09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuICIiOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzFdLnJlcGxhY2UoL1wrL2csICIgIikpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldEJyb3dzZXJOYW1lVmVyKCkgew0KICAgICAgdmFyIHNCcm93c2VyLCBzVXNyQWcgPSBuYXZpZ2F0b3IudXNlckFnZW50Ow0KICAgICAgLy8gVGhlIG9yZGVyIG1hdHRlcnMgaGVyZSwgYW5kIHRoaXMgbWF5IHJlcG9ydCBmYWxzZSBwb3NpdGl2ZXMgZm9yIHVubGlzdGVkIGJyb3dzZXJzLg0KICAgICAgaWYgKHNVc3JBZy5pbmRleE9mKCJGaXJlZm94IikgPiAtMSkgew0KICAgICAgICBzQnJvd3NlciA9ICJNb3ppbGxhIEZpcmVmb3giOw0KICAgICAgICAvLyAiTW96aWxsYS81LjAgKFgxMTsgVWJ1bnR1OyBMaW51eCB4ODZfNjQ7IHJ2OjYxLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvNjEuMCINCiAgICAgIH0gZWxzZSBpZiAoc1VzckFnLmluZGV4T2YoIlNhbXN1bmdCcm93c2VyIikgPiAtMSkgew0KICAgICAgICBzQnJvd3NlciA9ICJTYW1zdW5nIEludGVybmV0IjsNCiAgICAgICAgLy8gIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCA5OyBTQU1TVU5HIFNNLUc5NTVGIEJ1aWxkL1BQUjEuMTgwNjEwLjAxMSkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgU2Ftc3VuZ0Jyb3dzZXIvOS40IENocm9tZS82Ny4wLjMzOTYuODcgTW9iaWxlIFNhZmFyaS81MzcuMzYNCiAgICAgIH0gZWxzZSBpZiAoc1VzckFnLmluZGV4T2YoIk9wZXJhIikgPiAtMSB8fCBzVXNyQWcuaW5kZXhPZigiT1BSIikgPiAtMSkgew0KICAgICAgICBzQnJvd3NlciA9ICJPcGVyYSI7DQogICAgICAgIC8vICJNb3ppbGxhLzUuMCAoTWFjaW50b3NoOyBJbnRlbCBNYWMgT1MgWCAxMF8xNF8wKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvNzAuMC4zNTM4LjEwMiBTYWZhcmkvNTM3LjM2IE9QUi81Ny4wLjMwOTguMTA2Ig0KICAgICAgfSBlbHNlIGlmIChzVXNyQWcuaW5kZXhPZigiVHJpZGVudCIpID4gLTEpIHsNCiAgICAgICAgc0Jyb3dzZXIgPSAiTWljcm9zb2Z0IEludGVybmV0IEV4cGxvcmVyIjsNCiAgICAgICAgLy8gIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdPVzY0OyBUcmlkZW50LzcuMDsgLk5FVDQuMEM7IC5ORVQ0LjBFOyBab29tIDMuNi4wOyB3YnggMS4wLjA7IHJ2OjExLjApIGxpa2UgR2Vja28iDQogICAgICB9IGVsc2UgaWYgKHNVc3JBZy5pbmRleE9mKCJFZGdlIikgPiAtMSkgew0KICAgICAgICBzQnJvd3NlciA9ICJNaWNyb3NvZnQgRWRnZSAoTGVnYWN5KSI7DQogICAgICAgIC8vICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvNTguMC4zMDI5LjExMCBTYWZhcmkvNTM3LjM2IEVkZ2UvMTYuMTYyOTkiDQogICAgICB9IGVsc2UgaWYgKHNVc3JBZy5pbmRleE9mKCJFZGciKSA+IC0xKSB7DQogICAgICAgIHNCcm93c2VyID0gIk1pY3Jvc29mdCBFZGdlIChDaHJvbWl1bSkiOw0KICAgICAgICAvLyBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvOTEuMC40NDcyLjEyNCBTYWZhcmkvNTM3LjM2IEVkZy85MS4wLjg2NC42NA0KICAgICAgfSBlbHNlIGlmIChzVXNyQWcuaW5kZXhPZigiQ2hyb21lIikgPiAtMSkgew0KICAgICAgICBzQnJvd3NlciA9ICJHb29nbGUgQ2hyb21lIG9yIENocm9taXVtIjsNCiAgICAgICAgLy8gIk1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgVWJ1bnR1IENocm9taXVtLzY2LjAuMzM1OS4xODEgQ2hyb21lLzY2LjAuMzM1OS4xODEgU2FmYXJpLzUzNy4zNiINCiAgICAgIH0gZWxzZSBpZiAoc1VzckFnLmluZGV4T2YoIlNhZmFyaSIpID4gLTEpIHsNCiAgICAgICAgc0Jyb3dzZXIgPSAiQXBwbGUgU2FmYXJpIjsNCiAgICAgICAgLy8gIk1vemlsbGEvNS4wIChpUGhvbmU7IENQVSBpUGhvbmUgT1MgMTFfNCBsaWtlIE1hYyBPUyBYKSBBcHBsZVdlYktpdC82MDUuMS4xNSAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vMTEuMCBNb2JpbGUvMTVFMTQ4IFNhZmFyaS82MDQuMSA5ODB4MTMwNiINCiAgICAgIH0gZWxzZSBpZiAoIS9TYWZhcml8Q3JpT1MvLnRlc3Qoc1VzckFnKSAmJiAvaVBob25lfGlQYWRcaVBvZC8udGVzdChzVXNyQWcpKSB7DQogICAgICAgIC8vKCAvaVBob25lfGlQYWRcaVBvZC8udGVzdChzVXNyQWcpICYmICAvU2FmYXJpLy50ZXN0KHNVc3JBZykgKQ0KICAgICAgICBzQnJvd3NlciA9ICJpUGhvbmUgU2FmYXJpIFdlYlZpZXciOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc0Jyb3dzZXIgPSAidW5rbm93biI7DQogICAgICB9DQogICAgICBzVXNyQWdBcnIgPSBuYXZpZ2F0b3IudXNlckFnZW50LnNwbGl0KCIgIikNCiAgICAgIHNCcm93c2VyID0gc0Jyb3dzZXIgKyAiICIgKyBzVXNyQWdBcnJbMF0gKyAiICIgKyBzVXNyQWdBcnJbc1VzckFnQXJyLmxlbmd0aCAtIDFdDQogICAgICBkZWJ1Z091dCgiWW91IGFyZSB1c2luZzogIiArIHNCcm93c2VyKTsNCiAgICAgIHJldHVybiBzQnJvd3NlcjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0cmFja0V2ZW50KGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsLCB2YWx1ZSkgew0KICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInVuZGVmaW5lZCIgfHwgdmFsdWUgPT09IG51bGwpIHsNCiAgICAgICAgdmFsdWUgPSAwOw0KICAgICAgfQ0KICAgICAgaWYgKHR5cGVvZiBfX2dhVHJhY2tlciAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgX19nYVRyYWNrZXIoInNlbmQiLCB7DQogICAgICAgICAgaGl0VHlwZTogImV2ZW50IiwNCiAgICAgICAgICBldmVudENhdGVnb3J5OiBjYXRlZ29yeSwNCiAgICAgICAgICBldmVudEFjdGlvbjogYWN0aW9uLA0KICAgICAgICAgIGV2ZW50TGFiZWw6IGxhYmVsLA0KICAgICAgICAgIGV2ZW50VmFsdWU6IHZhbHVlDQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0NCiAgICAvL0NhdGVnb3J5OiBHYW1lUGxheVBhZ2UsIEFjdGlvbjogRGVza3RvcGlGcmFtZSAvIERlc2t0b3BUb3BsZXZlbCAvIERlc2t0b3BJbW1lcnNpdmUgLyBNb2JpbGVUb3BsZXZlbCAvIE1vYmlsZUltbWVyc2l2ZSwgTGFiZWw6IEdhbWUgdGl0bGUNCiAgICB2YXIgcENhdGVnb3J5ID0gIkdhbWVQbGF5UGFnZVJlZGlyZWN0IjsNCiAgICB2YXIgcEFjdGlvbiA9ICJNb2JpbGUgIiArIGdldEJyb3dzZXJOYW1lVmVyKCk7DQogICAgdmFyIHBMYWJlbCA9IGxvY2F0aW9uLnBhdGhuYW1lOw0KICAgIGlmIChwTGFiZWwuc3RhcnRzV2l0aCgiLyIpKSB7DQogICAgICBwTGFiZWwgPSBwTGFiZWwuc3Vic3RyKDEpOw0KICAgIH0NCg0KICAgIGRlYnVnT3V0KCJjbWdwbGF5cGFnZTogZGVidWcgcmVkaXJlY3QgY2hlY2sgLSBwQ2F0ZWdvcnk9IiArIHBDYXRlZ29yeSArICIsIHBBY3Rpb249IiArIHBBY3Rpb24gKyAiICIgKyBuZXcgRGF0ZSgpKTsNCg0KICAgIGlmICh3aW5kb3cudG9wID09IHdpbmRvdy5zZWxmICYmIGRvY3VtZW50LnJlZmVycmVyID09ICIiKSB7DQogICAgICAoZnVuY3Rpb24odywgZCwgcywgbCwgaSkgew0KICAgICAgICB3W2xdID0gd1tsXSB8fCBbXTsNCiAgICAgICAgd1tsXS5wdXNoKHsNCiAgICAgICAgICAiZ3RtLnN0YXJ0IjogbmV3IERhdGUoKS5nZXRUaW1lKCksDQogICAgICAgICAgZXZlbnQ6ICJndG0uanMiDQogICAgICAgIH0pOw0KICAgICAgICB2YXIgZiA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUocylbMF0sDQogICAgICAgICAgaiA9IGQuY3JlYXRlRWxlbWVudChzKSwNCiAgICAgICAgICBkbCA9IGwgIT0gImRhdGFMYXllciIgPyAiJmw9IiArIGwgOiAiIjsNCiAgICAgICAgai5hc3luYyA9IHRydWU7DQogICAgICAgIGouc3JjID0NCiAgICAgICAgICAiaHR0cHM6Ly93d3cuZ29vZ2xldGFnbWFuYWdlci5jb20vZ3RtLmpzP2lkPSIgKyBpICsgZGw7DQogICAgICAgIGYucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoaiwgZik7DQogICAgICB9KSh3aW5kb3csIGRvY3VtZW50LCAic2NyaXB0IiwgImRhdGFMYXllciIsICJHVE0tV0tSU05OOCIpOw0KDQogICAgICBmdW5jdGlvbiBnYTRPYmpJbml0KGV2ZW50KSB7DQogICAgICAgIGdhNE9iaiA9IHt9Ow0KICAgICAgICB2YXIgY2tlRW4gPSBuYXZpZ2F0b3IuY29va2llRW5hYmxlZDsNCiAgICAgICAgLy9SZXF1aXJlZA0KICAgICAgICB2YXIgZXZlbnQgPSAodHlwZW9mIGV2ZW50ID09PSAidW5kZWZpbmVkIiB8fCBldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gIiIpID8gInBhZ2VfbG9hZCIgOiBldmVudDsNCiAgICAgICAgdmFyIHVzZXJUeXBlID0gKCFja2VFbiB8fCBnZXRDb29raWUoImNtZ19sIikgPT0gbnVsbCkgPyAiQW5vbnltb3VzVXNlciIgOiAiRnJlZVVzZXIiOw0KICAgICAgICBpZiAoY2tlRW4gJiYgZ2V0Q29va2llKCJjbWdfc3giKSAhPSBudWxsKSB7DQogICAgICAgICAgdXNlclR5cGUgPSAiUHJlbWl1bVVzZXIiOw0KICAgICAgICB9DQogICAgICAgIHZhciB0aW1lWm9uZSA9IEludGwuRGF0ZVRpbWVGb3JtYXQoKS5yZXNvbHZlZE9wdGlvbnMoKS50aW1lWm9uZTsNCiAgICAgICAgdmFyIGFkQmxvY2sgPSAodHlwZW9mIGFkX2Jsb2NrZXJfZGV0ZWN0ZWQgIT09ICJ1bmRlZmluZWQiKSA/IGFkX2Jsb2NrZXJfZGV0ZWN0ZWQgOiBmYWxzZTsNCiAgICAgICAgaWYgKHR5cGVvZiBnYW1lUGFnZSAhPSAidW5kZWZpbmVkIiAmJiBnYW1lUGFnZSAmJiB0eXBlb2YgaGlkZV9wcmVyb2xsX2FkcyAhPSAidW5kZWZpbmVkIiAmJiAhaGlkZV9wcmVyb2xsX2FkcyAmJiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJhbmRvbUFkQmxvY2tEaXYiKSA9PSBudWxsIHx8IHR5cGVvZiBnb29nbGUgPT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIGNtZ3BianMgPT0gInVuZGVmaW5lZCIpKSB7DQogICAgICAgICAgYWRCbG9jayA9IHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICAvL0RldmljZVR5cGUNCiAgICAgICAgdmFyIGRldmljZVR5cGUgPSAiRGVza3RvcCI7IC8vRGVmYXVsdA0KICAgICAgICB2YXIgdWEgPSBuYXZpZ2F0b3IudXNlckFnZW50Ow0KICAgICAgICBpZiAoL0FuZHJvaWR8d2ViT1N8aVBob25lfEJsYWNrQmVycnl8SUVNb2JpbGV8T3BlcmEgTWluaS9pLnRlc3QodWEpIHx8IG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyA9PSA1KSB7DQogICAgICAgICAgZGV2aWNlVHlwZSA9ICJNb2JpbGUiOw0KICAgICAgICB9DQogICAgICAgIGlmICgvQW5kcm9pZC8udGVzdCh1YSkgJiYgL0Nocm9tZVwvWy4wLTldKiBNb2JpbGUvLnRlc3QodWEpKSB7IC8vUGhvbmUgcGF0dGVybjogIkFuZHJvaWQiICsgIkNocm9tZS9bLjAtOV0qIE1vYmlsZSINCiAgICAgICAgICBkZXZpY2VUeXBlID0gIk1vYmlsZSI7DQogICAgICAgIH0gZWxzZSBpZiAoL0FuZHJvaWQvLnRlc3QodWEpICYmIC9DaHJvbWVcL1suMC05XSogKD8hTW9iaWxlKS8udGVzdCh1YSkpIHsgLy9UYWJsZXQgcGF0dGVybjogIkFuZHJvaWQiICsgIkNocm9tZS9bLjAtOV0qICg/IU1vYmlsZSkiDQogICAgICAgICAgZGV2aWNlVHlwZSA9ICJUYWJsZXQiOw0KICAgICAgICB9IGVsc2UgaWYgKC9pUGFkLy50ZXN0KHVhKSAmJiAvTW9iaWxlXC9bMC05QS1aXSogU2FmYXJpXC9bLjAtOV0qLy50ZXN0KHVhKSkgew0KICAgICAgICAgIGRldmljZVR5cGUgPSAiVGFibGV0IjsNCiAgICAgICAgfSBlbHNlIGlmICgvaVBob25lfGlQb2QvLnRlc3QodWEpICYmIC9Nb2JpbGVcL1swLTlBLVpdKiBTYWZhcmlcL1suMC05XSovLnRlc3QodWEpKSB7DQogICAgICAgICAgZGV2aWNlVHlwZSA9ICJNb2JpbGUiOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9kYXRhTGF5ZXIgb2JqIHdpdGggcmVxdWlyZWQgcGFyYW1zDQogICAgICAgIHZhciBnYTRPYmogPSB7DQogICAgICAgICAgImV2ZW50IjogZXZlbnQsDQogICAgICAgICAgInVzZXJfdHlwZSI6IHVzZXJUeXBlLA0KICAgICAgICAgICJkZXZpY2VfdHlwZSI6IGRldmljZVR5cGUsDQogICAgICAgICAgInRpbWV6b25lIjogdGltZVpvbmUsDQogICAgICAgICAgImFkX2Jsb2NrZXJfZGV0ZWN0ZWQiOiBhZEJsb2NrDQogICAgICAgIH07DQoNCiAgICAgICAgLy9PcHRpb25hbCAtIGRhdGFMYXllciBwYXJhbXMNCiAgICAgICAgaWYgKHR5cGVvZiBnYW1lVHlwZSAhPSAidW5kZWZpbmVkIiAmJiBnYW1lVHlwZSAhPSBudWxsKSB7DQogICAgICAgICAgZ2FtZVR5cGUgPSBnYW1lVHlwZS5yZXBsYWNlKCJnYW1lXyIsICIiKTsNCiAgICAgICAgICBnYTRPYmouZ2FtZV90eXBlID0gZ2FtZVR5cGU7DQogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHF1aXpQYWdlICE9ICJ1bmRlZmluZWQiICYmIHF1aXpQYWdlICE9IG51bGwgJiYgdHlwZW9mIHF1aXpUaXRsZSAhPSAidW5kZWZpbmVkIikgew0KICAgICAgICAgIGdhNE9iai5nYW1lX3R5cGUgPSAidHJpdmlhIjsNCiAgICAgICAgICBpZiAodHlwZW9mIHJlc3VsdF9wYWdlICE9ICJ1bmRlZmluZWQiICYmIHJlc3VsdF9wYWdlID09ICJ0cnVlIiAmJiBldmVudCA9PSAicGFnZV9sb2FkIikgew0KICAgICAgICAgICAgZ2E0T2JqLmdhbWVfdHlwZSA9ICJ0cml2aWFfcmVzdWx0IjsNCiAgICAgICAgICB9DQogICAgICAgICAgZ2E0T2JqLmdhbWVfbmFtZSA9IHF1aXpUaXRsZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodHlwZW9mIGdhbWVJZCAhPSAidW5kZWZpbmVkIiAmJiBnYW1lSWQgIT0gbnVsbCAmJiB0eXBlb2Ygd2luZG93LmdldEdhbWVOYW1lID09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICBnYTRPYmouZ2FtZV9uYW1lID0gZm9ybWF0R2FtZU5hbWUod2luZG93LmdldEdhbWVOYW1lKCkpOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7DQogICAgICAgICAgbW9udGg6ICJzaG9ydCIsDQogICAgICAgICAgZGF5OiAibnVtZXJpYyIsDQogICAgICAgICAgeWVhcjogIm51bWVyaWMiDQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIGNtZ0wgPSBja2VFbiAmJiBnZXRDb29raWUoImNtZ19sIikgIT0gbnVsbCA/IGdldENvb2tpZSgiY21nX2wiKSA6ICIiOw0KICAgICAgICBpZiAoY21nTCAhPSAiIikgew0KICAgICAgICAgIGdhNE9iai5jb29sbWF0aF91c2VyX2lkID0gY21nTDsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBnYTRPYmo7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGdhNF90cmFja0V2ZW50KGV2ZW50LCBwQXJyLCB2QXJyKSB7DQogICAgICAgIGlmICh0eXBlb2YgZGF0YUxheWVyICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgZGF0YUxheWVyLnB1c2ggPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICBnYTRPYmogPSBnYTRPYmpJbml0KGV2ZW50KTsNCiAgICAgICAgICBpZiAodHlwZW9mIHBBcnIgIT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHZBcnIgIT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgIHZhciBhTGVuID0gcEFyci5sZW5ndGg7DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFMZW47IGkrKykgew0KICAgICAgICAgICAgICBnYTRPYmpbcEFycltpXV0gPSB2QXJyW2ldOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBkZWJ1Z091dCgiQ01HZ2E0OiB0cmFjayA6IiArIGV2ZW50ICsgIiAiICsgSlNPTi5zdHJpbmdpZnkoZ2E0T2JqKSArICIgIiArIG5ldyBEYXRlKCkpOw0KICAgICAgICAgIHZhciBnYTRSZXNwb25zZSA9IGRhdGFMYXllci5wdXNoKGdhNE9iaik7DQogICAgICAgICAgZGVidWdPdXQoIkNNR2dhNDogdHJhY2sgOiIgKyBldmVudCArICIgZGF0YUxheWVyLnB1c2ggcmVzcG9uc2UgPSAiICsgSlNPTi5zdHJpbmdpZnkoZ2E0UmVzcG9uc2UpICsgIiAiICsgbmV3IERhdGUoKSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgZGVidWdPdXQoIkNNR2dhNDogZGF0YUxheWVyIGRvZXMgbm90IGV4aXN0IDogIiArIG5ldyBEYXRlKCkpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIC8vR0EgVHJhY2tldmVudCBhbmQgdGhlbiBSZWRpcmVjdCB0aGUgdXNlciB0byBnYW1lIGxhbmRpbmcgcGFnZQ0KICAgICAgLy9DaGVjayBpZiB3ZSBjYW4gdXNlIEdBDQoNCiAgICAgIC8vR0EgTG9hZGluZw0KDQogICAgICAoZnVuY3Rpb24oaSwgcywgbywgZywgciwgYSwgbSkgew0KICAgICAgICBpWyJHb29nbGVBbmFseXRpY3NPYmplY3QiXSA9IHI7DQogICAgICAgIGlbcl0gPSBpW3JdIHx8IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIChpW3JdLnEgPSBpW3JdLnEgfHwgW10pLnB1c2goYXJndW1lbnRzKQ0KICAgICAgICB9LCBpW3JdLmwgPSAxICogbmV3IERhdGUoKTsNCiAgICAgICAgYSA9IHMuY3JlYXRlRWxlbWVudChvKSwNCiAgICAgICAgICBtID0gcy5nZXRFbGVtZW50c0J5VGFnTmFtZShvKVswXTsNCiAgICAgICAgYS5hc3luYyA9IDE7DQogICAgICAgIGEuc3JjID0gZzsNCiAgICAgICAgbS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLCBtKQ0KICAgICAgfSkod2luZG93LCBkb2N1bWVudCwgInNjcmlwdCIsICIvL3d3dy5nb29nbGUtYW5hbHl0aWNzLmNvbS9hbmFseXRpY3MuanMiLCAiX19nYVRyYWNrZXIiKTsNCiAgICAgIHZhciBnYV9kZXZfaG9zdCA9IC8oc3RhZ2V8c3RhZ2UyfGRldnxkZXYyfGRldjN8ZDlcLXRlc3QpKFwtZWRpdCk/XC5jb29sbWF0aGdhbWVzXC4oY29tfGxvY2FsKS8udGVzdCh3aW5kb3cubG9jYXRpb24uaG9zdCk7DQogICAgICBpZiAoZ2FfZGV2X2hvc3QgfHwgd2luZG93LmxvY2F0aW9uLmhvc3QgPT0gImQ5LXRlc3QtY29vbG1hdGhnYW1lcy5sb2NhbCIpIHsNCiAgICAgICAgX19nYVRyYWNrZXIoImNyZWF0ZSIsICJVQS0xMTkyOTk4LTIxIiwgImF1dG8iKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIF9fZ2FUcmFja2VyKCJjcmVhdGUiLCAiVUEtMTE5Mjk5OC0yIiwgImF1dG8iKTsNCiAgICAgIH0NCg0KICAgICAgLy9FbmQgb2YgR0EgbG9hZGluZw0KICAgICAgaWYgKGNtZ19pc19tb2JpbGVfZGV2aWNlKCkpIHsNCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgICAvL0xvYWQgYW5kIGZpcmUgR0EgZXZlbnQNCiAgICAgICAgICB0cmFja0V2ZW50KHBDYXRlZ29yeSwgcEFjdGlvbiwgcExhYmVsKTsNCiAgICAgICAgICB2YXIgc1VzckFnID0gbmF2aWdhdG9yLnVzZXJBZ2VudDsNCiAgICAgICAgICAvL0V4Y2x1ZGUgaVBhZHMsIGlwaG9uZS9pUG9kIEFwcCBhbmQgQW5kcm9pZCBBcHANCiAgICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigibGlua1tyZWw9J2Nhbm9uaWNhbCddIikuaHJlZiAmJiAhL2lQYWQvLnRlc3Qoc1VzckFnKSAmJiAoKC9pUGhvbmV8aVBvZC8udGVzdChzVXNyQWcpICYmIC9TYWZhcmkvLnRlc3Qoc1VzckFnKSkgfHwgKC9BbmRyb2lkLy50ZXN0KHNVc3JBZykgJiYgIS93di8udGVzdChzVXNyQWcpKSkpIHsNCiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigibGlua1tyZWw9J2Nhbm9uaWNhbCddIikuaHJlZjsNCiAgICAgICAgICB9DQogICAgICAgIH0sIDEwMCk7DQogICAgICB9DQogICAgICB2YXIgaXNWYWxpZERldmljZSA9IHRydWU7DQogICAgICB2YXIgYnJvd3NlckluZm8gPSBuYXZpZ2F0b3IudXNlckFnZW50Ow0KICAgICAgaWYgKChicm93c2VySW5mby5pbmNsdWRlcyA9PT0gImlQaG9uZSIgJiYgYnJvd3NlckluZm8uaW5jbHVkZXMgPT09ICJtb2JpbGUiKSAmJiAoYnJvd3NlckluZm8uaW5jbHVkZXMgPT09ICJDaHJvbWUiIHx8IGJyb3dzZXJJbmZvLmluY2x1ZGVzID09PSAiU2FmYXJpIikpIHsNCiAgICAgICAgaXNWYWxpZERldmljZSA9IGZhbHNlOw0KICAgICAgfQ0KICAgICAgaWYgKGlzVmFsaWREZXZpY2UpIHsNCiAgICAgICAgdHJhY2tFdmVudCgiZ2FtZVBsYXlQYWdlIiwgInVzZXJWaXNpdCIsIGxvY2F0aW9uLnBhdGhuYW1lKTsNCiAgICAgICAgZ2E0X3RyYWNrRXZlbnQoImdhbWVQbGF5UGFnZSIsIFsiYWN0aW9uIiwgInBhdGgiXSwgWyJ1c2VyVmlzaXQiLCBsb2NhdGlvbi5wYXRobmFtZV0pOw0KICAgICAgfQ0KICAgIH0NCiAgICAvL0dBNCBBRUcNCiAgICBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsNCiAgICAgIGlmICghZG9jdW1lbnQuaGlkZGVuKSB7DQogICAgICAgIGlmICh0eXBlb2Ygd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSA9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgZGVidWdPdXQobmV3IERhdGUoKSArICIgY21nR2FtZUhlYXJ0YmVhdDogQWN0aXZlIHRhYi4gcGFyZW50IHBvc3RNc2ciKTsNCiAgICAgICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICJjbWdHYW1lSGVhcnRiZWF0IjogZG9jdW1lbnQuaGFzRm9jdXMoKQ0KICAgICAgICAgIH0sICIqIik7DQogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdy50b3AucG9zdE1lc3NhZ2UgPT0gImZ1bmN0aW9uIiAmJiB3aW5kb3cudG9wICE9IHdpbmRvdy5zZWxmKSB7DQogICAgICAgICAgZGVidWdPdXQobmV3IERhdGUoKSArICIgY21nR2FtZUhlYXJ0YmVhdDogQWN0aXZlIHRhYi4gdG9wIHBvc3RNc2ciKTsNCiAgICAgICAgICB3aW5kb3cudG9wLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICJjbWdHYW1lSGVhcnRiZWF0IjogZG9jdW1lbnQuaGFzRm9jdXMoKQ0KICAgICAgICAgIH0sICIqIik7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGRlYnVnT3V0KG5ldyBEYXRlKCkgKyAiIGNtZ0dhbWVIZWFydGJlYXQ6IEluYWN0aXZlIHRhYi4gTm8gZXZlbnQiKTsNCiAgICAgIH0NCiAgICB9LCA2MDAwMCk7DQogIDwvc2NyaXB0Pg0KPC9oZWFkPg0KDQo8Ym9keT4NCg0KICA8bm9zY3JpcHQ+VGhpcyB3ZWJwYWdlIG1ha2VzIGV4dGVuc2l2ZSB1c2Ugb2YgSmF2YVNjcmlwdC4gUGxlYXNlIGVuYWJsZSBKYXZhU2NyaXB0IGluIHlvdXIgd2ViIGJyb3dzZXIgdG8gdmlldyB0aGlzIHBhZ2UuPC9ub3NjcmlwdD4NCg0KICA8ZGl2IGlkPSJvcGVuZmwtY29udGVudCI+PC9kaXY+DQoNCiAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KICAgIGxpbWUuZW1iZWQoIkdyaW5kQ3JhZnQiLCAib3BlbmZsLWNvbnRlbnQiLCAwLCAwLCB7DQogICAgICBwYXJhbWV0ZXJzOiB7fQ0KICAgIH0pOw0KICA8L3NjcmlwdD4NCg0KICA8c2NyaXB0Pg0KICAgIGZ1bmN0aW9uIGZuU2VuZE1zZyhldnQpIHsNCiAgICAgIGlmICh0eXBlb2Ygd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSA9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoJ2tleXByZXNzLWZyb20tZ2FtZScsICcqJyk7DQogICAgICB9IGVsc2UgaWYgKHR5cGVvZiB3aW5kb3cudG9wLnBvc3RNZXNzYWdlID09ICdmdW5jdGlvbicgJiYgd2luZG93LnRvcCAhPSB3aW5kb3cuc2VsZikgew0KICAgICAgICB3aW5kb3cudG9wLnBvc3RNZXNzYWdlKCdrZXlwcmVzcy1mcm9tLWdhbWUnLCAnKicpOw0KICAgICAgfQ0KICAgIH0NCiAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgIGZuU2VuZE1zZyhldmVudCk7DQogICAgfSk7DQogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCBmdW5jdGlvbihldmVudCkgew0KICAgICAgZm5TZW5kTXNnKGV2ZW50KTsNCiAgICB9KTsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZSkgew0KICAgICAgZm5TZW5kTXNnKGV2ZW50KTsNCiAgICB9KTsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uKGUpIHsNCiAgICAgIGZuU2VuZE1zZyhldmVudCk7DQogICAgfSk7DQogIDwvc2NyaXB0Pg0KPC9ib2R5Pg0KDQo8L2h0bWw+";
