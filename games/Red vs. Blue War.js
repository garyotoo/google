window.game = "PCFET0NUWVBFIGh0bWw+DQoNCg0KDQo8IS0tIFVsdGltYXRlIEdhbWUgU3Rhc2ggZmlsZS0tPiANCjwhLS0gRm9yIHRoZSByZWd1bGFybHkgdXBkYXRpbmcgZG9jIGdvIHRvIGh0dHBzOi8vZG9jcy5nb29nbGUuY29tL2RvY3VtZW50L2QvMV9GbUgzQmxTQlFJN0ZHZ0FRTDU5LVpQZThlQ3hzMzV3ZWw2SlV5VmFHOFEvIC0tPg0KCQ0KDQoNCjxodG1sIGxhbmc9ImVuLXVzIj4NCjxoZWFkPg0KPG1ldGEgY2hhcnNldD0idXRmLTgiLz4NCiA8YmFzZSBocmVmPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvYnViYmxzL1VHUy1Bc3NldHNAbWFpbi9yZWR2c2JsdWUvIj4NCjxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ii8+DQo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCwgdXNlci1zY2FsYWJsZT1ubyIvPg0KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSIuL3N0eWxlLmNzcyIvPiANCjwhLS0gWWFuZGV4IEdhbWVzIFNESyAtLT4NCjxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvcmV2ZXJzZS1pbWFnZS1nb2dnbC9nQG1haW4vdjIuMjcyZWIyMDc1MWUyZGM2ZmU0ZTYuanMiPjwvc2NyaXB0Pg0KPHN0eWxlPg0KICAgICAgICAvKiDQo9Cx0LjRgNCw0LXQvCDQstGL0LTQtdC70LXQvdC40LUg0L/QviDQvdCw0LbQsNGC0LjRjiDQutC70LDQstC40YggKi8NCiAgICAgICAgY2FudmFzOmZvY3VzIHsNCiAgICAgICAgICAgIG91dGxpbmU6IG5vbmU7DQogICAgICAgIH0NCg0KICAgICAgICBodG1sLCBib2R5IHsNCiAgICAgICAgICAgIC8qINCj0LHQuNGA0LDQtdC8INC+0YLRgdGC0YPQv9GLICovDQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgLyog0J7RgtC60LvRjtGH0LDQtdC8INGB0LrRgNC+0LvQuyDQuCDQu9C+0L3Qs9GC0LDQvyDQvdCwIElPUyAqLw0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgICAgICAgIC13ZWJraXQtdG91Y2gtY2FsbG91dDogbm9uZTsNCiAgICAgICAgICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAgICAgICAta2h0bWwtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAgICAgICAtbW96LXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgICAgICAgLW1zLXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAgICAgICAtd2Via2l0LXRhcC1oaWdobGlnaHQtY29sb3I6IHJnYmEoMCwwLDAsMCk7DQogICAgICAgICAgICAvKiDQodGC0LDQstC40Lwg0LLRi9GB0L7RgtGDINC90LAgMTAwJSAqLw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICB9DQogICAgPC9zdHlsZT4NCjwhLS0gQWRkaXRpb25hbCBoZWFkIG1vZHVsZXMgLS0+DQo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQogICAgICAgIHdpbmRvdy55YW5kZXhNZXRyaWNhQ291bnRlcklkID0gcGFyc2VJbnQoOTcwNDk4ODEpOw0KPC9zY3JpcHQ+DQo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQogICAgKGZ1bmN0aW9uIChtLCBlLCB0LCByLCBpLCBrLCBhKSB7DQogICAgICAgIG1baV0gPSBtW2ldIHx8IGZ1bmN0aW9uICgpIHsgKG1baV0uYSA9IG1baV0uYSB8fCBbXSkucHVzaChhcmd1bWVudHMpIH07DQogICAgICAgIG1baV0ubCA9IDEgKiBuZXcgRGF0ZSgpOw0KICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGRvY3VtZW50LnNjcmlwdHMubGVuZ3RoOyBqKyspIHsgaWYgKGRvY3VtZW50LnNjcmlwdHNbal0uc3JjID09PSByKSB7IHJldHVybjsgfSB9DQogICAgICAgIGsgPSBlLmNyZWF0ZUVsZW1lbnQodCksIGEgPSBlLmdldEVsZW1lbnRzQnlUYWdOYW1lKHQpWzBdLCBrLmFzeW5jID0gMSwgay5zcmMgPSByLCBhLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGssIGEpDQogICAgfSkNCiAgICAgICAgKHdpbmRvdywgZG9jdW1lbnQsICJzY3JpcHQiLCAidGFnLmpzIiwgInltIik7DQoNCiAgICB5bSh3aW5kb3cueWFuZGV4TWV0cmljYUNvdW50ZXJJZCwgImluaXQiLCB7DQogICAgICAgIGNsaWNrbWFwOiBmYWxzZSwNCiAgICAgICAgdHJhY2tMaW5rczogdHJ1ZSwNCiAgICAgICAgYWNjdXJhdGVUcmFja0JvdW5jZTogdHJ1ZQ0KICAgIH0pOw0KPC9zY3JpcHQ+DQo8L2hlYWQ+DQo8Ym9keSBjbGFzcz0iZGFyayI+DQo8ZGl2IGlkPSJ1bml0eS1jb250YWluZXIiIGNsYXNzPSJ1bml0eS1kZXNrdG9wIj4NCjxjYW52YXMgaWQ9InVuaXR5LWNhbnZhcyIgdGFiaW5kZXg9Ii0xIj48L2NhbnZhcz4NCjwvZGl2Pg0KPGRpdiBpZD0ibG9hZGluZy1jb3ZlciIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPg0KPGRpdiBpZD0idW5pdHktbG9hZGluZy1iYXIiPg0KPGRpdiBpZD0idW5pdHktbG9nbyI+PGltZyBzcmM9ImxvZ28ucG5nIi8+PC9kaXY+DQo8ZGl2IGlkPSJ1bml0eS1wcm9ncmVzcy1iYXItZW1wdHkiIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+DQo8ZGl2IGlkPSJ1bml0eS1wcm9ncmVzcy1iYXItZnVsbCI+PC9kaXY+DQo8L2Rpdj4NCjxkaXYgY2xhc3M9InNwaW5uZXIiPjwvZGl2Pg0KPC9kaXY+DQo8L2Rpdj4gDQo8IS0tIEFkZGl0aW9uYWwgYm9keSBtb2R1bGVzIC0tPg0KPHNjcmlwdD4NCiAgICAgICAgY29uc3QgaGlkZUZ1bGxTY3JlZW5CdXR0b24gPSAiIjsNCiAgICAgICAgY29uc3QgYnVpbGRVcmwgPSAiQnVpbGQiOw0KICAgICAgICBjb25zdCBsb2FkZXJVcmwgPSBidWlsZFVybCArICIvQmx1ZVZTUmVkMS5sb2FkZXIuanMiOw0KICAgICAgICBjb25zdCBjb25maWcgPSB7DQogICAgICAgICAgICBkYXRhVXJsOiBidWlsZFVybCArICIvYTM2YjlmNTk0MDQ0OGQzNmE4ZDU2ODJiYzM4NDc4ZWEuZGF0YS51bml0eXdlYiIsDQogICAgICAgICAgICBmcmFtZXdvcmtVcmw6IGJ1aWxkVXJsICsgIi9iYzNlODhhMDg2ZmIwM2E3M2RhZWNlNzYxMDkxNGMyZi5qcy51bml0eXdlYiIsDQogICAgICAgICAgICBjb2RlVXJsOiBidWlsZFVybCArICIvYjhlNWIzZGZjMzljMjE5OTg4ZTliNzk0ZDBlMmI4NjUud2FzbS51bml0eXdlYiIsDQogICAgICAgIHN0cmVhbWluZ0Fzc2V0c1VybDogIlN0cmVhbWluZ0Fzc2V0cyIsDQogICAgICAgICAgICBjb21wYW55TmFtZTogIkFoaW9HYW1lIiwNCiAgICAgICAgICAgIHByb2R1Y3ROYW1lOiAiQmx1ZVZTUmVkIiwNCiAgICAgICAgICAgIHByb2R1Y3RWZXJzaW9uOiAiMS4wIg0KICAgICAgICB9Ow0KDQogICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1jb250YWluZXIiKTsNCiAgICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3VuaXR5LWNhbnZhcyIpOw0KICAgICAgICBjb25zdCBsb2FkaW5nQ292ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjbG9hZGluZy1jb3ZlciIpOw0KICAgICAgICBjb25zdCBwcm9ncmVzc0JhckVtcHR5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3VuaXR5LXByb2dyZXNzLWJhci1lbXB0eSIpOw0KICAgICAgICBjb25zdCBwcm9ncmVzc0JhckZ1bGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjdW5pdHktcHJvZ3Jlc3MtYmFyLWZ1bGwiKTsNCiAgICAgICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zcGlubmVyJyk7DQoNCiAgICAgICAgY29uc3QgY2FuRnVsbHNjcmVlbiA9IChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBbDQogICAgICAgICAgICAgICAgJ2V4aXRGdWxsc2NyZWVuJywNCiAgICAgICAgICAgICAgICAnd2Via2l0RXhpdEZ1bGxzY3JlZW4nLA0KICAgICAgICAgICAgICAgICd3ZWJraXRDYW5jZWxGdWxsU2NyZWVuJywNCiAgICAgICAgICAgICAgICAnbW96Q2FuY2VsRnVsbFNjcmVlbicsDQogICAgICAgICAgICAgICAgJ21zRXhpdEZ1bGxzY3JlZW4nLA0KICAgICAgICAgICAgXSkgew0KICAgICAgICAgICAgICAgIGlmIChrZXkgaW4gZG9jdW1lbnQpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9KCkpOw0KDQogICAgICAgIGlmICgvaVBob25lfGlQYWR8aVBvZHxBbmRyb2lkL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgew0KICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9ICJ1bml0eS1tb2JpbGUiOw0KICAgICAgICAgICAgDQogICAgICAgIH0NCg0KICAgICAgICAvLyDQpNC+0L3QvtCy0L7QtSDQuNC30L7QsdGA0LDQttC10L3QuNC1INC/0YDQuCDQt9Cw0LPRgNGD0LfQutC1INC40LPRgNGLLiDQn9GA0Lgg0YHQsdC+0YDQutC1INCx0LjQu9C00LAg0LrQvtC0INC80LXQvdGP0LXRgtGB0Y8g0LLQt9Cw0LLQuNGB0LjQvNC+0YHRgtC4INC+0YIg0L3QsNGB0YLRgNC+0LXQuiDQv9GA0L7QtdC60YLQsC4NCiAgICAgICAgDQogICAgICAgIGNhbnZhcy5zdHlsZS5iYWNrZ3JvdW5kID0gInVybCgnYmFja2dyb3VuZC5qcGcnKSBjZW50ZXIgLyBjb3ZlciI7DQoNCiAgICAgICAgbG9hZGluZ0NvdmVyLnN0eWxlLmRpc3BsYXkgPSAiIjsNCg0KICAgICAgICAvLyDQktGL0LrQu9GO0YfQsNC10Lwg0L/QvtGP0LLQu9C10L3QuNC1INC80LXQvdGOINC/0YDQuCDQv9GA0LDQstC+0Lwg0LrQu9C40LrQtSDQvNGL0YjQuA0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjb250ZXh0bWVudScsIGV2ZW50ID0+IGV2ZW50LnByZXZlbnREZWZhdWx0KCkpOw0KDQogICAgICAgIC8vINCS0L7Qt9Cy0YDQsNGJ0LDQtdC8INGE0L7QutGD0YEsINC10YHQu9C4INC60LvQuNC60L3Rg9C70Lgg0L/QviDRjdC60YDQsNC90YMNCiAgICAgICAgZnVuY3Rpb24gRm9jdXNHYW1lKCkgew0KICAgICAgICAgICAgd2luZG93LmZvY3VzKCk7DQogICAgICAgICAgICBjYW52YXMuZm9jdXMoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVyZG93bicsICgpID0+IHsNCiAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICB9KTsNCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCAoKSA9PiB7DQogICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgbGV0IFN0YXJ0VW5pdHlJbnN0YW5jZTsNCiAgICAgICAgbGV0IG15R2FtZUluc3RhbmNlID0gbnVsbDsNCiAgICAgICAgbGV0IHlzZGsgPSBudWxsOw0KICAgICAgICBsZXQgcGxheWVyID0gbnVsbDsNCiAgICAgICAgbGV0IGxlYWRlcmJvYXJkOw0KICAgICAgICBsZXQgcGF5bWVudHMgPSBudWxsOw0KICAgICAgICBsZXQgaW5pdEdhbWUgPSBmYWxzZTsNCiAgICAgICAgbGV0IG5vd0Z1bGxBZE9wZW4gPSBmYWxzZTsNCg0KICAgICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsNCiAgICAgICAgc2NyaXB0LnNyYyA9IGxvYWRlclVybDsNCiAgICAgICAgc2NyaXB0Lm9ubG9hZCA9ICgpID0+IHsNCiAgICAgICAgICAgIFN0YXJ0VW5pdHlJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBjcmVhdGVVbml0eUluc3RhbmNlKGNhbnZhcywgY29uZmlnLCAocHJvZ3Jlc3MpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgc3Bpbm5lci5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0JhckVtcHR5LnN0eWxlLmRpc3BsYXkgPSAiIjsNCiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJGdWxsLnN0eWxlLndpZHRoID0gYCR7MTAwICogcHJvZ3Jlc3N9JWA7DQogICAgICAgICAgICAgICAgfSkudGhlbigodW5pdHlJbnN0YW5jZSkgPT4gew0KICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZSA9IHVuaXR5SW5zdGFuY2U7DQogICAgICAgICAgICAgICAgICAgIGxvYWRpbmdDb3Zlci5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgICAgICAgICAgICAgIH0pLmNhdGNoKChtZXNzYWdlKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgaWYgKExvY2FsSG9zdCgpKQ0KICAgICAgICAgICAgICAgIFN0YXJ0VW5pdHlJbnN0YW5jZV9JZlVubG9hZGVkKCk7DQogICAgICAgIH07DQoNCiAgICAgICAgZnVuY3Rpb24gU3RhcnRVbml0eUluc3RhbmNlX0lmVW5sb2FkZWQoKSB7DQogICAgICAgICAgICBpZiAoc3Bpbm5lci5zdHlsZS5kaXNwbGF5ICE9PSAibm9uZSIpDQogICAgICAgICAgICAgICAgU3RhcnRVbml0eUluc3RhbmNlKCk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBMb2NhbEhvc3QoKSB7DQogICAgICAgICAgICB2YXIgaG9zdCA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZTsNCiAgICAgICAgICAgIGlmIChob3N0ID09ICJsb2NhbGhvc3QiIHx8IGhvc3QgPT0gIjEyNy4wLjAuMSIpDQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICBlbHNlIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNldFRpbWVvdXQoU3RhcnRVbml0eUluc3RhbmNlX0lmVW5sb2FkZWQsIDUwMDApOw0KDQogICAgICAgIEluaXRZU0RLKCk7DQogICAgICAgIGFzeW5jIGZ1bmN0aW9uIEluaXRZU0RLKCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBpZiAoTG9jYWxIb3N0KCkpIHJldHVybjsNCg0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJbml0IFlhbmRleCBTREsnKTsNCiAgICAgICAgICAgICAgICB5c2RrID0gYXdhaXQgWWFHYW1lcy5pbml0KCk7DQoNCiAgICAgICAgICAgICAgICBJbml0UGF5bWVudHMoKTsNCiAgICAgICAgICAgICAgICAvLyBGaXJzdCBhZCBmYWxzZQ0KDQogICAgICAgICAgICAgICAgLy8gQWRkaXRpb25hbCBpbml0IG1vZHVsZXMNCmNsb3VkU2F2ZXMgPSBhd2FpdCBMb2FkQ2xvdWQoKTsNCmNvbnNvbGUubG9nKCdJbml0IFN0b3JhZ2UgeXNkaycpOw0KDQplbnZpcm9ubWVudERhdGEgPSBhd2FpdCBSZXF1ZXN0aW5nRW52aXJvbm1lbnREYXRhKCk7DQpjb25zb2xlLmxvZygnSW5pdCBFbnZpciB5c2RrJyk7DQoNCnBsYXllckRhdGEgPSBhd2FpdCBJbml0UGxheWVyKCk7DQpjb25zb2xlLmxvZygnSW5pdCBQbGF5ZXIgeXNkaycpOw0KDQpmbGFzZ3NEYXRhID0gYXdhaXQgR2V0RmxhZ3MoKTsNCmNvbnNvbGUubG9nKCdJbml0IEZsYWdzIHlzZGsnKTsNCg0KDQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggSW5pdGlhbGl6YXRpb24gU0RLOiAnLCBlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgU3RhcnRVbml0eUluc3RhbmNlX0lmVW5sb2FkZWQoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIEluaXRHYW1lKCkgew0KICAgICAgICAgICAgY29uc29sZS5sb2coJ0luaXQgR2FtZSBTdWNjZXNzJyk7DQogICAgICAgICAgICBpbml0R2FtZSA9IHRydWU7DQoNCiAgICAgICAgICAgIGlmIChub3dGdWxsQWRPcGVuID09IHRydWUgJiYgbXlHYW1lSW5zdGFuY2UgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ09wZW5GdWxsQWQnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIEZ1bGxBZFNob3coKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGlmIChub3dGdWxsQWRPcGVuICE9PSB0cnVlICYmIHlzZGsgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgeXNkay5hZHYuc2hvd0Z1bGxzY3JlZW5BZHYoDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uT3BlbjogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09wZW4gQWQgSW50ZXJzdGl0aWFsJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3dGdWxsQWRPcGVuID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbml0R2FtZSA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ09wZW5GdWxsQWQnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogKHdhc1Nob3duKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3dGdWxsQWRPcGVuID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdEdhbWUgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2FzU2hvd24pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnQ2xvc2VGdWxsQWQnLCAndHJ1ZScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnQ2xvc2VGdWxsQWQnLCAnZmFsc2UnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25FcnJvcjogKGVycm9yKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBBZCBJbnRlcnN0aXRpYWwnLCBlcnJvcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdFcnJvckZ1bGxBZCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEZ1bGxBZCBTaG93OiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gUmV3YXJkZWRTaG93KGlkKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHlzZGsuYWR2LnNob3dSZXdhcmRlZFZpZGVvKA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3M6DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25PcGVuOiAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdPcGVuZWQgVmlkZW8gQWQuIElkOiAnICsgaWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdPcGVuVmlkZW8nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6ICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Nsb3NlZCBWaWRlbyBBZC4gSWQ6ICcgKyBpZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ0Nsb3NlVmlkZW8nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblJld2FyZGVkOiAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXdhcmQgVmlkZW8gQWQuIElkOiAnICsgaWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdSZXdhcmRWaWRlbycsIGlkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRXJyb3I6IChlKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIFZpZGVvIEFkLiBJZDogJyArIGlkLCBlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnRXJyb3JWaWRlbycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBSZXdhcmRlZCBWaWRlbyBBZCBTaG93OiAnLCBlcnIubWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBTdGlja3lBZEFjdGl2aXR5KHNob3cpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgeXNkay5hZHYuZ2V0QmFubmVyQWR2U3RhdHVzKCkudGhlbigoeyBzdGlja3lBZHZJc1Nob3dpbmcsIHJlYXNvbiB9KSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmIChzdGlja3lBZHZJc1Nob3dpbmcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2hvdykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlzZGsuYWR2LmhpZGVCYW5uZXJBZHYoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZWFzb24pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTdGlja3kgYWQgYXJlIG5vdCBzaG93bi4gUmVhc29uOicsIHJlYXNvbik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc2hvdykgew0KICAgICAgICAgICAgICAgICAgICAgICAgeXNkay5hZHYuc2hvd0Jhbm5lckFkdigpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBTdGlja3kgQWN0aXZpdHk6ICcsIGUubWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBJbml0UGF5bWVudHMoKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHlzZGsuZ2V0UGF5bWVudHMoKS50aGVuKF9wYXltZW50cyA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQdXJjaGFzZXMgYXJlIGF2YWlsYWJsZScpOw0KICAgICAgICAgICAgICAgICAgICBwYXltZW50cyA9IF9wYXltZW50czsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQdXJjaGFzZXMgYXJlIG5vdCBhdmFpbGFibGUnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggSW5pdCBQYXltZW50czogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIEJ1eVBheW1lbnRzKGlkKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGlmIChwYXltZW50cyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHBheW1lbnRzLnB1cmNoYXNlKGlkKS50aGVuKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQdXJjaGFzZSBTdWNjZXNzJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBDb25zdW1lUHVyY2hhc2UoaWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignUHVyY2hhc2UgRmFpbGVkJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ09uUHVyY2hhc2VGYWlsZWQnLCBpZCk7DQogICAgICAgICAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUGF5bWVudHMgPT0gbnVsbCcpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBCdXkgUGF5bWVudHM6ICcsIGUubWVzc2FnZSk7DQogICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBsZXQgY2FsbENvdW50X0dldFBheW1lbnRzID0gMDsNCiAgICAgICAgZnVuY3Rpb24gR2V0UGF5bWVudHMoKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGlmIChwYXltZW50cyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHBheW1lbnRzLmdldENhdGFsb2coKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4ocHJvZHVjdHMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcm9kdWN0SUQgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGl0bGUgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGVzY3JpcHRpb24gPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW1hZ2VVUkkgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJpY2VWYWx1ZSA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjb25zdW1lZCA9IFtdOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudHMuZ2V0UHVyY2hhc2VzKCkudGhlbihwdXJjaGFzZXMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHByb2R1Y3RzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0SURbaV0gPSBwcm9kdWN0c1tpXS5pZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlW2ldID0gcHJvZHVjdHNbaV0udGl0bGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbltpXSA9IHByb2R1Y3RzW2ldLmRlc2NyaXB0aW9uOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VVUklbaV0gPSBwcm9kdWN0c1tpXS5pbWFnZVVSSTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlVmFsdWVbaV0gPSBwcm9kdWN0c1tpXS5wcmljZVZhbHVlOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lZFtpXSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkyID0gMDsgaTIgPCBwdXJjaGFzZXMubGVuZ3RoOyBpMisrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHB1cmNoYXNlc1tpMl0ucHJvZHVjdElEID09PSBwcm9kdWN0SURbaV0pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRbaV0gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGpzb25QYXltZW50cyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpZCI6IHByb2R1Y3RJRCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0aXRsZSI6IHRpdGxlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogZGVzY3JpcHRpb24sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW1hZ2VVUkkiOiBpbWFnZVVSSSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwcmljZVZhbHVlIjogcHJpY2VWYWx1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjb25zdW1lZCI6IGNvbnN1bWVkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnUGF5bWVudHNFbnRyaWVzJywgSlNPTi5zdHJpbmdpZnkoanNvblBheW1lbnRzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoY2FsbENvdW50X0dldFBheW1lbnRzIDwgMikgew0KICAgICAgICAgICAgICAgICAgICBnZXRQYXltZW50cygpLg0KICAgICAgICAgICAgICAgICAgICAgICAgdGhlbihfcGF5bWVudHMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRzID0gX3BheW1lbnRzOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdldFBheW1lbnRzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggR2V0IFBheW1lbnRzOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gQ29uc3VtZVB1cmNoYXNlKGlkKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGlmIChwYXltZW50cyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHBheW1lbnRzLmdldFB1cmNoYXNlcygpLnRoZW4ocHVyY2hhc2VzID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBwdXJjaGFzZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHVyY2hhc2VzW2ldLnByb2R1Y3RJRCA9PT0gaWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudHMuY29uc3VtZVB1cmNoYXNlKHB1cmNoYXNlc1tpXS5wdXJjaGFzZVRva2VuKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnT25QdXJjaGFzZVN1Y2Nlc3MnLCBpZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBjb25zb2xlLmxvZygnQ29uc3VtZSBwdXJjaGFzZTogcGF5bWVudHMgbnVsbCcpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIENvbnN1bWUgUHVyY2hhc2U6ICcsIGUubWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBDb25zdW1lUHVyY2hhc2VzKCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBpZiAocGF5bWVudHMgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBwYXltZW50cy5nZXRQdXJjaGFzZXMoKS50aGVuKHB1cmNoYXNlcyA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVW5wcm9jZXNzZWQgcHVyY2hhc2VzOiAnLCBwdXJjaGFzZXMubGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBwdXJjaGFzZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50cy5jb25zdW1lUHVyY2hhc2UocHVyY2hhc2VzW2ldLnB1cmNoYXNlVG9rZW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ09uUHVyY2hhc2VTdWNjZXNzJywgcHVyY2hhc2VzW2ldLnByb2R1Y3RJRCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGNvbnNvbGUubG9nKCdDb25zdW1lIHB1cmNoYXNlczogcGF5bWVudHMgbnVsbCcpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIENvbnN1bWUgcHVyY2hhc2VzOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gSW5pdExlYWRlcmJvYXJkKCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICB5c2RrLmdldExlYWRlcmJvYXJkcygpLnRoZW4oX2xiID0+IHsNCiAgICAgICAgICAgICAgICAgICAgbGVhZGVyYm9hcmQgPSBfbGINCiAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnSW5pdGlhbGl6ZWRMQicpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEluaXQgTGVhZGVyYm9hcmQ6ICcsIGUubWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBTZXRMZWFkZXJib2FyZFNjb3JlcyhfbmFtZSwgc2NvcmUpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgeXNkay5nZXRMZWFkZXJib2FyZHMoKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbihsZWFkZXJib2FyZCA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBsZWFkZXJib2FyZC5zZXRMZWFkZXJib2FyZFNjb3JlKF9uYW1lLCBzY29yZSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFNldCBMZWFkZXIgYm9hcmQgU2NvcmVzOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gR2V0TGVhZGVyYm9hcmRTY29yZXMobmFtZUxCLCBtYXhQbGF5ZXJzLCBxdWFudGl0eVRvcCwgcXVhbnRpdHlBcm91bmQsIHBob3RvU2l6ZSwgYXV0aCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICB2YXIganNvbkVudHJpZXMgPSB7DQogICAgICAgICAgICAgICAgICAgIHRlY2hub05hbWU6ICcnLA0KICAgICAgICAgICAgICAgICAgICBpc0RlZmF1bHQ6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICBpc0ludmVydFNvcnRPcmRlcjogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIGRlY2ltYWxPZmZzZXQ6IDAsDQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICcnIC8vICwgdGl0bGU6ICcnDQogICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgIHlzZGsuZ2V0TGVhZGVyYm9hcmRzKCkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4obGVhZGVyYm9hcmQgPT4gbGVhZGVyYm9hcmQuZ2V0TGVhZGVyYm9hcmREZXNjcmlwdGlvbihuYW1lTEIpKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbihyZXMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAganNvbkVudHJpZXMudGVjaG5vTmFtZSA9IG5hbWVMQjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb25FbnRyaWVzLmlzRGVmYXVsdCA9IHJlcy5kZWZhdWx0Ow0KICAgICAgICAgICAgICAgICAgICAgICAganNvbkVudHJpZXMuaXNJbnZlcnRTb3J0T3JkZXIgPSByZXMuZGVzY3JpcHRpb24uaW52ZXJ0X3NvcnRfb3JkZXI7DQogICAgICAgICAgICAgICAgICAgICAgICBqc29uRW50cmllcy5kZWNpbWFsT2Zmc2V0ID0gcmVzLmRlc2NyaXB0aW9uLnNjb3JlX2Zvcm1hdC5vcHRpb25zLmRlY2ltYWxfb2Zmc2V0Ow0KICAgICAgICAgICAgICAgICAgICAgICAganNvbkVudHJpZXMudHlwZSA9IHJlcy5kZXNjcmlwdGlvbi50eXBlOyAvLyDQndC1INC+0L/RgNC10LTQtdC70Y/QtdGC0YHRjyDQvdCwINC80L7QvNC10L3RgiAxOC4wNy4yMw0KICAgICAgICAgICAgICAgICAgICAgICAgLy9qc29uRW50cmllcy50aXRsZSA9IHJlcy50aXRsZTsgLy8g0KDQtdCw0LvQuNC30YPQudGC0LUg0L/QviDQv9GA0LXQtNC/0L7Rh9GC0LXQvdC40Y/QvA0KDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGVhZGVyYm9hcmQuZ2V0TGVhZGVyYm9hcmRFbnRyaWVzKG5hbWVMQiwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1YW50aXR5VG9wOiBxdWFudGl0eVRvcCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlVXNlcjogYXV0aCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWFudGl0eUFyb3VuZDogcXVhbnRpdHlBcm91bmQNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAudGhlbihyZXMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGpzb25QbGF5ZXJzID0gRW50cmllc0xCKHJlcywgbWF4UGxheWVycywgcGhvdG9TaXplKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjb21iaW5lZEpzb24gPSB7IC4uLmpzb25FbnRyaWVzLCAuLi5qc29uUGxheWVycyB9Ow0KDQogICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdMZWFkZXJib2FyZEVudHJpZXMnLCBKU09OLnN0cmluZ2lmeShjb21iaW5lZEpzb24pKTsNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggR2V0IExlYWRlcmJvYXJkOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gRW50cmllc0xCKHJlcywgbWF4UGxheWVycywgcGhvdG9TaXplKSB7DQogICAgICAgICAgICBsZXQgTGVhZGVyYm9hcmRFbnRyaWVzVGV4dCA9ICcnOw0KICAgICAgICAgICAgbGV0IHBsYXllcnNDb3VudDsNCg0KICAgICAgICAgICAgaWYgKHJlcy5lbnRyaWVzLmxlbmd0aCA8IG1heFBsYXllcnMpIHsNCiAgICAgICAgICAgICAgICBwbGF5ZXJzQ291bnQgPSByZXMuZW50cmllcy5sZW5ndGg7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHBsYXllcnNDb3VudCA9IG1heFBsYXllcnM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxldCByYW5rcyA9IG5ldyBBcnJheShwbGF5ZXJzQ291bnQpOw0KICAgICAgICAgICAgbGV0IHBob3RvcyA9IG5ldyBBcnJheShwbGF5ZXJzQ291bnQpOw0KICAgICAgICAgICAgbGV0IG1hbWVzID0gbmV3IEFycmF5KHBsYXllcnNDb3VudCk7DQogICAgICAgICAgICBsZXQgc2NvcmVzID0gbmV3IEFycmF5KHBsYXllcnNDb3VudCk7DQogICAgICAgICAgICBsZXQgdW5pcXVlSURzID0gbmV3IEFycmF5KHBsYXllcnNDb3VudCk7DQoNCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBwbGF5ZXJzQ291bnQ7IGkrKykgew0KICAgICAgICAgICAgICAgIHJhbmtzW2ldID0gcmVzLmVudHJpZXNbaV0ucmFuazsNCiAgICAgICAgICAgICAgICBzY29yZXNbaV0gPSByZXMuZW50cmllc1tpXS5zY29yZTsNCiAgICAgICAgICAgICAgICB1bmlxdWVJRHNbaV0gPSByZXMuZW50cmllc1tpXS5wbGF5ZXIudW5pcXVlSUQ7DQoNCiAgICAgICAgICAgICAgICBpZiAocGhvdG9TaXplID09PSAnbm9uZVBob3RvJyB8fCByZXMuZW50cmllc1tpXS5wbGF5ZXIuc2NvcGVQZXJtaXNzaW9ucy5hdmF0YXIgIT09ICJhbGxvdyIpIHsNCiAgICAgICAgICAgICAgICAgICAgcGhvdG9zW2ldID0gJ25vbmVQaG90byc7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcGhvdG9zW2ldID0gcmVzLmVudHJpZXNbaV0ucGxheWVyLmdldEF2YXRhclNyYyhwaG90b1NpemUpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChyZXMuZW50cmllc1tpXS5wbGF5ZXIuc2NvcGVQZXJtaXNzaW9ucy5wdWJsaWNfbmFtZSAhPT0gImFsbG93Iikgew0KICAgICAgICAgICAgICAgICAgICBtYW1lc1tpXSA9ICJhbm9ueW1vdXMiOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIG1hbWVzW2ldID0gcmVzLmVudHJpZXNbaV0ucGxheWVyLnB1YmxpY05hbWU7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgTGVhZGVyYm9hcmRFbnRyaWVzVGV4dCArPSByYW5rc1tpXSArICcuICcgKyBtYW1lc1tpXSArICI6ICIgKyBzY29yZXNbaV0gKyAnXG4nOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAocGxheWVyc0NvdW50ID09PSAwKSB7DQogICAgICAgICAgICAgICAgTGVhZGVyYm9hcmRFbnRyaWVzVGV4dCA9ICdubyBkYXRhJzsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbGV0IGpzb25QbGF5ZXJzID0gew0KICAgICAgICAgICAgICAgICJlbnRyaWVzIjogTGVhZGVyYm9hcmRFbnRyaWVzVGV4dCwNCiAgICAgICAgICAgICAgICAicmFua3MiOiByYW5rcywNCiAgICAgICAgICAgICAgICAicGhvdG9zIjogcGhvdG9zLA0KICAgICAgICAgICAgICAgICJuYW1lcyI6IG1hbWVzLA0KICAgICAgICAgICAgICAgICJzY29yZXMiOiBzY29yZXMsDQogICAgICAgICAgICAgICAgInVuaXF1ZUlEcyI6IHVuaXF1ZUlEcw0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgcmV0dXJuIGpzb25QbGF5ZXJzOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gUmV2aWV3KCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICB5c2RrLmZlZWRiYWNrLmNhblJldmlldygpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKCh7IHZhbHVlLCByZWFzb24gfSkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXNkay5mZWVkYmFjay5yZXF1ZXN0UmV2aWV3KCkudGhlbigoeyBmZWVkYmFja1NlbnQgfSkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZmVlZGJhY2tTZW50ICcsIGZlZWRiYWNrU2VudCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmZWVkYmFja1NlbnQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1Jldmlld1NlbnQnLCAndHJ1ZScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1JldmlldyBsZWZ0JykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1Jldmlld1NlbnQnLCAnZmFsc2UnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXZpZXcgbm90IGxlZnQnLCByZWFzb24pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXZpZXcgY2FuIHNob3cgPSBmYWxzZScsIHJlYXNvbik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggUmV2aWV3OiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gUHJvbXB0U2hvdygpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgeXNkay5zaG9ydGN1dC5zaG93UHJvbXB0KCkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTaG9ydGN1dCBjcmVhdGVkPzonLCByZXN1bHQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5vdXRjb21lID09PSAnYWNjZXB0ZWQnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb21wdCBTdWNjZXNzJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnT25Qcm9tcHRTdWNjZXNzJyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdPblByb21wdEZhaWwnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBQcm9tcHQgU2hvdzogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIFBhaW50UkJUKHJidCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyYnQpLnN0eWxlLmJhY2tncm91bmQgPSAnI2ZmMDAwMCc7DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggUGFpbnQgUkJUOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gU3RhdGljUkJURGVhY3RpdmF0ZSgpIHsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEFkZGl0aW9uYWwgc2NyaXB0IG1vZHVsZXM6DQoNCnZhciBjbG91ZFNhdmVzID0gJ25vRGF0YSc7DQoNCmZ1bmN0aW9uIFNhdmVDbG91ZChqc29uRGF0YSwgZmx1c2gpIHsNCiAgICBpZiAocGxheWVyID09IG51bGwpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggU2F2ZSBDbG91ZDogJywgJ0RpZG50IGhhdmUgdGltZSB0byBsb2FkJyk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgdHJ5IHsNCiAgICAgICAgcGxheWVyLnNldERhdGEoew0KICAgICAgICAgICAgc2F2ZXM6IFtqc29uRGF0YV0sDQogICAgICAgIH0sIGZsdXNoKTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFNhdmUgQ2xvdWQ6ICcsIGUubWVzc2FnZSk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBMb2FkQ2xvdWQoc2VuZGJhY2spIHsNCiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsNCiAgICAgICAgaWYgKHlzZGsgPT0gbnVsbCkgew0KICAgICAgICAgICAgaWYgKHNlbmRiYWNrKQ0KICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1NldExvYWRTYXZlcycsICdub0RhdGEnKTsNCiAgICAgICAgICAgIHJlc29sdmUoJ25vRGF0YScpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICB5c2RrLmdldFBsYXllcih7IHNjb3BlczogZmFsc2UgfSkNCiAgICAgICAgICAgICAgICAudGhlbihfcGxheWVyID0+IHsNCiAgICAgICAgICAgICAgICAgICAgX3BsYXllci5nZXREYXRhKFsic2F2ZXMiXSkudGhlbihkYXRhID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnNhdmVzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbmRiYWNrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRMb2FkU2F2ZXMnLCBKU09OLnN0cmluZ2lmeShkYXRhLnNhdmVzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShKU09OLnN0cmluZ2lmeShkYXRhLnNhdmVzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0TG9hZFNhdmVzJywgJ25vRGF0YScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ25vRGF0YScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdMb2FkIENsb3VkIEVycm9yIScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbmRiYWNrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1NldExvYWRTYXZlcycsICdub0RhdGEnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ25vRGF0YScpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9KS5jYXRjaChlID0+IHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTG9hZCBDbG91ZCBFcnJvciEnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoc2VuZGJhY2spDQogICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRMb2FkU2F2ZXMnLCAnbm9EYXRhJyk7DQogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ25vRGF0YScpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBMb2FkIHNhdmVzIENsb3VkOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgaWYgKHNlbmRiYWNrKQ0KICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1NldExvYWRTYXZlcycsICdub0RhdGEnKTsNCiAgICAgICAgICAgIHJlc29sdmUoJ25vRGF0YScpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoNCg0KdmFyIGVudmlyb25tZW50RGF0YSA9ICdudWxsJzsNCg0KZnVuY3Rpb24gUmVxdWVzdGluZ0Vudmlyb25tZW50RGF0YShzZW5kYmFjaykgew0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgIGlmICh5c2RrID09IG51bGwpIHsNCiAgICAgICAgICAgIHJlc29sdmUoJycpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICB2YXIgcHJvbXB0Q2FuU2hvdyA9IGZhbHNlOw0KICAgICAgICAgICAgdmFyIHJldmlld0NhblNob3cgPSBmYWxzZTsNCg0KICAgICAgICAgICAgeXNkay5mZWVkYmFjay5jYW5SZXZpZXcoKQ0KICAgICAgICAgICAgICAgIC50aGVuKCh7IHZhbHVlIH0pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV2aWV3Q2FuU2hvdyA9IHRydWU7DQoNCiAgICAgICAgICAgICAgICAgICAgeXNkay5zaG9ydGN1dC5jYW5TaG93UHJvbXB0KCkudGhlbihwcm9tcHQgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb21wdC5jYW5TaG93KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb21wdENhblNob3cgPSB0cnVlOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBsZXQganNvbkVudmlyID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsYW5ndWFnZSI6IHlzZGsuZW52aXJvbm1lbnQuaTE4bi5sYW5nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkb21haW4iOiB5c2RrLmVudmlyb25tZW50LmkxOG4udGxkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkZXZpY2VUeXBlIjogeXNkay5kZXZpY2VJbmZvLnR5cGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzTW9iaWxlIjogeXNkay5kZXZpY2VJbmZvLmlzTW9iaWxlKCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzRGVza3RvcCI6IHlzZGsuZGV2aWNlSW5mby5pc0Rlc2t0b3AoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXNUYWJsZXQiOiB5c2RrLmRldmljZUluZm8uaXNUYWJsZXQoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXNUViI6IHlzZGsuZGV2aWNlSW5mby5pc1RWKCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImFwcElEIjogeXNkay5lbnZpcm9ubWVudC5hcHAuaWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImJyb3dzZXJMYW5nIjogeXNkay5lbnZpcm9ubWVudC5icm93c2VyLmxhbmcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgInBheWxvYWQiOiB5c2RrLmVudmlyb25tZW50LnBheWxvYWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgInByb21wdENhblNob3ciOiBwcm9tcHRDYW5TaG93LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJyZXZpZXdDYW5TaG93IjogcmV2aWV3Q2FuU2hvdw0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRFbnZpckRhdGEnLCBKU09OLnN0cmluZ2lmeShqc29uRW52aXIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoSlNPTi5zdHJpbmdpZnkoanNvbkVudmlyKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRW52aXJvbm1lbnQgRGF0YTogIiArIEpTT04uc3RyaW5naWZ5KGpzb25FbnZpcikpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggUmVxdWVzdGluZyBFbnZpcm9ubWVudCBEYXRhOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgcmVqZWN0KGUpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoNCndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCAoZXZlbnQpID0+IHsNCiAgICBpZihteUdhbWVJbnN0YW5jZSAhPSBudWxsKSANCiAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnX1NhdmVQcm9ncmVzcycpOyANCiAgICB9KTsNCg0KDQp2YXIgcGxheWVyRGF0YSA9ICdub0RhdGEnOw0KDQpmdW5jdGlvbiBJbml0UGxheWVyKHNlbmRiYWNrKSB7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgTm90QXV0aG9yaXplZCgpOw0KICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0SW5pdGlhbGl6YXRpb25TREsnLCBOb3RBdXRob3JpemVkKCkpOw0KICAgICAgICAgICAgICAgIHJlc29sdmUoTm90QXV0aG9yaXplZCgpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGxldCBfc2NvcGVzID0gZmFsc2U7DQogICAgICAgICAgICAgICAgeXNkay5nZXRQbGF5ZXIoeyBzY29wZXM6IF9zY29wZXMgfSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oX3BsYXllciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIgPSBfcGxheWVyOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGxheWVyTmFtZSA9IHBsYXllci5nZXROYW1lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGxheWVyUGhvdG8gPSBwbGF5ZXIuZ2V0UGhvdG8oJ3NtYWxsJyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX3Njb3Blcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllck5hbWUgPSAiYW5vbnltb3VzIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJQaG90byA9ICJudWxsIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5nZXRNb2RlKCkgPT09ICdsaXRlJykgew0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ05vdCBBdXRob3JpemVkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbmRiYWNrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRJbml0aWFsaXphdGlvblNESycsIE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShOb3RBdXRob3JpemVkKCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXV0aEpzb24gPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwbGF5ZXJBdXRoIjogInJlc29sdmVkIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBsYXllck5hbWUiOiBwbGF5ZXJOYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGxheWVySWQiOiBwbGF5ZXIuZ2V0VW5pcXVlSUQoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBsYXllclBob3RvIjogcGxheWVyUGhvdG8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0SW5pdGlhbGl6YXRpb25TREsnLCBKU09OLnN0cmluZ2lmeShhdXRoSnNvbikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoSlNPTi5zdHJpbmdpZnkoYXV0aEpzb24pKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBdXRob3JpemVkIGVycjogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRJbml0aWFsaXphdGlvblNESycsIE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBpbml0IFBsYXllcjogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRJbml0aWFsaXphdGlvblNESycsIE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICByZXNvbHZlKE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgIH0NCiAgICB9KTsNCn0NCg0KZnVuY3Rpb24gTm90QXV0aG9yaXplZCgpIHsNCiAgICBsZXQgYXV0aEpzb24gPSB7DQogICAgICAgICJwbGF5ZXJBdXRoIjogInJlamVjdGVkIiwNCiAgICAgICAgInBsYXllck5hbWUiOiAidW5hdXRob3JpemVkIiwNCiAgICAgICAgInBsYXllcklkIjogInVuYXV0aG9yaXplZCIsDQogICAgICAgICJwbGF5ZXJQaG90byI6ICJudWxsIg0KICAgIH07DQogICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGF1dGhKc29uKTsNCn0NCg0KZnVuY3Rpb24gT3BlbkF1dGhEaWFsb2coKSB7DQogICAgaWYgKHlzZGsgIT09IG51bGwpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHlzZGsuYXV0aC5vcGVuQXV0aERpYWxvZygpLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgIEluaXRQbGF5ZXIodHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnR2V0RGF0YUludm9rZScpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnQ1JBU0ggT3BlbiBBdXRoIERpYWxvZzogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KDQpsZXQgZmxhc2dzRGF0YSA9ICJudWxsIjsNCg0KZnVuY3Rpb24gR2V0RmxhZ3MoKSB7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgICAgIGlmICh5c2RrID09IG51bGwpIHsNCiAgICAgICAgICAgIHJlc29sdmUoJ251bGwnKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgeXNkay5nZXRGbGFncygpLnRoZW4oZmxhZ3MgPT4gew0KICAgICAgICAgICAgICAgIGxldCBuYW1lcyA9IFtdOw0KICAgICAgICAgICAgICAgIGxldCB2YWx1ZXMgPSBbXTsNCg0KICAgICAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiBmbGFncykgew0KICAgICAgICAgICAgICAgICAgICBpZiAoZmxhZ3MuaGFzT3duUHJvcGVydHkoa2V5KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXMucHVzaChrZXkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzLnB1c2goZmxhZ3Nba2V5XSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBsZXQganNvbkZsYWdzID0gew0KICAgICAgICAgICAgICAgICAgICAibmFtZXMiOiBuYW1lcywNCiAgICAgICAgICAgICAgICAgICAgInZhbHVlcyI6IHZhbHVlcw0KICAgICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICAgICByZXNvbHZlKEpTT04uc3RyaW5naWZ5KGpzb25GbGFncykpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEdldCBGbGFnczogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIHJlc29sdmUoJ251bGwnKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfQ0KDQoNCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICAgIDwvc2NyaXB0Pg0KPC9ib2R5Pg0KPC9odG1sPg==";
