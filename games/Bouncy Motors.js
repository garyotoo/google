window.game = "PCFET0NUWVBFIGh0bWw+DQoNCg0KPCEtLSBVbHRpbWF0ZSBHYW1lIFN0YXNoIGZpbGUtLT4gDQo8IS0tIEZvciB0aGUgcmVndWxhcmx5IHVwZGF0aW5nIGRvYyBnbyB0byBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFfRm1IM0JsU0JRSTdGR2dBUUw1OS1aUGU4ZUN4czM1d2VsNkpVeVZhRzhRLyAtLT4NCjwhLS0gTWFkZSBieSBHYWxheHlraW5nMTYgLS0+IA0KDQoNCjxodG1sIGxhbmc9ImVuLXVzIj4NCiAgICA8aGVhZD4NCiAgICAgICAgPG1ldGEgY2hhcnNldD0idXRmLTgiPg0KICAgICAgICA8bWV0YSBodHRwLWVxdWl2PSJDb250ZW50LVR5cGUiIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD11dGYtOCI+DQogICAgICAgIDxiYXNlIGhyZWYgPSAiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL0Nvb2xEdWRlMjM0OS9ib3VuY3lAbWFpbi8iPg0KDQogICAgICAgIDxzdHlsZT4NCiAgICAgICAgICAgIGh0bWwsIGJvZHkgew0KICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwcHg7DQogICAgICAgICAgICAgICAgbWFyZ2luOiAwcHg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAuZnVsbHNjcmVlbiB7DQogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogIzAwMDAwMDsNCiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgICAgICAgICAgIHRvcDogMHB4Ow0KICAgICAgICAgICAgICAgIGxlZnQ6IDBweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICNiYW5uZXItY29udGFpbmVyIHsNCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgICAgICAgICAgICAgYm90dG9tOiAwcHg7DQogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICAgICAgaGVpZ2h0OiA5MHB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgI2xvYWRpbmctb3ZlcmxheSB7DQogICAgICAgICAgICAgICAgZm9udC1zaXplOiAyMHB4Ow0KICAgICAgICAgICAgICAgIHotaW5kZXg6IDE7DQogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgICAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAjaWNvbiB7DQogICAgICAgICAgICAgICAgbWF4LXdpZHRoOiAxMjBweDsNCiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMHB4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDIwcHg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAjcHJvZ3Jlc3MtYmFyIHsNCiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1cHg7DQogICAgICAgICAgICAgICAgd2lkdGg6IDkwJTsNCiAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDI1MHB4Ow0KICAgICAgICAgICAgICAgIGhlaWdodDogMjBweDsNCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMjQyNDI0Ow0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDVweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICNwcm9ncmVzcy1iYXItZmlsbCB7DQogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogM3B4Ow0KICAgICAgICAgICAgICAgIHdpZHRoOiAwJTsNCiAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogI0ZGOUEwMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgPC9zdHlsZT4NCiAgICA8L2hlYWQ+DQogICAgPGJvZHk+DQogICAgICAgIDxjYW52YXMgaWQ9ImNhbnZhcyIgY2xhc3M9ImZ1bGxzY3JlZW4iPjwvY2FudmFzPg0KICAgICAgICA8ZGl2IGlkPSJiYW5uZXItY29udGFpbmVyIiBzdHlsZT0iZGlzcGxheTogbm9uZSI+PC9kaXY+DQogICAgICAgIDxkaXYgaWQ9ImxvYWRpbmctb3ZlcmxheSIgY2xhc3M9ImZ1bGxzY3JlZW4iPg0KICAgICAgICAgICAgPGltZyBpZD0iaWNvbiIgc3JjPSIuL2ljb24ucG5nIiAvPg0KICAgICAgICAgICAgPGRpdiBpZD0icHJvZ3Jlc3MtYmFyIj48ZGl2IGlkPSJwcm9ncmVzcy1iYXItZmlsbCI+PC9kaXY+PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgICA8c2NyaXB0IHNyYz0iLi9pbnN0YW50LWdhbWVzLWJyaWRnZS5qcz92PTIiPjwvc2NyaXB0Pg0KICAgICAgICA8c2NyaXB0Pg0KICAgICAgICAgICAgaWYgKC9pUGhvbmV8aVBhZHxpUG9kfEFuZHJvaWQvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7DQogICAgICAgICAgICAgICAgbGV0IG1ldGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtZXRhJykNCiAgICAgICAgICAgICAgICBtZXRhLm5hbWUgPSAndmlld3BvcnQnDQogICAgICAgICAgICAgICAgbWV0YS5jb250ZW50ID0gJ3dpZHRoPWRldmljZS13aWR0aCwgaGVpZ2h0PWRldmljZS1oZWlnaHQsIGluaXRpYWwtc2NhbGU9MS4wLCB1c2VyLXNjYWxhYmxlPW5vLCBzaHJpbmstdG8tZml0PXllcycNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKG1ldGEpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxldCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJykNCiAgICAgICAgICAgIGxldCBsb2FkaW5nT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nLW92ZXJsYXknKQ0KICAgICAgICAgICAgbGV0IHByb2dyZXNzQmFyRmlsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzcy1iYXItZmlsbCcpDQogICAgICAgICAgICBsZXQgYmFubmVyQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jhbm5lci1jb250YWluZXInKQ0KDQogICAgICAgICAgICBjb25zdCBTVE9SQUdFX0RBVEFfU0VQQVJBVE9SID0gJ3ticmlkZ2VfZGF0YV9zZXBhcmF0b3J9Jw0KICAgICAgICAgICAgY29uc3QgU1RPUkFHRV9LRVlTX1NFUEFSQVRPUiA9ICd7YnJpZGdlX2tleXNfc2VwYXJhdG9yfScNCiAgICAgICAgICAgIGNvbnN0IFNUT1JBR0VfVkFMVUVTX1NFUEFSQVRPUiA9ICd7YnJpZGdlX3ZhbHVlc19zZXBhcmF0b3J9Jw0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIHV0aWxzDQogICAgICAgICAgICB3aW5kb3cudW5pdHlJbnN0YW5jZSA9IG51bGwNCiAgICAgICAgICAgIGxldCBwcm9ncmVzc0JhckZpbGxpbmdJbnRlcnZhbCA9IG51bGwNCg0KICAgICAgICAgICAgZnVuY3Rpb24gc2VuZE1lc3NhZ2VUb1VuaXR5KG5hbWUsIHZhbHVlKSB7DQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy51bml0eUluc3RhbmNlICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy51bml0eUluc3RhbmNlLlNlbmRNZXNzYWdlKCdCcmlkZ2UnLCBuYW1lLCB2YWx1ZSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIG9uVW5pdHlMb2FkaW5nUHJvZ3Jlc3NDaGFuZ2VkKHByb2dyZXNzKSB7DQogICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzID09PSAwLjkpIHsNCiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVQcm9ncmVzc0JhckZpbGxpbmcoKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBwcm9ncmVzc0JhckZpbGwuc3R5bGUud2lkdGggPSBgJHsgcHJvZ3Jlc3MgKiAxMDAgfSVgDQogICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzID09PSAxICYmIHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocHJvZ3Jlc3NCYXJGaWxsaW5nSW50ZXJ2YWwpDQogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsID0gbnVsbA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZnVuY3Rpb24gY29tcGxldGVQcm9ncmVzc0JhckZpbGxpbmcoKSB7DQogICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGxldCBjdXJyZW50UGVyY2VudCA9IDkwDQogICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJGaWxsLnN0eWxlLndpZHRoID0gYCR7IGN1cnJlbnRQZXJjZW50IH0lYA0KICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGVyY2VudCsrDQogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UGVyY2VudCA+IDEwMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBlcmNlbnQgPSAxMDANCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRmlsbC5zdHlsZS53aWR0aCA9IGAkeyBjdXJyZW50UGVyY2VudCB9JWANCg0KICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFBlcmNlbnQgPj0gMTAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJGaWxsaW5nSW50ZXJ2YWwgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sIDEwMCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJkb3duJywgKCkgPT4gew0KICAgICAgICAgICAgICAgIHdpbmRvdy5mb2N1cygpDQogICAgICAgICAgICAgICAgY2FudmFzLmZvY3VzKCkNCiAgICAgICAgICAgIH0pDQoNCg0KICAgICAgICAgICAgbGV0IGJyaWRnZU9wdGlvbnMgPSB7DQogICAgICAgICAgICAgICAgcGxhdGZvcm1zOiB7DQogICAgICAgICAgICAgICAgICAgICdnYW1lX2Rpc3RyaWJ1dGlvbic6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWVJZDogJzc0NDczYjBkOGE0MjQxNWRiNzVmZWYwYTAwNWI5NjU0Jw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBpbml0aWFsaXphdGlvbg0KICAgICAgICAgICAgYnJpZGdlDQogICAgICAgICAgICAgICAgLmluaXRpYWxpemUoYnJpZGdlT3B0aW9ucykNCiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50Lm9uKCdiYW5uZXJfc3RhdGVfY2hhbmdlZCcsIHN0YXRlID0+IHNlbmRNZXNzYWdlVG9Vbml0eSgnT25CYW5uZXJTdGF0ZUNoYW5nZWQnLCBzdGF0ZSkpDQogICAgICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50Lm9uKCdpbnRlcnN0aXRpYWxfc3RhdGVfY2hhbmdlZCcsIHN0YXRlID0+IHNlbmRNZXNzYWdlVG9Vbml0eSgnT25JbnRlcnN0aXRpYWxTdGF0ZUNoYW5nZWQnLCBzdGF0ZSkpDQogICAgICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50Lm9uKCdyZXdhcmRlZF9zdGF0ZV9jaGFuZ2VkJywgc3RhdGUgPT4gc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblJld2FyZGVkU3RhdGVDaGFuZ2VkJywgc3RhdGUpKQ0KICAgICAgICAgICAgICAgICAgICBicmlkZ2UuZ2FtZS5vbigndmlzaWJpbGl0eV9zdGF0ZV9jaGFuZ2VkJywgc3RhdGUgPT4gc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblZpc2liaWxpdHlTdGF0ZUNoYW5nZWQnLCBzdGF0ZSkpDQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKGJyaWRnZS5wbGF0Zm9ybS5pZCA9PT0gYnJpZGdlLlBMQVRGT1JNX0lELllBTkRFWCB8fCBicmlkZ2UucGxhdGZvcm0uaWQgPT09IGJyaWRnZS5QTEFURk9STV9JRC5HQU1FX0RJU1RSSUJVVElPTikgew0KICAgICAgICAgICAgICAgICAgICAgICAgYnJpZGdlLmFkdmVydGlzZW1lbnQuc2hvd0ludGVyc3RpdGlhbCgpDQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBsZXQgdW5pdHlMb2FkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKQ0KICAgICAgICAgICAgICAgICAgICB1bml0eUxvYWRlci5zcmMgPSAnQnVpbGQvYm91bmN5LW1vdG9ycy13ZWIubG9hZGVyLmpzJw0KICAgICAgICAgICAgICAgICAgICB1bml0eUxvYWRlci5vbmxvYWQgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVVbml0eUluc3RhbmNlKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFVcmw6ICdCdWlsZC9iMjRiNWIyOWI1ODIwMTZjNmUzMDk3ZThjYTY3YzZkZC5kYXRhLnVuaXR5d2ViJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWV3b3JrVXJsOiAnQnVpbGQvOGM2OTY4MThlOGI4MTBmOTk5ZmZiMjgxZGQ1OWY2NmEuanMudW5pdHl3ZWInLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlVXJsOiAnQnVpbGQvYWQxYTMwNmEyZTM2YTBmYjM3NDY1NzZjYTVkYWUzMDMud2FzbS51bml0eXdlYicsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbWluZ0Fzc2V0c1VybDogJ1N0cmVhbWluZ0Fzc2V0cycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhbnlOYW1lOiAnTWV3dG9uIEdhbWVzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdE5hbWU6ICdCb3VuY3kgTW90b3JzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdFZlcnNpb246ICcxLjEyLjAnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtYXRjaFdlYkdMVG9DYW52YXNTaXplOiBmYWxzZSwgLy8gVW5jb21tZW50IHRoaXMgdG8gc2VwYXJhdGVseSBjb250cm9sIFdlYkdMIGNhbnZhcyByZW5kZXIgc2l6ZSBhbmQgRE9NIGVsZW1lbnQgc2l6ZS4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGV2aWNlUGl4ZWxSYXRpbzogMSwgLy8gVW5jb21tZW50IHRoaXMgdG8gb3ZlcnJpZGUgbG93IERQSSByZW5kZXJpbmcgb24gaGlnaCBEUEkgZGlzcGxheXMuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblVuaXR5TG9hZGluZ1Byb2dyZXNzQ2hhbmdlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigodW5pdHlJbnN0YW5jZSkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cudW5pdHlJbnN0YW5jZSA9IHVuaXR5SW5zdGFuY2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ092ZXJsYXkucmVtb3ZlKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzLmZvY3VzKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodW5pdHlMb2FkZXIpDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5lcnJvcihlcnJvcikpDQogICAgICAgICAgICANCg0KICAgICAgICAgICAgLy8gcGxhdGZvcm0NCiAgICAgICAgICAgIHdpbmRvdy5nZXRQbGF0Zm9ybUlkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5wbGF0Zm9ybS5pZA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0UGxhdGZvcm1MYW5ndWFnZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGxhdGZvcm0ubGFuZ3VhZ2UNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldFBsYXRmb3JtUGF5bG9hZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGxldCBwYXlsb2FkID0gYnJpZGdlLnBsYXRmb3JtLnBheWxvYWQNCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBheWxvYWQgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXlsb2FkDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0UGxhdGZvcm1UbGQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBsZXQgdGxkID0gYnJpZGdlLnBsYXRmb3JtLnRsZA0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGxkID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGxkDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuc2VuZE1lc3NhZ2VUb1BsYXRmb3JtID0gZnVuY3Rpb24obWVzc2FnZSkgew0KICAgICAgICAgICAgICAgIGJyaWRnZS5wbGF0Zm9ybS5zZW5kTWVzc2FnZShtZXNzYWdlKQ0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAgIC8vIGRldmljZQ0KICAgICAgICAgICAgd2luZG93LmdldERldmljZVR5cGUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLmRldmljZS50eXBlDQogICAgICAgICAgICB9DQoNCg0KICAgICAgICAgICAgLy8gcGxheWVyDQogICAgICAgICAgICB3aW5kb3cuZ2V0SXNQbGF5ZXJBdXRob3JpemF0aW9uU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5wbGF5ZXIuaXNBdXRob3JpemF0aW9uU3VwcG9ydGVkLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldElzUGxheWVyQXV0aG9yaXplZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGxheWVyLmlzQXV0aG9yaXplZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRQbGF5ZXJJZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGlmIChicmlkZ2UucGxheWVyLmlkKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGxheWVyLmlkLnRvU3RyaW5nKCkNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gJycNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldFBsYXllck5hbWUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBpZiAoYnJpZGdlLnBsYXllci5uYW1lKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGxheWVyLm5hbWUudG9TdHJpbmcoKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiAnJw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0UGxheWVyUGhvdG9zID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgaWYgKGJyaWRnZS5wbGF5ZXIucGhvdG9zLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGJyaWRnZS5wbGF5ZXIucGhvdG9zKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiAnJw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuYXV0aG9yaXplUGxheWVyID0gZnVuY3Rpb24ob3B0aW9ucykgew0KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgYnJpZGdlLnBsYXllci5hdXRob3JpemUob3B0aW9ucykNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkF1dGhvcml6ZUNvbXBsZXRlZCcsICd0cnVlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25BdXRob3JpemVDb21wbGV0ZWQnLCAnZmFsc2UnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAgIC8vIGdhbWUNCiAgICAgICAgICAgIHdpbmRvdy5nZXRWaXNpYmlsaXR5U3RhdGUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLmdhbWUudmlzaWJpbGl0eVN0YXRlDQogICAgICAgICAgICB9DQoNCg0KICAgICAgICAgICAgLy8gc3RvcmFnZQ0KICAgICAgICAgICAgd2luZG93LmdldFN0b3JhZ2VEZWZhdWx0VHlwZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc3RvcmFnZS5kZWZhdWx0VHlwZQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0SXNTdG9yYWdlU3VwcG9ydGVkID0gZnVuY3Rpb24oc3RvcmFnZVR5cGUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnN0b3JhZ2UuaXNTdXBwb3J0ZWQoc3RvcmFnZVR5cGUpLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldElzU3RvcmFnZUF2YWlsYWJsZSA9IGZ1bmN0aW9uKHN0b3JhZ2VUeXBlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zdG9yYWdlLmlzQXZhaWxhYmxlKHN0b3JhZ2VUeXBlKS50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRTdG9yYWdlRGF0YSA9IGZ1bmN0aW9uKGtleSwgc3RvcmFnZVR5cGUpIHsNCiAgICAgICAgICAgICAgICBsZXQga2V5cyA9IGtleS5zcGxpdChTVE9SQUdFX0tFWVNfU0VQQVJBVE9SKQ0KDQogICAgICAgICAgICAgICAgYnJpZGdlLnN0b3JhZ2UuZ2V0KGtleXMsIHN0b3JhZ2VUeXBlKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXlzLmxlbmd0aCA+IDEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWVzID0gW10NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSBkYXRhW2ldDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh2YWx1ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKCcnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkdldFN0b3JhZ2VEYXRhU3VjY2VzcycsIGAke2tleX0ke1NUT1JBR0VfREFUQV9TRVBBUkFUT1J9JHt2YWx1ZXMuam9pbihTVE9SQUdFX1ZBTFVFU19TRVBBUkFUT1IpfWApDQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhWzBdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YVswXSAhPT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhWzBdKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9ICcnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkdldFN0b3JhZ2VEYXRhU3VjY2VzcycsIGAke2tleX0ke1NUT1JBR0VfREFUQV9TRVBBUkFUT1J9JHtkYXRhfWApDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uR2V0U3RvcmFnZURhdGFGYWlsZWQnLCBrZXkpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5zZXRTdG9yYWdlRGF0YSA9IGZ1bmN0aW9uKGtleSwgdmFsdWUsIHN0b3JhZ2VUeXBlKSB7DQogICAgICAgICAgICAgICAgbGV0IGtleXMgPSBrZXkuc3BsaXQoU1RPUkFHRV9LRVlTX1NFUEFSQVRPUikNCiAgICAgICAgICAgICAgICBsZXQgdmFsdWVzID0gdmFsdWUuc3BsaXQoU1RPUkFHRV9WQUxVRVNfU0VQQVJBVE9SKQ0KDQogICAgICAgICAgICAgICAgYnJpZGdlLnN0b3JhZ2Uuc2V0KGtleXMsIHZhbHVlcywgc3RvcmFnZVR5cGUpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25TZXRTdG9yYWdlRGF0YVN1Y2Nlc3MnLCBrZXkpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uU2V0U3RvcmFnZURhdGFGYWlsZWQnLCBrZXkpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5kZWxldGVTdG9yYWdlRGF0YSA9IGZ1bmN0aW9uKGtleSwgc3RvcmFnZVR5cGUpIHsNCiAgICAgICAgICAgICAgICBsZXQga2V5cyA9IGtleS5zcGxpdChTVE9SQUdFX0tFWVNfU0VQQVJBVE9SKQ0KDQogICAgICAgICAgICAgICAgYnJpZGdlLnN0b3JhZ2UuZGVsZXRlKGtleXMsIHN0b3JhZ2VUeXBlKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uRGVsZXRlU3RvcmFnZURhdGFTdWNjZXNzJywga2V5KQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkRlbGV0ZVN0b3JhZ2VEYXRhRmFpbGVkJywga2V5KQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAgIC8vIGFkdmVydGlzZW1lbnQNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJbnRlcnN0aXRpYWxTdGF0ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGlmIChicmlkZ2UuYWR2ZXJ0aXNlbWVudC5pbnRlcnN0aXRpYWxTdGF0ZSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLmFkdmVydGlzZW1lbnQuaW50ZXJzdGl0aWFsU3RhdGUNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJycNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0Jhbm5lclN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UuYWR2ZXJ0aXNlbWVudC5pc0Jhbm5lclN1cHBvcnRlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHdpbmRvdy5nZXRNaW5pbXVtRGVsYXlCZXR3ZWVuSW50ZXJzdGl0aWFsID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5hZHZlcnRpc2VtZW50Lm1pbmltdW1EZWxheUJldHdlZW5JbnRlcnN0aXRpYWwudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuc2V0TWluaW11bURlbGF5QmV0d2VlbkludGVyc3RpdGlhbCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgew0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7IH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgYnJpZGdlLmFkdmVydGlzZW1lbnQuc2V0TWluaW11bURlbGF5QmV0d2VlbkludGVyc3RpdGlhbChvcHRpb25zKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuc2hvd0Jhbm5lciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBpZiAoYnJpZGdlLnBsYXRmb3JtLmlkID09PSBicmlkZ2UuUExBVEZPUk1fSUQuQ1JBWllfR0FNRVMpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHsgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChicmlkZ2UucGxhdGZvcm0uaWQgPT09IGJyaWRnZS5QTEFURk9STV9JRC5HQU1FX0RJU1RSSUJVVElPTikgew0KICAgICAgICAgICAgICAgICAgICBiYW5uZXJDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jaycNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBvcHRpb25zWydjcmF6eV9nYW1lcyddID0gew0KICAgICAgICAgICAgICAgICAgICBjb250YWluZXJJZDogJ2Jhbm5lci1jb250YWluZXInDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgb3B0aW9uc1snZ2FtZV9kaXN0cmlidXRpb24nXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVySWQ6ICdiYW5uZXItY29udGFpbmVyJw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LnNob3dCYW5uZXIob3B0aW9ucykNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmhpZGVCYW5uZXIgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBpZiAoYnJpZGdlLnBsYXRmb3JtLmlkID09PSBicmlkZ2UuUExBVEZPUk1fSUQuQ1JBWllfR0FNRVMpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGJyaWRnZS5wbGF0Zm9ybS5pZCA9PT0gYnJpZGdlLlBMQVRGT1JNX0lELkdBTUVfRElTVFJJQlVUSU9OKSB7DQogICAgICAgICAgICAgICAgICAgIGJhbm5lckNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgYnJpZGdlLmFkdmVydGlzZW1lbnQuaGlkZUJhbm5lcigpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5zaG93SW50ZXJzdGl0aWFsID0gZnVuY3Rpb24ob3B0aW9ucykgew0KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgYnJpZGdlLmFkdmVydGlzZW1lbnQuc2hvd0ludGVyc3RpdGlhbChvcHRpb25zKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuc2hvd1Jld2FyZGVkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgYnJpZGdlLmFkdmVydGlzZW1lbnQuc2hvd1Jld2FyZGVkKCkNCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICAvLyBzb2NpYWwNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1NoYXJlU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zb2NpYWwuaXNTaGFyZVN1cHBvcnRlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0ludml0ZUZyaWVuZHNTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnNvY2lhbC5pc0ludml0ZUZyaWVuZHNTdXBwb3J0ZWQudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0SXNKb2luQ29tbXVuaXR5U3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zb2NpYWwuaXNKb2luQ29tbXVuaXR5U3VwcG9ydGVkLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldElzQ3JlYXRlUG9zdFN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzQ3JlYXRlUG9zdFN1cHBvcnRlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0FkZFRvSG9tZVNjcmVlblN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzQWRkVG9Ib21lU2NyZWVuU3VwcG9ydGVkLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldElzQWRkVG9GYXZvcml0ZXNTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnNvY2lhbC5pc0FkZFRvRmF2b3JpdGVzU3VwcG9ydGVkLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldElzUmF0ZVN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzUmF0ZVN1cHBvcnRlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0V4dGVybmFsTGlua3NBbGxvd2VkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zb2NpYWwuaXNFeHRlcm5hbExpbmtzQWxsb3dlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5zaGFyZSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgew0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwuc2hhcmUob3B0aW9ucykNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblNoYXJlQ29tcGxldGVkJywgJ3RydWUnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblNoYXJlQ29tcGxldGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93Lmludml0ZUZyaWVuZHMgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBicmlkZ2Uuc29jaWFsLmludml0ZUZyaWVuZHMoKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uSW52aXRlRnJpZW5kc0NvbXBsZXRlZCcsICd0cnVlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25JbnZpdGVGcmllbmRzQ29tcGxldGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmpvaW5Db21tdW5pdHkgPSBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBicmlkZ2Uuc29jaWFsLmpvaW5Db21tdW5pdHkob3B0aW9ucykNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkpvaW5Db21tdW5pdHlDb21wbGV0ZWQnLCAndHJ1ZScpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uSm9pbkNvbW11bml0eUNvbXBsZXRlZCcsICdmYWxzZScpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5jcmVhdGVQb3N0ID0gZnVuY3Rpb24ob3B0aW9ucykgew0KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgYnJpZGdlLnNvY2lhbC5jcmVhdGVQb3N0KG9wdGlvbnMpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25DcmVhdGVQb3N0Q29tcGxldGVkJywgJ3RydWUnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkNyZWF0ZVBvc3RDb21wbGV0ZWQnLCAnZmFsc2UnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuYWRkVG9Ib21lU2NyZWVuID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgYnJpZGdlLnNvY2lhbC5hZGRUb0hvbWVTY3JlZW4oKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQWRkVG9Ib21lU2NyZWVuQ29tcGxldGVkJywgJ3RydWUnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFkZFRvSG9tZVNjcmVlbkNvbXBsZXRlZCcsICdmYWxzZScpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5hZGRUb0Zhdm9yaXRlcyA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwuYWRkVG9GYXZvcml0ZXMoKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQWRkVG9GYXZvcml0ZXNDb21wbGV0ZWQnLCAndHJ1ZScpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQWRkVG9GYXZvcml0ZXNDb21wbGV0ZWQnLCAnZmFsc2UnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cucmF0ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwucmF0ZSgpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25SYXRlQ29tcGxldGVkJywgJ3RydWUnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblJhdGVDb21wbGV0ZWQnLCAnZmFsc2UnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAgIC8vIGxlYWRlcmJvYXJkDQogICAgICAgICAgICB3aW5kb3cuZ2V0SXNMZWFkZXJib2FyZFN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UubGVhZGVyYm9hcmQuaXNTdXBwb3J0ZWQudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0SXNMZWFkZXJib2FyZE5hdGl2ZVBvcHVwU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5sZWFkZXJib2FyZC5pc05hdGl2ZVBvcHVwU3VwcG9ydGVkLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldElzTGVhZGVyYm9hcmRNdWx0aXBsZUJvYXJkc1N1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UubGVhZGVyYm9hcmQuaXNNdWx0aXBsZUJvYXJkc1N1cHBvcnRlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0xlYWRlcmJvYXJkU2V0U2NvcmVTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLmxlYWRlcmJvYXJkLmlzU2V0U2NvcmVTdXBwb3J0ZWQudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0SXNMZWFkZXJib2FyZEdldFNjb3JlU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5sZWFkZXJib2FyZC5pc0dldFNjb3JlU3VwcG9ydGVkLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldElzTGVhZGVyYm9hcmRHZXRFbnRyaWVzU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5sZWFkZXJib2FyZC5pc0dldEVudHJpZXNTdXBwb3J0ZWQudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cubGVhZGVyYm9hcmRTZXRTY29yZSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgew0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGJyaWRnZS5sZWFkZXJib2FyZC5zZXRTY29yZShvcHRpb25zKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uTGVhZGVyYm9hcmRTZXRTY29yZUNvbXBsZXRlZCcsICd0cnVlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZFNldFNjb3JlQ29tcGxldGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmxlYWRlcmJvYXJkR2V0U2NvcmUgPSBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBicmlkZ2UubGVhZGVyYm9hcmQuZ2V0U2NvcmUob3B0aW9ucykNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSAhPT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkR2V0U2NvcmVDb21wbGV0ZWQnLCBkYXRhKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uTGVhZGVyYm9hcmRHZXRTY29yZUNvbXBsZXRlZCcsICcnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkR2V0U2NvcmVDb21wbGV0ZWQnLCAnZmFsc2UnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cubGVhZGVyYm9hcmRHZXRFbnRyaWVzID0gZnVuY3Rpb24ob3B0aW9ucykgew0KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgYnJpZGdlLmxlYWRlcmJvYXJkLmdldEVudHJpZXMob3B0aW9ucykNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSAhPT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkR2V0RW50cmllc0NvbXBsZXRlZFN1Y2Nlc3MnLCBkYXRhKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uTGVhZGVyYm9hcmRHZXRFbnRyaWVzQ29tcGxldGVkU3VjY2VzcycsICcnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkR2V0RW50cmllc0NvbXBsZXRlZEZhaWxlZCcsICdmYWxzZScpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5sZWFkZXJib2FyZFNob3dOYXRpdmVQb3B1cCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgew0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGJyaWRnZS5sZWFkZXJib2FyZC5zaG93TmF0aXZlUG9wdXAob3B0aW9ucykNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkU2hvd05hdGl2ZVBvcHVwQ29tcGxldGVkJywgJ3RydWUnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkU2hvd05hdGl2ZVBvcHVwQ29tcGxldGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgPC9zY3JpcHQ+DQogICAgICAgIDwhLS0gPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiID4gKGZ1bmN0aW9uKG0sZSx0LHIsaSxrLGEpe21baV09bVtpXXx8ZnVuY3Rpb24oKXsobVtpXS5hPW1baV0uYXx8W10pLnB1c2goYXJndW1lbnRzKX07IG1baV0ubD0xKm5ldyBEYXRlKCk7IGZvciAodmFyIGogPSAwOyBqIDwgZG9jdW1lbnQuc2NyaXB0cy5sZW5ndGg7IGorKykge2lmIChkb2N1bWVudC5zY3JpcHRzW2pdLnNyYyA9PT0gcikgeyByZXR1cm47IH19IGs9ZS5jcmVhdGVFbGVtZW50KHQpLGE9ZS5nZXRFbGVtZW50c0J5VGFnTmFtZSh0KVswXSxrLmFzeW5jPTEsay5zcmM9cixhLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGssYSl9KSAod2luZG93LCBkb2N1bWVudCwgInNjcmlwdCIsICJodHRwczovL21jLnlhbmRleC5ydS9tZXRyaWthL3RhZy5qcyIsICJ5bSIpOyB5bSg5MjU3OTE0NiwgImluaXQiLCB7IGNsaWNrbWFwOnRydWUsIHRyYWNrTGlua3M6dHJ1ZSwgYWNjdXJhdGVUcmFja0JvdW5jZTp0cnVlLCB0cmFja0hhc2g6dHJ1ZSB9KTsgPC9zY3JpcHQ+IDxub3NjcmlwdD48ZGl2PjxpbWcgc3JjPSJodHRwczovL21jLnlhbmRleC5ydS93YXRjaC85MjU3OTE0NiIgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlOyBsZWZ0Oi05OTk5cHg7IiBhbHQ9IiIgLz48L2Rpdj48L25vc2NyaXB0PiAtLT4NCiAgICA8L2JvZHk+DQo8L2h0bWw+";
