window.game = "PE1vZHVsZT4NCg0KDQo8IS0tIFVsdGltYXRlIEdhbWUgU3Rhc2ggZmlsZS0tPiANCjwhLS0gRm9yIHRoZSByZWd1bGFybHkgdXBkYXRpbmcgZG9jIGdvIHRvIGh0dHBzOi8vZG9jcy5nb29nbGUuY29tL2RvY3VtZW50L2QvMV9GbUgzQmxTQlFJN0ZHZ0FRTDU5LVpQZThlQ3hzMzV3ZWw2SlV5VmFHOFEvIC0tPg0KDQoNCjwvc3R5bGU+PHN0eWxlIHR5cGU9InRleHQvY3NzIj4jYnV0dG9uIHsNCiAgZGlzcGxheTpub25lOw0KfQ0KLmltZ2JfdmlzIHsNCiAgYW5pbWF0aW9uOiBpbWdiLWFuaW1hdGlvbiA3cyBsaW5lYXI7DQp9DQpAa2V5ZnJhbWVzIGltZ2ItYW5pbWF0aW9uIHsNCiAgMTAlIHsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCk7DQogIH0NCiAgMjAlIHsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMTAwcHgpOw0KICB9DQogIDkwJSB7DQogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDEwMHB4KTsNCiAgfQ0KICAxMDAlIHsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCk7DQogIH0NCn08L3N0eWxlPjwvaGVhZD48Ym9keSBjbGFzcz0iZGFyayIgZGlyPSJsdHIiPjxzY3JpcHQgYXN5bmM9IiIgc3JjPSJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbS9ndGFnL2pzP2lkPUctTUVOQk02R1NOWSI+PC9zY3JpcHQ+PHNjcmlwdD5mdW5jdGlvbiBndGFnKCl7ZGF0YUxheWVyLnB1c2goYXJndW1lbnRzKX13aW5kb3cuZGF0YUxheWVyPXdpbmRvdy5kYXRhTGF5ZXJ8fFtdLGd0YWcoImpzIixuZXcgRGF0ZSksZ3RhZygiY29uZmlnIiwiRy1NRU5CTTZHU05ZIik8L3NjcmlwdD4NCjxkaXYgY2xhc3M9InVuaXR5LWRlc2t0b3AiIGlkPSJ1bml0eS1jb250YWluZXIiPg0KICAgIDxjYW52YXMgaWQ9InVuaXR5LWNhbnZhcyI+PC9jYW52YXM+DQo8L2Rpdj4NCjxkaXYgaWQ9ImxvYWRpbmctY292ZXIiIHN0eWxlPSIiPg0KICAgIDxkaXYgaWQ9InVuaXR5LWxvYWRpbmctYmFyIj4NCiAgICAgICAgPGRpdiBpZD0idW5pdHktbG9nbyI+PC9kaXY+DQogICAgICAgIDxkaXYgaWQ9InVuaXR5LXByb2dyZXNzLWJhci1lbXB0eSI+DQogICAgICAgICAgICA8ZGl2IGlkPSJ1bml0eS1wcm9ncmVzcy1iYXItZnVsbCIgc3R5bGU9IndpZHRoOiAyMy41NDIzJTsiPjwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPGRpdiBjbGFzcz0ic3Bpbm5lciI+PC9kaXY+DQogICAgPC9kaXY+DQo8L2Rpdj4NCjxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvc3QzOS9zZGtAbWFpbi9hcGkuanMiPjwvc2NyaXB0Pg0KPHNjcmlwdD4NCiAgICB2YXIgZ2FtZVN0YXRlID0gew0KICAgICAgICBpc0luaXRpYWxpemVkOiBmYWxzZSwNCiAgICAgICAgaW5zdGFuY2U6IG51bGwsDQogICAgICAgIHBsYXllcjogbnVsbCwNCiAgICAgICAgbGVhZGVyYm9hcmQ6IG51bGwsDQogICAgICAgIHBheW1lbnRzOiBudWxsLA0KICAgICAgICBwcm9tcHRDYW5TaG93OiBmYWxzZSwNCiAgICAgICAgcmV2aWV3Q2FuU2hvdzogZmFsc2UsDQogICAgICAgIGluaXRTREs6IGZhbHNlLA0KICAgICAgICBpbml0R2FtZTogZmFsc2UsDQogICAgICAgIHBob3RvU2l6ZUZvckluaXQ6IG51bGwsDQogICAgICAgIHNjb3Blc0ZvckluaXQ6IG51bGwsDQogICAgICAgIGZpcnN0QWQ6IHRydWUsDQogICAgICAgIGxvYWRpbmdQcm9ncmVzczogew0KICAgICAgICAgICAgZGF0YUZpbGVzUHJvZ3Jlc3M6IDAsDQogICAgICAgICAgICB1bml0eVByb2dyZXNzOiAwDQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgZnVuY3Rpb24gdXBkYXRlVG90YWxQcm9ncmVzcygpIHsNCiAgICAgICAgLy8g0J/QtdGA0LLRi9C1IDUwJSDQv9GA0L7Qs9GA0LXRgdGB0LAgLSDQt9Cw0LPRgNGD0LfQutCwIGRhdGEg0YTQsNC50LvQvtCyDQogICAgICAgIC8vINCe0YHRgtCw0LLRiNC40LXRgdGPIDUwJSAtINC30LDQs9GA0YPQt9C60LAgVW5pdHkNCiAgICAgICAgY29uc3QgdG90YWxQcm9ncmVzcyA9IChnYW1lU3RhdGUubG9hZGluZ1Byb2dyZXNzLmRhdGFGaWxlc1Byb2dyZXNzICogMC41KSArIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIChnYW1lU3RhdGUubG9hZGluZ1Byb2dyZXNzLnVuaXR5UHJvZ3Jlc3MgKiAwLjUpOw0KICAgICAgICBjb25zdCBwcm9ncmVzc0JhckZ1bGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjdW5pdHktcHJvZ3Jlc3MtYmFyLWZ1bGwiKTsNCiAgICAgICAgcHJvZ3Jlc3NCYXJGdWxsLnN0eWxlLndpZHRoID0gYCR7dG90YWxQcm9ncmVzcyAqIDEwMH0lYDsNCiAgICB9DQoNCiAgICBhc3luYyBmdW5jdGlvbiBtZXJnZVVuaXR5V2ViRmlsZXNXaXRoUHJvZ3Jlc3MoYmFzZVVybCwgZmlsZVByZWZpeCwgdG90YWxQYXJ0cywgZXh0ZW5zaW9uKSB7DQogICAgICAgIGNvbnN0IHBhcnRVcmxzID0gW107DQogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHRvdGFsUGFydHM7IGkrKykgew0KICAgICAgICAgICAgcGFydFVybHMucHVzaChgJHtiYXNlVXJsfS8ke2ZpbGVQcmVmaXh9JHtpfS4ke2V4dGVuc2lvbn1gKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnN0IGJ1ZmZlcnMgPSBbXTsNCiAgICAgICAgbGV0IHRvdGFsRG93bmxvYWRlZCA9IDA7DQogICAgICAgIGxldCB0b3RhbFNpemUgPSAwOw0KDQogICAgICAgIC8vINCS0YvRh9C40YHQu9GP0LXQvCDQvtCx0YnQuNC5INGA0LDQt9C80LXRgCDRhNCw0LnQu9C+0LINCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3RhbFBhcnRzOyBpKyspIHsNCiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2gocGFydFVybHNbaV0sIHsgbWV0aG9kOiAiSEVBRCIgfSk7DQogICAgICAgICAgICBjb25zdCBjb250ZW50TGVuZ3RoID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoIkNvbnRlbnQtTGVuZ3RoIik7DQogICAgICAgICAgICBpZiAoY29udGVudExlbmd0aCkgew0KICAgICAgICAgICAgICAgIHRvdGFsU2l6ZSArPSBwYXJzZUludChjb250ZW50TGVuZ3RoLCAxMCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRvdGFsUGFydHM7IGkrKykgew0KICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChwYXJ0VXJsc1tpXSk7DQogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFN0cmVhbWluZyBub3Qgc3VwcG9ydGVkIGZvciBmaWxlOiAke3BhcnRVcmxzW2ldfWApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjb25zdCByZWFkZXIgPSByZXNwb25zZS5ib2R5LmdldFJlYWRlcigpOw0KICAgICAgICAgICAgY29uc3QgcGFydEJ1ZmZlciA9IFtdOw0KDQogICAgICAgICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHsgZG9uZSwgdmFsdWUgfSA9IGF3YWl0IHJlYWRlci5yZWFkKCk7DQogICAgICAgICAgICAgICAgaWYgKGRvbmUpIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgcGFydEJ1ZmZlci5wdXNoKHZhbHVlKTsNCiAgICAgICAgICAgICAgICB0b3RhbERvd25sb2FkZWQgKz0gdmFsdWUubGVuZ3RoOw0KDQogICAgICAgICAgICAgICAgZ2FtZVN0YXRlLmxvYWRpbmdQcm9ncmVzcy5kYXRhRmlsZXNQcm9ncmVzcyA9IHRvdGFsRG93bmxvYWRlZCAvIHRvdGFsU2l6ZTsNCiAgICAgICAgICAgICAgICB1cGRhdGVUb3RhbFByb2dyZXNzKCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGJ1ZmZlcnMucHVzaChuZXcgVWludDhBcnJheShwYXJ0QnVmZmVyLnJlZHVjZSgoYWNjLCBjaHVuaykgPT4gYWNjICsgY2h1bmsubGVuZ3RoLCAwKSkpOw0KICAgICAgICAgICAgbGV0IG9mZnNldCA9IDA7DQogICAgICAgICAgICBmb3IgKGNvbnN0IGNodW5rIG9mIHBhcnRCdWZmZXIpIHsNCiAgICAgICAgICAgICAgICBidWZmZXJzW2ldLnNldChjaHVuaywgb2Zmc2V0KTsNCiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gY2h1bmsubGVuZ3RoOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgY29uc3QgdG90YWxMZW5ndGggPSBidWZmZXJzLnJlZHVjZSgoYWNjLCBidWZmZXIpID0+IGFjYyArIGJ1ZmZlci5ieXRlTGVuZ3RoLCAwKTsNCiAgICAgICAgY29uc3QgY29tYmluZWRCdWZmZXIgPSBuZXcgVWludDhBcnJheSh0b3RhbExlbmd0aCk7DQogICAgICAgIGxldCBvZmZzZXQgPSAwOw0KDQogICAgICAgIGJ1ZmZlcnMuZm9yRWFjaCgoYnVmZmVyKSA9PiB7DQogICAgICAgICAgICBjb21iaW5lZEJ1ZmZlci5zZXQobmV3IFVpbnQ4QXJyYXkoYnVmZmVyKSwgb2Zmc2V0KTsNCiAgICAgICAgICAgIG9mZnNldCArPSBidWZmZXIuYnl0ZUxlbmd0aDsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgcmV0dXJuIGNvbWJpbmVkQnVmZmVyOw0KICAgIH0NCg0KICAgIGNvbnN0IGhpZGVGdWxsU2NyZWVuQnV0dG9uID0gIiI7DQogICAgY29uc3QgYnVpbGRVcmwgPSAiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2Jhdmxpbi1zYW43OTkwL3JlYWN0QGEyZjAzNWI1MTliOTlkYmMyYzY5ZjE3NGNmOTc4OGI1NmNiMzZjMzIvc3JjIjsNCiAgICBjb25zdCBsb2FkZXJVcmwgPSAiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2xpbmtkMS9nQGUwNzllNDc0NjQ3ZWExMTM5NjhjZGMxNDBjYTk3MzgwYmU2NDA5YWYvQkFOS1JPQkJFUlkyL0J1aWxkL0JhbmtSb2JiZXJ5Mi5sb2FkZXIuanMiOw0KDQogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3VuaXR5LWNvbnRhaW5lciIpOw0KICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1jYW52YXMiKTsNCiAgICBjb25zdCBsb2FkaW5nQ292ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjbG9hZGluZy1jb3ZlciIpOw0KICAgIGNvbnN0IHByb2dyZXNzQmFyRW1wdHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjdW5pdHktcHJvZ3Jlc3MtYmFyLWVtcHR5Iik7DQogICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zcGlubmVyJyk7DQoNCiAgICBjb25zdCBjYW5GdWxsc2NyZWVuID0gKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgWw0KICAgICAgICAgICAgJ2V4aXRGdWxsc2NyZWVuJywNCiAgICAgICAgICAgICd3ZWJraXRFeGl0RnVsbHNjcmVlbicsDQogICAgICAgICAgICAnd2Via2l0Q2FuY2VsRnVsbFNjcmVlbicsDQogICAgICAgICAgICAnbW96Q2FuY2VsRnVsbFNjcmVlbicsDQogICAgICAgICAgICAnbXNFeGl0RnVsbHNjcmVlbicsDQogICAgICAgIF0pIHsNCiAgICAgICAgICAgIGlmIChrZXkgaW4gZG9jdW1lbnQpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfSgpKTsNCg0KICAgIGlmICgvaVBob25lfGlQYWR8aVBvZHxBbmRyb2lkL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgew0KICAgICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gInVuaXR5LW1vYmlsZSI7DQogICAgfQ0KDQogICAgbG9hZGluZ0NvdmVyLnN0eWxlLmRpc3BsYXkgPSAiIjsNCiAgICBwcm9ncmVzc0JhckVtcHR5LnN0eWxlLmRpc3BsYXkgPSAiIjsNCg0KICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaHN0YXJ0IiwgKCkgPT4geyB3aW5kb3cuZm9jdXMoKSB9KTsNCiAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCAoKSA9PiB7IHdpbmRvdy5mb2N1cygpIH0pOw0KDQogICAgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUdhbWUoKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCBkYXRhQnVmZmVyID0gYXdhaXQgbWVyZ2VVbml0eVdlYkZpbGVzV2l0aFByb2dyZXNzKGJ1aWxkVXJsLCAiYnIiLCAyLCAiZGF0YS5qcyIpOw0KICAgICAgICAgICAgY29uc3QgZGF0YUJsb2JVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtkYXRhQnVmZmVyXSwgeyB0eXBlOiAiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIiB9KSk7DQoNCiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IHsNCiAgICAgICAgICAgICAgICBkYXRhVXJsOiBkYXRhQmxvYlVybCwNCiAgICAgICAgICAgICAgICBmcmFtZXdvcmtVcmw6ICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvbGlua2QxL2dAZTA3OWU0NzQ2NDdlYTExMzk2OGNkYzE0MGNhOTczODBiZTY0MDlhZi9CQU5LUk9CQkVSWTIvQnVpbGQvQmFua1JvYmJlcnkyLmZyYW1ld29yay5qcy51bml0eXdlYiIsDQogICAgICAgICAgICAgICAgY29kZVVybDogImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9saW5rZDEvZ0BlMDc5ZTQ3NDY0N2VhMTEzOTY4Y2RjMTQwY2E5NzM4MGJlNjQwOWFmL0JBTktST0JCRVJZMi9CdWlsZC9CYW5rUm9iYmVyeTIud2FzbS51bml0eXdlYiIsDQogICAgICAgICAgICAgICAgc3RyZWFtaW5nQXNzZXRzVXJsOiAiU3RyZWFtaW5nQXNzZXRzIiwNCiAgICAgICAgICAgICAgICBjb21wYW55TmFtZTogIkp1c3RBbGllbiIsDQogICAgICAgICAgICAgICAgcHJvZHVjdE5hbWU6ICJCYW5rUm9iYmVyeTIiLA0KICAgICAgICAgICAgICAgIHByb2R1Y3RWZXJzaW9uOiAiMS4wIiwNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOw0KICAgICAgICAgICAgc2NyaXB0LnNyYyA9IGxvYWRlclVybDsNCiAgICAgICAgICAgIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgY3JlYXRlVW5pdHlJbnN0YW5jZShjYW52YXMsIGNvbmZpZywgKHByb2dyZXNzKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIC8vINCe0LHQvdC+0LLQu9GP0LXQvCDQv9GA0L7Qs9GA0LXRgdGBINC30LDQs9GA0YPQt9C60LggVW5pdHkNCiAgICAgICAgICAgICAgICAgICAgZ2FtZVN0YXRlLmxvYWRpbmdQcm9ncmVzcy51bml0eVByb2dyZXNzID0gcHJvZ3Jlc3M7DQogICAgICAgICAgICAgICAgICAgIHVwZGF0ZVRvdGFsUHJvZ3Jlc3MoKTsNCiAgICAgICAgICAgICAgICB9KS50aGVuKCh1bml0eUluc3RhbmNlKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGdhbWVTdGF0ZS5pbnN0YW5jZSA9IHVuaXR5SW5zdGFuY2U7DQogICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlID0gdW5pdHlJbnN0YW5jZTsNCiAgICAgICAgICAgICAgICAgICAgZ2FtZVN0YXRlLmlzSW5pdGlhbGl6ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBsb2FkaW5nQ292ZXIuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICAgICAgICAgICAgICB9KS5jYXRjaCgobWVzc2FnZSkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJVbml0eSBpbml0aWFsaXphdGlvbiBlcnJvcjoiLCBtZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgYWxlcnQobWVzc2FnZSk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcigiR2FtZSBpbml0aWFsaXphdGlvbiBmYWlsZWQ6IiwgZXJyb3IpOw0KICAgICAgICAgICAgYWxlcnQoIkZhaWxlZCB0byBpbml0aWFsaXplIGdhbWU6ICIgKyBlcnJvci5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHdhaXRGb3JHYW1lSW5pdGlhbGl6YXRpb24oKSB7DQogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gew0KICAgICAgICAgICAgY29uc3QgY2hlY2tJbml0aWFsaXphdGlvbiA9ICgpID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoZ2FtZVN0YXRlLmlzSW5pdGlhbGl6ZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoY2hlY2tJbml0aWFsaXphdGlvbiwgMTAwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgY2hlY2tJbml0aWFsaXphdGlvbigpOw0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICBhc3luYyBmdW5jdGlvbiBJbml0U0RLKHBob3RvU2l6ZSwgc2NvcGVzKSB7DQogICAgICAgIGF3YWl0IHdhaXRGb3JHYW1lSW5pdGlhbGl6YXRpb24oKTsNCiAgICAgICAgDQogICAgICAgIGNvbnNvbGUubG9nKCdJbml0IEdBTUUnKTsNCiAgICAgICAgZ2FtZVN0YXRlLmluaXRHYW1lID0gdHJ1ZTsNCiAgICAgICAgZ2FtZVN0YXRlLnBob3RvU2l6ZUZvckluaXQgPSBwaG90b1NpemU7DQogICAgICAgIGdhbWVTdGF0ZS5zY29wZXNGb3JJbml0ID0gc2NvcGVzOw0KDQogICAgICAgIGlmIChnYW1lU3RhdGUuaW5pdFNESyA9PSB0cnVlKSB7DQogICAgICAgICAgICB5c2RrLmZlYXR1cmVzLkxvYWRpbmdBUEk/LnJlYWR5KCk7DQogICAgICAgICAgICBJbml0UGxheWVyKHBob3RvU2l6ZSwgc2NvcGVzKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIE5vdEF1dGhvcml6ZWQoKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnQXV0aG9yaXplZCBmYWlsZWQnKTsNCiAgICAgICAgICAgIGxldCBhdXRoSnNvbiA9IHsNCiAgICAgICAgICAgICAgICAicGxheWVyQXV0aCI6ICJyZWplY3RlZCIsDQogICAgICAgICAgICAgICAgInBsYXllck5hbWUiOiAidW5hdXRob3JpemVkIiwNCiAgICAgICAgICAgICAgICAicGxheWVySWQiOiAidW5hdXRob3JpemVkIiwNCiAgICAgICAgICAgICAgICAicGxheWVyUGhvdG8iOiAibnVsbCINCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBnYW1lU3RhdGUuaW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0SW5pdGlhbGl6YXRpb25TREsnLCBKU09OLnN0cmluZ2lmeShhdXRoSnNvbikpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBOb3QgQXV0aG9yaXplZDogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpbml0aWFsaXplR2FtZSgpLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgY29uc29sZS5lcnJvcigiRmFpbGVkIHRvIHN0YXJ0IGdhbWU6IiwgZXJyb3IpOw0KICAgIH0pOw0KICAgIGZ1bmN0aW9uIEluaXRQbGF5ZXIocGhvdG9TaXplLCBfc2NvcGVzKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXR1cm4geXNkay5nZXRQbGF5ZXIoe3Njb3BlczogX3Njb3Blc30pLnRoZW4oX3BsYXllciA9PiB7DQoNCiAgICAgICAgICAgICAgICBwbGF5ZXIgPSBfcGxheWVyOw0KDQogICAgICAgICAgICAgICAgbGV0IHBsYXllck5hbWUgPSBwbGF5ZXIuZ2V0TmFtZSgpOw0KICAgICAgICAgICAgICAgIGxldCBwbGF5ZXJQaG90byA9IHBsYXllci5nZXRQaG90byhwaG90b1NpemUpOw0KDQogICAgICAgICAgICAgICAgaWYgKCFfc2NvcGVzKSB7DQogICAgICAgICAgICAgICAgICAgIHBsYXllck5hbWUgPSAiYW5vbnltb3VzIjsNCiAgICAgICAgICAgICAgICAgICAgcGxheWVyUGhvdG8gPSAibnVsbCI7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKHBsYXllci5nZXRNb2RlKCkgPT09ICdsaXRlJykgew0KDQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdOb3QgQXV0aG9yaXplZCcpOw0KICAgICAgICAgICAgICAgICAgICBOb3RBdXRob3JpemVkKCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGF1dGhKc29uID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgInBsYXllckF1dGgiOiAicmVzb2x2ZWQiLA0KICAgICAgICAgICAgICAgICAgICAgICAgInBsYXllck5hbWUiOiBwbGF5ZXJOYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgInBsYXllcklkIjogcGxheWVyLmdldFVuaXF1ZUlEKCksDQogICAgICAgICAgICAgICAgICAgICAgICAicGxheWVyUGhvdG8iOiBwbGF5ZXJQaG90bw0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRJbml0aWFsaXphdGlvblNESycsIEpTT04uc3RyaW5naWZ5KGF1dGhKc29uKSk7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mb2N1cygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0F1dGhvcml6ZWQgZXJyOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIE5vdEF1dGhvcml6ZWQoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBpbml0IFBsYXllcjogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIHdpbmRvdy5mb2N1cygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gT3BlbkF1dGhEaWFsb2cocGhvdG9TaXplLCBzY29wZXMpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHlzZGsuYXV0aC5vcGVuQXV0aERpYWxvZygpLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgIEluaXRQbGF5ZXIocGhvdG9TaXplLCBzY29wZXMpOw0KICAgICAgICAgICAgfSkuY2F0Y2goKCkgPT4gew0KICAgICAgICAgICAgICAgIEluaXRTREsocGhvdG9TaXplLCBzY29wZXMpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDUkFTSCBPcGVuIEF1dGggRGlhbG9nOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gRnVsbEFkU2hvdygpIHsNCiAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgZnVuY3Rpb24gUmV3YXJkZWRTaG93KGlkKSB7DQogICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXdhcmQgVmlkZW8gQWQuIElkOiAnICsgaWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1Jld2FyZFZpZGVvJywgaWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgfQ0KDQogICAgZnVuY3Rpb24gU3RpY2t5QWRBY3Rpdml0eShzaG93KSB7DQogICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgeXNkay5hZHYuaGlkZUJhbm5lckFkdigpOw0KICAgICAgICAgICAgICAgICAgDQogICAgfQ0KDQogICAgZnVuY3Rpb24gSW5pdFBheW1lbnRzKCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgeXNkay5nZXRQYXltZW50cygpLnRoZW4oX3BheW1lbnRzID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHVyY2hhc2VzIGFyZSBhdmFpbGFibGUnKTsNCiAgICAgICAgICAgICAgICBwYXltZW50cyA9IF9wYXltZW50czsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHVyY2hhc2VzIGFyZSBub3QgYXZhaWxhYmxlJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIH0pDQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEluaXQgUGF5bWVudHM6ICcsIGUubWVzc2FnZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBCdXlQYXltZW50cyhpZCkgew0KICAgIA0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHVyY2hhc2UgU3VjY2VzcycpOw0KICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdPblB1cmNoYXNlU3VjY2VzcycsIGlkKTsNCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZvY3VzKCk7DQogICAgICAgIA0KICAgIH0NCiAgICANCiAgICBmdW5jdGlvbiBHZXRQYXltZW50cygpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChwYXltZW50cyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgcGF5bWVudHMuZ2V0Q2F0YWxvZygpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKHByb2R1Y3RzID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcm9kdWN0SUQgPSBbcHJvZHVjdHMubGVuZ3RoXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0aXRsZSA9IFtwcm9kdWN0cy5sZW5ndGhdOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRlc2NyaXB0aW9uID0gW3Byb2R1Y3RzLmxlbmd0aF07DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW1hZ2VVUkkgPSBbcHJvZHVjdHMubGVuZ3RoXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcmljZVZhbHVlID0gW3Byb2R1Y3RzLmxlbmd0aF07DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHVyY2hhc2VkID0gW3Byb2R1Y3RzLmxlbmd0aF07DQogICAgDQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcHJvZHVjdHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0SURbaV0gPSBwcm9kdWN0c1tpXS5pZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZVtpXSA9IHByb2R1Y3RzW2ldLnRpdGxlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uW2ldID0gcHJvZHVjdHNbaV0uZGVzY3JpcHRpb247DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VVUklbaV0gPSBwcm9kdWN0c1tpXS5pbWFnZVVSSTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZVZhbHVlW2ldID0gcHJvZHVjdHNbaV0ucHJpY2VWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZWRbaV0gPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudHMuZ2V0UHVyY2hhc2VzKCkudGhlbihwdXJjaGFzZXMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaTEgPSAwOyBpMSA8IHByb2R1Y3RzLmxlbmd0aDsgaTErKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkyID0gMDsgaTIgPCBwdXJjaGFzZXMubGVuZ3RoOyBpMisrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvZHVjdHNbaTFdLmlkID09PSBwdXJjaGFzZXNbaTJdLnByb2R1Y3RJRCl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVyY2hhc2VkW2kxXSsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqc29uUGF5bWVudHMgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaWQiOiBwcm9kdWN0SUQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidGl0bGUiOiB0aXRsZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6IGRlc2NyaXB0aW9uLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImltYWdlVVJJIjogaW1hZ2VVUkksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicHJpY2VWYWx1ZSI6IHByaWNlVmFsdWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicHVyY2hhc2VkIjogcHVyY2hhc2VkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1BheW1lbnRzRW50cmllcycsIEpTT04uc3RyaW5naWZ5KGpzb25QYXltZW50cykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnR2V0IFBheW1lbnRzOiBwYXltZW50cyA9PSBudWxsJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEdldCBQYXltZW50czogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIERlbGV0ZVB1cmNoYXNlKGlkKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAocGF5bWVudHMgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHBheW1lbnRzLmdldFB1cmNoYXNlcygpLnRoZW4ocHVyY2hhc2VzID0+IHsNCiAgICAgICAgICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgcHVyY2hhc2VzLmxlbmd0aDsgaSsrKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwdXJjaGFzZXNbaV0ucHJvZHVjdElEID09PSBpZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50cy5jb25zdW1lUHVyY2hhc2UocHVyY2hhc2VzW2ldLnB1cmNoYXNlVG9rZW4pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGNvbnNvbGUubG9nKCdEZWxldGUgUHVyY2hhc2U6IHBheW1lbnRzID09IG51bGwnKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggRGVsZXRlIFB1cmNoYXNlOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gRGVsZXRlQWxsUHVyY2hhc2VzKCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKHBheW1lbnRzICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBwYXltZW50cy5nZXRQdXJjaGFzZXMoKS50aGVuKHB1cmNoYXNlcyA9PiB7DQogICAgICAgICAgICAgICAgICAgIGZvcihpID0gMDsgaSA8IHB1cmNoYXNlcy5sZW5ndGg7IGkrKyl7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50cy5jb25zdW1lUHVyY2hhc2UocHVyY2hhc2VzW2ldLnB1cmNoYXNlVG9rZW4pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGNvbnNvbGUubG9nKCdEZWxldGUgQWxsIFB1cmNoYXNlczogcGF5bWVudHMgPT0gbnVsbCcpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBEZWxldGUgQWxsIFB1cmNoYXNlczogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIFNhdmVDbG91ZChqc29uRGF0YSwgZmx1c2gpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHBsYXllci5zZXREYXRhKHsNCiAgICAgICAgICAgICAgICBzYXZlczogW2pzb25EYXRhXSwNCiAgICAgICAgICAgIH0sIGZsdXNoKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggU2F2ZSBDbG91ZDogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIExvYWRDbG91ZCgpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHBsYXllci5nZXREYXRhKFsic2F2ZXMiXSkudGhlbihkYXRhID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zYXZlcykgew0KICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRMb2FkU2F2ZXMnLCBKU09OLnN0cmluZ2lmeShkYXRhLnNhdmVzKSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0TG9hZFNhdmVzJywgIm5vRGF0YSIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdnZXREYXRhIEVycm9yIScpOw0KICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1NldExvYWRTYXZlcycsICJub0RhdGEiKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBMb2FkIHNhdmVzIENsb3VkOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0TG9hZFNhdmVzJywgIm5vRGF0YSIpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gSW5pdExlYWRlcmJvYXJkKCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgeXNkay5nZXRMZWFkZXJib2FyZHMoKS50aGVuKF9sYiA9PiB7DQogICAgICAgICAgICAgICAgbGVhZGVyYm9hcmQgPSBfbGINCiAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdJbml0aWFsaXplZExCJyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggSW5pdCBMZWFkZXJib2FyZDogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIFNldExlYWRlcmJvYXJkU2NvcmVzKF9uYW1lLCBzY29yZSkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgeXNkay5nZXRMZWFkZXJib2FyZHMoKQ0KICAgICAgICAgICAgICAgIC50aGVuKGxlYWRlcmJvYXJkID0+IHsNCiAgICAgICAgICAgICAgICAgICAgbGVhZGVyYm9hcmQuc2V0TGVhZGVyYm9hcmRTY29yZShfbmFtZSwgc2NvcmUpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBTZXQgTGVhZGVyIGJvYXJkIFNjb3JlczogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEdldExlYWRlcmJvYXJkU2NvcmVzKG5hbWVMQiwgbWF4UGxheWVycywgcXVhbnRpdHlUb3AsIHF1YW50aXR5QXJvdW5kLCBwaG90b1NpemUsIGF1dGgpIHsNCiAgICAgICAgaWYgKGF1dGgpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgeXNkay5nZXRMZWFkZXJib2FyZHMoKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbihsZWFkZXJib2FyZCA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBsZWFkZXJib2FyZC5nZXRMZWFkZXJib2FyZEVudHJpZXMoJycgKyBuYW1lTEIsIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWFudGl0eVRvcDogcXVhbnRpdHlUb3AsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZVVzZXI6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHlBcm91bmQ6IHF1YW50aXR5QXJvdW5kDQogICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVudHJpZXNMQihyZXMsIG5hbWVMQiwgbWF4UGxheWVycywgcGhvdG9TaXplKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggR2V0IExlYWRlcmJvYXJkIFNjb3JlczogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgeXNkay5nZXRMZWFkZXJib2FyZHMoKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbihsZWFkZXJib2FyZCA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBsZWFkZXJib2FyZC5nZXRMZWFkZXJib2FyZEVudHJpZXMoJycgKyBuYW1lTEIsIHtxdWFudGl0eVRvcDogcXVhbnRpdHlUb3B9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVudHJpZXNMQihyZXMsIG5hbWVMQiwgbWF4UGxheWVycywgcGhvdG9TaXplKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggR2V0IExlYWRlcmJvYXJkIFNjb3JlczogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEVudHJpZXNMQihyZXMsIG5hbWVMQiwgbWF4UGxheWVycywgcGhvdG9TaXplKSB7DQogICAgICAgIGxldCBMZWFkZXJib2FyZEVudHJpZXNUZXh0ID0gJyc7DQoNCiAgICAgICAgbGV0IHBsYXllcnNDb3VudDsNCiAgICAgICAgaWYgKHJlcy5lbnRyaWVzLmxlbmd0aCA8IG1heFBsYXllcnMpIHsNCiAgICAgICAgICAgIHBsYXllcnNDb3VudCA9IHJlcy5lbnRyaWVzLmxlbmd0aDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHBsYXllcnNDb3VudCA9IG1heFBsYXllcnM7DQogICAgICAgIH0NCg0KICAgICAgICBsZXQgcmFuayA9IFttYXhQbGF5ZXJzXTsNCiAgICAgICAgbGV0IHBob3RvID0gW21heFBsYXllcnNdOw0KICAgICAgICBsZXQgcGxheWVyc05hbWUgPSBbbWF4UGxheWVyc107DQogICAgICAgIGxldCBzY29yZVBsYXllcnMgPSBbbWF4UGxheWVyc107DQoNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBsYXllcnNDb3VudDsgaSsrKSB7DQogICAgICAgICAgICByYW5rW2ldID0gcmVzLmVudHJpZXNbaV0ucmFuazsNCiAgICAgICAgICAgIHNjb3JlUGxheWVyc1tpXSA9IHJlcy5lbnRyaWVzW2ldLnNjb3JlOw0KDQogICAgICAgICAgICBpZiAocGhvdG9TaXplID09PSAnbm9uZVBob3RvJyB8fCByZXMuZW50cmllc1tpXS5wbGF5ZXIuc2NvcGVQZXJtaXNzaW9ucy5hdmF0YXIgIT09ICJhbGxvdyIpIHsNCiAgICAgICAgICAgICAgICBwaG90b1tpXSA9ICdub25lUGhvdG8nOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBwaG90b1tpXSA9IHJlcy5lbnRyaWVzW2ldLnBsYXllci5nZXRBdmF0YXJTcmMocGhvdG9TaXplKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHJlcy5lbnRyaWVzW2ldLnBsYXllci5zY29wZVBlcm1pc3Npb25zLnB1YmxpY19uYW1lICE9PSAiYWxsb3ciKSB7DQogICAgICAgICAgICAgICAgcGxheWVyc05hbWVbaV0gPSAiYW5vbnltb3VzIjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcGxheWVyc05hbWVbaV0gPSByZXMuZW50cmllc1tpXS5wbGF5ZXIucHVibGljTmFtZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgTGVhZGVyYm9hcmRFbnRyaWVzVGV4dCArPSByYW5rW2ldICsgJy4gJyArIHBsYXllcnNOYW1lW2ldICsgIjogIiArIHNjb3JlUGxheWVyc1tpXSArICdcbic7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAocGxheWVyc0NvdW50ID09PSAwKSB7DQogICAgICAgICAgICBMZWFkZXJib2FyZEVudHJpZXNUZXh0ID0gJ05vIGRhdGEnOw0KICAgICAgICB9DQoNCiAgICAgICAgbGV0IGpzb25MQiA9IHsNCiAgICAgICAgICAgICJuYW1lTEIiOiBuYW1lTEIsDQogICAgICAgICAgICAiZW50cmllcyI6IExlYWRlcmJvYXJkRW50cmllc1RleHQsDQogICAgICAgICAgICAicmFuayI6IHJhbmssDQogICAgICAgICAgICAicGhvdG8iOiBwaG90bywNCiAgICAgICAgICAgICJwbGF5ZXJzTmFtZSI6IHBsYXllcnNOYW1lLA0KICAgICAgICAgICAgInNjb3JlUGxheWVycyI6IHNjb3JlUGxheWVycw0KICAgICAgICB9Ow0KICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdMZWFkZXJib2FyZEVudHJpZXMnLCBKU09OLnN0cmluZ2lmeShqc29uTEIpKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBMYW5ndWFnZVJlcXVlc3QoKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRMYW5ndWFnZScsIHlzZGsuZW52aXJvbm1lbnQuaTE4bi5sYW5nKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggTGFuZ3VhZ2UgUmVxdWVzdDogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIFJlcXVlc3RpbmdFbnZpcm9ubWVudERhdGEoKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBsZXQganNvbkVudmlyID0gew0KICAgICAgICAgICAgICAgICJsYW5ndWFnZSI6IHlzZGsuZW52aXJvbm1lbnQuaTE4bi5sYW5nLA0KICAgICAgICAgICAgICAgICJkb21haW4iOiB5c2RrLmVudmlyb25tZW50LmkxOG4udGxkLA0KICAgICAgICAgICAgICAgICJkZXZpY2VUeXBlIjogeXNkay5kZXZpY2VJbmZvLnR5cGUsDQogICAgICAgICAgICAgICAgImlzTW9iaWxlIjogeXNkay5kZXZpY2VJbmZvLmlzTW9iaWxlKCksDQogICAgICAgICAgICAgICAgImlzRGVza3RvcCI6IHlzZGsuZGV2aWNlSW5mby5pc0Rlc2t0b3AoKSwNCiAgICAgICAgICAgICAgICAiaXNUYWJsZXQiOiB5c2RrLmRldmljZUluZm8uaXNUYWJsZXQoKSwNCiAgICAgICAgICAgICAgICAiaXNUViI6IHlzZGsuZGV2aWNlSW5mby5pc1RWKCksDQogICAgICAgICAgICAgICAgImFwcElEIjogeXNkay5lbnZpcm9ubWVudC5hcHAuaWQsDQogICAgICAgICAgICAgICAgImJyb3dzZXJMYW5nIjogeXNkay5lbnZpcm9ubWVudC5icm93c2VyLmxhbmcsDQogICAgICAgICAgICAgICAgInBheWxvYWQiOiB5c2RrLmVudmlyb25tZW50LnBheWxvYWQsDQogICAgICAgICAgICAgICAgInByb21wdENhblNob3ciOiBwcm9tcHRDYW5TaG93LA0KICAgICAgICAgICAgICAgICJyZXZpZXdDYW5TaG93IjogcmV2aWV3Q2FuU2hvdw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1NldEVudmlyb25tZW50RGF0YScsIEpTT04uc3RyaW5naWZ5KGpzb25FbnZpcikpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBSZXF1ZXN0aW5nIEVudmlyb25tZW50IERhdGE6ICcsIGUubWVzc2FnZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBSZXZpZXcoKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICB5c2RrLmZlZWRiYWNrLmNhblJldmlldygpDQogICAgICAgICAgICAgICAgLnRoZW4oKHsgdmFsdWUsIHJlYXNvbiB9KSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgeXNkay5mZWVkYmFjay5yZXF1ZXN0UmV2aWV3KCkudGhlbigoe2ZlZWRiYWNrU2VudH0pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZmVlZGJhY2tTZW50ICcsIGZlZWRiYWNrU2VudCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZlZWRiYWNrU2VudCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnUmV2aWV3U2VudCcsICd0cnVlJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdSZXZpZXdTZW50JywgJ2ZhbHNlJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmZvY3VzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Jldmlld0NhblNob3cgPSBmYWxzZScsIHJlYXNvbikNCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mb2N1cygpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggUmV2aWV3OiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgd2luZG93LmZvY3VzKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBQcm9tcHRTaG93KCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgeXNkay5zaG9ydGN1dC5zaG93UHJvbXB0KCkNCiAgICAgICAgICAgICAgICAudGhlbihyZXN1bHQgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU2hvcnRjdXQgY3JlYXRlZD86JywgcmVzdWx0KTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5vdXRjb21lID09PSAnYWNjZXB0ZWQnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJvbXB0IFN1Y2Nlc3MnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ09uUHJvbXB0U3VjY2VzcycpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnT25Qcm9tcHRGYWlsJyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZvY3VzKCk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFByb21wdCBTaG93OiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgd2luZG93LmZvY3VzKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBQYWludFJCVChyYnQpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJidCkuc3R5bGUuYmFja2dyb3VuZCA9ICcjZmYwMDAwJzsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggUGFpbnQgUkJUOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gU3RhdGljUkJURGVhY3RpdmF0ZSgpIHsNCiAgICB9DQoNCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7DQo8L3NjcmlwdD4NCg0KDQo8L2JvZHk+PC9odG1sPg0KPC9zY3JpcHQ+PGxpbmsgaHJlZj0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2xpbmtkMS9nQGUwNzllNDc0NjQ3ZWExMTM5NjhjZGMxNDBjYTk3MzgwYmU2NDA5YWYvQkFOS1JPQkJFUlkyL1RlbXBsYXRlRGF0YS9zdHlsZS5jc3MiIHJlbD0ic3R5bGVzaGVldCI+DQogICAgPG1ldGEgY2hhcnNldD0idXRmLTgiPg0KICAgIDxtZXRhIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD11dGYtOCIgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIj4NCiAgICA8bWV0YSBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCB1c2VyLXNjYWxhYmxlPW5vIiBuYW1lPSJ2aWV3cG9ydCI+DQoJPHRpdGxlPjwvdGl0bGU+DQoNCiAgICANCjxzY3JpcHQ+DQovKiBtcC1zdGFydCAqLw0KDQp2YXIgX3BhcmFtcyA9IGdhZGdldHMudXRpbC5nZXRVcmxQYXJhbWV0ZXJzKCk7DQppZiAoX3BhcmFtc1snZXhwX3JwY19qcyddICE9IDEpIHsNCiAgdmFyIHVybCA9IF9wYXJhbXNbJ3BhcmVudCddICsgJy9pZy9pZnBjX3JlbGF5JzsNCiAgZ2FkZ2V0cy5ycGMuc2V0UmVsYXlVcmwoJy4uJywgdXJsLCB0cnVlKTsNCn0NCi8qIG1wLWVuZCAqLw0KPC9zY3JpcHQ+PHN0eWxlIHR5cGU9InRleHQvY3NzIiBpZD0ib3BlcmFVc2VyU3R5bGUiPg==";
