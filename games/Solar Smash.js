window.game = "PCFET0NUWVBFIGh0bWw+DQoNCg0KPCEtLSBVbHRpbWF0ZSBHYW1lIFN0YXNoIGZpbGUtLT4gDQo8IS0tIEZvciB0aGUgcmVndWxhcmx5IHVwZGF0aW5nIGRvYyBnbyB0byBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFfRm1IM0JsU0JRSTdGR2dBUUw1OS1aUGU4ZUN4czM1d2VsNkpVeVZhRzhRLyAtLT4NCg0KDQoNCjxodG1sIGxhbmc9ImVuLXVzIj4NCg0KPGhlYWQ+DQogIDxiYXNlIGhyZWY9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9idWJibHMveW91dHViZS1wbGF5YWJsZXNAYTJlNGJiNjg5NTVmMjY2NWQxNjY2OWJiYmY3YmUzMTIzODcwYzJlMC9zb2xhci1zbWFzaC8iPg0KICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogIDxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ij4NCiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPg0KICA8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9ImllPWVkZ2UiPg0KDQogIDx0aXRsZT5ZVCBHYW1lIFdyYXBwZXIgV2ViR0wgVGVtcGxhdGU8L3RpdGxlPg0KICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9IlRlbXBsYXRlRGF0YS9zdHlsZS5jc3MiIG5vbmNlPSJ3ZThaUE1BYzEwc2piTWVBOGZfcFJ3Ij4NCiAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9idWJibHMveW91dHViZS1wbGF5YWJsZXNAbWFpbi95dGdhbWUuanMiIG5vbmNlPSJ3ZThaUE1BYzEwc2piTWVBOGZfcFJ3Ij4vLyBMb2FkIFlUIEdhbWUgQVBJIGNvZGU8L3NjcmlwdD4NCjwvaGVhZD4NCg0KPGJvZHk+DQogIDxkaXYgaWQ9InVuaXR5LWNvbnRhaW5lciIgY2xhc3M9InVuaXR5LWRlc2t0b3AiPg0KICAgIDxjYW52YXMgaWQ9InVuaXR5LWNhbnZhcyIgd2lkdGg9MTAwJSBoZWlnaHQ9MTAwJSB0YWJpbmRleD0iLTEiPjwvY2FudmFzPg0KICAgIDxkaXYgaWQ9InVuaXR5LWxvYWRpbmctYmFyIj4NCiAgICAgIDxkaXYgaWQ9InVuaXR5LWxvZ28iPjwvZGl2Pg0KICAgICAgPGRpdiBpZD0idW5pdHktcHJvZ3Jlc3MtYmFyLWVtcHR5Ij4NCiAgICAgICAgPGRpdiBpZD0idW5pdHktcHJvZ3Jlc3MtYmFyLWZ1bGwiPjwvZGl2Pg0KICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogICAgPGRpdiBpZD0idW5pdHktd2FybmluZyI+IDwvZGl2Pg0KICA8L2Rpdj4NCg0KPHNjcmlwdCBhc3luYz4NCiAgICBmdW5jdGlvbiBtZXJnZUZpbGVzKGZpbGVQYXJ0cykgew0KICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgbGV0IGJ1ZmZlcnMgPSBbXTsNCg0KICAgICAgICAgICAgZnVuY3Rpb24gZmV0Y2hQYXJ0KGluZGV4KSB7DQogICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IGZpbGVQYXJ0cy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG1lcmdlZEJsb2IgPSBuZXcgQmxvYihidWZmZXJzLCB7IHR5cGU6ICJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iIH0pOw0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG1lcmdlZEJsb2IpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGZldGNoKGZpbGVQYXJ0c1tpbmRleF0pDQogICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gcmVzcG9uc2UuYXJyYXlCdWZmZXIoKSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlcnMucHVzaChkYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoUGFydChpbmRleCArIDEpOw0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2gocmVqZWN0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZldGNoUGFydCgwKTsNCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0UGFydHMoZmlsZSwgc3RhcnQsIGVuZCkgew0KICAgICAgICBsZXQgcGFydHMgPSBbXTsNCiAgICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDw9IGVuZDsgaSsrKSB7DQogICAgICAgICAgICBwYXJ0cy5wdXNoKGZpbGUgKyAiLnBhcnQiICsgaSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHBhcnRzOw0KICAgIH0NCg0KICAgIFByb21pc2UuYWxsKFsNCiAgICAgICAgbWVyZ2VGaWxlcyhnZXRQYXJ0cygiU3RyZWFtaW5nQXNzZXRzL0Fzc2V0QnVuZGxlcy9XZWJHTC9wbGFuZXRzIiwgMSwgMikpLA0KICAgICAgICBtZXJnZUZpbGVzKGdldFBhcnRzKCJTdHJlYW1pbmdBc3NldHMvQXNzZXRCdW5kbGVzL1dlYkdML3BsYW5ldHMyIiwgMSwgMikpDQogICAgXSkudGhlbigoW3BsYW5ldHMxLCBwbGFuZXRzMl0pID0+IHsNCiAgICAgICAgY29uc3Qgb3JpZ2luYWxGZXRjaCA9IHdpbmRvdy5mZXRjaDsNCg0KICAgICAgICB3aW5kb3cuZmV0Y2ggPSBhc3luYyBmdW5jdGlvbiAoLi4uYXJncykgew0KICAgICAgICAgICAgY29uc3QgdXJsID0gYXJnc1swXTsNCg0KICAgICAgICAgICAgaWYgKHR5cGVvZiB1cmwgPT09ICJzdHJpbmciICYmIHVybC5pbmNsdWRlcygiU3RyZWFtaW5nQXNzZXRzL0Fzc2V0QnVuZGxlcy9XZWJHTC9wbGFuZXRzIikpIHsNCiAgICAgICAgICAgICAgICBpZiAodXJsLmluY2x1ZGVzKCJwbGFuZXRzMiIpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UocGxhbmV0czIsIHsgc3RhdHVzOiAyMDAgfSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1cmwuaW5jbHVkZXMoInBsYW5ldHMzIikpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsRmV0Y2guYXBwbHkodGhpcywgYXJncyk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShwbGFuZXRzMSwgeyBzdGF0dXM6IDIwMCB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbEZldGNoLmFwcGx5KHRoaXMsIGFyZ3MpOw0KICAgICAgICB9Ow0KICAgIH0pOw0KPC9zY3JpcHQ+DQoNCiAgPHNjcmlwdCBub25jZT0iVmRLNW5BR3BGS2Q5dnUySmF6U05hQSI+DQogICAgInVzZSBzdHJpY3QiOw0KY29uc3QgRElTVCA9IDEsDQogICAgRVhUID0gRElTVCA/ICIubWluLmpzIiA6ICIuanMiOw0KDQpmdW5jdGlvbiBsb2FkU2NyaXB0KGUsIHIpIHsNCiAgICByZXR1cm4gbG9hZFNjcmlwdEZyb21QYXRoKCJsaWIvIiArIHIgKyBFWFQpDQp9DQoNCmZ1bmN0aW9uIGxvYWRTY3JpcHRGcm9tUGF0aChhKSB7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyLCBlKSA9PiB7DQogICAgICAgIGlmICgib2JqZWN0IiA9PSB0eXBlb2Ygd2luZG93KSB7DQogICAgICAgICAgICBsZXQgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOw0KICAgICAgICAgICAgZS50eXBlID0gInRleHQvamF2YXNjcmlwdCIsIGUuc3JjID0gYSwgZS5vbmxvYWQgPSByLCBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGUpDQogICAgICAgIH0gZWxzZSAiZnVuY3Rpb24iID09IHR5cGVvZiBpbXBvcnRTY3JpcHRzID8gKGltcG9ydFNjcmlwdHMoYSksIHIoKSkgOiBlKCkNCiAgICB9KQ0KfQ0KDQpmdW5jdGlvbiBjdXJyZW50U2NyaXB0UGF0aCgpIHsNCiAgICB0cnkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpDQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBsZXQgciA9IGUuc3RhY2ssDQogICAgICAgICAgICBhID0gKC0xICE9PSByLmluZGV4T2YoIkAiKSA/IHIuc3BsaXQoIkAiKVsxXS5zcGxpdCgiXG4iKSA6IHIuc3BsaXQoIigiKVsxXS5zcGxpdCgiKSIpKVswXTsNCiAgICAgICAgcmV0dXJuIGEuc3Vic3RyaW5nKDAsIGEubGFzdEluZGV4T2YoIi8iKSkgKyAiLyINCiAgICB9DQp9DQpsZXQgdW5yYXJNZW1vcnlGaWxlTG9jYXRpb24gPSBudWxsLA0KICAgIGdfb25fbG9hZGVkX2NiID0gbnVsbCwNCiAgICB1bnJhclJlYWR5ID0gbmV3IFByb21pc2UoKGUsIHIpID0+IHsNCiAgICAgICAgZ19vbl9sb2FkZWRfY2IgPSBlDQogICAgfSk7DQpjbGFzcyBVbmFyY2hpdmVyIHsNCiAgICBzdGF0aWMgYXN5bmMgbG9hZChlID0gbnVsbCkgew0KICAgICAgICByZXR1cm4gZSA9IGUgfHwgWyJ6aXAiLCAicmFyIiwgInRhciIsICJneiIsICJ4eiIsICJiejIiXSwgUHJvbWlzZS5hbGwoZS5tYXAodGhpcy5fbG9hZEZvcm1hdCkpDQogICAgfQ0KICAgIHN0YXRpYyBhc3luYyBfbG9hZEZvcm1hdCh0KSB7DQogICAgICAgIGlmICghKHQgaW4gVW5hcmNoaXZlci5sb2FkZWRGb3JtYXRzKSkgew0KICAgICAgICAgICAgbGV0IGEgPSBjdXJyZW50U2NyaXB0UGF0aCgpOw0KICAgICAgICAgICAgcmV0dXJuIFVuYXJjaGl2ZXIubG9hZGVkRm9ybWF0c1t0XSA9IG5ldyBQcm9taXNlKGFzeW5jIChlLCByKSA9PiB7DQogICAgICAgICAgICAgICAgc3dpdGNoICh0KSB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgInppcCI6DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBsb2FkU2NyaXB0KGEsICJqc3ppcCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgInJhciI6DQogICAgICAgICAgICAgICAgICAgICAgICB1bnJhck1lbW9yeUZpbGVMb2NhdGlvbiA9IGEgKyAibGliL2xpYnVucmFyLmpzLm1lbSIsIGF3YWl0IGxvYWRTY3JpcHQoYSwgImxpYnVucmFyIiksIGF3YWl0IHVucmFyUmVhZHk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAidGFyIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGxvYWRTY3JpcHQoYSwgImxpYnVudGFyIik7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZ3oiOg0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbG9hZFNjcmlwdChhLCAicGFrb19pbmZsYXRlIik7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAieHoiOg0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbG9hZFNjcmlwdChhLCAieHoiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJiejIiOg0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbG9hZFNjcmlwdChhLCAiYnoyIik7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBhcmNoaXZlIGZvcm1hdCAnIiArIHQgKyAiJy4iKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlKCkNCiAgICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgICAgYXdhaXQgVW5hcmNoaXZlci5sb2FkZWRGb3JtYXRzW3RdDQogICAgfQ0KICAgIHN0YXRpYyBvcGVuKHIsIGwgPSBudWxsKSB7DQogICAgICAgIGxldCBvID0gdGhpczsNCiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChpLCBlKSA9PiB7DQogICAgICAgICAgICBsZXQgbiA9IHIubmFtZTsNCiAgICAgICAgICAgIGwgPSBsIHx8IG51bGw7DQogICAgICAgICAgICBsZXQgcyA9IG5ldyBGaWxlUmVhZGVyOw0KICAgICAgICAgICAgcy5vbmxvYWQgPSBhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAgICAgbGV0IGUgPSBzLnJlc3VsdDsNCiAgICAgICAgICAgICAgICBvLl9pc0d6aXAoZSkgPyAoYXdhaXQgby5fbG9hZEZvcm1hdCgiZ3oiKSwgZSA9IHBha28uaW5mbGF0ZShlKS5idWZmZXIpIDogby5faXNYWihlKSA/IChhd2FpdCBvLl9sb2FkRm9ybWF0KCJ4eiIpLCBlID0gdG9YWihuZXcgVWludDhBcnJheShlKSwgMCwgMCwgMCwgMiAqKiAyOCkuYnVmZmVyKSA6IG8uX2lzQloyKGUpICYmIChhd2FpdCBvLl9sb2FkRm9ybWF0KCJiejIiKSwgZSA9IGJ6Mi5kZWNvbXByZXNzKG5ldyBVaW50OEFycmF5KGUpKS5idWZmZXIpOw0KICAgICAgICAgICAgICAgIGxldCByID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgYSA9IFtdLA0KICAgICAgICAgICAgICAgICAgICB0ID0gbnVsbDsNCiAgICAgICAgICAgICAgICBpZiAoby5faXNSYXJGaWxlKGUpKSB0ID0gInJhciIsIGF3YWl0IG8uX2xvYWRGb3JtYXQodCksIHIgPSBvLl9yYXJPcGVuKG4sIGwsIGUpLCBhID0gby5fcmFyR2V0RW50cmllcyhyKTsNCiAgICAgICAgICAgICAgICBlbHNlIGlmIChvLl9pc1ppcEZpbGUoZSkpIHQgPSAiemlwIiwgYXdhaXQgby5fbG9hZEZvcm1hdCh0KSwgciA9IGF3YWl0IG8uX3ppcE9wZW4obiwgbCwgZSksIGEgPSBvLl96aXBHZXRFbnRyaWVzKHIpOw0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpZiAoIW8uX2lzVGFyRmlsZShlKSkgdGhyb3cgbmV3IEVycm9yKCJUaGUgYXJjaGl2ZSB0eXBlIGlzIHVua25vd24iKTsNCiAgICAgICAgICAgICAgICAgICAgdCA9ICJ0YXIiLCBhd2FpdCBvLl9sb2FkRm9ybWF0KHQpLCByID0gby5fdGFyT3BlbihuLCBsLCBlKSwgYSA9IG8uX3RhckdldEVudHJpZXMocikNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYS5zb3J0KChlLCByKSA9PiBlLm5hbWUubG9jYWxlQ29tcGFyZShyLm5hbWUpKSwgaSh7DQogICAgICAgICAgICAgICAgICAgIGZpbGVfbmFtZTogbiwNCiAgICAgICAgICAgICAgICAgICAgYXJjaGl2ZV90eXBlOiB0LA0KICAgICAgICAgICAgICAgICAgICBhcnJheV9idWZmZXI6IGUsDQogICAgICAgICAgICAgICAgICAgIGVudHJpZXM6IGEsDQogICAgICAgICAgICAgICAgICAgIGhhbmRsZTogcg0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9LCBzLnJlYWRBc0FycmF5QnVmZmVyKHIpDQogICAgICAgIH0pDQogICAgfQ0KICAgIHN0YXRpYyBjbG9zZShlKSB7DQogICAgICAgIGUuZmlsZV9uYW1lID0gbnVsbCwgZS5hcmNoaXZlX3R5cGUgPSBudWxsLCBlLmFycmF5X2J1ZmZlciA9IG51bGwsIGUuZW50cmllcyA9IG51bGwsIGUuaGFuZGxlID0gbnVsbA0KICAgIH0NCiAgICBzdGF0aWMgX3Jhck9wZW4oZSwgciwgYSkgew0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgZmlsZV9uYW1lOiBlLA0KICAgICAgICAgICAgYXJyYXlfYnVmZmVyOiBhLA0KICAgICAgICAgICAgcGFzc3dvcmQ6IHIsDQogICAgICAgICAgICByYXJfZmlsZXM6IFt7DQogICAgICAgICAgICAgICAgbmFtZTogZSwNCiAgICAgICAgICAgICAgICBzaXplOiBhLmJ5dGVMZW5ndGgsDQogICAgICAgICAgICAgICAgdHlwZTogIiIsDQogICAgICAgICAgICAgICAgY29udGVudDogbmV3IFVpbnQ4QXJyYXkoYSkNCiAgICAgICAgICAgIH1dDQogICAgICAgIH0NCiAgICB9DQogICAgc3RhdGljIGFzeW5jIF96aXBPcGVuKGUsIHIsIGEpIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGZpbGVfbmFtZTogZSwNCiAgICAgICAgICAgIGFycmF5X2J1ZmZlcjogYSwNCiAgICAgICAgICAgIHBhc3N3b3JkOiByLA0KICAgICAgICAgICAgemlwOiBhd2FpdCBKU1ppcC5sb2FkQXN5bmMoYSkNCiAgICAgICAgfQ0KICAgIH0NCiAgICBzdGF0aWMgX3Rhck9wZW4oZSwgciwgYSkgew0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgZmlsZV9uYW1lOiBlLA0KICAgICAgICAgICAgYXJyYXlfYnVmZmVyOiBhLA0KICAgICAgICAgICAgcGFzc3dvcmQ6IHINCiAgICAgICAgfQ0KICAgIH0NCiAgICBzdGF0aWMgX3JhckdldEVudHJpZXMobikgew0KICAgICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMocmVhZFJBUkZpbGUobi5yYXJfZmlsZXMsIG4ucGFzc3dvcmQpKS5tYXAoKFssIGVdKSA9PiB7DQogICAgICAgICAgICBsZXQgdCA9IGUubmFtZSwNCiAgICAgICAgICAgICAgICBpID0gZS5pc19maWxlOw0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICBuYW1lOiB0LA0KICAgICAgICAgICAgICAgIGlzX2ZpbGU6IGUuaXNfZmlsZSwNCiAgICAgICAgICAgICAgICBzaXplX2NvbXByZXNzZWQ6IGUuc2l6ZV9jb21wcmVzc2VkLA0KICAgICAgICAgICAgICAgIHNpemVfdW5jb21wcmVzc2VkOiBlLnNpemVfdW5jb21wcmVzc2VkLA0KICAgICAgICAgICAgICAgIHJlYWQ6ICgpID0+IG5ldyBQcm9taXNlKChyLCBhKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmIChpKSB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVhZFJBUkNvbnRlbnQobi5yYXJfZmlsZXMsIG4ucGFzc3dvcmQsIHQsIGUgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIobmV3IEZpbGUoW2VdLCB0KSkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGEoZSkNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHIobnVsbCkNCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgIH0NCiAgICBzdGF0aWMgX3ppcEdldEVudHJpZXMoZSkgew0KICAgICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMoZS56aXAuZmlsZXMpLm1hcCgoWywgYV0pID0+IHsNCiAgICAgICAgICAgIGxldCB0ID0gYS5uYW1lLA0KICAgICAgICAgICAgICAgIGkgPSAhYS5kaXI7DQogICAgICAgICAgICB2YXIgZSA9IGEuX2RhdGEgPyBhLl9kYXRhLmNvbXByZXNzZWRTaXplIDogMCwNCiAgICAgICAgICAgICAgICByID0gYS5fZGF0YSA/IGEuX2RhdGEudW5jb21wcmVzc2VkU2l6ZSA6IDA7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIG5hbWU6IHQsDQogICAgICAgICAgICAgICAgaXNfZmlsZTogaSwNCiAgICAgICAgICAgICAgICBzaXplX2NvbXByZXNzZWQ6IGUsDQogICAgICAgICAgICAgICAgc2l6ZV91bmNvbXByZXNzZWQ6IHIsDQogICAgICAgICAgICAgICAgcmVhZDogKCkgPT4gbmV3IFByb21pc2UoYXN5bmMgKGUsIHIpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgZShpID8gbmV3IEZpbGUoW2F3YWl0IGEuYXN5bmMoImJsb2IiKV0sIHQpIDogbnVsbCkNCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgIH0NCiAgICBzdGF0aWMgX3RhckdldEVudHJpZXMocykgew0KICAgICAgICByZXR1cm4gdGFyR2V0RW50cmllcyhzLmZpbGVfbmFtZSwgcy5hcnJheV9idWZmZXIpLm1hcCh0ID0+IHsNCiAgICAgICAgICAgIGxldCBpID0gdC5uYW1lLA0KICAgICAgICAgICAgICAgIG4gPSB0LmlzX2ZpbGU7DQogICAgICAgICAgICB2YXIgZSA9IHQuc2l6ZTsNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgbmFtZTogaSwNCiAgICAgICAgICAgICAgICBpc19maWxlOiBuLA0KICAgICAgICAgICAgICAgIHNpemVfY29tcHJlc3NlZDogZSwNCiAgICAgICAgICAgICAgICBzaXplX3VuY29tcHJlc3NlZDogZSwNCiAgICAgICAgICAgICAgICByZWFkOiAoKSA9PiBuZXcgUHJvbWlzZSgoZSwgcikgPT4gew0KICAgICAgICAgICAgICAgICAgICB2YXIgYTsNCiAgICAgICAgICAgICAgICAgICAgbiA/IChhID0gdGFyR2V0RW50cnlEYXRhKHQsIHMuYXJyYXlfYnVmZmVyKSwgZShuZXcgRmlsZShbYS5idWZmZXJdLCBpKSkpIDogZShudWxsKQ0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgfQ0KICAgIHN0YXRpYyBfaXNSYXJGaWxlKGUpIHsNCiAgICAgICAgaWYgKGUuYnl0ZUxlbmd0aCA8IDgpIHJldHVybiAhMTsNCiAgICAgICAgZSA9IG5ldyBVaW50OEFycmF5KGUsIDAsIDgpOw0KICAgICAgICByZXR1cm4gODIgPT0gZVswXSAmJiAoNjkgPT0gZVsxXSAmJiAxMjYgPT0gZVsyXSAmJiA5NCA9PSBlWzNdIHx8IDk3ID09IGVbMV0gJiYgMTE0ID09IGVbMl0gJiYgMzMgPT0gZVszXSAmJiAyNiA9PSBlWzRdICYmIDcgPT0gZVs1XSAmJiAoMCA9PSBlWzZdIHx8IDEgPT0gZVs2XSAmJiAwID09IGVbN10pKQ0KICAgIH0NCiAgICBzdGF0aWMgX2lzWmlwRmlsZShlKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9jaGVja0hlYWRlcihbODAsIDc1LCAzLCA0XSwgZSkNCiAgICB9DQogICAgc3RhdGljIF9pc1RhckZpbGUoZSkgew0KICAgICAgICByZXR1cm4gdGhpcy5fY2hlY2tIZWFkZXIoWzExNywgMTE1LCAxMTYsIDk3LCAxMTRdLCBlLCAyNTcsIDUxMikNCiAgICB9DQogICAgc3RhdGljIF9pc0d6aXAoZSkgew0KICAgICAgICByZXR1cm4gdGhpcy5fY2hlY2tIZWFkZXIoWzMxLCAxMzksIDhdLCBlKQ0KICAgIH0NCiAgICBzdGF0aWMgX2lzQloyKGUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2NoZWNrSGVhZGVyKFs2NiwgOTAsIDEwNF0sIGUpDQogICAgfQ0KICAgIHN0YXRpYyBfaXNYWihlKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9jaGVja0hlYWRlcihbMjUzLCA1NSwgMTIyLCA4OCwgOTAsIDBdLCBlKQ0KICAgIH0NCiAgICBzdGF0aWMgX2NoZWNrSGVhZGVyKHIsIGUsIGEgPSAwLCB0ID0gbnVsbCkgew0KICAgICAgICB2YXIgaSA9IGEgKyByLmxlbmd0aDsNCiAgICAgICAgaWYgKGUuYnl0ZUxlbmd0aCA8ICh0IHx8IGkpKSByZXR1cm4gITE7DQogICAgICAgIHZhciBuID0gbmV3IFVpbnQ4QXJyYXkoZSwgYSwgaSk7DQogICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgci5sZW5ndGg7ICsrZSkNCiAgICAgICAgICAgIGlmIChuW2VdICE9IHJbZV0pIHJldHVybiAhMTsNCiAgICAgICAgcmV0dXJuICEwDQogICAgfQ0KfQ0KVW5hcmNoaXZlci5sb2FkZWRGb3JtYXRzID0ge307DQogIDwvc2NyaXB0Pg0KICA8c2NyaXB0IG5vbmNlPSJWZEs1bkFHcEZLZDl2dTJKYXpTTmFBIj4gLy8gTG9naWMgZm9yIFVuaXR5IGNvbnRpYW5lcg0KICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjdW5pdHktY29udGFpbmVyIik7DQogICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1jYW52YXMiKTsNCiAgICB2YXIgbG9hZGluZ0JhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1sb2FkaW5nLWJhciIpOw0KICAgIHZhciBwcm9ncmVzc0JhckZ1bGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjdW5pdHktcHJvZ3Jlc3MtYmFyLWZ1bGwiKTsNCiAgICB2YXIgZnVsbHNjcmVlbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1mdWxsc2NyZWVuLWJ1dHRvbiIpOw0KICAgIHZhciBmdWxsc2NyZWVuT3ZlcmxheUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1vdmVybGF5LWZ1bGxzY3JlZW4tYnV0dG9uIik7DQogICAgdmFyIHF1aXRjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjcXVpdC1jYW52YXMiKTsNCiAgICB2YXIgd2FybmluZ0Jhbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS13YXJuaW5nIik7DQoNCiAgICAvLyBGb3IgWVQgaXQgaXMgc3Ryb25nbHkgZW5jb3VyYWdlZCB0aGF0IGFsbCB3YXJuaW5ncyAvIGVycm9ycyBzaG93IGluDQogICAgLy8gY29uc29sZSBhbmQgYmFubmVycyBzaG91bGQgYmUgaW4gZ2FtZSBhcyBuZWVkZWQgdG8gbm90IGNvbmZ1c2UgdXNlcnMuDQogICAgLy8gDQogICAgLy8gSWYgbmVlZGVkIHBsZWFzZSB1bmNvbW1lbnQgc2VjdGlvbiBiZWxvdyB0byBzaG93IGEgdGVtcG9yYXJ5IG1lc3NhZ2UgDQogICAgLy8gYmFubmVyL3JpYmJvbiBmb3IgYSBmZXcgc2Vjb25kcywgb3IgYSBwZXJtYW5lbnQgZXJyb3IgbWVzc2FnZSBvbiB0b3AgDQogICAgLy8gb2YgdGhlIGNhbnZhcyBpZiB0eXBlPT0nZXJyb3InLg0KICAgIGZ1bmN0aW9uIHVuaXR5U2hvd0Jhbm5lcihtc2csIHR5cGUpIHsNCiAgICAgIC8vIGZ1bmN0aW9uIHVwZGF0ZUJhbm5lclZpc2liaWxpdHkoKSB7DQogICAgICAvLyAgIHdhcm5pbmdCYW5uZXIuc3R5bGUuZGlzcGxheSA9IHdhcm5pbmdCYW5uZXIuY2hpbGRyZW4ubGVuZ3RoID8gJ2Jsb2NrJyA6ICdub25lJzsNCiAgICAgIC8vIH0NCiAgICAgIC8vIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICAgIC8vIGRpdi5pbm5lckhUTUwgPSBtc2c7DQogICAgICAvLyB3YXJuaW5nQmFubmVyLmFwcGVuZENoaWxkKGRpdik7DQogICAgICAvLyBpZiAodHlwZSA9PSAnZXJyb3InKSBkaXYuc3R5bGUgPSAnYmFja2dyb3VuZDogcmVkOyBwYWRkaW5nOiAxMHB4Oyc7DQogICAgICAvLyBlbHNlIHsNCiAgICAgIC8vICAgaWYgKHR5cGUgPT0gJ3dhcm5pbmcnKSBkaXYuc3R5bGUgPSAnYmFja2dyb3VuZDogeWVsbG93OyBwYWRkaW5nOiAxMHB4Oyc7DQogICAgICAvLyAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAvLyAgICAgd2FybmluZ0Jhbm5lci5yZW1vdmVDaGlsZChkaXYpOw0KICAgICAgLy8gICAgIHVwZGF0ZUJhbm5lclZpc2liaWxpdHkoKTsNCiAgICAgIC8vICAgfSwgNTAwMCk7DQogICAgICAvLyB9DQogICAgICAvLyB1cGRhdGVCYW5uZXJWaXNpYmlsaXR5KCk7DQogICAgfQ0KDQogICAgdmFyIGJ1aWxkVXJsID0gIkJ1aWxkIjsNCiAgICB2YXIgbG9hZGVyVXJsID0gYnVpbGRVcmwgKyAiL0J1aWxkLmxvYWRlci5qcyI7DQogICAgdmFyIGNvbmZpZyA9IHsNCiAgICAgIGRhdGFVcmw6IGJ1aWxkVXJsICsgIi9CdWlsZC5kYXRhIiwNCiAgICAgIGZyYW1ld29ya1VybDogYnVpbGRVcmwgKyAiL0J1aWxkLmZyYW1ld29yay5qcyIsDQogICAgICAgIGNvZGVVcmw6IGJ1aWxkVXJsICsgIi9CdWlsZC53YXNtIiwNCiAgICAgIHN0cmVhbWluZ0Fzc2V0c1VybDogIlN0cmVhbWluZ0Fzc2V0cyIsDQogICAgICBjb21wYW55TmFtZTogIlBhcmFkeW1lIEdhbWVzIiwNCiAgICAgIHByb2R1Y3ROYW1lOiAiTGl2ZSAtIFNvbGFyIFNtYXNoIFlvdVR1YmUiLA0KICAgICAgcHJvZHVjdFZlcnNpb246ICIwLjEuMCIsDQogICAgICBzaG93QmFubmVyOiB1bml0eVNob3dCYW5uZXIsDQogICAgfTsNCg0KICAgIC8vIEJ5IGRlZmF1bHQsIFVuaXR5IGtlZXBzIFdlYkdMIGNhbnZhcyByZW5kZXIgdGFyZ2V0IHNpemUgbWF0Y2hlZCB3aXRoDQogICAgLy8gdGhlIERPTSBzaXplIG9mIHRoZSBjYW52YXMgZWxlbWVudCAoc2NhbGVkIGJ5IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKQ0KICAgIC8vIFNldCB0aGlzIHRvIGZhbHNlIGlmIHlvdSB3YW50IHRvIGRlY291cGxlIHRoaXMgc3luY2hyb25pemF0aW9uIGZyb20NCiAgICAvLyBoYXBwZW5pbmcgaW5zaWRlIHRoZSBlbmdpbmUsIGFuZCB5b3Ugd291bGQgaW5zdGVhZCBsaWtlIHRvIHNpemUgdXANCiAgICAvLyB0aGUgY2FudmFzIERPTSBzaXplIGFuZCBXZWJHTCByZW5kZXIgdGFyZ2V0IHNpemVzIHlvdXJzZWxmLg0KICAgIC8vIGNvbmZpZy5tYXRjaFdlYkdMVG9DYW52YXNTaXplID0gZmFsc2U7DQoNCiAgICBpZiAoL2lQaG9uZXxpUGFkfGlQb2R8QW5kcm9pZC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsNCiAgICAgIC8vIE1vYmlsZSBkZXZpY2Ugc3R5bGU6IGZpbGwgdGhlIHdob2xlIGJyb3dzZXIgY2xpZW50IGFyZWEgd2l0aCB0aGUgZ2FtZSBjYW52YXM6DQoNCiAgICAgIHZhciBtZXRhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbWV0YScpOw0KICAgICAgbWV0YS5uYW1lID0gJ3ZpZXdwb3J0JzsNCiAgICAgIG1ldGEuY29udGVudCA9ICd3aWR0aD1kZXZpY2Utd2lkdGgsIGhlaWdodD1kZXZpY2UtaGVpZ2h0LCBpbml0aWFsLXNjYWxlPTEuMCwgdXNlci1zY2FsYWJsZT1ubywgc2hyaW5rLXRvLWZpdD15ZXMnOw0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZChtZXRhKTsNCiAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSAidW5pdHktbW9iaWxlIjsNCiAgICAgIGNhbnZhcy5jbGFzc05hbWUgPSAidW5pdHktbW9iaWxlIjsNCg0KICAgICAgLy8gVG8gbG93ZXIgY2FudmFzIHJlc29sdXRpb24gb24gbW9iaWxlIGRldmljZXMgdG8gZ2FpbiBzb21lDQogICAgICAvLyBwZXJmb3JtYW5jZSwgdW5jb21tZW50IHRoZSBmb2xsb3dpbmcgbGluZToNCiAgICAgIC8vY29uZmlnLmRldmljZVBpeGVsUmF0aW8gPSAwLjg7DQoNCiAgICB9IGVsc2Ugew0KICAgICAgLy8gRGVza3RvcCBzdHlsZTogUmVuZGVyIHRoZSBnYW1lIGNhbnZhcyBpbiBhIHdpbmRvdyB0aGF0IGNhbiBiZSBtYXhpbWl6ZWQgdG8gZnVsbHNjcmVlbjoNCiAgICAgIGNhbnZhcy5zdHlsZS53aWR0aCA9ICIxMDAlIjsNCiAgICAgIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7DQogICAgfQ0KDQogICAgbG9hZGluZ0Jhci5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCg0KICAgIGNvbnN0IHN1YlppcFN0ciA9ICcuemlwJzsNCiAgICBjb25zdCBzdWJXQVNNU3RyID0gJy53YXNtJzsNCiAgICBjb25zdCBzdWJKU1N0ciA9ICcuanMnOw0KICAgIGNvbnN0IHN1YkRhdGFTdHIgPSAnLmRhdGEnOw0KICAgIA0KICAgIC8vIGxvYWRSZXNvdXJjZXMgaXMgb25seSB1c2VkIGlmIHlvdSBuZWVkIGxvYWQgWmlwcGVkIGZpbGVzIGZvciAud2FzbSwgb3IgLmRhdGEgYW5kIG5lZWQgDQogICAgLy8gdGhlbSB0byBiZSBkZWNvbXByZXNzZWQuIElmIHRoZSBmaWxlIGlzIG5vdCB6aXBwZWQgd2UgYnlwYXNzIGRlY29tcHJlc3Npb24gc3RlcCBhdXRvbWF0aWNhbGx5LA0KICAgIC8vIGhvd2V2ZXIgaXRzIGJlc3QgdG8gbm90IHRyaWdnZXIgdGhpcyBpZiB5b3UgZG9udCB1c2VkIGNvbXByZXNzaW9uLiANCiAgICAvLyBOT1RFOiBHWmlwIGRvZXMgbm90IHdvcmsgQVRNLiAgSWYgdGhpcyBpcyBuZWVkZWQgVW5hcmNoaXZlciB3aWxsIG5lZWQgdG8gYmUgdXBkYXRlZC4NCiAgICBsb2FkUmVzb3VyY2VzID0gKGNhbGxiYWNrKSA9PiB7DQogICAgICAvLyBDaGVjayB0aGUgRGF0YSBVcmwgZmlyc3QsIGZvbGxvd2VkIGJ5IHRoZSBXQVNNIGZpbGUNCiAgICAgIHZhciBkYXRhVXJsID0gY29uZmlnLmRhdGFVcmw7DQogICAgICB2YXIgc2hvdWxkRGVjb21wcmVzcyA9IHRydWU7DQogICAgICAvLyBjaGVjayBpZiAuemlwIGFscmVhZHkgZXhpc3RzIGluIHRoZSBVUkwsIGlmIGl0IGRvZXNudCBjaGVjayBpZiBhIC56aXAgZmlsZSBleGlzdHMNCiAgICAgIGlmICghZGF0YVVybC5pbmNsdWRlcyhzdWJaaXBTdHIpKSB7DQogICAgICAgIGlmIChVcmxFeGlzdHMoZGF0YVVybCArIHN1YlppcFN0cikpIHsNCiAgICAgICAgICBkYXRhVXJsID0gZGF0YVVybCArIHN1YlppcFN0cjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzaG91bGREZWNvbXByZXNzID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgaWYgKHNob3VsZERlY29tcHJlc3MpDQogICAgICB7DQogICAgICAgIHZhciBibG9iVHlwZURhdGEgPSBHZXRCbG9iVHlwZShkYXRhVXJsKTsNCiAgICAgICAgRGVjb21wcmVzc0ZpbGUoZGF0YVVybCwgYmxvYlR5cGVEYXRhLCAoZmlsZSkgPT4gew0KICAgICAgICAgIGNvbmZpZy5kYXRhVXJsID0gZmlsZTsNCiAgICAgICAgICBMb2FkV0FTTShjYWxsYmFjayk7DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgICAgZWxzZQ0KICAgICAgew0KICAgICAgICBMb2FkV0FTTShjYWxsYmFjayk7DQogICAgICB9DQogICAgfQ0KDQogICAgLy8gRmV0Y2gvTG9hZCBhIGZpbGUgdGhlbiBjYWxsIG91ciBjYWxsYmFjayANCiAgICBsb2FkWmlwRGF0YSA9ICh1cmwsIGNhbGxiYWNrKSA9PiB7DQogICAgICBmZXRjaCh1cmwpDQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmJsb2IoKSkNCiAgICAgICAgLnRoZW4oYmxvYiA9PiB7DQogICAgICAgICAgY2FsbGJhY2soYmxvYik7DQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIExvYWRXQVNNKGNhbGxiYWNrKQ0KICAgIHsNCiAgICAgIC8vIEFmdGVyIERhdGEgZmlsZSBpcyBjaGVja2VkIGRlY29tcHJlc3MgYW5kIGNoZWNrIFdBU00gZmlsZSwgZm9sbG93ZWQgYnkgb3VyIGNhbGxiYWNrDQogICAgICB2YXIgY29kZVVybCA9IGNvbmZpZy5jb2RlVXJsOw0KICAgICAgdmFyIHNob3VsZERlY29tcHJlc3MgPSB0cnVlOw0KDQogICAgICAvLyBjaGVjayBpZiAuemlwIGFscmVhZHkgZXhpc3RzIGluIHRoZSBVUkwsIGlmIGl0IGRvZXNudCBjaGVjayBpZiBhIC56aXAgZmlsZSBleGlzdHMNCiAgICAgIGlmICghY29kZVVybC5pbmNsdWRlcyhzdWJaaXBTdHIpKSB7DQogICAgICAgIGlmIChVcmxFeGlzdHMoY29kZVVybCArIHN1YlppcFN0cikpIHsNCiAgICAgICAgICBjb2RlVXJsID0gY29kZVVybCArIHN1YlppcFN0cjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzaG91bGREZWNvbXByZXNzID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgLy8gZGVjb21wcmVzcyBpZiB1c2luZyBhIHppcCBmaWxlLCBvdGhlcndpc2UganVzdCBsb2FkIHJlZ3VsYXIgd2FzbSBmaWxlDQogICAgICBpZiAoc2hvdWxkRGVjb21wcmVzcykgew0KICAgICAgICAvLyBEZWNvbXByZXNzIHRoZSBmaWxlIGJhc2VkIG9uIHRoZSB0eXBlLCBXQVNNLCBKUywgZXRjLg0KICAgICAgICAvLyBpZiB5b3UgbmVlZCBtb3JlIHR5cGVzIHBsZWFzZSBhZGQgYSBjb25zdCBhYm92ZSBhbmQgbW9kaWZ5IHRoZSB0eXBlIGxvZ2ljIGJlbG93Lg0KICAgICAgICB2YXIgYmxvYlR5cGVXQVNNID0gR2V0QmxvYlR5cGUoY29kZVVybCk7DQogICAgICAgIERlY29tcHJlc3NGaWxlKGNvZGVVcmwsIGJsb2JUeXBlV0FTTSwgKGZpbGUpID0+IHsNCiAgICAgICAgICBjb25maWcuY29kZVVybCA9IGZpbGU7DQogICAgICAgICAgY2FsbGJhY2soKTsNCiAgICAgICAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjYWxsYmFjaygpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEdldEJsb2JUeXBlKHVybFRvQ2hlY2spIHsNCiAgICAgIC8vIGlmIHlvdSBuZWVkIG1vcmUgdHlwZXMgcGxlYXNlIGFkZCBhIGNvbnN0IGFib3ZlIGFuZCBtb2RpZnkgdGhlIHR5cGUgbG9naWMgYmVsb3cuDQogICAgICAvLyBOb3RlIHRoYXQgb2N0ZXQtc3RyZWFtIGRlZmF1bHQgaXMgZm9yIC5kYXRhIGZpbGVzLCBKUyBhbmQgV0FTTSBoYXZlIHRoZWlyIG93biBNSU1FIHR5cGVzLg0KICAgICAgdmFyIGJsb2JUeXBlID0gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7DQogICAgICBpZiAodXJsVG9DaGVjay5pbmNsdWRlcyhzdWJXQVNNU3RyKSl7DQogICAgICAgIGJsb2JUeXBlID0gJ2FwcGxpY2F0aW9uL3dhc20nOw0KICAgICAgfSBlbHNlIGlmICh1cmxUb0NoZWNrLmluY2x1ZGVzKHN1YkpTU3RyKSl7DQogICAgICAgIGJsb2JUeXBlID0gJ3RleHQvamF2YXNjcmlwdCc7DQogICAgICB9IA0KICAgICAgcmV0dXJuIGJsb2JUeXBlOw0KICAgIH0NCg0KICAgIC8vIENoZWNrIGlmIFVSTCAvIEZpbGUgZXhpc3RzDQogICAgZnVuY3Rpb24gVXJsRXhpc3RzKHVybFRvQ2hlY2spDQogICAgew0KICAgICAgICB2YXIgaHR0cFJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KICAgICAgICBodHRwUmVxLm9wZW4oJ0hFQUQnLCB1cmxUb0NoZWNrLCBmYWxzZSk7DQogICAgICAgIGh0dHBSZXEuc2VuZCgpOw0KICAgICAgICByZXR1cm4gaHR0cFJlcS5zdGF0dXMhPTQwNDsNCiAgICB9DQoNCiAgICAvLyBkZWNvbXByZXNzIGZpbGVzIGFuZCBjYWxsIGNhbGxiYWNrDQogICAgLy8gVE9ETzogdGVzdCBhbmQgcG90ZW50aWFsbHkgc3dpdGNoIHRvIENvbXByZXNzaW9uIFN0cmVhbXMgQVBJDQogICAgZnVuY3Rpb24gRGVjb21wcmVzc0ZpbGUoZmlsZSwgYmxvYk1pbWVUeXBlLCBjYWxsYmFjaykgew0KICAgICAgbGV0IGRlY29tcHJlc3NlZEZpbGU7DQoNCiAgICAgIGxvYWRaaXBEYXRhKGZpbGUsIChmKSA9PiB7DQogICAgICAgIFVuYXJjaGl2ZXIub3BlbihmKS50aGVuKGFzeW5jIGZ1bmN0aW9uIChhcmNoaXZlKSB7DQogICAgICAgICAgZm9yIChsZXQgZW50cnkgb2YgYXJjaGl2ZS5lbnRyaWVzKSB7DQogICAgICAgICAgICBpZiAoZW50cnkuaXNfZmlsZSkgew0KICAgICAgICAgICAgICBsZXQgZW50cnlSZWFkID0gYXdhaXQgZW50cnkucmVhZCgpOw0KICAgICAgICAgICAgICBsZXQgZW50cnlEYXRhID0gYXdhaXQgZW50cnlSZWFkLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgIGxldCBkYXRhQmxvYiA9IG5ldyBCbG9iKFtuZXcgVWludDhBcnJheShlbnRyeURhdGEpXSwgeyB0eXBlOiBibG9iTWltZVR5cGUgfSk7DQogICAgICAgICAgICAgIGRlY29tcHJlc3NlZEZpbGUgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChkYXRhQmxvYik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIGNhbGxiYWNrKGRlY29tcHJlc3NlZEZpbGUpOw0KICAgICAgICB9KTsNCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIHZhciB1bml0eUdhbWVJbnN0YW5jZSA9IG51bGw7DQogICAgLy8gU2V0dXAgdGhlIFVuaXR5IHNlY3Rpb24gb25jZSB6aXAgZmlsZSBpcyBkb3dubG9hZGVkIGFuZCBkZWNvbXByZXNzZWQNCiAgICBmdW5jdGlvbiBJbml0VW5pdHlTZWN0aW9uKCkgew0KICAgICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOw0KICAgICAgc2NyaXB0LnNyYyA9IGxvYWRlclVybDsNCiAgICAgIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiB7DQogICAgICAgIGNyZWF0ZVVuaXR5SW5zdGFuY2UoY2FudmFzLCBjb25maWcsIChwcm9ncmVzcykgPT4gew0KICAgICAgICAgIHByb2dyZXNzQmFyRnVsbC5zdHlsZS53aWR0aCA9IDEwMCAqIHByb2dyZXNzICsgIiUiOw0KICAgICAgICAgIH0pLnRoZW4oKHVuaXR5SW5zdGFuY2UpID0+IHsNCiAgICAgICAgICAgIHVuaXR5R2FtZUluc3RhbmNlID0gdW5pdHlJbnN0YW5jZTsNCiAgICAgICAgICAgIGxvYWRpbmdCYXIuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICAgICAgICB9KS5jYXRjaCgobWVzc2FnZSkgPT4gew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsNCiAgICAgICAgICB9KTsNCiAgICAgIH07DQoNCiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsNCiAgICB9DQoNCiAgICAvLyBQYXRoIDE6IFVzZSB0aGlzIHBhdGggaWYgbm8gZGVjb21wcmVzc2lvbiBvZiB5b3VyIC53YXNtLCAuZGF0YSwgLmpzIGZpbGVzIGFyZSBuZWVkZWQNCiAgICAvL0luaXRVbml0eVNlY3Rpb24oKTsNCg0KICAgIC8vIFBhdGggMjogVXNlIHRoaXMgcGF0aCB0byBMb2FkIHJlc291cmNlcyAoLndhc20sIC5kYXRhKSB0aGF0IGFyZSBaaXBwZWQgYW5kIG5lZWQgdG8gYmUgZGVjb21wcmVzc2VkDQogICAgLy8gaWYgeW91IGRvbnQgdXNlIGNvbXByZXNzZWlvbiBpdHMgYmVzdCB0byBjb21tZW50IG91dCBQYXRoIDEgYW5kIHVuY29tbWVudCBQYXRoIDIuDQogICAgIGxvYWRSZXNvdXJjZXMoSW5pdFVuaXR5U2VjdGlvbik7ICAvLyBVbmNvbW1lbnQgdGhpcyBsaW5lIHRvIHN0YXJ0IFVuaXR5IGJ5IGxvYWRpbmcgemlwcGVkIGZpbGVzDQogIDwvc2NyaXB0Pg0KPC9ib2R5Pg0KPC9odG1sPg==";
