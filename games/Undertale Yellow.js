window.game = "PCFET0NUWVBFIGh0bWw+DQoNCg0KPCEtLSBVbHRpbWF0ZSBHYW1lIFN0YXNoIGZpbGUtLT4gDQo8IS0tIEZvciB0aGUgcmVndWxhcmx5IHVwZGF0aW5nIGRvYyBnbyB0byBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFfRm1IM0JsU0JRSTdGR2dBUUw1OS1aUGU4ZUN4czM1d2VsNkpVeVZhRzhRLyAtLT4NCg0KDQo8aHRtbCBsYW5nPSJlbi11cyI+DQogIDxoZWFkPg0KICAgIDxiYXNlIGhyZWY9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC8xZTI5NWE0OTEwOGU3MTZjZThhYjdlYmEwYzhkY2E3ZC85MzI2MjY1ZTRmMWIxNDM0NWEzYmRhYjZmOGZmYWQwZTJlN2FiM2ZkYTkyMGM1ZjBmMDk1Zjc3MzU5YWYwMGFlYWUyMjU5MWM1YmM0OTE0Yzg0YzEzZDk5ZWI2MjA5MWQ3Y2U3QG1haW4vdXR5d2ViLyI+DQogICAgPGJvZHkgb25jb250ZXh0bWVudT0icmV0dXJuIGZhbHNlOyI+DQogICAgPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+DQogICAgPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiIC8+DQogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9InZpZXdwb3J0LWZpdD1jb3Zlciwgd2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCwgbWluaW11bS1zY2FsZT0xLjAsIG1heGltdW0tc2NhbGU9MS4wIiAvPg0KICAgIDxtZXRhIG5hbWU9Im1vYmlsZS13ZWItYXBwLWNhcGFibGUiIGNvbnRlbnQ9InllcyIgLz4NCiAgICA8bWV0YSBuYW1lPSJhcHBsZS1tb2JpbGUtd2ViLWFwcC1jYXBhYmxlIiBjb250ZW50PSJ5ZXMiIC8+DQogICAgPG1ldGEgbmFtZT0iYXBwbGUtbW9iaWxlLXdlYi1hcHAtc3RhdHVzLWJhci1zdHlsZSIgY29udGVudD0iYmxhY2stdHJhbnNsdWNlbnQiIC8+DQogICAgPGxpbmsgcmVsPSJpY29uIiB0eXBlPSJ4LWljb24iIGhyZWY9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC8xZTI5NWE0OTEwOGU3MTZjZThhYjdlYmEwYzhkY2E3ZC85MzI2MjY1ZTRmMWIxNDM0NWEzYmRhYjZmOGZmYWQwZTJlN2FiM2ZkYTkyMGM1ZjBmMDk1Zjc3MzU5YWYwMGFlYWUyMjU5MWM1YmM0OTE0Yzg0YzEzZDk5ZWI2MjA5MWQ3Y2U3QG1haW4vdXR5d2ViL2Zhdi5pY28iPg0KICAgIDx0aXRsZT5VTkRFUlRBTEUgWWVsbG93PC90aXRsZT4NCiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9InV0eS5jc3MiPg0KICAgIDxzY3JpcHQgc3JjPSJqc3ppcC5taW4uanMiPjwvc2NyaXB0Pg0KICA8L2hlYWQ+DQoNCiAgPGJvZHk+DQogICAgPGRpdiBpZD0iZ2FtZS1jb250YWluZXIiPg0KICAgICAgPGNhbnZhcyBjbGFzcz0iZW1zY3JpcHRlbiIgaWQ9ImNhbnZhcyIgb25jb250ZXh0bWVudT0iZXZlbnQucHJldmVudERlZmF1bHQoKSIgdGFiaW5kZXg9Ii0xIj48L2NhbnZhcz4NCiAgICAgIDxkaXYgY2xhc3M9ImxvYWRpbmciPg0KICAgICAgICA8ZGl2IGNsYXNzPSJzcGlubmVyIiBpZD0ic3Bpbm5lciI+PC9kaXY+DQogICAgICAgIDxub3NjcmlwdCBjbGFzcz0ibnNtZXNzYWdlIj5UaGlzIHJlcXVpcmVzIEphdmFTY3JpcHQgYW5kIFdlYkFzc2VtYmx5IHRvIGJlIGVuYWJsZWQgaW4geW91ciBicm93c2VyLjwvbm9zY3JpcHQ+DQogICAgICAgIDxkaXYgY2xhc3M9ImVtc2NyaXB0ZW4iIGlkPSJzdGF0dXMiPkxvYWRpbmcuLi48L2Rpdj4NCiAgICAgICAgPHByb2dyZXNzIHZhbHVlPSIwIiBtYXg9IjEwMCIgaWQ9InByb2dyZXNzIiBoaWRkZW49IjEiPjwvcHJvZ3Jlc3M+DQogICAgICA8L2Rpdj4NCiAgICAgIDxkaXYgY2xhc3M9Im91dHB1dC1jb250YWluZXIiIGlkPSJvdXRwdXQtY29udGFpbmVyIj4NCiAgICAgIDxidXR0b24gY2xhc3M9Im91dHB1dC1idXR0b24iIG9uY2xpY2s9InRvZ2dsZUNvbnNvbGUoKSIgdGl0bGU9Ikxpc3RzIGVtc2NyaXB0ZW4vR00gY29uc29sZSBvdXRwdXQgYW5kIGxvYWRpbmcgcHJvZ3Jlc3MiPlRvZ2dsZSBDb25zb2xlITwvYnV0dG9uPg0KICAgICAgPGJ1dHRvbiBjbGFzcz0ib3V0cHV0LWJ1dHRvbiIgaWQ9InN0YXRzLWJ1dHRvbiIgb25jbGljaz0idG9nZ2xlRlBTKCkiIHRpdGxlPSJUb2dnbGVzIHRoZSBleHRlcm5hbCBGUFMgQ291bnRlciI+VG9nZ2xlIEZQUyBDb3VudGVyITwvYnV0dG9uPg0KICAgICAgPGJ1dHRvbiBjbGFzcz0ib3V0cHV0LWJ1dHRvbiIgb25jbGljaz0id2luZG93LlNBVkVNYW5hZ2VyLm9wZW5TQVZFTWFuYWdlcigpIiB0aXRsZT0iTWFuYWdlIHlvdXIgVU5ERVJUQUxFIFNBVkUgZmlsZXMiPlNBVkUgTWFuYWdlciE8L2J1dHRvbj4NCiAgICAgIDxidXR0b24gY2xhc3M9Im91dHB1dC1idXR0b24iIG9uY2xpY2s9InRvZ2dsZVdBU0QodGhpcykiIHRpdGxlPSJUb2dnbGVzIE1pcnJvcmluZyBBcnJvdyBLZXlzIHRvIFdBU0QgZm9yIGVhc2llciBjb250cm9sIj5NaXJyb3IgV0FTRCB0byBBcnJvd3MhPC9idXR0b24+DQogICAgICA8aW5wdXQgaWQ9ImNvbG9ycGlja2VyIiB0eXBlPSJjb2xvciIgb25jaGFuZ2U9ImNoYW5nZWNvbG9yKHRoaXMpIiB0aXRsZT0iQ2hhbmdlcyBjb2xvciBvZiB0aGUgY2FudmFzJyBzdXJyb3VuZGluZyBhcmVhcyI+DQogICAgICA8dGV4dGFyZWEgaWQ9Im91dHB1dCI+PC90ZXh0YXJlYT4NCiAgICA8L2Rpdj4NCiAgICA8YnV0dG9uIGlkPSJjbG9zZVVJQnV0dG9uIiBvbmNsaWNrPSJoaWRlVUkoKSI+JnRpbWVzOzwvYnV0dG9uPg0KICAgIDxkaXYgaWQ9Im1lc3NhZ2UtY29udGFpbmVyIj4NCiAgICAgIDxkaXYgaWQ9Im1lc3NhZ2VzIj48L2Rpdj4NCiAgICA8L2Rpdj4NCiAgPC9kaXY+DQogIDxkaXYgaWQ9ImN1c3RvbU1lc3NhZ2VCb3giIGNsYXNzPSJjdXN0b20tbWVzc2FnZS1ib3giPg0KICAgIDxkaXYgY2xhc3M9ImN1c3RvbS1tZXNzYWdlLWJveC1jb250ZW50Ij4NCiAgICAgIDxwIGlkPSJtZXNzYWdlQm94VGV4dCI+PC9wPg0KICAgICAgPGJ1dHRvbiBpZD0ibWVzc2FnZUJveENvbmZpcm1CdG4iPk9LPC9idXR0b24+DQogICAgPC9kaXY+DQogIDwvZGl2Pg0KICA8ZGl2IGlkPSJzYXZlTWFuYWdlck1vZGFsIiBjbGFzcz0ic2F2ZS1tYW5hZ2VyLW1vZGFsIj4NCiAgICA8ZGl2IGNsYXNzPSJzYXZlLW1hbmFnZXItY29udGVudCI+DQogICAgICA8c3BhbiBjbGFzcz0iY2xvc2UtYnV0dG9uIiBvbmNsaWNrPSJ3aW5kb3cuU0FWRU1hbmFnZXIuY2xvc2VTQVZFTWFuYWdlcigpIj4mdGltZXM7PC9zcGFuPg0KICAgICAgPGRpdiBjbGFzcz0ic2F2ZS1tYW5hZ2VyLWNvbnRlbnQyIj4NCiAgICAgICAgPHNwYW4gY2xhc3M9Im1pbmltaXplLWJ1dHRvbiIgb25jbGljaz0id2luZG93LlNBVkVNYW5hZ2VyLmNsb3NlU01ub3JlbG9hZCgpIj4mZGFzaDs8L3NwYW4+DQogICAgICAgIDxoMj5TQVZFIEZpbGUgTWFuYWdlciE8L2gyPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJvdXRwdXQtYnV0dG9uIiBvbmNsaWNrPSJ0b2dnbGVjbGVhcl9zaXRlX2NhY2hlKCkiPldpcGUgYWxsIG9mIHlvdXIgU0FWRXM/PC9idXR0b24+DQogICAgICAgIDxidXR0b24gaWQ9ImV4cG9ydEFsbEJ0biIgY2xhc3M9Im91dHB1dC1idXR0b24iIG9uY2xpY2s9IlNBVkVNYW5hZ2VyLmV4cG9ydEFsbFRvWmlwKCkiPkV4cG9ydCBhbGwgU0FWRXMgdG8gWklQPzwvYnV0dG9uPg0KICAgICAgICA8aDM+Q3VycmVudCBTQVZFIEZpbGVzOjwvaDM+DQogICAgICAgIDxkaXYgaWQ9InNhdmVGaWxlTGlzdCIgY2xhc3M9InNhdmUtZmlsZS1saXN0Ij4NCiAgICAgICAgICA8cCBzdHlsZT0idGV4dC1hbGlnbjogY2VudGVyOyBjb2xvcjogIzg4ODsiPk5vIHNhdmVzIGZvdW5kLiBUcnkgaW1wb3J0aW5nIG9uZSBvciBzYXZpbmcgaW4tZ2FtZSBmaXJzdC48L3A+DQogICAgICAgIDwvZGl2Pg0KICAgICAgICA8ZGl2IGNsYXNzPSJmaWxlLXVwbG9hZC1zZWN0aW9uIj4NCiAgICAgICAgICA8aDM+SW1wb3J0IFNhdmUgRmlsZXM/PC9oMz4NCiAgICAgICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgaWQ9InVwbG9hZEZpbGVJbnB1dCIgYWNjZXB0PSIqIiBtdWx0aXBsZT4NCiAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9InVwbG9hZEZpbGVOYW1lSW5wdXQiIHBsYWNlaG9sZGVyPSJFbnRlciB0aGUgY29ycmVzcG9uZGluZyBmaWxlbmFtZSAoZS5nLiwgZmlsZWNoMV8wLCBkci5pbmkgLyBmb3Igc2luZ2xlIGZpbGUgb25seSkiPg0KICAgICAgICAgIDxidXR0b24gb25jbGljaz0iU0FWRU1hbmFnZXIuaGFuZGxlVXBsb2FkKCkiPlNlbGVjdCBGaWxlKHMpITwvYnV0dG9uPg0KICAgICAgICA8L2Rpdj4NCiAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KICAgIDxzY3JpcHQ+DQogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHsNCiAgICAgICAgY29uc3QgbW9iaWxlQnV0dG9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2JpbGUtYnV0dG9ucycpOw0KICAgICAgICBpZiAoL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxCbGFja0JlcnJ5fElFTW9iaWxlfE9wZXJhIE1pbmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7DQogICAgICAgICAgbW9iaWxlQnV0dG9ucy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgPC9zY3JpcHQ+DQogICAgPHNjcmlwdD4NCiAgICAgIHdpbmRvdy5TQVZFTWFuYWdlciA9IChmdW5jdGlvbigpIHsNCiAgICAgICAgZnVuY3Rpb24gc2hvd01lc3NhZ2VCb3gobWVzc2FnZSwgb25Db25maXJtID0gbnVsbCkgew0KICAgICAgICAgIGNvbnN0IG1lc3NhZ2VCb3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VzdG9tTWVzc2FnZUJveCcpOw0KICAgICAgICAgIGNvbnN0IG1lc3NhZ2VCb3hUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lc3NhZ2VCb3hUZXh0Jyk7DQogICAgICAgICAgY29uc3QgbWVzc2FnZUJveENvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVzc2FnZUJveENvbmZpcm1CdG4nKTsNCiAgICAgICAgICBjb25zdCBtZXNzYWdlQm94Q2FuY2VsQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lc3NhZ2VCb3hDYW5jZWxCdG4nKTsNCiAgICAgICAgICBtZXNzYWdlQm94VGV4dC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7DQogICAgICAgICAgbWVzc2FnZUJveENvbmZpcm1CdG4udGV4dENvbnRlbnQgPSAnQWxyaWdodCEnOw0KICAgICAgICAgIGlmIChtZXNzYWdlQm94Q2FuY2VsQnRuKSB7DQogICAgICAgICAgICBtZXNzYWdlQm94Q2FuY2VsQnRuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgfQ0KICAgICAgICAgIG1lc3NhZ2VCb3guc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsNCiAgICAgICAgICBtZXNzYWdlQm94Q29uZmlybUJ0bi5vbmNsaWNrID0gKCkgPT4gew0KICAgICAgICAgICAgbWVzc2FnZUJveC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgaWYgKG9uQ29uZmlybSkgb25Db25maXJtKCk7DQogICAgICAgICAgfTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGNvbmZpcm1Cb3gobWVzc2FnZSkgew0KICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gew0KICAgICAgICAgICAgY29uc3QgbWVzc2FnZUJveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXN0b21NZXNzYWdlQm94Jyk7DQogICAgICAgICAgICBjb25zdCBtZXNzYWdlQm94VGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXNzYWdlQm94VGV4dCcpOw0KICAgICAgICAgICAgY29uc3QgbWVzc2FnZUJveENvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVzc2FnZUJveENvbmZpcm1CdG4nKTsNCiAgICAgICAgICAgIGxldCBtZXNzYWdlQm94Q2FuY2VsQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lc3NhZ2VCb3hDYW5jZWxCdG4nKTsNCiAgICAgICAgICAgIGlmICghbWVzc2FnZUJveENhbmNlbEJ0bikgew0KICAgICAgICAgICAgICBtZXNzYWdlQm94Q2FuY2VsQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7DQogICAgICAgICAgICAgIG1lc3NhZ2VCb3hDYW5jZWxCdG4uaWQgPSAnbWVzc2FnZUJveENhbmNlbEJ0bic7DQogICAgICAgICAgICAgIG1lc3NhZ2VCb3hDYW5jZWxCdG4uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyM2Yzc1N2QnOw0KICAgICAgICAgICAgICBtZXNzYWdlQm94Q2FuY2VsQnRuLnN0eWxlLm1hcmdpbkxlZnQgPSAnMTBweCc7DQogICAgICAgICAgICAgIG1lc3NhZ2VCb3hDb25maXJtQnRuLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQobWVzc2FnZUJveENhbmNlbEJ0bik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBtZXNzYWdlQm94VGV4dC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7DQogICAgICAgICAgICBtZXNzYWdlQm94Q29uZmlybUJ0bi50ZXh0Q29udGVudCA9ICdTdXJlISc7DQogICAgICAgICAgICBtZXNzYWdlQm94Q2FuY2VsQnRuLnRleHRDb250ZW50ID0gJ05haC4nOw0KICAgICAgICAgICAgbWVzc2FnZUJveENhbmNlbEJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1ibG9jayc7DQogICAgICAgICAgICBtZXNzYWdlQm94LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQogICAgICAgICAgICBtZXNzYWdlQm94Q29uZmlybUJ0bi5vbmNsaWNrID0gKCkgPT4gew0KICAgICAgICAgICAgICBtZXNzYWdlQm94LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgbWVzc2FnZUJveENhbmNlbEJ0bi5vbmNsaWNrID0gKCkgPT4gew0KICAgICAgICAgICAgICBtZXNzYWdlQm94LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBEQl9OQU1FID0gJy9fc2F2ZWRhdGEnOw0KICAgICAgICBjb25zdCBTVE9SRV9OQU1FID0gJ0ZJTEVfREFUQSc7DQogICAgICAgIGNvbnN0IERCX1ZFUlNJT04gPSAyMTsNCiAgICAgICAgbGV0IGRiOw0KICAgICAgICBhc3luYyBmdW5jdGlvbiBvcGVuSW5kZXhlZERCKCkgew0KICAgICAgICAgIGlmIChkYikgcmV0dXJuIGRiOw0KICAgICAgICAgIGlmICghd2luZG93LmluZGV4ZWREQikgew0KICAgICAgICAgICAgc2hvd01lc3NhZ2VCb3goIllvdXIgYnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgSW5kZXhlZERCLiBUaGUgU0FWRSBNYW5hZ2VyIHdpbGwgbm90IHdvcmsuIik7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkluZGV4ZWREQiBub3Qgc3VwcG9ydGVkIPCfmIIgbm8gc2F2ZXMgZm9yIHlvdSBnbmciKTsNCiAgICAgICAgICB9DQogICAgICAgICAgY29uc3QgZGF0YWJhc2VzID0gYXdhaXQgd2luZG93LmluZGV4ZWREQi5kYXRhYmFzZXMoKTsNCiAgICAgICAgICBjb25zdCBkYkV4aXN0cyA9IGRhdGFiYXNlcy5zb21lKGRiSW5mbyA9PiBkYkluZm8ubmFtZSA9PT0gREJfTkFNRSk7DQogICAgICAgICAgaWYgKCFkYkV4aXN0cykgew0KICAgICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYERhdGFiYXNlICcke0RCX05BTUV9JyBub3QgZm91bmQuIFBsZWFzZSBTQVZFIGluLWdhbWUgZmlyc3QhYDsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yTWVzc2FnZSk7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNZXNzYWdlKTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihEQl9OQU1FLCBEQl9WRVJTSU9OKTsNCiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IChldmVudCkgPT4gew0KICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJJbmRleGVkREIgZXJyb3I6IiwgZXZlbnQudGFyZ2V0LmVycm9yKTsNCiAgICAgICAgICAgICAgc2hvd01lc3NhZ2VCb3goIkVycm9yIG9wZW5pbmcgSW5kZXhlZERCOiAiICsgKGV2ZW50LnRhcmdldC5lcnJvciA/IGV2ZW50LnRhcmdldC5lcnJvci5tZXNzYWdlIDogIlVua25vd24gZXJyb3I/PyIpKTsNCiAgICAgICAgICAgICAgcmVqZWN0KCJFcnJvciBvcGVuaW5nIEluZGV4ZWREQiEiKTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4gew0KICAgICAgICAgICAgICBkYiA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7DQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJJbmRleGVkREIgb3BlbmVkIHN1Y2Nlc3NmdWxseS4iKTsNCiAgICAgICAgICAgICAgcmVzb2x2ZShkYik7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSAoZXZlbnQpID0+IHsNCiAgICAgICAgICAgICAgZGIgPSBldmVudC50YXJnZXQucmVzdWx0Ow0KICAgICAgICAgICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoU1RPUkVfTkFNRSkpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgT2JqZWN0IHN0b3JlICcke1NUT1JFX05BTUV9JyBub3QgZm91bmQuIFdhaXRpbmcgZm9yIHRoZSBnYW1lIHRvIGNyZWF0ZSBpdC4uLiBzbWhgKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBhc3luYyBmdW5jdGlvbiBnZXRTYXZlRmlsZXMoKSB7DQogICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGF3YWl0IG9wZW5JbmRleGVkREIoKTsNCiAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oW1NUT1JFX05BTUVdLCAncmVhZG9ubHknKTsNCiAgICAgICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoU1RPUkVfTkFNRSk7DQogICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gb2JqZWN0U3RvcmUuZ2V0QWxsKCk7DQogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gZXZlbnQudGFyZ2V0LnJlc3VsdDsNCiAgICAgICAgICAgICAgICBjb25zdCBmaWxlTmFtZXNSZXF1ZXN0ID0gb2JqZWN0U3RvcmUuZ2V0QWxsS2V5cygpOw0KICAgICAgICAgICAgICAgIGZpbGVOYW1lc1JlcXVlc3Qub25zdWNjZXNzID0gKGV2ZW50S2V5cykgPT4gew0KICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZU5hbWVzID0gZXZlbnRLZXlzLnRhcmdldC5yZXN1bHQ7DQogICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmaWxlcy5tYXAoKGZpbGUsIGluZGV4KSA9PiAoew0KICAgICAgICAgICAgICAgICAgICBuYW1lOiBmaWxlTmFtZXNbaW5kZXhdLA0KICAgICAgICAgICAgICAgICAgICBkYXRhOiBmaWxlDQogICAgICAgICAgICAgICAgICB9KSk7DQogICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBmaWxlTmFtZXNSZXF1ZXN0Lm9uZXJyb3IgPSAoZXZlbnRLZXlzKSA9PiB7DQogICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBnZXR0aW5nIGZpbGUgbmFtZXM6IiwgZXZlbnRLZXlzLnRhcmdldC5lcnJvcik7DQogICAgICAgICAgICAgICAgICByZWplY3QoIkVycm9yIGdldHRpbmcgZmlsZSBuYW1lczogIiArIChldmVudEtleXMudGFyZ2V0LmVycm9yID8gZXZlbnRLZXlzLnRhcmdldC5lcnJvci5tZXNzYWdlIDogIlVua25vd24gZXJyb3IiKSk7DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gKGV2ZW50KSA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZ2V0dGluZyBzYXZlIGZpbGVzIGZyb20gb2JqZWN0IHN0b3JlOiIsIGV2ZW50LnRhcmdldC5lcnJvcik7DQogICAgICAgICAgICAgICAgcmVqZWN0KCJFcnJvciBnZXR0aW5nIHNhdmUgZmlsZXM6ICIgKyAoZXZlbnQudGFyZ2V0LmVycm9yID8gZXZlbnQudGFyZ2V0LmVycm9yLm1lc3NhZ2UgOiAiVW5rbm93biBlcnJvciIpKTsNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBpbiBnZXRTYXZlRmlsZXM6IiwgZXJyb3IpOw0KICAgICAgICAgICAgc2hvd01lc3NhZ2VCb3goIkZhaWxlZCB0byByZXRyaWV2ZSBzYXZlIGZpbGVzOiAiICsgZXJyb3IubWVzc2FnZSk7DQogICAgICAgICAgICByZXR1cm4gW107DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGRpc3BsYXlTYXZlRmlsZXMoKSB7DQogICAgICAgICAgY29uc3Qgc2F2ZUZpbGVMaXN0RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmVGaWxlTGlzdCcpOw0KICAgICAgICAgIHNhdmVGaWxlTGlzdERpdi5pbm5lckhUTUwgPSAnJzsNCiAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgY29uc3QgZmlsZXMgPSBhd2FpdCBnZXRTYXZlRmlsZXMoKTsNCiAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgc2F2ZUZpbGVMaXN0RGl2LmlubmVySFRNTCA9ICdObyBzYXZlcyBmb3VuZC4gVHJ5IGltcG9ydGluZyBvbmUgb3Igc2F2aW5nIGluLWdhbWUgZmlyc3QuJzsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZmlsZXMuZm9yRWFjaChmaWxlRW50cnkgPT4gew0KICAgICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IGZpbGVFbnRyeS5uYW1lOw0KICAgICAgICAgICAgICBjb25zdCBmaWxlRGF0YSA9IGZpbGVFbnRyeS5kYXRhOw0KICAgICAgICAgICAgICBjb25zdCBpdGVtRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgICAgICAgICAgIGl0ZW1EaXYuY2xhc3NMaXN0LmFkZCgnc2F2ZS1maWxlLWl0ZW0nKTsNCiAgICAgICAgICAgICAgY29uc3QgaW5mb0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgICAgICAgICAgICBpbmZvRGl2LmNsYXNzTGlzdC5hZGQoJ3NhdmUtZmlsZS1pbmZvJyk7DQogICAgICAgICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IGZpbGVEYXRhLnRpbWVzdGFtcCA/IG5ldyBEYXRlKGZpbGVEYXRhLnRpbWVzdGFtcCkudG9Mb2NhbGVTdHJpbmcoKSA6ICdOL0EnOw0KICAgICAgICAgICAgICBjb25zdCBzaXplID0gZmlsZURhdGEuY29udGVudHMgPyBmaWxlRGF0YS5jb250ZW50cy5ieXRlTGVuZ3RoIDogMDsNCiAgICAgICAgICAgICAgaW5mb0Rpdi5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmc+RmlsZTo8L3N0cm9uZz4gJHtmaWxlTmFtZS5yZXBsYWNlKCcvX3NhdmVkYXRhLycsICcnKX0NCiAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmc+TGFzdCBNb2RpZmllZDo8L3N0cm9uZz4gJHt0aW1lc3RhbXB9DQogICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPlNpemU6PC9zdHJvbmc+ICR7c2l6ZX0gYnl0ZXMNCiAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4NCiAgICAgICAgICAgICAgICBgOw0KICAgICAgICAgICAgICBjb25zdCBhY3Rpb25zRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgICAgICAgICAgIGFjdGlvbnNEaXYuY2xhc3NMaXN0LmFkZCgnc2F2ZS1maWxlLWFjdGlvbnMnKTsNCiAgICAgICAgICAgICAgY29uc3QgZG93bmxvYWRCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsNCiAgICAgICAgICAgICAgZG93bmxvYWRCdG4udGV4dENvbnRlbnQgPSAnRG93bmxvYWQnOw0KICAgICAgICAgICAgICBkb3dubG9hZEJ0bi5vbmNsaWNrID0gKCkgPT4gZG93bmxvYWRTYXZlRmlsZShmaWxlTmFtZSwgZmlsZURhdGEuY29udGVudHMpOw0KICAgICAgICAgICAgICBhY3Rpb25zRGl2LmFwcGVuZENoaWxkKGRvd25sb2FkQnRuKTsNCiAgICAgICAgICAgICAgY29uc3QgZGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7DQogICAgICAgICAgICAgIGRlbGV0ZUJ0bi50ZXh0Q29udGVudCA9ICdEZWxldGUnOw0KICAgICAgICAgICAgICBkZWxldGVCdG4uY2xhc3NMaXN0LmFkZCgnZGVsZXRlLWJ0bicpOw0KICAgICAgICAgICAgICBkZWxldGVCdG4ub25jbGljayA9IGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBjb25maXJtZWQgPSBhd2FpdCBjb25maXJtQm94KGBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlICIke2ZpbGVOYW1lfSI/YCk7DQogICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCkgew0KICAgICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlU2F2ZUZpbGUoZmlsZU5hbWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgYWN0aW9uc0Rpdi5hcHBlbmRDaGlsZChkZWxldGVCdG4pOw0KICAgICAgICAgICAgICBpdGVtRGl2LmFwcGVuZENoaWxkKGluZm9EaXYpOw0KICAgICAgICAgICAgICBpdGVtRGl2LmFwcGVuZENoaWxkKGFjdGlvbnNEaXYpOw0KICAgICAgICAgICAgICBzYXZlRmlsZUxpc3REaXYuYXBwZW5kQ2hpbGQoaXRlbURpdik7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZGlzcGxheWluZyBzYXZlIGZpbGVzOiIsIGVycm9yKTsNCiAgICAgICAgICAgIHNhdmVGaWxlTGlzdERpdi5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBzdHlsZT0idGV4dC1hbGlnbjogY2VudGVyOyBjb2xvcjogI0ZBMUU0RTsiPkVycm9yIGxvYWRpbmcgZmlsZXM6ICR7ZXJyb3IubWVzc2FnZX08L3A+YDsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBkb3dubG9hZFNhdmVGaWxlKGZpbGVOYW1lLCBjb250ZW50cykgew0KICAgICAgICAgIGlmICghY29udGVudHMpIHsNCiAgICAgICAgICAgIHNob3dNZXNzYWdlQm94KCJObyBjb250ZW50IHRvIGRvd25sb2FkIGZvciB0aGlzIGZpbGUhIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbY29udGVudHNdLCB7DQogICAgICAgICAgICB0eXBlOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJw0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7DQogICAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsNCiAgICAgICAgICBhLmhyZWYgPSB1cmw7DQogICAgICAgICAgYS5kb3dubG9hZCA9IGZpbGVOYW1lOw0KICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7DQogICAgICAgICAgYS5jbGljaygpOw0KICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSk7DQogICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpOw0KICAgICAgICAgIHNob3dNZXNzYWdlQm94KGBGaWxlICIke2ZpbGVOYW1lfSIgZG93bmxvYWRlZC5gKTsNCiAgICAgICAgfQ0KICAgICAgICBhc3luYyBmdW5jdGlvbiBkZWxldGVTYXZlRmlsZShmaWxlTmFtZSkgew0KICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICBhd2FpdCBvcGVuSW5kZXhlZERCKCk7DQogICAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKFtTVE9SRV9OQU1FXSwgJ3JlYWR3cml0ZScpOw0KICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShTVE9SRV9OQU1FKTsNCiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBvYmplY3RTdG9yZS5kZWxldGUoZmlsZU5hbWUpOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2VCb3goYEZpbGUgIiR7ZmlsZU5hbWV9IiBkZWxldGVkIHN1Y2Nlc3NmdWxseS5gKTsNCiAgICAgICAgICAgICAgICBkaXNwbGF5U2F2ZUZpbGVzKCk7DQogICAgICAgICAgICAgICAgcmVzb2x2ZSgpOw0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoZXZlbnQpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBkZWxldGluZyBmaWxlOiIsIGV2ZW50LnRhcmdldC5lcnJvcik7DQogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2VCb3goYEVycm9yIGRlbGV0aW5nIGZpbGUgIiR7ZmlsZU5hbWV9IjogYCArIChldmVudC50YXJnZXQuZXJyb3IgPyBldmVudC50YXJnZXQuZXJyb3IubWVzc2FnZSA6ICJVbmtub3duIGVycm9yIikpOw0KICAgICAgICAgICAgICAgIHJlamVjdCgiRXJyb3IgZGVsZXRpbmcgZmlsZS4iKTsNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBpbiBkZWxldGVTYXZlRmlsZToiLCBlcnJvcik7DQogICAgICAgICAgICBzaG93TWVzc2FnZUJveCgiRmFpbGVkIHRvIGRlbGV0ZSBzYXZlIGZpbGU6ICIgKyBlcnJvci5tZXNzYWdlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlVXBsb2FkKCkgew0KICAgICAgICAgIGNvbnN0IHVwbG9hZEZpbGVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGxvYWRGaWxlSW5wdXQnKTsNCiAgICAgICAgICBjb25zdCB1cGxvYWRGaWxlTmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwbG9hZEZpbGVOYW1lSW5wdXQnKTsNCiAgICAgICAgICBjb25zdCBmaWxlcyA9IHVwbG9hZEZpbGVJbnB1dC5maWxlczsNCiAgICAgICAgICBpZiAoZmlsZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICBzaG93TWVzc2FnZUJveCgiUGxlYXNlIHNlbGVjdCBhdCBsZWFzdCBvbmUgZmlsZSB0byB1cGxvYWQuIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCB1cGxvYWRQcm9taXNlcyA9IFtdOw0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICBjb25zdCBmaWxlID0gZmlsZXNbaV07DQogICAgICAgICAgICAgIGxldCBmaWxlTmFtZSA9IChmaWxlcy5sZW5ndGggPT09IDEgJiYgdXBsb2FkRmlsZU5hbWVJbnB1dC52YWx1ZS50cmltKCkpID8gdXBsb2FkRmlsZU5hbWVJbnB1dC52YWx1ZS50cmltKCkgOiBmaWxlLm5hbWU7DQogICAgICAgICAgICAgIGZpbGVOYW1lID0gZmlsZU5hbWUucmVwbGFjZSgvXl9zYXZlZGF0YVwvLywgJycpOw0KICAgICAgICAgICAgICBmaWxlTmFtZSA9IGZpbGVOYW1lLnJlcGxhY2UoL15cLy8sICcnKTsNCiAgICAgICAgICAgICAgaWYgKCFmaWxlTmFtZSkgew0KICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlQm94KGBJbnZhbGlkIGZpbGUgbmFtZSBmb3IgIiR7ZmlsZS5uYW1lfSIgYWZ0ZXIgcHJvY2Vzc2luZy4gU2tpcHBpbmcuYCk7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgIGNvbnN0IHVpbnQ4QXJyYXlDb250ZW50cyA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgY29uc3Qgc2F2ZU9iamVjdCA9IHsNCiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksDQogICAgICAgICAgICAgICAgbW9kZTogMzMyMDYsDQogICAgICAgICAgICAgICAgY29udGVudHM6IHVpbnQ4QXJyYXlDb250ZW50cw0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICBjb25zdCBmaW5hbEZpbGVOYW1lID0gYC9fc2F2ZWRhdGEvJHtmaWxlTmFtZX1gOw0KICAgICAgICAgICAgICB1cGxvYWRQcm9taXNlcy5wdXNoKHNhdmVTYXZlRmlsZShmaW5hbEZpbGVOYW1lLCBzYXZlT2JqZWN0KSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbCh1cGxvYWRQcm9taXNlcyk7DQogICAgICAgICAgICBzaG93TWVzc2FnZUJveChgJHtmaWxlcy5sZW5ndGh9IGZpbGUocykgdXBsb2FkZWQgYW5kIHNhdmVkIHN1Y2Nlc3NmdWxseS5gKTsNCiAgICAgICAgICAgIHVwbG9hZEZpbGVJbnB1dC52YWx1ZSA9ICcnOw0KICAgICAgICAgICAgdXBsb2FkRmlsZU5hbWVJbnB1dC52YWx1ZSA9ICcnOw0KICAgICAgICAgICAgZGlzcGxheVNhdmVGaWxlcygpOw0KICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciB1cGxvYWRpbmcgZmlsZShzKToiLCBlcnJvcik7DQogICAgICAgICAgICBzaG93TWVzc2FnZUJveCgiRmFpbGVkIHRvIHVwbG9hZCBvbmUgb3IgbW9yZSBmaWxlczogIiArIGVycm9yLm1lc3NhZ2UpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBhc3luYyBmdW5jdGlvbiBleHBvcnRBbGxUb1ppcCgpIHsNCiAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgY29uc3QgZmlsZXMgPSBhd2FpdCBnZXRTYXZlRmlsZXMoKTsNCiAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgc2hvd01lc3NhZ2VCb3goIk5vIHNhdmUgZmlsZXMgdG8gZXhwb3J0LiIpOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCB6aXAgPSBuZXcgSlNaaXAoKTsNCiAgICAgICAgICAgIGZpbGVzLmZvckVhY2goZmlsZUVudHJ5ID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBmaWxlRW50cnkubmFtZS5yZXBsYWNlKC9eXC9fc2F2ZWRhdGFcLy8sICcnKTsNCiAgICAgICAgICAgICAgY29uc3QgY29udGVudHMgPSBmaWxlRW50cnkuZGF0YS5jb250ZW50czsNCiAgICAgICAgICAgICAgaWYgKGNvbnRlbnRzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgemlwQ29udGVudHMgPSAoY29udGVudHMgaW5zdGFuY2VvZiBJbnQ4QXJyYXkpID8gbmV3IFVpbnQ4QXJyYXkoY29udGVudHMuYnVmZmVyKSA6IGNvbnRlbnRzOw0KICAgICAgICAgICAgICAgIHppcC5maWxlKGZpbGVOYW1lLCB6aXBDb250ZW50cyk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgY29uc3QgemlwQmxvYiA9IGF3YWl0IHppcC5nZW5lcmF0ZUFzeW5jKHsNCiAgICAgICAgICAgICAgdHlwZTogJ2Jsb2InDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoemlwQmxvYik7DQogICAgICAgICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOw0KICAgICAgICAgICAgYS5ocmVmID0gdXJsOw0KICAgICAgICAgICAgYS5kb3dubG9hZCA9ICdVTkRFUlRBTEVXZWJfU0FWRXMuemlwJzsNCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7DQogICAgICAgICAgICBhLmNsaWNrKCk7DQogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOw0KICAgICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpOw0KICAgICAgICAgICAgc2hvd01lc3NhZ2VCb3goIkFsbCBzYXZlIGZpbGVzIGV4cG9ydGVkIHRvIFVOREVSVEFMRVdlYl9TQVZFcy56aXAuIik7DQogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGV4cG9ydGluZyB0byBaSVA6IiwgZXJyb3IpOw0KICAgICAgICAgICAgc2hvd01lc3NhZ2VCb3goIkZhaWxlZCB0byBleHBvcnQgdG8gWklQOiAiICsgZXJyb3IubWVzc2FnZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGFzeW5jIGZ1bmN0aW9uIHNhdmVTYXZlRmlsZShmaWxlTmFtZSwgZGF0YSkgew0KICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICBhd2FpdCBvcGVuSW5kZXhlZERCKCk7DQogICAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKFtTVE9SRV9OQU1FXSwgJ3JlYWR3cml0ZScpOw0KICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShTVE9SRV9OQU1FKTsNCiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBvYmplY3RTdG9yZS5wdXQoZGF0YSwgZmlsZU5hbWUpOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgcmVzb2x2ZSgpOw0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoZXZlbnQpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzYXZpbmcgZmlsZToiLCBldmVudC50YXJnZXQuZXJyb3IpOw0KICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlQm94KCJFcnJvciBzYXZpbmcgZmlsZTogIiArIChldmVudC50YXJnZXQuZXJyb3IgPyBldmVudC50YXJnZXQuZXJyb3IubWVzc2FnZSA6ICJVbmtub3duIGVycm9yIikpOw0KICAgICAgICAgICAgICAgIHJlamVjdCgiRXJyb3Igc2F2aW5nIGZpbGUuIik7DQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgaW4gc2F2ZVNhdmVGaWxlOiIsIGVycm9yKTsNCiAgICAgICAgICAgIHNob3dNZXNzYWdlQm94KCJGYWlsZWQgdG8gc2F2ZSBmaWxlOiAiICsgZXJyb3IubWVzc2FnZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGFzeW5jIGZ1bmN0aW9uIG9wZW5TQVZFTWFuYWdlcigpIHsNCiAgICAgICAgICBjb25zdCBzYXZlTWFuYWdlck1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmVNYW5hZ2VyTW9kYWwnKTsNCiAgICAgICAgICBzYXZlTWFuYWdlck1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQogICAgICAgICAgYXdhaXQgZGlzcGxheVNhdmVGaWxlcygpOw0KICAgICAgICAgIEdNX3BhdXNlKCk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBjbG9zZVNBVkVNYW5hZ2VyKCkgew0KICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsNCiAgICAgICAgICBjb25zdCBzYXZlTWFuYWdlck1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmVNYW5hZ2VyTW9kYWwnKTsNCiAgICAgICAgICBzYXZlTWFuYWdlck1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBjbG9zZVNNbm9yZWxvYWQoKSB7DQogICAgICAgICAgY29uc3Qgc2F2ZU1hbmFnZXJNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlTWFuYWdlck1vZGFsJyk7DQogICAgICAgICAgc2F2ZU1hbmFnZXJNb2RhbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgIEdNX3VucGF1c2UoKTsNCiAgICAgICAgfQ0KICAgICAgICBsZXQgdXBsb2FkRmlsZU5hbWVJbnB1dCA9IG51bGw7DQoNCiAgICAgICAgZnVuY3Rpb24gcHJvdGVjdElucHV0RnJvbUdhbWUoZSkgew0KICAgICAgICAgIGlmICh1cGxvYWRGaWxlTmFtZUlucHV0ICYmIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IHVwbG9hZEZpbGVOYW1lSW5wdXQpIHsNCiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7DQogICAgICAgICAgdXBsb2FkRmlsZU5hbWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGxvYWRGaWxlTmFtZUlucHV0Jyk7DQogICAgICAgICAgY29uc3QgdXBsb2FkRmlsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwbG9hZEZpbGVJbnB1dCcpOw0KICAgICAgICAgIGlmICh1cGxvYWRGaWxlSW5wdXQgJiYgdXBsb2FkRmlsZU5hbWVJbnB1dCkgew0KICAgICAgICAgICAgaWYgKHVwbG9hZEZpbGVJbnB1dCAmJiB1cGxvYWRGaWxlTmFtZUlucHV0KSB7DQogICAgICAgICAgICAgIHVwbG9hZEZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKHVwbG9hZEZpbGVJbnB1dC5maWxlcy5sZW5ndGggPT09IDEpIHsNCiAgICAgICAgICAgICAgICAgIHVwbG9hZEZpbGVOYW1lSW5wdXQuZGlzYWJsZWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgIHVwbG9hZEZpbGVOYW1lSW5wdXQudmFsdWUgPSB1cGxvYWRGaWxlSW5wdXQuZmlsZXNbMF0ubmFtZTsNCiAgICAgICAgICAgICAgICAgIHVwbG9hZEZpbGVOYW1lSW5wdXQucGxhY2Vob2xkZXIgPSAnRW50ZXIgdGhlIGNvcnJlc3BvbmRpbmcgZmlsZW5hbWUgKGUuZy4sIGZpbGVjaDFfMCwgZHIuaW5pIC8gZm9yIHNpbmdsZSBmaWxlIG9ubHkpJzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgdXBsb2FkRmlsZU5hbWVJbnB1dC5kaXNhYmxlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICB1cGxvYWRGaWxlTmFtZUlucHV0LnZhbHVlID0gJyc7DQogICAgICAgICAgICAgICAgICB1cGxvYWRGaWxlTmFtZUlucHV0LnBsYWNlaG9sZGVyID0gJ0N1c3RvbSBmaWxlbmFtZXMgZG8gbm90IHdvcmsgd2hlbiBzZWxlY3RpbmcgbXVsdGlwbGUgZmlsZXMhJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAodXBsb2FkRmlsZU5hbWVJbnB1dCkgew0KICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBwcm90ZWN0SW5wdXRGcm9tR2FtZSwgdHJ1ZSk7DQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBwcm90ZWN0SW5wdXRGcm9tR2FtZSwgdHJ1ZSk7DQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCBwcm90ZWN0SW5wdXRGcm9tR2FtZSwgdHJ1ZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICBvcGVuU0FWRU1hbmFnZXI6IG9wZW5TQVZFTWFuYWdlciwNCiAgICAgICAgICBjbG9zZVNBVkVNYW5hZ2VyOiBjbG9zZVNBVkVNYW5hZ2VyLA0KICAgICAgICAgIGNsb3NlU01ub3JlbG9hZDogY2xvc2VTTW5vcmVsb2FkLA0KICAgICAgICAgIGhhbmRsZVVwbG9hZDogaGFuZGxlVXBsb2FkLA0KICAgICAgICAgIHNob3dNZXNzYWdlQm94OiBzaG93TWVzc2FnZUJveCwNCiAgICAgICAgICBjb25maXJtQm94OiBjb25maXJtQm94LA0KICAgICAgICAgIG9wZW5JbmRleGVkREI6IG9wZW5JbmRleGVkREIsDQogICAgICAgICAgZXhwb3J0QWxsVG9aaXA6IGV4cG9ydEFsbFRvWmlwDQogICAgICAgIH07DQogICAgICB9KSgpOw0KICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBhc3luYyAoKSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgYXdhaXQgd2luZG93LlNBVkVNYW5hZ2VyLm9wZW5JbmRleGVkREIoKTsNCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBJbmRleGVkREIgb24gbG9hZDoiLCBlcnJvcik7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgICAgKGZ1bmN0aW9uKCkgew0KICAgICAgICBjb25zdCBvcmlnaW5hbExvZyA9IGNvbnNvbGUubG9nOw0KICAgICAgICBjb25zb2xlLmxvZyA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHsNCiAgICAgICAgICBvcmlnaW5hbExvZy5hcHBseShjb25zb2xlLCBhcmdzKTsNCiAgICAgICAgICBpZiAoYXJncy5pbmNsdWRlcygiSGVhZGluZyBiYWNrIHRvIGhvbWVwYWdlLi4uIikpIHsNCiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy8nOw0KICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgIH0pKCk7DQogICAgICAoZnVuY3Rpb24oKSB7DQogICAgICAgIGNvbnN0IG9yaWdpbmFsTG9nID0gY29uc29sZS5sb2c7DQogICAgICAgIGNvbnNvbGUubG9nID0gZnVuY3Rpb24oLi4uYXJncykgew0KICAgICAgICAgIG9yaWdpbmFsTG9nLmFwcGx5KGNvbnNvbGUsIGFyZ3MpOw0KICAgICAgICAgIGlmIChhcmdzLmluY2x1ZGVzKCJFUlJPUiBpbiIpKSB7DQogICAgICAgICAgICBpZiAoY29uZmlybSgiSGV5YSEgU2VlbXMgbGlrZSBVTkRFUlRBTEUgWWVsbG93IGhhcyBjcmFzaGVkISBXb3VsZCB5b3UgbGlrZSB0byByZWxvYWQgdGhlIHBhZ2U/IikpIHsNCiAgICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgfSkoKTsNCiAgICA8L3NjcmlwdD4NCiAgICA8c2NyaXB0Pg0KICAgICAgZnVuY3Rpb24gc2hvd1RvZ2dsZU1lc3NhZ2UoYnV0dG9uLCBtZXNzYWdlKSB7DQogICAgICAgIGNvbnN0IG9sZE1lc3NhZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudG9nZ2xlLWZlZWRiYWNrJyk7DQogICAgICAgIGlmIChvbGRNZXNzYWdlKSBvbGRNZXNzYWdlLnJlbW92ZSgpOw0KICAgICAgICBjb25zdCByZWN0ID0gYnV0dG9uLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgICAgICBwb3B1cC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7DQogICAgICAgIE9iamVjdC5hc3NpZ24ocG9wdXAuc3R5bGUsIHsNCiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywNCiAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOSknLA0KICAgICAgICAgIGNvbG9yOiAnIzFhMWExYScsDQogICAgICAgICAgcGFkZGluZzogJzZweCAxMnB4JywNCiAgICAgICAgICBib3JkZXJSYWRpdXM6ICcxNXB4JywNCiAgICAgICAgICBmb250RmFtaWx5OiAnc2Fucy1zZXJpZicsDQogICAgICAgICAgZm9udFNpemU6ICcxM3B4JywNCiAgICAgICAgICBmb250V2VpZ2h0OiAnYm9sZCcsDQogICAgICAgICAgekluZGV4OiAnOTk5OScsDQogICAgICAgICAgcG9pbnRlckV2ZW50czogJ25vbmUnLA0KICAgICAgICAgIGxlZnQ6IGAke3JlY3QubGVmdCArIHJlY3Qud2lkdGggLyAyfXB4YCwNCiAgICAgICAgICB0b3A6IGAke3JlY3QudG9wfXB4YCwNCiAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGUoLTUwJSwgLTExMCUpJywNCiAgICAgICAgICBvcGFjaXR5OiAnMScsDQogICAgICAgICAgdHJhbnNpdGlvbjogJ29wYWNpdHkgMC40cyBlYXNlLW91dCwgdHJhbnNmb3JtIDAuNHMgZWFzZS1vdXQnDQogICAgICAgIH0pOw0KICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBvcHVwKTsNCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgcG9wdXAuc3R5bGUub3BhY2l0eSA9ICcwJzsNCiAgICAgICAgICBwb3B1cC5zdHlsZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlKC01MCUsIC0xNjAlKSc7DQogICAgICAgIH0sIDgwMCk7DQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcG9wdXAucmVtb3ZlKCksIDEyMDApOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzaW11bGF0ZUtleUV2ZW50KGV2ZW50VHlwZSwga2V5LCBrZXlDb2RlKSB7DQogICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEtleWJvYXJkRXZlbnQoZXZlbnRUeXBlLCB7DQogICAgICAgICAga2V5OiBrZXksDQogICAgICAgICAga2V5Q29kZToga2V5Q29kZSwNCiAgICAgICAgICB3aGljaDoga2V5Q29kZSwNCiAgICAgICAgICBidWJibGVzOiB0cnVlLA0KICAgICAgICAgIGNhbmNlbGFibGU6IHRydWUsDQogICAgICAgIH0pOw0KICAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTsNCiAgICAgIH0NCiAgICAgIChmdW5jdGlvbih3aW5kb3cpIHsNCiAgICAgICAgY29uc3QgV0FTRF9DT05UUk9MTEVSID0gew0KICAgICAgICAgIGlzRW5hYmxlZDogZmFsc2UsDQogICAgICAgICAgYm91bmRIYW5kbGVyOiBudWxsLA0KICAgICAgICAgIGV2ZW50VGFyZ2V0OiBkb2N1bWVudC5ib2R5LA0KICAgICAgICAgIGtleU1hcDogew0KICAgICAgICAgICAgJ3cnOiB7DQogICAgICAgICAgICAgIGtleTogJ0Fycm93VXAnLA0KICAgICAgICAgICAgICBjb2RlOiAnQXJyb3dVcCcsDQogICAgICAgICAgICAgIGtleUNvZGU6IDM4DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgJ2EnOiB7DQogICAgICAgICAgICAgIGtleTogJ0Fycm93TGVmdCcsDQogICAgICAgICAgICAgIGNvZGU6ICdBcnJvd0xlZnQnLA0KICAgICAgICAgICAgICBrZXlDb2RlOiAzNw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICdzJzogew0KICAgICAgICAgICAgICBrZXk6ICdBcnJvd0Rvd24nLA0KICAgICAgICAgICAgICBjb2RlOiAnQXJyb3dEb3duJywNCiAgICAgICAgICAgICAga2V5Q29kZTogNDANCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAnZCc6IHsNCiAgICAgICAgICAgICAga2V5OiAnQXJyb3dSaWdodCcsDQogICAgICAgICAgICAgIGNvZGU6ICdBcnJvd1JpZ2h0JywNCiAgICAgICAgICAgICAga2V5Q29kZTogMzkNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAnVyc6IHsNCiAgICAgICAgICAgICAga2V5OiAnQXJyb3dVcCcsDQogICAgICAgICAgICAgIGNvZGU6ICdBcnJvd1VwJywNCiAgICAgICAgICAgICAga2V5Q29kZTogMzgNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAnQSc6IHsNCiAgICAgICAgICAgICAga2V5OiAnQXJyb3dMZWZ0JywNCiAgICAgICAgICAgICAgY29kZTogJ0Fycm93TGVmdCcsDQogICAgICAgICAgICAgIGtleUNvZGU6IDM3DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgJ1MnOiB7DQogICAgICAgICAgICAgIGtleTogJ0Fycm93RG93bicsDQogICAgICAgICAgICAgIGNvZGU6ICdBcnJvd0Rvd24nLA0KICAgICAgICAgICAgICBrZXlDb2RlOiA0MA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICdEJzogew0KICAgICAgICAgICAgICBrZXk6ICdBcnJvd1JpZ2h0JywNCiAgICAgICAgICAgICAgY29kZTogJ0Fycm93UmlnaHQnLA0KICAgICAgICAgICAgICBrZXlDb2RlOiAzOQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgaGFuZGxlS2V5RXZlbnQ6IGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICBpZiAoIXRoaXMuaXNFbmFibGVkKSByZXR1cm47DQogICAgICAgICAgICBjb25zdCB0YXJnZXROb2RlID0gZXZlbnQudGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICBpZiAodGFyZ2V0Tm9kZSA9PT0gJ2lucHV0JyB8fCB0YXJnZXROb2RlID09PSAndGV4dGFyZWEnIHx8IGV2ZW50LnRhcmdldC5pc0NvbnRlbnRFZGl0YWJsZSkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBrZXlEYXRhID0gdGhpcy5rZXlNYXBbZXZlbnQua2V5XTsNCiAgICAgICAgICAgIGlmIChrZXlEYXRhKSB7DQogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICAgICAgICBjb25zdCBhcnJvd0tleUV2ZW50ID0gbmV3IEtleWJvYXJkRXZlbnQoZXZlbnQudHlwZSwgew0KICAgICAgICAgICAgICAgIGtleToga2V5RGF0YS5rZXksDQogICAgICAgICAgICAgICAgY29kZToga2V5RGF0YS5jb2RlLA0KICAgICAgICAgICAgICAgIGJ1YmJsZXM6IHRydWUsDQogICAgICAgICAgICAgICAgY2FuY2VsYWJsZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICBjb21wb3NlZDogdHJ1ZSwNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhcnJvd0tleUV2ZW50LCAna2V5Q29kZScsIHsNCiAgICAgICAgICAgICAgICB2YWx1ZToga2V5RGF0YS5rZXlDb2RlLA0KICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQ0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGFycm93S2V5RXZlbnQsICd3aGljaCcsIHsNCiAgICAgICAgICAgICAgICB2YWx1ZToga2V5RGF0YS5rZXlDb2RlLA0KICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQ0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgdGhpcy5ldmVudFRhcmdldC5kaXNwYXRjaEV2ZW50KGFycm93S2V5RXZlbnQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLmlzRW5hYmxlZCkgcmV0dXJuOw0KICAgICAgICAgICAgdGhpcy5ib3VuZEhhbmRsZXIgPSB0aGlzLmJvdW5kSGFuZGxlciB8fCB0aGlzLmhhbmRsZUtleUV2ZW50LmJpbmQodGhpcyk7DQogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5ib3VuZEhhbmRsZXIsIHRydWUpOw0KICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLmJvdW5kSGFuZGxlciwgdHJ1ZSk7DQogICAgICAgICAgICB0aGlzLmlzRW5hYmxlZCA9IHRydWU7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnV0FTRCAtPiBhcnJvdyBrZXkgY29udHJvbCBoYXMgYmVlbiBFTkFCTEVEISBUYXJnZXQ6JywgdGhpcy5ldmVudFRhcmdldCk7DQogICAgICAgICAgfSwNCiAgICAgICAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIGlmICghdGhpcy5pc0VuYWJsZWQgfHwgIXRoaXMuYm91bmRIYW5kbGVyKSByZXR1cm47DQogICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5ib3VuZEhhbmRsZXIsIHRydWUpOw0KICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLmJvdW5kSGFuZGxlciwgdHJ1ZSk7DQogICAgICAgICAgICB0aGlzLmlzRW5hYmxlZCA9IGZhbHNlOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1dBU0QgLT4gYXJyb3cga2V5IGNvbnRyb2wgaGFzIGJlZW4gRElTQUJMRUQhJyk7DQogICAgICAgICAgfSwNCiAgICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKGJ1dHRvbikgew0KICAgICAgICAgICAgaWYgKHRoaXMuaXNFbmFibGVkKSB7DQogICAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpOw0KICAgICAgICAgICAgICBzaG93VG9nZ2xlTWVzc2FnZShidXR0b24sICdUb2dnbGVkIG9mZiEnKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHRoaXMuZW5hYmxlKCk7DQogICAgICAgICAgICAgIHNob3dUb2dnbGVNZXNzYWdlKGJ1dHRvbiwgJ1RvZ2dsZWQgb24hJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICB3aW5kb3cudG9nZ2xlV0FTRCA9IGZ1bmN0aW9uKGJ1dHRvbikgew0KICAgICAgICAgIFdBU0RfQ09OVFJPTExFUi50b2dnbGUoYnV0dG9uKTsNCiAgICAgICAgfTsNCiAgICAgIH0pKHdpbmRvdyk7DQogICAgPC9zY3JpcHQ+DQogICAgPHNjcmlwdD4NCiAgICAgIGFsZXJ0KCJMb2FkaW5nLCB0aGlzIG1heSB0YWtlIGEgd2hpbGUuLi4iKTsNCiAgICAgIGFsZXJ0KCJNYWtlIHN1cmUgdG8gY2xpY2sgaW5zaWRlIHRoZSB0YWIgd2hlbiB0aGUgZ2FtZSBmaW5pc2hlcyBsb2FkaW5nIGZvciBhdWRpbyEiKTsNCiAgICAgIGNvbnN0IGtvbmFtaUNvZGUgPSBbJ3AnLCAnaScsICdlJ107DQogICAgICBsZXQga29uYW1pSW5kZXggPSAwOw0KDQogICAgICBmdW5jdGlvbiBoaWRlVUkoKSB7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdXRwdXQtY29udGFpbmVyJykuY2xhc3NMaXN0LnJlbW92ZSgndmlzaWJsZScpOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVzc2FnZS1jb250YWluZXInKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4tdWknKTsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlVUlCdXR0b24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzaG93VUkoKSB7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdXRwdXQtY29udGFpbmVyJykuY2xhc3NMaXN0LmFkZCgndmlzaWJsZScpOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVzc2FnZS1jb250YWluZXInKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4tdWknKTsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlVUlCdXR0b24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgZW5zdXJlQXNwZWN0UmF0aW8oKTsNCiAgICAgIH0NCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4gew0KICAgICAgICBpZiAoZS5rZXkgPT09IGtvbmFtaUNvZGVba29uYW1pSW5kZXhdKSB7DQogICAgICAgICAga29uYW1pSW5kZXgrKzsNCiAgICAgICAgICBpZiAoa29uYW1pSW5kZXggPT09IGtvbmFtaUNvZGUubGVuZ3RoKSB7DQogICAgICAgICAgICBzaG93VUkoKTsNCiAgICAgICAgICAgIGtvbmFtaUluZGV4ID0gMDsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAga29uYW1pSW5kZXggPSAwOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4gew0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3V0cHV0LWNvbnRhaW5lcicpLmNsYXNzTGlzdC5yZW1vdmUoJ3Zpc2libGUnKTsNCiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxvYWRpbmcnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4tdWknKTsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lc3NhZ2UtY29udGFpbmVyJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuLXVpJyk7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZVVJQnV0dG9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgIH0pOw0KICAgIDwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgaWQ9InRpY2std29ya2VyIiB0eXBlPSJqYXZhc2NyaXB0L3dvcmtlciI+DQogICAgICBsZXQgcnVubmluZyA9IGZhbHNlOw0KICAgICAgbGV0IHN0b3BfY2FsbGVkID0gZmFsc2U7DQoNCiAgICAgIGxldCBpbnRlcnZhbE1zID0gMTY7DQoNCiAgICAgIG9ubWVzc2FnZSA9IChlKSA9PiB7DQogICAgICAgIGlmIChlLmRhdGEucnVuKSB7DQogICAgICAgICAgaW50ZXJ2YWxNcyA9IE1hdGguZmxvb3IoMTAwMCAvIGUuZGF0YS5mcHMpOw0KDQogICAgICAgICAgaWYgKCFydW5uaW5nKSB7DQogICAgICAgICAgICBydW5uaW5nID0gdHJ1ZTsNCiAgICAgICAgICAgIHNldFRpbWVvdXQodGljaywgaW50ZXJ2YWxNcyk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHN0b3BfY2FsbGVkID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBjb25zdCB0aWNrID0gKCkgPT4gew0KICAgICAgICBpZiAoc3RvcF9jYWxsZWQpIHsNCiAgICAgICAgICBzdG9wX2NhbGxlZCA9IGZhbHNlOw0KICAgICAgICAgIHJ1bm5pbmcgPSBmYWxzZTsNCg0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQogICAgICAgIHBvc3RNZXNzYWdlKCcnKTsNCiAgICAgICAgY29uc3QgZW5kID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQoNCiAgICAgICAgbGV0IG5leHRfdXBkYXRlID0gc3RhcnQgKyBpbnRlcnZhbE1zIC0gZW5kOw0KICAgICAgICBuZXh0X3VwZGF0ZSA9IE1hdGgubWF4KG5leHRfdXBkYXRlLCAwKTsNCiAgICAgICAgc2V0VGltZW91dCh0aWNrLCBuZXh0X3VwZGF0ZSk7DQogICAgICB9DQogICAgPC9zY3JpcHQ+DQoNCiAgICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQogICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0aWNrLXdvcmtlcicpLnRleHRDb250ZW50XSk7DQogICAgICBjb25zdCB3b3JrZXIgPSBuZXcgV29ya2VyKHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpKTsNCg0KICAgICAgd29ya2VyLm9ubWVzc2FnZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgR01fdGljayhwZXJmb3JtYW5jZS5ub3coKSk7DQogICAgICB9DQogICAgICANCiAgICAgIGlmICgiZ2V0R2FtZXBhZHMiIGluIG5hdmlnYXRvcikgew0KICAgICAgICBjb25zdCBzZW5kR2FtZXBhZEluZm8gPSAoaWQpID0+IHsNCiAgICAgICAgICBjb25zdCBmaXJlZm94UmVnZXggPSAvXihbMC05YS1mQS1GXXs0fSktKFswLTlhLWZBLUZdezR9KS0oLiopJC87DQogICAgICAgICAgY29uc3QgY2hyb21lUmVnZXggPSAvXiguKikgP1woLipbdlZdW2VFXVtuTl1bZERdW29PXVtyUl06ID8oWzAtOWEtZkEtRl17NH0pLipbcFBdW3JSXVtvT11bZERdW3VVXVtjQ11bdFRdOiA/KFswLTlhLWZBLUZdezR9KVwpJC87DQogICAgICAgICAgDQogICAgICAgICAgbGV0IG5hbWUgPSB1bmRlZmluZWQ7DQogICAgICAgICAgbGV0IHZlbmRvciA9IHVuZGVmaW5lZDsNCiAgICAgICAgICBsZXQgcHJvZHVjdCA9IHVuZGVmaW5lZDsNCiAgICAgICAgICBjb25zdCBmaXJlZm94TWF0Y2ggPSBpZC5tYXRjaChmaXJlZm94UmVnZXgpOw0KICAgICAgICAgIGlmIChmaXJlZm94TWF0Y2gpIHsNCiAgICAgICAgICAgIG5hbWUgPSBmaXJlZm94TWF0Y2hbM107DQogICAgICAgICAgICB2ZW5kb3IgPSBmaXJlZm94TWF0Y2hbMV07DQogICAgICAgICAgICBwcm9kdWN0ID0gZmlyZWZveE1hdGNoWzJdOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjb25zdCBjaHJvbWVNYXRjaCA9IGlkLm1hdGNoKGNocm9tZVJlZ2V4KTsNCiAgICAgICAgICAgIGlmIChjaHJvbWVNYXRjaCkgew0KICAgICAgICAgICAgICBuYW1lID0gY2hyb21lTWF0Y2hbMV07DQogICAgICAgICAgICAgIHZlbmRvciA9IGNocm9tZU1hdGNoWzJdOw0KICAgICAgICAgICAgICBwcm9kdWN0ID0gY2hyb21lTWF0Y2hbM107DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIA0KICAgICAgICAgIGlmICghbmFtZSkgew0KICAgICAgICAgICAgbmFtZSA9ICIiOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAoIXZlbmRvcikgew0KICAgICAgICAgICAgdmVuZG9yID0gIiI7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmICghcHJvZHVjdCkgew0KICAgICAgICAgICAgcHJvZHVjdCA9ICIiOw0KICAgICAgICAgIH0NCiAgICAgICAgICBuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgIHZlbmRvciA9IHZlbmRvci50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgIHByb2R1Y3QgPSBwcm9kdWN0LnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgDQogICAgICAgICAgbGV0IHBzID0gZmFsc2U7DQogICAgICAgICAgbGV0IGR1YWxzZW5zZSA9IGZhbHNlOw0KICAgICAgICAgIGlmIChuYW1lLmluY2x1ZGVzKCJkdWFsc2Vuc2UiKSB8fCBuYW1lLmluY2x1ZGVzKCJwczUiKSkgew0KICAgICAgICAgICAgcHMgPSB0cnVlOw0KICAgICAgICAgICAgZHVhbHNlbnNlID0gdHJ1ZTsNCiAgICAgICAgICB9IGVsc2UgaWYgKHZlbmRvciA9PSAiMDU0YyIgfHwNCiAgICAgICAgICAgICAgICAgICAgIG5hbWUuaW5jbHVkZXMoInBsYXlzdGF0aW9uIikgfHwgbmFtZS5pbmNsdWRlcygiZHVhbHNob2NrIikgfHwNCiAgICAgICAgICAgICAgICAgICAgIG5hbWUuaW5jbHVkZXMoInBzMSIpIHx8IG5hbWUuaW5jbHVkZXMoInBzMiIpIHx8DQogICAgICAgICAgICAgICAgICAgICBuYW1lLmluY2x1ZGVzKCJwczMiKSB8fCBuYW1lLmluY2x1ZGVzKCJwczQiKSkgew0KICAgICAgICAgICAgcHMgPSB0cnVlOw0KICAgICAgICAgIH0NCiAgICAgICAgICBjb25zdCBkYXRhVG9TZW5kID0geyBnYW1lcGFkSXNQbGF5c3RhdGlvbjogcHMsIGdhbWVwYWRJc0R1YWxzZW5zZTogZHVhbHNlbnNlIH07DQogICAgICAgICAgd2luZG93LnBvc3RNZXNzYWdlKGRhdGFUb1NlbmQpOw0KICAgICAgICB9Ow0KICAgICAgDQogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJnYW1lcGFkY29ubmVjdGVkIiwgKGV2ZW50KSA9PiB7DQogICAgICAgICAgY29uc3QgaWQgPSBldmVudC5nYW1lcGFkLmlkOw0KICAgICAgICAgIGNvbnNvbGUubG9nKCJHYW1lcGFkIGNvbm5lY3RlZCB3aXRoIElEOiAiICsgaWQpOw0KICAgICAgICAgIHNlbmRHYW1lcGFkSW5mbyhpZCk7DQogICAgICAgIH0pOw0KICAgICAgICANCiAgICAgICAgc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgIGNvbnN0IGdhbWVwYWRzID0gbmF2aWdhdG9yLmdldEdhbWVwYWRzKCk7DQogICAgICAgICAgbGV0IGFjdGl2aXR5RGV0ZWN0ZWRJbmRleCA9IC0xOw0KICAgICAgICAgIGZvciAoY29uc3QgZ3Agb2YgZ2FtZXBhZHMpIHsNCiAgICAgICAgICAgIGlmICghZ3ApIHsNCiAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsZXQgYWN0aXZpdHlEZXRlY3RlZCA9IGZhbHNlOw0KICAgICAgICAgICAgaWYgKGdwLm1hcHBpbmcgIT09ICJzdGFuZGFyZCIgfHwgZ3AuYXhlcy5sZW5ndGggPCAyKSB7DQogICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3AuYXhlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGFjdGl2aXR5RGV0ZWN0ZWQgfD0gTWF0aC5hYnMoZ3AuYXhlc1tpXSkgPj0gMC40Ow0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3AuYnV0dG9ucy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGFjdGl2aXR5RGV0ZWN0ZWQgfD0gZ3AuYnV0dG9uc1tpXS5wcmVzc2VkOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBhY3Rpdml0eURldGVjdGVkIHw9IE1hdGguYWJzKGdwLmF4ZXNbMF0pID49IDAuNCB8fCBNYXRoLmFicyhncC5heGVzWzFdKSA+PSAwLjQ7DQogICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3AuYnV0dG9ucy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGFjdGl2aXR5RGV0ZWN0ZWQgfD0gZ3AuYnV0dG9uc1tpXS5wcmVzc2VkOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYWN0aXZpdHlEZXRlY3RlZCkgew0KICAgICAgICAgICAgICBzZW5kR2FtZXBhZEluZm8oZ3AuaWQpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0sIDE2KTsNCiAgICAgIH0NCiAgICA8L3NjcmlwdD4NCg0KICAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4NCiAgICAgIC8vIENvbWJpbmVkIGFuZCBkZS1kdXBsaWNhdGVkIHZhcmlhYmxlIGRlY2xhcmF0aW9ucw0KICAgICAgY29uc3QgQ0hBTkdFX0FTUEVDVF9SQVRJTyA9IHRydWU7DQogICAgICB2YXIgYm9keUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdOw0KICAgICAgdmFyIHN0YXR1c0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3RhdHVzIik7DQogICAgICB2YXIgcHJvZ3Jlc3NFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2dyZXNzIik7DQogICAgICB2YXIgc3Bpbm5lckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3Bpbm5lciIpOw0KICAgICAgdmFyIGNhbnZhc0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2FudmFzIik7DQogICAgICB2YXIgb3V0cHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJvdXRwdXQiKTsNCiAgICAgIHZhciBvdXRwdXRDb250YWluZXJFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm91dHB1dC1jb250YWluZXIiKTsNCiAgICAgIGNvbnN0IG1lc3NhZ2VDb250YWluZXJFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1lc3NhZ2UtY29udGFpbmVyIik7DQogICAgICBjb25zdCBtZXNzYWdlc0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibWVzc2FnZXMiKTsNCiAgICAgIA0KICAgICAgLy8gRXZlbnQgbGlzdGVuZXIgZm9yIGNhbnZhcyBmb2N1cw0KICAgICAgY2FudmFzRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKCkgeyBjYW52YXNFbGVtZW50LmZvY3VzKCk7IH0pOw0KDQogICAgICAvLyBQcmV2ZW50IEdhbWVNYWtlciBmcm9tIGNoYW5naW5nIHdpbmRvdyB0aXRsZSBlcnJvbmVvdXNseS4NCiAgICAgIHZhciBhY3R1YWxEb2N1bWVudFRpdGxlID0gZG9jdW1lbnQudGl0bGU7DQogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZG9jdW1lbnQsICJ0aXRsZSIsIHsNCiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHt9LA0KICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gYWN0dWFsRG9jdW1lbnRUaXRsZTsgfQ0KICAgICAgfSk7DQoNCiAgICAgIC8vIFJvbGxiYWNrIG1lc3NhZ2UgaGFuZGxpbmcgZnJvbSB0aGUgc2Vjb25kIHNjcmlwdA0KICAgICAgbGV0IHJvbGxiYWNrTWVzc2FnZXMgPSBbXTsNCiAgICAgIGNvbnN0IENPTlNPTEVfbGF5ZXJfc2V0X3Zpc2libGUgPSAibGF5ZXJfc2V0X3Zpc2libGUoKSAtIGNvdWxkIG5vdCBmaW5kIHNwZWNpZmllZCBsYXllciBpbiBjdXJyZW50IHJvb20iOw0KICAgICAgY29uc3QgQ09OU09MRV9sYXllcl90aWxlbWFwX2dldF9pZCA9ICJsYXllcl90aWxlbWFwX2dldF9pZCgpIC0gc3BlY2lmaWVkIHRpbGVtYXAgbm90IGZvdW5kIjsNCiAgICAgIGNvbnN0IENPTlNPTEVfbGF5ZXJfZGVwdGggPSAibGF5ZXJfZGVwdGgoKSAtIGNhbid0IGZpbmQgc3BlY2lmaWVkIGxheWVyIjsNCiAgICAgIGNvbnN0IENPTlNPTEVfZHJhd190aWxlbWFwID0gImRyYXdfdGlsZW1hcCgpIC0gY291bGRuJ3QgZmluZCBzcGVjaWZpZWQgdGlsZW1hcCI7DQogICAgICBjb25zdCBDT05TT0xFX2xheWVyX2dldF9hbGxfZWxlbWVudHMgPSAibGF5ZXJfZ2V0X2FsbF9lbGVtZW50cygpIC0gY2FuJ3QgZmluZCBzcGVjaWZpZWQgbGF5ZXIiOw0KICAgICAgbGV0IGNsZWFyUm9sbGJhY2tNZXNzYWdlc1RpbWVvdXRJZCA9IC0xOw0KICAgICAgDQogICAgICBjb25zdCBzaG93Um9sbGJhY2tNZXNzYWdlID0gZnVuY3Rpb24obWVzc2FnZSkgew0KICAgICAgICBsZXQgbWVzc2FnZXMgPSAiIjsNCiAgICAgICAgcm9sbGJhY2tNZXNzYWdlcy5wdXNoKG1lc3NhZ2UpOw0KICAgICAgICByb2xsYmFja01lc3NhZ2VzLmZvckVhY2gobSA9PiBtZXNzYWdlcyArPSAiIDwgcCA+ICIgKyBtICsgIiA8IC9wPiIpOw0KICAgICAgICBtZXNzYWdlc0VsZW1lbnQuaW5uZXJIVE1MID0gbWVzc2FnZXM7DQogICAgICAgIG1lc3NhZ2VDb250YWluZXJFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICBpZiAoY2xlYXJSb2xsYmFja01lc3NhZ2VzVGltZW91dElkICE9PSAtMSkgew0KICAgICAgICAgIGNsZWFyVGltZW91dChjbGVhclJvbGxiYWNrTWVzc2FnZXNUaW1lb3V0SWQpOw0KICAgICAgICB9DQogICAgICAgIGNsZWFyUm9sbGJhY2tNZXNzYWdlc1RpbWVvdXRJZCA9IHNldFRpbWVvdXQoY2xlYXJSb2xsYmFja01lc3NhZ2VzLCA1MDAwKTsNCiAgICAgIH07DQoNCiAgICAgIGNvbnN0IGNsZWFyUm9sbGJhY2tNZXNzYWdlcyA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBjbGVhclJvbGxiYWNrTWVzc2FnZXNUaW1lb3V0SWQgPSAtMTsNCiAgICAgICAgcm9sbGJhY2tNZXNzYWdlcyA9IFtdOw0KICAgICAgICBtZXNzYWdlQ29udGFpbmVyRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgfTsNCg0KICAgICAgLy8gVXRpbGl0eSBhbmQgZ2FtZSBzdGF0ZSB2YXJpYWJsZXMNCiAgICAgIHZhciBsb2FkcHJvZ3Jlc3MgPSAwOw0KICAgICAgdmFyIHN0YXJ0aW5nSGVpZ2h0LCBzdGFydGluZ1dpZHRoOw0KICAgICAgdmFyIHN0YXJ0aW5nQXNwZWN0Ow0KICAgICAgDQogICAgICAvLyBNb3JlIGNvbXByZWhlbnNpdmUgTW9kdWxlIG9iamVjdCBmcm9tIHRoZSBzZWNvbmQgc2NyaXB0DQogICAgICB2YXIgTW9kdWxlID0gew0KICAgICAgICBwcmVSdW46IFtdLA0KICAgICAgICBwb3N0UnVuOiBbXSwNCiAgICAgICAgcHJpbnQ6IChmdW5jdGlvbigpIHsNCiAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJvdXRwdXQiKTsNCiAgICAgICAgICBpZiAoZWxlbWVudCkgZWxlbWVudC52YWx1ZSA9ICIiOw0KICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0ZXh0KSB7DQogICAgICAgICAgICBpZiAodGV4dCA9PT0gIlN0YXJ0aW5nIFdBRCIpIHsNCiAgICAgICAgICAgICAgbG9hZHByb2dyZXNzICs9IDE7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobG9hZHByb2dyZXNzID09PSAxKSB7DQogICAgICAgICAgICAgIE1vZHVsZS5zZXRTdGF0dXModGV4dCk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGxvYWRwcm9ncmVzcyA+PSAyKSB7DQogICAgICAgICAgICAgIE1vZHVsZS5zZXRTdGF0dXMoIiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB0ZXh0ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKS5qb2luKCIgIik7DQogICAgICAgICAgICBpZiAodGV4dCAhPSBDT05TT0xFX2xheWVyX3NldF92aXNpYmxlICYmIHRleHQgIT0gQ09OU09MRV9sYXllcl90aWxlbWFwX2dldF9pZCAmJiB0ZXh0ICE9IENPTlNPTEVfbGF5ZXJfZGVwdGggJiYgdGV4dCAhPSBDT05TT0xFX2RyYXdfdGlsZW1hcCAmJiB0ZXh0ICE9IENPTlNPTEVfbGF5ZXJfZ2V0X2FsbF9lbGVtZW50cykgew0KICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0ZXh0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0ZXh0ID09PSAiRW50ZXJpbmcgbWFpbiBsb29wLiIpIHsNCiAgICAgICAgICAgICAgZW5zdXJlQXNwZWN0UmF0aW8oKTsNCiAgICAgICAgICAgICAgbG9hZHByb2dyZXNzICs9IDE7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZWxlbWVudCkgew0KICAgICAgICAgICAgICBpZiAodGV4dCAhPSBDT05TT0xFX2xheWVyX3NldF92aXNpYmxlICYmIHRleHQgIT0gQ09OU09MRV9sYXllcl90aWxlbWFwX2dldF9pZCAmJiB0ZXh0ICE9IENPTlNPTEVfbGF5ZXJfZGVwdGggJiYgdGV4dCAhPSBDT05TT0xFX2RyYXdfdGlsZW1hcCAmJiB0ZXh0ICE9IENPTlNPTEVfbGF5ZXJfZ2V0X2FsbF9lbGVtZW50cykgew0KICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsdWUgKz0gdGV4dCArICJcbiI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgZWxlbWVudC5zY3JvbGxUb3AgPSBlbGVtZW50LnNjcm9sbEhlaWdodDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9Ow0KICAgICAgICB9KSgpLA0KICAgICAgICBwcmludEVycjogZnVuY3Rpb24odGV4dCkgew0KICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkgdGV4dCA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykuam9pbigiICIpOw0KICAgICAgICAgIGNvbnNvbGUuZXJyb3IodGV4dCk7DQogICAgICAgIH0sDQogICAgICAgIGNhbnZhczogKGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2FudmFzIik7DQogICAgICAgIH0pKCksDQogICAgICAgIHNldFN0YXR1czogZnVuY3Rpb24odGV4dCkgew0KICAgICAgICAgIGlmICghTW9kdWxlLnNldFN0YXR1cy5sYXN0KSBNb2R1bGUuc2V0U3RhdHVzLmxhc3QgPSB7IHRpbWU6IERhdGUubm93KCksIHRleHQ6ICIiIH07DQogICAgICAgICAgaWYgKHRleHQgPT09IE1vZHVsZS5zZXRTdGF0dXMubGFzdC50ZXh0KSByZXR1cm47DQogICAgICAgICAgdmFyIG0gPSB0ZXh0Lm1hdGNoKC8oW14oXSspXCgoXGQrKFwuXGQrKT8pXC8oXGQrKVwpLyk7DQogICAgICAgICAgdmFyIG5vdyA9IERhdGUubm93KCk7DQogICAgICAgICAgaWYgKG0gJiYgbm93IC0gTW9kdWxlLnNldFN0YXR1cy5sYXN0LnRpbWUgPCAzMCkgcmV0dXJuOw0KICAgICAgICAgIGlmICh0ZXh0LmluY2x1ZGVzKCJEb3dubG9hZGluZyBkYXRhLi4uIikpIHRleHQgPSAiRG93bmxvYWRpbmcgZGF0YS4uLiI7DQogICAgICAgICAgTW9kdWxlLnNldFN0YXR1cy5sYXN0LnRpbWUgPSBub3c7DQogICAgICAgICAgTW9kdWxlLnNldFN0YXR1cy5sYXN0LnRleHQgPSB0ZXh0Ow0KICAgICAgICAgIGlmIChtKSB7DQogICAgICAgICAgICB0ZXh0ID0gbVsxXTsNCiAgICAgICAgICAgIHByb2dyZXNzRWxlbWVudC52YWx1ZSA9IHBhcnNlSW50KG1bMl0pICogMTAwOw0KICAgICAgICAgICAgcHJvZ3Jlc3NFbGVtZW50Lm1heCA9IHBhcnNlSW50KG1bNF0pICogMTAwOw0KICAgICAgICAgICAgcHJvZ3Jlc3NFbGVtZW50LmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgc3Bpbm5lckVsZW1lbnQuaGlkZGVuID0gZmFsc2U7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHByb2dyZXNzRWxlbWVudC52YWx1ZSA9IG51bGw7DQogICAgICAgICAgICBwcm9ncmVzc0VsZW1lbnQubWF4ID0gbnVsbDsNCiAgICAgICAgICAgIHByb2dyZXNzRWxlbWVudC5oaWRkZW4gPSB0cnVlOw0KICAgICAgICAgICAgaWYgKCF0ZXh0KSB7DQogICAgICAgICAgICAgIHNwaW5uZXJFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgICAgICAgICAgIGNhbnZhc0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIHN0YXR1c0VsZW1lbnQuaW5uZXJIVE1MID0gdGV4dDsNCiAgICAgICAgfSwNCiAgICAgICAgdG90YWxEZXBlbmRlbmNpZXM6IDAsDQogICAgICAgIG1vbml0b3JSdW5EZXBlbmRlbmNpZXM6IGZ1bmN0aW9uKGxlZnQpIHsNCiAgICAgICAgICB0aGlzLnRvdGFsRGVwZW5kZW5jaWVzID0gTWF0aC5tYXgodGhpcy50b3RhbERlcGVuZGVuY2llcywgbGVmdCk7DQogICAgICAgICAgTW9kdWxlLnNldFN0YXR1cyhsZWZ0ID8gIlByZXBhcmluZy4uLiAoIiArICh0aGlzLnRvdGFsRGVwZW5kZW5jaWVzIC0gbGVmdCkgKyAiLyIgKyB0aGlzLnRvdGFsRGVwZW5kZW5jaWVzICsgIikiIDogIkFsbCBkb3dubG9hZHMgY29tcGxldGUuIik7DQogICAgICAgIH0sDQogICAgICB9Ow0KDQogICAgICBNb2R1bGUuc2V0U3RhdHVzKCJEb3dubG9hZGluZy4uLiIpOw0KDQogICAgICB3aW5kb3cub25lcnJvciA9IGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgIHNwaW5uZXJFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgICAgIE1vZHVsZS5zZXRTdGF0dXMgPSBmdW5jdGlvbih0ZXh0KSB7DQogICAgICAgICAgaWYgKHRleHQpIE1vZHVsZS5wcmludEVycigiW3Bvc3QtZXhjZXB0aW9uIHN0YXR1c10gIiArIHRleHQpOw0KICAgICAgICB9Ow0KICAgICAgfTsNCg0KICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICJvYmplY3QiKSB7DQogICAgICAgIE1vZHVsZVsnYXJndW1lbnRzJ10gPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cigxKS50cmltKCkuc3BsaXQoJyYnKTsNCiAgICAgICAgaWYgKCFNb2R1bGVbJ2FyZ3VtZW50cyddWzBdKSB7DQogICAgICAgICAgTW9kdWxlWydhcmd1bWVudHMnXSA9IFtdOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIC8vIC0tLSBDb21iaW5lZCBGdW5jdGlvbnMgLS0tDQogICAgICANCiAgICAgIGZ1bmN0aW9uIGNoYW5nZWNvbG9yKGVsKSB7DQogICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gZWwudmFsdWU7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHRvZ2dsZUNvbnNvbGUoKSB7DQogICAgICAgIHZhciBpc1Nob3duID0gb3V0cHV0RWxlbWVudC5zdHlsZS5kaXNwbGF5ID09PSAiZmxleCI7DQogICAgICAgIGlmIChpc1Nob3duKSB7DQogICAgICAgICAgb3V0cHV0RWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgICAgICAgIG91dHB1dEVsZW1lbnQuc2Nyb2xsSW50b1ZpZXcoZmFsc2UpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG91dHB1dEVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsNCiAgICAgICAgICBvdXRwdXRFbGVtZW50LnNjcm9sbEludG9WaWV3KHRydWUpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGFzeW5jIGZ1bmN0aW9uIHRvZ2dsZWNsZWFyX3NpdGVfY2FjaGUoKSB7DQogICAgICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IHdpbmRvdy5TQVZFTWFuYWdlci5jb25maXJtQm94KCJUaGlzIHdpbGwgY2xlYXIgdGhlIHNpdGUgY2FjaGUuIE1vc3QgaW1wb3J0YW50bHksIHRoaXMgd2lsbCBBTFNPIGNsZWFyIEFMTCBPRiBZT1VSIFNBVkVTLiBPTkxZIGRvIHRoaXMgaWYgeW91IGtub3cgd2hhdCB5b3UgYXJlIGRvaW5nIG9yIGlmIHRoZSBzaXRlL2dhbWUgY3Jhc2hlcyByZXBlYXRlZGx5LiBTdGlsbCB3YW5uYSBjb250aW51ZT8iKTsNCiAgICAgICAgaWYgKGNvbmZpcm1lZCkgew0KICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCBkYnMgPSBhd2FpdCB3aW5kb3cuaW5kZXhlZERCLmRhdGFiYXNlcygpOw0KICAgICAgICAgICAgZGJzLmZvckVhY2goZGIgPT4geyB3aW5kb3cuaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKGRiLm5hbWUpIH0pOw0KICAgICAgICAgICAgd2luZG93LlNBVkVNYW5hZ2VyLnNob3dNZXNzYWdlQm94KCJBbGwgc2l0ZSBkYXRhIGhhcyBiZWVuIGNsZWFyZWQhXG5QbGVhc2UgcmVsb2FkIHRoZSBwYWdlIGZvciBpdCB0byB0YWtlIGVmZmVjdC4iKTsNCiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgY2xlYXJpbmcgSW5kZXhlZERCOiIsIGVycm9yKTsNCiAgICAgICAgICAgIHdpbmRvdy5TQVZFTWFuYWdlci5zaG93TWVzc2FnZUJveCgiRmFpbGVkIHRvIGNsZWFyIHNpdGUgZGF0YS4gRXJyb3I6ICIgKyBlcnJvci5tZXNzYWdlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgKGZ1bmN0aW9uKHdpbmRvdykgew0KICAgICAgICBsZXQgc3RhdHMgPSBudWxsOw0KICAgICAgICBsZXQgaXNMb2FkZWQgPSBmYWxzZTsNCiAgICAgICAgbGV0IGlzVmlzaWJsZSA9IGZhbHNlOw0KICAgICAgICBmdW5jdGlvbiBhbmltYXRpb25Mb29wKCkgew0KICAgICAgICAgIGlmIChzdGF0cykgew0KICAgICAgICAgICAgc3RhdHMudXBkYXRlKCk7DQogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0aW9uTG9vcCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7DQogICAgICAgICAgc3RhdHMgPSBuZXcgU3RhdHMoKTsNCiAgICAgICAgICBzdGF0cy5zaG93UGFuZWwoMCk7DQogICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzdGF0cy5kb20pOw0KICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRpb25Mb29wKTsNCiAgICAgICAgICBpc0xvYWRlZCA9IHRydWU7DQogICAgICAgICAgaXNWaXNpYmxlID0gdHJ1ZTsNCiAgICAgICAgICBjb25zb2xlLmxvZygnRlBTIGNvdW50ZXIgaW5pdGlhbGl6ZWQhJyk7DQogICAgICAgIH0NCiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlKCkgew0KICAgICAgICAgIGlmICghaXNMb2FkZWQpIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdMb2FkaW5nIHN0YXRzLmpzIGxpYnJhcnkuLi4nKTsNCiAgICAgICAgICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOw0KICAgICAgICAgICAgc2NyaXB0LnNyYyA9ICdodHRwczovL21yZG9vYi5naXRodWIuaW8vc3RhdHMuanMvYnVpbGQvc3RhdHMubWluLmpzJzsNCiAgICAgICAgICAgIHNjcmlwdC5vbmxvYWQgPSBpbml0Ow0KICAgICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAoaXNWaXNpYmxlKSB7DQogICAgICAgICAgICBzdGF0cy5kb20uc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIGlzVmlzaWJsZSA9IGZhbHNlOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZQUyBjb3VudGVyIGhpZGRlbi4nKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc3RhdHMuZG9tLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgaXNWaXNpYmxlID0gdHJ1ZTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGUFMgY291bnRlciBzaG93bi4nKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgd2luZG93LnRvZ2dsZUZQUyA9IHRvZ2dsZTsNCiAgICAgIH0pKHdpbmRvdyk7DQoNCiAgICAgIC8vIC0tLSBHYW1lTWFrZXIgSW50ZXJmYWNlIEZ1bmN0aW9ucyAtLS0NCiAgICAgIHZhciBnX3BXYWRMb2FkQ2FsbGJhY2sgPSB1bmRlZmluZWQ7DQogICAgICBmdW5jdGlvbiBzZXRXYWRMb2FkQ2FsbGJhY2soX3dhZExvYWRDYWxsYmFjaykgeyBnX3BXYWRMb2FkQ2FsbGJhY2sgPSBfd2FkTG9hZENhbGxiYWNrOyB9DQogICAgICANCiAgICAgIHZhciBnX3BBZGRBc3luY01ldGhvZCA9IC0xOw0KICAgICAgZnVuY3Rpb24gc2V0QWRkQXN5bmNNZXRob2QoYXN5bmNNZXRob2QpIHsgZ19wQWRkQXN5bmNNZXRob2QgPSBhc3luY01ldGhvZDsgfQ0KDQogICAgICB2YXIgZ19wSlNFeGNlcHRpb25IYW5kbGVyID0gdW5kZWZpbmVkOw0KICAgICAgZnVuY3Rpb24gc2V0SlNFeGNlcHRpb25IYW5kbGVyKGV4Y2VwdGlvbkhhbmRsZXIpIHsNCiAgICAgICAgaWYgKHR5cGVvZiBleGNlcHRpb25IYW5kbGVyID09ICJmdW5jdGlvbiIpIHsgZ19wSlNFeGNlcHRpb25IYW5kbGVyID0gZXhjZXB0aW9uSGFuZGxlcjsgfQ0KICAgICAgfQ0KICAgICAgZnVuY3Rpb24gaGFzSlNFeGNlcHRpb25IYW5kbGVyKCkgew0KICAgICAgICByZXR1cm4gKGdfcEpTRXhjZXB0aW9uSGFuZGxlciAhPSB1bmRlZmluZWQpICYmICh0eXBlb2YgZ19wSlNFeGNlcHRpb25IYW5kbGVyID09ICJmdW5jdGlvbiIpOw0KICAgICAgfQ0KICAgICAgZnVuY3Rpb24gZG9KU0V4Y2VwdGlvbkhhbmRsZXIoZXhjZXB0aW9uSlNPTikgew0KICAgICAgICBpZiAodHlwZW9mIGdfcEpTRXhjZXB0aW9uSGFuZGxlciA9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgdmFyIGV4Y2VwdGlvbiA9IEpTT04ucGFyc2UoZXhjZXB0aW9uSlNPTik7DQogICAgICAgICAgZ19wSlNFeGNlcHRpb25IYW5kbGVyKGV4Y2VwdGlvbik7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBtYW5pZmVzdEZpbGVzKCkgew0KICAgICAgICAgIHJldHVybiBbImdhbWUudW54IiwgImluZGV4Lmh0bWwiLCAibXVzL1VOREVSVEFMRV9vb2dsb29wLm9nZyIsICJtdXMvYV9jYWxsX3RvX2FjdGlvbi5vZ2ciLCAibXVzL2FfbmV3X3BhcnRuZXIub2dnIiwgIm11cy9hX3BsYWNlX3RvX3Jlc3Qub2dnIiwgIm11cy9hYmFuZG9uZWQub2dnIiwgIm11cy9hY3F1aXR0YWwub2dnIiwgIm11cy9hZnRlcl9ob3Vycy5vZ2ciLCAibXVzL2Fqb3VybmVkLm9nZyIsICJtdXMvYW1iaWVudF9yaXZlci5vZ2ciLCAibXVzL2FwZXgub2dnIiwgIm11cy9hcHByZWhlbnNpb25feWVsbG93Lm9nZyIsICJtdXMvYXNnb3Jlb3Aub2dnIiwgIm11cy9hdmlhdGlvbi5vZ2ciLCAibXVzL2F4aXNfY2hhc2Uub2dnIiwgIm11cy9heGlzX2ZsYXNobGlnaHQub2dnIiwgIm11cy9iYWlsYWRvcl9vdmVyd29ybGQub2dnIiwgIm11cy9iYXJyaWVyLm9nZyIsICJtdXMvYmF0dGxlX3Nub3dkaW4ub2dnIiwgIm11cy9iaXJkbm9pc2Uub2dnIiwgIm11cy9iaXJkc29mYWZlYXRoZXIub2dnIiwgIm11cy9ibG9zc29tLm9nZyIsICJtdXMvYnVpbGRfYV9ib3Qub2dnIiwgIm11cy9jYWZlLm9nZyIsICJtdXMvY2FmZV9hcmNhZGUub2dnIiwgIm11cy9jYXJkX2dhbWUub2dnIiwgIm11cy9jaGFuZ2Vfb2ZfcGxhbnMub2dnIiwgIm11cy9jbG92ZXJfanVtcF9kdW5lcy5vZ2ciLCAibXVzL2NvbXBsZXgub2dnIiwgIm11cy9jb21wdXRlcl9hbWJpZW5jZS5vZ2ciLCAibXVzL2Nvb2xlc3RjYXZlLm9nZyIsICJtdXMvY29ybmVyX29mX2FfY2lyY2xlLm9nZyIsICJtdXMvY3JlZGl0cy5vZ2ciLCAibXVzL2NyZXNjZW5kb19vZl9kcmVhZC5vZ2ciLCAibXVzL2N5bWJhbC5vZ2ciLCAibXVzL2RhbHZfZGlhcnkub2dnIiwgIm11cy9kYWx2YmF0dGxlX3llbGxvdy5vZ2ciLCAibXVzL2RhbHZlbnRlcnRhaW5lci5vZ2ciLCAibXVzL2RhbHZvcGVuaW5nX3llbGxvdy5vZ2ciLCAibXVzL2RhbnphX2F0dGFja18wMV95ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfMDJfeWVsbG93Lm9nZyIsICJtdXMvZGFuemFfYXR0YWNrXzAzX3llbGxvdy5vZ2ciLCAibXVzL2RhbnphX2F0dGFja18wNF95ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfMDVfeWVsbG93Lm9nZyIsICJtdXMvZGFuemFfYXR0YWNrXzA2X3llbGxvdy5vZ2ciLCAibXVzL2RhbnphX2F0dGFja18wN195ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfMDhfeWVsbG93Lm9nZyIsICJtdXMvZGFuemFfYXR0YWNrXzA5X3llbGxvdy5vZ2ciLCAibXVzL2RhbnphX2F0dGFja18xMF95ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfZmluYWxlXzAxX3llbGxvdy5vZ2ciLCAibXVzL2RhbnphX2F0dGFja19maW5hbGVfMDJfeWVsbG93Lm9nZyIsICJtdXMvZGFuemFfYXR0YWNrX2ZpbmFsZV95ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfaW5zdF8wMV95ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfaW5zdF8wMl95ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfaW5zdF8wM195ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfaW5zdF8wNF95ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfaW5zdF8wNV95ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfaW5zdF8wNl95ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfaW5zdF8wN195ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfaW5zdF8wOF95ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfaW5zdF8wOV95ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfaW5zdF8xMF95ZWxsb3cub2dnIiwgIm11cy9kYW56YV9hdHRhY2tfaW5zdF9maW5hbGVfMDFfeWVsbG93Lm9nZyIsICJtdXMvZGFuemFfYXR0YWNrX2luc3RfZmluYWxlXzAyX3llbGxvdy5vZ2ciLCAibXVzL2RhbnphX2JhdHRsZV95ZWxsb3cub2dnIiwgIm11cy9kYXJrcnVpbnMub2dnIiwgIm11cy9kZWFsX2VtX291dF9hY2VfeWVsbG93Lm9nZyIsICJtdXMvZGVhbF9lbV9vdXRfZWRfeWVsbG93Lm9nZyIsICJtdXMvZGVhbF9lbV9vdXRfbW9vY2hfeWVsbG93Lm9nZyIsICJtdXMvZGVhbF9lbV9vdXRfbW9yYXlfeWVsbG93Lm9nZyIsICJtdXMvZGVhbF9lbV9vdXRfeWVsbG93Lm9nZyIsICJtdXMvZGVjaWJhdF95ZWxsb3cub2dnIiwgIm11cy9kZWxpdmVyeS5vZ2ciLCAibXVzL2RlbGl2ZXJ5X2ludHJvLm9nZyIsICJtdXMvZGV0YWlubWVudC5vZ2ciLCAibXVzL2RldG91ci5vZ2ciLCAibXVzL2Rvb3JjbG9zZS5vZ2ciLCAibXVzL2Rvb3Jsb2NrLm9nZyIsICJtdXMvZHVhbC5vZ2ciLCAibXVzL2R1YWxfc2hvcnQub2dnIiwgIm11cy9kdW5lc19jYXZlLm9nZyIsICJtdXMvZHVuZXNfY2F2ZV9vdXRkb29ycy5vZ2ciLCAibXVzL2VsZXZhdG9yLm9nZyIsICJtdXMvZWxldmF0b3JfbG9uZy5vZ2ciLCAibXVzL2VudGVyX2F4aXMub2dnIiwgIm11cy9mX2xhdWdoLm9nZyIsICJtdXMvZl9uZXdsYXVnaC5vZ2ciLCAibXVzL2ZfcGhhc2UyX2NsYXkub2dnIiwgIm11cy9mX3BoYXNlMl9sb3dwb2x5Lm9nZyIsICJtdXMvZl9waGFzZTJfbWVjaGFuaWNhbC5vZ2ciLCAibXVzL2ZfcGhhc2UyX29yZ2FuaWMub2dnIiwgIm11cy9mX3BoYXNlMl9wYXBlci5vZ2ciLCAibXVzL2ZfcGhhc2UyX3lhcm4ub2dnIiwgIm11cy9mYWxsMi5vZ2ciLCAibXVzL2ZhbGxlbmRvd255ZWxsb3cub2dnIiwgIm11cy9mZWlzdHkub2dnIiwgIm11cy9maW5hbF9zdGFuZC5vZ2ciLCAibXVzL2ZsYW1lX2xvb3Aub2dnIiwgIm11cy9mbG9ja190b2dldGhlci5vZ2ciLCAibXVzL2Zsb3dleV9maW5hbF9ib3NzXzFfaW50cm8ub2dnIiwgIm11cy9mbG93ZXlfZmluYWxfYm9zc18xX21haW4ub2dnIiwgIm11cy9mbG93ZXlfcm9vZl9pbnRyb18xLm9nZyIsICJtdXMvZmxvd2V5X3Jvb2ZfaW50cm9fMi5vZ2ciLCAibXVzL2Zsb3dleV9zb3VuZHNjYXBlLm9nZyIsICJtdXMvZmxvd2V5X3dvcmxkLm9nZyIsICJtdXMvZmxvd2V5bmV3X3llbGxvdy5vZ2ciLCAibXVzL2Z1bnNpemVkX3llbGxvdy5vZ2ciLCAibXVzL2dhbWVvdmVyX3llbGxvdy5vZ2ciLCAibXVzL2dlbXN0b25lX2ZldmVyLm9nZyIsICJtdXMvZ2Vub2JhdHRsZV95ZWxsb3cub2dnIiwgIm11cy9nZXR0aW5nX3RoZV90aG91Z2h0c19vdXQub2dnIiwgIm11cy9naWZ0XzEub2dnIiwgIm11cy9naWZ0XzIub2dnIiwgIm11cy9naW1tZV91cl9jYXNoX3llbGxvdy5vZ2ciLCAibXVzL2dvbGRlbl9vcHBvcnR1bml0eS5vZ2ciLCAibXVzL2dvdGNoYS5vZ2ciLCAibXVzL2dyZWVuaG91c2Uub2dnIiwgIm11cy9ndWFyZGVuZXJfdGhlbWUub2dnIiwgIm11cy9ndW5zX2JsYXppbmcub2dnIiwgIm11cy9ndW5zX2JsYXppbmdfZ2Vuby5vZ2ciLCAibXVzL2d1bnNob3Aub2dnIiwgIm11cy9oYXBweV9ob3VyLm9nZyIsICJtdXMvaGVhdHdhdmVfYXBwcm9hY2hpbmcub2dnIiwgIm11cy9ob25lc3RfZGF5c193b3JrLm9nZyIsICJtdXMvaG9uZXlkZXdfYmFyay5vZ2ciLCAibXVzL2hvbmV5ZGV3X2RhbHYub2dnIiwgIm11cy9ob25leWRld19sb2RnZS5vZ2ciLCAibXVzL2hvbmV5ZGV3X3J1aW5zLm9nZyIsICJtdXMvaG9uZXlkZXdfc25vdy5vZ2ciLCAibXVzL2ludHJvLm9nZyIsICJtdXMvaW50cm9ub2lzZS5vZ2ciLCAibXVzL2p1c3RpY2Uub2dnIiwgIm11cy9rYW5ha28ub2dnIiwgIm11cy9rYW5ha29fcmVwcmlzZS5vZ2ciLCAibXVzL2xvdW5naW5nX2Fyb3VuZC5vZ2ciLCAibXVzL21haWxfamluZ2xlX2FsdC5vZ2ciLCAibXVzL21hbnRhX3NhaWwub2dnIiwgIm11cy9tYXJ0X2dlbm9fd2luZF95ZWxsb3cub2dnIiwgIm11cy9tYXJ0bGV0YmF0dGxlX3llbGxvdy5vZ2ciLCAibXVzL21lZGl1bS5vZ2ciLCAibXVzL21lbnVfZGFya3J1aW5zLm9nZyIsICJtdXMvbWVudV9vcHRpb25zLm9nZyIsICJtdXMvbWVudV9ydWlucy5vZ2ciLCAibXVzL21lbnVfc25vd2Rpbi5vZ2ciLCAibXVzL21lbnVfd2lsZF9lYXN0Lm9nZyIsICJtdXMvbWV3Lm9nZyIsICJtdXMvbWV3X2Jvc3Mub2dnIiwgIm11cy9tZXdfaW50cm8ub2dnIiwgIm11cy9tZXdfbG9nby5vZ2ciLCAibXVzL21pY3JvX3RlbXBlcmF0dXJlLm9nZyIsICJtdXMvbWljcm9zcHJpbmdzX2Zyb2dnaXRzLm9nZyIsICJtdXMvbWlzc2luZ19pbmFjdGlvbi5vZ2ciLCAibXVzL21peGluX2l0X3VwLm9nZyIsICJtdXMvbW9fcG9wLm9nZyIsICJtdXMvbW90aGVyc19sb3ZlX2ludHJvLm9nZyIsICJtdXMvbW90aGVyc19sb3ZlX3BoYXNlXzEub2dnIiwgIm11cy9tb3RoZXJzX2xvdmVfcGhhc2VfMi5vZ2ciLCAibXVzL21vdGhlcnNfbG92ZV9waGFzZV8zLm9nZyIsICJtdXMvbW90aGVyc19sb3ZlX3BoYXNlXzNfYnVpbGR1cC5vZ2ciLCAibXVzL21vdGhlcnNfbG92ZV90ZW1wLm9nZyIsICJtdXMvbm9ib2R5Y2FtZV95ZWxsb3cub2dnIiwgIm11cy9ub3RoaW5nX2J1dF90aGVfdHJ1dGgub2dnIiwgIm11cy9ub3Rzb3F1aWV0c3RyYXkub2dnIiwgIm11cy9udWxsLm9nZyIsICJtdXMvb2FzaXMub2dnIiwgIm11cy9vYXNpc19pbmRvb3JzLm9nZyIsICJtdXMvb2NjdXBpZWRfdHVyZl95ZWxsb3cub2dnIiwgIm11cy9vbmVzX3Bhc3Qub2dnIiwgIm11cy9waW5rZ29vX21vdmUub2dnIiwgIm11cy9waXBpbl9ob3RfeWVsbG93Lm9nZyIsICJtdXMvcG9wc19kZWZsYXRlLm9nZyIsICJtdXMvcHJlYmF0dGxlMV95ZWxsb3cub2dnIiwgIm11cy9wcmViYXR0bGUyX3llbGxvdy5vZ2ciLCAibXVzL3ByZWJhdHRsZTNfeWVsbG93Lm9nZyIsICJtdXMvcXVpZXRzdHJheS5vZ2ciLCAibXVzL3JlbGF4YXRpb24ub2dnIiwgIm11cy9yZW1lZHkub2dnIiwgIm11cy9yZW5ld2VkLm9nZyIsICJtdXMvcnVpbnNfeWVsbG93Lm9nZyIsICJtdXMvc2FkbG8ub2dnIiwgIm11cy9zYW5kc3Rvcm0ub2dnIiwgIm11cy9zaGVyaWZmc19mYXRlLm9nZyIsICJtdXMvc2hpbW1lci5vZ2ciLCAibXVzL3Nob3Aub2dnIiwgIm11cy9zaG93ZG93bi5vZ2ciLCAibXVzL3NodWZmbGluZzEub2dnIiwgIm11cy9zaHVmZmxpbmcyLm9nZyIsICJtdXMvc2h1ZmZsaW5nMy5vZ2ciLCAibXVzL3Nub3JpbmdfanVzdGljZS5vZ2ciLCAibXVzL3Nub3cub2dnIiwgIm11cy9zbm93ZGluX2JyaWRnZS5vZ2ciLCAibXVzL3Nub3dmYWxsLm9nZyIsICJtdXMvc29tZV9wb2ludF9vZl9ub19yZXR1cm4ub2dnIiwgIm11cy9zb3VsbWF0ZV9sb2NhdGVkLm9nZyIsICJtdXMvc3Bvb2sub2dnIiwgIm11cy9zdGFybG9fZW50cmFuY2Uub2dnIiwgIm11cy9zdGVhbXdvcmtzX292ZXJ3b3JsZC5vZ2ciLCAibXVzL3N1bm55c2lkZV9yYW5jaC5vZ2ciLCAibXVzL3RoZV9zdHJhdy5vZ2ciLCAibXVzL3RoZV90cmVrLm9nZyIsICJtdXMvdGhlX3dhbmRlcmluZy5vZ2ciLCAibXVzL3RoZV93aWxkX2Vhc3Qub2dnIiwgIm11cy90aGVfd2lsZF9lYXN0X2Jhcm4ub2dnIiwgIm11cy90aGVfd2lsZF9lYXN0X2hvc3BpdGFsLm9nZyIsICJtdXMvdGhlX3dpbGRfZWFzdF9ob3VzZS5vZ2ciLCAibXVzL3RoZV93aWxkX2Vhc3RfamFpbC5vZ2ciLCAibXVzL3RoZV93aWxkX2Vhc3Rfc2xlZXB5Lm9nZyIsICJtdXMvdGhyb3VnaF90aGVfbWFjcm9fbGVucy5vZ2ciLCAibXVzL3RyYWluX3Ryb3VibGUub2dnIiwgIm11cy90cmFpbl90cm91YmxlXzIub2dnIiwgIm11cy90cmFtcGxlZF9mbG93ZXJzLm9nZyIsICJtdXMvdHJhcGRvb3Iub2dnIiwgIm11cy90cmVhZGluZ19saWdodGx5Lm9nZyIsICJtdXMvdHJpYWxfYnlfZnVyeS5vZ2ciLCAibXVzL3RyaWFsX2J5X2Z1cnlfMi5vZ2ciLCAibXVzL3R1Y2tlZF9pbi5vZ2ciLCAibXVzL3Vob2gub2dnIiwgIm11cy91bmZvcmdpdmluZy5vZ2ciLCAibXVzL3ZpZ29yb3VzX3RlcnJhaW4ub2dnIiwgIm11cy92c2FzZ29yZS5vZ2ciLCAibXVzL3dlbGxfYmVfb2theS5vZ2ciLCAibXVzL3dpbGRfZWFzdF9zaG9ja2luZ19zb3VuZC5vZ2ciLCAibXVzL3dpbmQub2dnIiwgIm11cy93b29kX2Zsb3dleS5vZ2ciLCAibXVzL3dvb2RfcHVsbC5vZ2ciLCAibXVzL3dvb2RfemFwLm9nZyIsICJydW5uZXIuZGF0YSIsICJydW5uZXIuanMiLCAicnVubmVyLnN2ZyIsICJydW5uZXIud2FzbSIsICJhdWRpby13b3JrbGV0LmpzIiwgInJ1bm5lckxvY2FsLnN2ZyIsICJzbmQvYXhpc19mbGFzaGxpZ2h0Lm9nZyIsICJzbmQvY2xvdmVyX2p1bXBfZHVuZXMub2dnIiwgInNuZC9kb29yY2xvc2Uub2dnIiwgInNuZC9kb29ybG9jay5vZ2ciLCAic25kL2VsZXZhdG9yX2xvbmcub2dnIiwgInNuZC9mYWxsMi5vZ2ciLCAic25kL2ZsYW1lX2xvb3Aub2dnIiwgInNuZC9tYWlsX2ppbmdsZV9hbHQub2dnIiwgInNuZC9tYW50YV9zYWlsLm9nZyIsICJzbmQvbWljcm9zcHJpbmdzX2Zyb2dnaXRzLm9nZyIsICJzbmQvbW9fcG9wLm9nZyIsICJzbmQvcGlua2dvb19tb3ZlLm9nZyIsICJzbmQvcG9wc19kZWZsYXRlLm9nZyIsICJzbmQvc2FuZHN0b3JtLm9nZyIsICJzbmQvc25vd2Rpbl9icmlkZ2Uub2dnIiwgInNuZC93aWxkX2Vhc3Rfc2hvY2tpbmdfc291bmQub2dnIiwgInNuZC93b29kX2Zsb3dleS5vZ2ciLCAic25kL3dvb2RfcHVsbC5vZ2ciLCAic25kL3dvb2RfemFwLm9nZyJdLmpvaW4oIjsiKTsNCiAgICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBvbkZpcnN0RnJhbWVSZW5kZXJlZCgpIHt9DQoNCiAgICAgIC8vIFZlcnNpb24gb2Ygb25HYW1lU2V0V2luZG93U2l6ZSB0aGF0IGNhbGxzIGVuc3VyZUFzcGVjdFJhdGlvDQogICAgICBmdW5jdGlvbiBvbkdhbWVTZXRXaW5kb3dTaXplKHdpZHRoLCBoZWlnaHQpIHsNCiAgICAgICAgaWYgKHN0YXJ0aW5nSGVpZ2h0ID09PSB1bmRlZmluZWQgJiYgc3RhcnRpbmdXaWR0aCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgY29uc29sZS5sb2coIkluaXRpYWwgd2luZG93IHNpemUgc2V0IHRvIHdpZHRoOiAiICsgd2lkdGggKyAiLCBoZWlnaHQ6ICIgKyBoZWlnaHQpOw0KICAgICAgICAgIHN0YXJ0aW5nSGVpZ2h0ID0gaGVpZ2h0Ow0KICAgICAgICAgIHN0YXJ0aW5nV2lkdGggPSB3aWR0aDsNCiAgICAgICAgICBzdGFydGluZ0FzcGVjdCA9IHN0YXJ0aW5nV2lkdGggLyBzdGFydGluZ0hlaWdodDsNCiAgICAgICAgICBlbnN1cmVBc3BlY3RSYXRpbygpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICANCiAgICAgIGZ1bmN0aW9uIGVuc3VyZUFzcGVjdFJhdGlvKCkgew0KICAgICAgICBpZiAoY2FudmFzRWxlbWVudCA9PT0gdW5kZWZpbmVkIHx8IChzdGFydGluZ0hlaWdodCA9PT0gdW5kZWZpbmVkICYmIHN0YXJ0aW5nV2lkdGggPT09IHVuZGVmaW5lZCkpIHsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgY2FudmFzRWxlbWVudC5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsNCiAgICAgICAgY29uc3QgbWF4V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsNCiAgICAgICAgY29uc3QgbWF4SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0Ow0KICAgICAgICB2YXIgbmV3SGVpZ2h0LCBuZXdXaWR0aDsNCiAgICAgICAgdmFyIGhlaWdodFF1b3RpZW50ID0gc3RhcnRpbmdIZWlnaHQgLyBtYXhIZWlnaHQ7DQogICAgICAgIHZhciB3aWR0aFF1b3RpZW50ID0gc3RhcnRpbmdXaWR0aCAvIG1heFdpZHRoOw0KICAgICAgICBpZiAoaGVpZ2h0UXVvdGllbnQgPiB3aWR0aFF1b3RpZW50KSB7DQogICAgICAgICAgbmV3SGVpZ2h0ID0gbWF4SGVpZ2h0Ow0KICAgICAgICAgIG5ld1dpZHRoID0gbmV3SGVpZ2h0ICogc3RhcnRpbmdBc3BlY3Q7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbmV3V2lkdGggPSBtYXhXaWR0aDsNCiAgICAgICAgICBuZXdIZWlnaHQgPSBuZXdXaWR0aCAvIHN0YXJ0aW5nQXNwZWN0Ow0KICAgICAgICB9DQogICAgICAgIGNhbnZhc0VsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gbmV3SGVpZ2h0ICsgInB4IjsNCiAgICAgICAgY2FudmFzRWxlbWVudC5zdHlsZS53aWR0aCA9IG5ld1dpZHRoICsgInB4IjsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gcGF1c2UoKSB7DQogICAgICAgIGlmICghY2FudmFzRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoImFjdGl2ZSIpKSB7IHJldHVybjsgfQ0KICAgICAgICBHTV9wYXVzZSgpOw0KICAgICAgICBjYW52YXNFbGVtZW50LmNsYXNzTGlzdC5hZGQoInBhdXNlZCIpOw0KICAgICAgfQ0KICAgICAgZnVuY3Rpb24gcmVzdW1lKCkgew0KICAgICAgICBHTV91bnBhdXNlKCk7DQogICAgICAgIGNhbnZhc0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgicGF1c2VkIik7DQogICAgICAgIGNhbnZhc0VsZW1lbnQuY2xhc3NMaXN0LmFkZCgidW5wYXVzZWQiKTsNCiAgICAgICAgZW5zdXJlQXNwZWN0UmF0aW8oKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gcXVpdElmU3VwcG9ydGVkKCkgew0KICAgICAgICBpZiAod2luZG93Lm9wcnQgJiYgd2luZG93Lm9wcnQuY2xvc2VUYWIpIHsNCiAgICAgICAgICB3aW5kb3cub3BydC5jbG9zZVRhYigpOw0KICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5jaHJvbWUgJiYgd2luZG93LmNocm9tZS5ydW50aW1lICYmIHdpbmRvdy5jaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSkgew0KICAgICAgICAgIHdpbmRvdy5jaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSgnbXBvamptaWRtbnBjcG9wYmVibWVjbWpka2RiZ2Rla2UnLCB7IGNvbW1hbmQ6ICdjbG9zZVRhYicgfSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGZ1bmN0aW9uIGVudGVyRnVsbHNjcmVlbklmU3VwcG9ydGVkKCkgew0KICAgICAgICBpZiAoIXdpbmRvdy5vcHJ0IHx8ICF3aW5kb3cub3BydC5lbnRlckZ1bGxzY3JlZW4pIHsgcmV0dXJuOyB9DQogICAgICAgIHdpbmRvdy5vcHJ0LmVudGVyRnVsbHNjcmVlbigpOw0KICAgICAgICBsZXQgdmlld1N0YXR1cyA9IEdNX2dldF92aWV3X3N0YXR1cygpOw0KICAgICAgICB2aWV3U3RhdHVzLmZ1bGxzY3JlZW4gPSB0cnVlOw0KICAgICAgICBHTV9zZXRfdmlld19zdGF0dXModmlld1N0YXR1cyk7DQogICAgICB9DQogICAgICBmdW5jdGlvbiBsb2NrT3JpZW50YXRpb25JZlN1cHBvcnRlZCgpIHsNCiAgICAgICAgaWYgKCF3aW5kb3cub3BydCB8fCAhd2luZG93Lm9wcnQubG9ja1BvcnRyYWl0T3JpZW50YXRpb24gfHwgIXdpbmRvdy5vcHJ0LmxvY2tMYW5kc2NhcGVPcmllbnRhdGlvbikgeyByZXR1cm47IH0NCiAgICAgICAgbGV0IHZpZXdTdGF0dXMgPSBHTV9nZXRfdmlld19zdGF0dXMoKTsNCiAgICAgICAgaWYgKHZpZXdTdGF0dXMubGFuZHNjYXBlID09PSB0cnVlICYmIHZpZXdTdGF0dXMucG9ydHJhaXQgPT09IGZhbHNlKSB7DQogICAgICAgICAgd2luZG93Lm9wcnQubG9ja1BvcnRyYWl0T3JpZW50YXRpb24oKTsNCiAgICAgICAgfSBlbHNlIGlmICh2aWV3U3RhdHVzLmxhbmRzY2FwZSA9PT0gZmFsc2UgJiYgdmlld1N0YXR1cy5wb3J0cmFpdCA9PT0gdHJ1ZSkgew0KICAgICAgICAgIHdpbmRvdy5vcHJ0LmxvY2tQb3J0cmFpdE9yaWVudGF0aW9uKCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIA0KICAgICAgLy8gLS0tIEV2ZW50IExpc3RlbmVycyBhbmQgT2JzZXJ2ZXJzIC0tLQ0KICAgICAgY29uc3QgcmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4gew0KICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGVuc3VyZUFzcGVjdFJhdGlvKTsNCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGVuc3VyZUFzcGVjdFJhdGlvKSwgMTAwKTsNCiAgICAgIH0pOw0KICAgICAgcmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5ib2R5KTsNCg0KICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCAoZXZlbnQpID0+IHsNCiAgICAgICAgaWYgKCghd2luZG93Lm9wcnQgfHwgIXdpbmRvdy5vcHJ0LmVudGVyRnVsbHNjcmVlbikgJiYgKCF3aW5kb3cuY2hyb21lIHx8ICF3aW5kb3cuY2hyb21lLnJ1bnRpbWUgfHwgIXdpbmRvdy5jaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSkpIHsNCiAgICAgICAgICAvLyBBc3N1bWluZyBhIHF1aXRCdXR0b24gZXhpc3RzIG9yIGhhbmRsaW5nIGl0IGdyYWNlZnVsbHkgaWYgbm90DQogICAgICAgICAgdmFyIHF1aXRCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXVpdEJ1dHRvbiIpOyAvLyBZb3UgbWF5IG5lZWQgdG8gZGVmaW5lIHRoaXMgYnV0dG9uIGluIHlvdXIgSFRNTA0KICAgICAgICAgIGlmIChxdWl0QnV0dG9uKSBxdWl0QnV0dG9uLmhpZGRlbiA9IHRydWU7DQogICAgICAgIH0NCiAgICAgIH0pOw0KDQogICAgICBpZiAoL0FuZHJvaWR8aVBob25lfGlQb2QvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7DQogICAgICAgIGJvZHlFbGVtZW50LmNsYXNzTmFtZSA9ICJzY3JvbGxpbmdEaXNhYmxlZCI7DQogICAgICAgIG91dHB1dENvbnRhaW5lckVsZW1lbnQuaGlkZGVuID0gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIA0KICAgICAgc2V0V2FkTG9hZENhbGxiYWNrKCgpID0+IHsNCiAgICAgICAgZW50ZXJGdWxsc2NyZWVuSWZTdXBwb3J0ZWQoKTsNCiAgICAgICAgbG9ja09yaWVudGF0aW9uSWZTdXBwb3J0ZWQoKTsNCiAgICAgIH0pOw0KICAgIDwvc2NyaXB0Pg0KICAgIDxzY3JpcHQ+DQogICAgICBmdW5jdGlvbiB0b2dnbGVGdWxsc2NyZWVuKCkgew0KICAgICAgICBjb25zdCBkb2MgPSBkb2N1bWVudDsNCiAgICAgICAgY29uc3QgZG9jRWwgPSBkb2MuZG9jdW1lbnRFbGVtZW50Ow0KICAgICAgICBjb25zdCBpc0luRnVsbHNjcmVlbiA9ICgpID0+IGRvYy5mdWxsc2NyZWVuRWxlbWVudCB8fCBkb2Mud2Via2l0RnVsbHNjcmVlbkVsZW1lbnQgfHwgZG9jLm1vekZ1bGxTY3JlZW5FbGVtZW50IHx8IGRvYy5tc0Z1bGxzY3JlZW5FbGVtZW50Ow0KICAgICAgICBjb25zdCByZXF1ZXN0RnVsbHNjcmVlbiA9ICgpID0+IHsNCiAgICAgICAgICBpZiAoZG9jRWwucmVxdWVzdEZ1bGxzY3JlZW4pIGRvY0VsLnJlcXVlc3RGdWxsc2NyZWVuKCk7DQogICAgICAgICAgZWxzZSBpZiAoZG9jRWwud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4pIGRvY0VsLndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKCk7DQogICAgICAgICAgZWxzZSBpZiAoZG9jRWwubW96UmVxdWVzdEZ1bGxTY3JlZW4pIGRvY0VsLm1velJlcXVlc3RGdWxsU2NyZWVuKCk7DQogICAgICAgICAgZWxzZSBpZiAoZG9jRWwubXNSZXF1ZXN0RnVsbHNjcmVlbikgZG9jRWwubXNSZXF1ZXN0RnVsbHNjcmVlbigpOw0KICAgICAgICB9Ow0KICAgICAgICBjb25zdCBleGl0RnVsbHNjcmVlbiA9ICgpID0+IHsNCiAgICAgICAgICBpZiAoZG9jLmV4aXRGdWxsc2NyZWVuKSBkb2MuZXhpdEZ1bGxzY3JlZW4oKTsNCiAgICAgICAgICBlbHNlIGlmIChkb2Mud2Via2l0RXhpdEZ1bGxzY3JlZW4pIGRvYy53ZWJraXRFeGl0RnVsbHNjcmVlbigpOw0KICAgICAgICAgIGVsc2UgaWYgKGRvYy5tb3pDYW5jZWxGdWxsU2NyZWVuKSBkb2MubW96Q2FuY2VsRnVsbFNjcmVlbigpOw0KICAgICAgICAgIGVsc2UgaWYgKGRvYy5tc0V4aXRGdWxsc2NyZWVuKSBkb2MubXNFeGl0RnVsbHNjcmVlbigpOw0KICAgICAgICB9Ow0KICAgICAgICBpZiAoIWlzSW5GdWxsc2NyZWVuKCkpIHsNCiAgICAgICAgICByZXF1ZXN0RnVsbHNjcmVlbigpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGV4aXRGdWxsc2NyZWVuKCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGNvbnN0IG9yaWdpbmFsQ29uc29sZUxvZyA9IGNvbnNvbGUubG9nOw0KICAgICAgY29uc29sZS5sb2cgPSBmdW5jdGlvbiguLi5hcmdzKSB7DQogICAgICAgIG9yaWdpbmFsQ29uc29sZUxvZy5hcHBseShjb25zb2xlLCBhcmdzKTsNCiAgICAgICAgaWYgKGFyZ3Muc29tZShhcmcgPT4gdHlwZW9mIGFyZyA9PT0gJ3N0cmluZycgJiYgYXJnLmluY2x1ZGVzKCdUb2dnbGluZyBmdWxsc2NyZWVuLi4uJykpKSB7DQogICAgICAgICAgdG9nZ2xlRnVsbHNjcmVlbigpOw0KICAgICAgICB9DQogICAgICB9Ow0KICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsNCiAgICAgICAgY29uc3QgZnVsbHNjcmVlbkJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmdWxsc2NyZWVuJyk7DQogICAgICAgIGlmIChmdWxsc2NyZWVuQnV0dG9uKSB7DQogICAgICAgICAgZnVsbHNjcmVlbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZUZ1bGxzY3JlZW4pOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICA8L3NjcmlwdD4NCiAgICA8c2NyaXB0Pg0KICAgIGZ1bmN0aW9uIG1lcmdlRmlsZXMoZmlsZVBhcnRzKSB7DQogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICBsZXQgYnVmZmVycyA9IFtdOw0KDQogICAgICAgIGZ1bmN0aW9uIGZldGNoUGFydChpbmRleCkgew0KICAgICAgICAgIGlmIChpbmRleCA+PSBmaWxlUGFydHMubGVuZ3RoKSB7DQogICAgICAgICAgICBjb25zdCB0b3RhbExlbmd0aCA9IGJ1ZmZlcnMucmVkdWNlKChzdW0sIGJ1ZikgPT4gc3VtICsgYnVmLmJ5dGVMZW5ndGgsIDApOw0KICAgICAgICAgICAgY29uc29sZS5sb2coIkNvbWJpbmVkIHNpemUgKGJ5dGVzKToiLCB0b3RhbExlbmd0aCk7DQoNCiAgICAgICAgICAgIGNvbnN0IGNvbWJpbmVkID0gbmV3IFVpbnQ4QXJyYXkodG90YWxMZW5ndGgpOw0KICAgICAgICAgICAgbGV0IG9mZnNldCA9IDA7DQogICAgICAgICAgICBmb3IgKGNvbnN0IGJ1ZiBvZiBidWZmZXJzKSB7DQogICAgICAgICAgICAgIGNvbWJpbmVkLnNldChuZXcgVWludDhBcnJheShidWYpLCBvZmZzZXQpOw0KICAgICAgICAgICAgICBvZmZzZXQgKz0gYnVmLmJ5dGVMZW5ndGg7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNvbnN0IG1lcmdlZEJsb2IgPSBuZXcgQmxvYihbY29tYmluZWRdLCB7IHR5cGU6ICJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iIH0pOw0KICAgICAgICAgICAgcmVzb2x2ZShtZXJnZWRCbG9iKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmZXRjaChmaWxlUGFydHNbaW5kZXhdKQ0KICAgICAgICAgICAgLnRoZW4ocmVzcCA9PiB7DQogICAgICAgICAgICAgIGlmICghcmVzcC5vaykgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggJHtmaWxlUGFydHNbaW5kZXhdfWApOw0KICAgICAgICAgICAgICByZXR1cm4gcmVzcC5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gew0KICAgICAgICAgICAgICBidWZmZXJzLnB1c2goZGF0YSk7DQogICAgICAgICAgICAgIGZldGNoUGFydChpbmRleCArIDEpOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC5jYXRjaChyZWplY3QpOw0KICAgICAgICB9DQoNCiAgICAgICAgZmV0Y2hQYXJ0KDApOw0KICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0UGFydHMoZmlsZSwgdG90YWxQYXJ0cykgew0KICAgICAgbGV0IHBhcnRzID0gW107DQogICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSB0b3RhbFBhcnRzOyBpKyspIHsNCiAgICAgICAgcGFydHMucHVzaChgJHtmaWxlfS5wYXJ0JHtpfWApOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHBhcnRzOw0KICAgIH0NCg0KICAgIGNvbnN0IHRvdGFsUGFydHMgPSAxMDsNCg0KICAgIG1lcmdlRmlsZXMoZ2V0UGFydHMoImdhbWUudW54IiwgdG90YWxQYXJ0cykpDQogICAgICAudGhlbihibG9iID0+IHsNCiAgICAgICAgY29uc3QgYmxvYlVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7DQoNCiAgICAgICAgY29uc3Qgb3JpZ2luYWxGZXRjaCA9IHdpbmRvdy5mZXRjaDsNCiAgICAgICAgd2luZG93LmZldGNoID0gYXN5bmMgZnVuY3Rpb24odXJsLCAuLi5hcmdzKSB7DQogICAgICAgICAgaWYgKHVybC5lbmRzV2l0aCgiZ2FtZS51bngiKSkgew0KICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsRmV0Y2goYmxvYlVybCwgLi4uYXJncyk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiBvcmlnaW5hbEZldGNoKHVybCwgLi4uYXJncyk7DQogICAgICAgIH07DQoNCiAgICAgICAgY29uc3Qgb3JpZ2luYWxPcGVuID0gWE1MSHR0cFJlcXVlc3QucHJvdG90eXBlLm9wZW47DQogICAgICAgIFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24obWV0aG9kLCB1cmwsIC4uLnJlc3QpIHsNCiAgICAgICAgICBpZiAodXJsLmluY2x1ZGVzKCJnYW1lLnVueCIpKSB1cmwgPSBibG9iVXJsOw0KICAgICAgICAgIHJldHVybiBvcmlnaW5hbE9wZW4uY2FsbCh0aGlzLCBtZXRob2QsIHVybCwgLi4ucmVzdCk7DQogICAgICAgIH07DQoNCiAgICAgICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7DQogICAgICAgIHNjcmlwdC5zcmMgPSAicnVubmVyLmpzIjsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICAgICAgfSkNCiAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5lcnJvcigiRmFpbGVkIHRvIG1lcmdlIHBhcnRzOiIsIGVycikpOw0KICAgIDwvc2NyaXB0Pg0KPC9ib2R5Pg0KPC9odG1sPg0K";
