window.game = "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuLXVzIj4KICAgIDxoZWFkPgogICAgICAgIDxiYXNlIGhyZWYgPSAiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2Nvb2xkdWRlMjM0OS9ldmVyeXRoaW5nQG1haW4vbXJyYWNlcnJyLyI+CiAgICAgICAgPGxpbmsgcmVsPSJtYW5pZmVzdCIgaHJlZj0iLi9tYW5pZmVzdC5qc29uIj4KICAgICAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICAgICAgPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiPgogICAgICAgIDx0aXRsZT5NUiBSQUNFUiA8L3RpdGxlPgogICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgaHRtbCwgYm9keSB7CiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBweDsKICAgICAgICAgICAgICAgIG1hcmdpbjogMHB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC5mdWxsc2NyZWVuIHsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICMyNDI0MjQ7CiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgICAgIHRvcDogMHB4OwogICAgICAgICAgICAgICAgbGVmdDogMHB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgICNiYW5uZXItY29udGFpbmVyIHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgICAgIGJvdHRvbTogMHB4OwogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDkwcHg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgI2xvYWRpbmctb3ZlcmxheSB7CiAgICAgICAgICAgICAgICBmb250LXNpemU6IDIwcHg7CiAgICAgICAgICAgICAgICB6LWluZGV4OiAxOwogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgI2ljb24gewogICAgICAgICAgICAgICAgbWF4LXdpZHRoOiAxMDBweDsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgICNwcm9ncmVzcy1iYXIgewogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNXB4OwogICAgICAgICAgICAgICAgd2lkdGg6IDkwJTsKICAgICAgICAgICAgICAgIG1heC13aWR0aDogMjUwcHg7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDIwcHg7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMTgxODE4OwogICAgICAgICAgICAgICAgcGFkZGluZzogNXB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgICNwcm9ncmVzcy1iYXItZmlsbCB7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7CiAgICAgICAgICAgICAgICB3aWR0aDogMCU7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjOTc0N0ZGOwogICAgICAgICAgICB9CiAgICAgICAgPC9zdHlsZT4KICAgIDwvaGVhZD4KICAgIDxib2R5PgogICAgICAgIDxjYW52YXMgaWQ9ImNhbnZhcyIgY2xhc3M9ImZ1bGxzY3JlZW4iPjwvY2FudmFzPgogICAgICAgIDxkaXYgaWQ9ImJhbm5lci1jb250YWluZXIiIHN0eWxlPSJkaXNwbGF5OiBub25lIj48L2Rpdj4KICAgICAgICA8ZGl2IGlkPSJsb2FkaW5nLW92ZXJsYXkiIGNsYXNzPSJmdWxsc2NyZWVuIj4KICAgICAgICAgICAgPGltZyBpZD0iaWNvbiIgc3JjPSIuL2ljb24ucG5nIiAvPgogICAgICAgICAgICA8ZGl2IGlkPSJwcm9ncmVzcy1iYXIiPjxkaXYgaWQ9InByb2dyZXNzLWJhci1maWxsIj48L2Rpdj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8c2NyaXB0IHNyYz0iLi9wbGF5Z2FtYS1icmlkZ2UuanMiPjwvc2NyaXB0PgogICAgICAgIDxzY3JpcHQ+CiAgICAgICAgICAgIGlmICgvaVBob25lfGlQYWR8aVBvZHxBbmRyb2lkL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgewogICAgICAgICAgICAgICAgbGV0IG1ldGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtZXRhJykKICAgICAgICAgICAgICAgIG1ldGEubmFtZSA9ICd2aWV3cG9ydCcKICAgICAgICAgICAgICAgIG1ldGEuY29udGVudCA9ICd3aWR0aD1kZXZpY2Utd2lkdGgsIGhlaWdodD1kZXZpY2UtaGVpZ2h0LCBpbml0aWFsLXNjYWxlPTEuMCwgdXNlci1zY2FsYWJsZT1ubywgc2hyaW5rLXRvLWZpdD15ZXMnCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKG1ldGEpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJykKICAgICAgICAgICAgbGV0IGxvYWRpbmdPdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmctb3ZlcmxheScpCiAgICAgICAgICAgIGxldCBwcm9ncmVzc0JhckZpbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3MtYmFyLWZpbGwnKQogICAgICAgICAgICBsZXQgYmFubmVyQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jhbm5lci1jb250YWluZXInKQoKICAgICAgICAgICAgY29uc3QgU1RPUkFHRV9EQVRBX1NFUEFSQVRPUiA9ICd7YnJpZGdlX2RhdGFfc2VwYXJhdG9yfScKICAgICAgICAgICAgY29uc3QgU1RPUkFHRV9LRVlTX1NFUEFSQVRPUiA9ICd7YnJpZGdlX2tleXNfc2VwYXJhdG9yfScKICAgICAgICAgICAgY29uc3QgU1RPUkFHRV9WQUxVRVNfU0VQQVJBVE9SID0gJ3ticmlkZ2VfdmFsdWVzX3NlcGFyYXRvcn0nCiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gdXRpbHMKICAgICAgICAgICAgd2luZG93LnVuaXR5SW5zdGFuY2UgPSBudWxsCiAgICAgICAgICAgIGxldCBwcm9ncmVzc0JhckZpbGxpbmdJbnRlcnZhbCA9IG51bGwKICAgICAgICAgICAgbGV0IHByb2dyZXNzQmFyQ29tcGxldGVGaWxsaW5nU3RhcnRlZCA9IGZhbHNlCgogICAgICAgICAgICBmdW5jdGlvbiBzZW5kTWVzc2FnZVRvVW5pdHkobmFtZSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cudW5pdHlJbnN0YW5jZSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy51bml0eUluc3RhbmNlLlNlbmRNZXNzYWdlKCdQbGF5Z2FtYUJyaWRnZScsIG5hbWUsIHZhbHVlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBvblVuaXR5TG9hZGluZ1Byb2dyZXNzQ2hhbmdlZChwcm9ncmVzcykgewogICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzID49IDEgJiYgcHJvZ3Jlc3NCYXJGaWxsaW5nSW50ZXJ2YWwgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsKQogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsID0gbnVsbAogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChwcm9ncmVzc0JhckNvbXBsZXRlRmlsbGluZ1N0YXJ0ZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocHJvZ3Jlc3MgPj0gMC45KSB7CiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJDb21wbGV0ZUZpbGxpbmdTdGFydGVkID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlUHJvZ3Jlc3NCYXJGaWxsaW5nKCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwcm9ncmVzc0JhckZpbGwuc3R5bGUud2lkdGggPSBgJHsgcHJvZ3Jlc3MgKiAxMDAgfSVgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBsZXRlUHJvZ3Jlc3NCYXJGaWxsaW5nKCkgewogICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRQZXJjZW50ID0gOTAKICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRmlsbC5zdHlsZS53aWR0aCA9IGAkeyBjdXJyZW50UGVyY2VudCB9JWAKICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQZXJjZW50KysKICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFBlcmNlbnQgPiAxMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBlcmNlbnQgPSAxMDAKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRmlsbC5zdHlsZS53aWR0aCA9IGAkeyBjdXJyZW50UGVyY2VudCB9JWAKCiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRQZXJjZW50ID49IDEwMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsKQogICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0JhckZpbGxpbmdJbnRlcnZhbCA9IG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTAwKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLCAoKSA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZm9jdXMoKQogICAgICAgICAgICAgICAgY2FudmFzLmZvY3VzKCkKICAgICAgICAgICAgfSkKCgogICAgICAgICAgICBsZXQgYnJpZGdlT3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgIHBsYXRmb3JtczogewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpbml0aWFsaXphdGlvbgogICAgICAgICAgICBicmlkZ2UKICAgICAgICAgICAgICAgIC5pbml0aWFsaXplKGJyaWRnZU9wdGlvbnMpCiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgYnJpZGdlLmFkdmVydGlzZW1lbnQub24oJ2Jhbm5lcl9zdGF0ZV9jaGFuZ2VkJywgc3RhdGUgPT4gc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkJhbm5lclN0YXRlQ2hhbmdlZCcsIHN0YXRlKSkKICAgICAgICAgICAgICAgICAgICBicmlkZ2UuYWR2ZXJ0aXNlbWVudC5vbignaW50ZXJzdGl0aWFsX3N0YXRlX2NoYW5nZWQnLCBzdGF0ZSA9PiBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uSW50ZXJzdGl0aWFsU3RhdGVDaGFuZ2VkJywgc3RhdGUpKQogICAgICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50Lm9uKCdyZXdhcmRlZF9zdGF0ZV9jaGFuZ2VkJywgc3RhdGUgPT4gc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblJld2FyZGVkU3RhdGVDaGFuZ2VkJywgc3RhdGUpKQogICAgICAgICAgICAgICAgICAgIGJyaWRnZS5nYW1lLm9uKCd2aXNpYmlsaXR5X3N0YXRlX2NoYW5nZWQnLCBzdGF0ZSA9PiBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uVmlzaWJpbGl0eVN0YXRlQ2hhbmdlZCcsIHN0YXRlKSkKCiAgICAgICAgICAgICAgICAgICAgaWYgKGJyaWRnZS5wbGF0Zm9ybS5pZCA9PT0gYnJpZGdlLlBMQVRGT1JNX0lELkdBTUVfRElTVFJJQlVUSU9OKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LnNob3dJbnRlcnN0aXRpYWwoKQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbGV0IHVuaXR5TG9hZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JykKICAgICAgICAgICAgICAgICAgICB1bml0eUxvYWRlci5zcmMgPSAnQnVpbGQvTVJSX1BsYXlnYW1hX1YxLmxvYWRlci5qcycKICAgICAgICAgICAgICAgICAgICB1bml0eUxvYWRlci5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVVuaXR5SW5zdGFuY2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVVybDogJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbXJyYWNlcnJAMS4wLjEvZTc2NDc5OTYwYzE1YmFhNTg1OGUwMDk3MTFjOGRlZTUuZGF0YS51bml0eXdlYicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWV3b3JrVXJsOiAnQnVpbGQvZjE4OWViM2QyMWQwNGRjOGY0ZjE2NWFhNDcxOWVhYzkuanMudW5pdHl3ZWInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVVcmw6ICdCdWlsZC9iNjgwZDkzYmQ1OTJmYzM5MDQ0OTAxYWUzOGE2MjJiMy53YXNtLnVuaXR5d2ViJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW1pbmdBc3NldHNVcmw6ICdTdHJlYW1pbmdBc3NldHMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhbnlOYW1lOiAnQ2hlbm5haUdhbWVzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0TmFtZTogJ01SIFJBQ0VSJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0VmVyc2lvbjogJzEuNS42LjInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1hdGNoV2ViR0xUb0NhbnZhc1NpemU6IGZhbHNlLCAvLyBVbmNvbW1lbnQgdGhpcyB0byBzZXBhcmF0ZWx5IGNvbnRyb2wgV2ViR0wgY2FudmFzIHJlbmRlciBzaXplIGFuZCBET00gZWxlbWVudCBzaXplLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRldmljZVBpeGVsUmF0aW86IDEsIC8vIFVuY29tbWVudCB0aGlzIHRvIG92ZXJyaWRlIGxvdyBEUEkgcmVuZGVyaW5nIG9uIGhpZ2ggRFBJIGRpc3BsYXlzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uVW5pdHlMb2FkaW5nUHJvZ3Jlc3NDaGFuZ2VkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHVuaXR5SW5zdGFuY2UpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cudW5pdHlJbnN0YW5jZSA9IHVuaXR5SW5zdGFuY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nT3ZlcmxheS5yZW1vdmUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy5mb2N1cygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHVuaXR5TG9hZGVyKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKGVycm9yKSkKICAgICAgICAgICAgCgogICAgICAgICAgICAvLyBwbGF0Zm9ybQogICAgICAgICAgICB3aW5kb3cuZ2V0UGxhdGZvcm1JZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5wbGF0Zm9ybS5pZAogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0UGxhdGZvcm1MYW5ndWFnZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5wbGF0Zm9ybS5sYW5ndWFnZQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0UGxhdGZvcm1QYXlsb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBsZXQgcGF5bG9hZCA9IGJyaWRnZS5wbGF0Zm9ybS5wYXlsb2FkCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBheWxvYWQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBheWxvYWQKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRQbGF0Zm9ybVRsZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgbGV0IHRsZCA9IGJyaWRnZS5wbGF0Zm9ybS50bGQKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGxkID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0bGQKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5zZW5kTWVzc2FnZVRvUGxhdGZvcm0gPSBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICBicmlkZ2UucGxhdGZvcm0uc2VuZE1lc3NhZ2UobWVzc2FnZSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldFNlcnZlclRpbWUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5wbGF0Zm9ybS5nZXRTZXJ2ZXJUaW1lKCkKICAgICAgICAgICAgICAgICAgICAudGhlbihyZXN1bHQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uR2V0U2VydmVyVGltZUNvbXBsZXRlZCcsIHJlc3VsdC50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkdldFNlcnZlclRpbWVDb21wbGV0ZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAvLyBkZXZpY2UKICAgICAgICAgICAgd2luZG93LmdldERldmljZVR5cGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UuZGV2aWNlLnR5cGUKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIHBsYXllcgogICAgICAgICAgICB3aW5kb3cuZ2V0SXNQbGF5ZXJBdXRob3JpemF0aW9uU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnBsYXllci5pc0F1dGhvcml6YXRpb25TdXBwb3J0ZWQudG9TdHJpbmcoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0SXNQbGF5ZXJBdXRob3JpemVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnBsYXllci5pc0F1dGhvcml6ZWQudG9TdHJpbmcoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0UGxheWVySWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGlmIChicmlkZ2UucGxheWVyLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5wbGF5ZXIuaWQudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0UGxheWVyTmFtZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKGJyaWRnZS5wbGF5ZXIubmFtZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGxheWVyLm5hbWUudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiAnJwogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0UGxheWVyUGhvdG9zID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAoYnJpZGdlLnBsYXllci5waG90b3MubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShicmlkZ2UucGxheWVyLnBob3RvcykKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gJycKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmF1dGhvcml6ZVBsYXllciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmlkZ2UucGxheWVyLmF1dGhvcml6ZShvcHRpb25zKQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkF1dGhvcml6ZUNvbXBsZXRlZCcsICd0cnVlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25BdXRob3JpemVDb21wbGV0ZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAvLyBnYW1lCiAgICAgICAgICAgIHdpbmRvdy5nZXRWaXNpYmlsaXR5U3RhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UuZ2FtZS52aXNpYmlsaXR5U3RhdGUKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIHN0b3JhZ2UKICAgICAgICAgICAgd2luZG93LmdldFN0b3JhZ2VEZWZhdWx0VHlwZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zdG9yYWdlLmRlZmF1bHRUeXBlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1N0b3JhZ2VTdXBwb3J0ZWQgPSBmdW5jdGlvbihzdG9yYWdlVHlwZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zdG9yYWdlLmlzU3VwcG9ydGVkKHN0b3JhZ2VUeXBlKS50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1N0b3JhZ2VBdmFpbGFibGUgPSBmdW5jdGlvbihzdG9yYWdlVHlwZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zdG9yYWdlLmlzQXZhaWxhYmxlKHN0b3JhZ2VUeXBlKS50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRTdG9yYWdlRGF0YSA9IGZ1bmN0aW9uKGtleSwgc3RvcmFnZVR5cGUpIHsKICAgICAgICAgICAgICAgIGxldCBrZXlzID0ga2V5LnNwbGl0KFNUT1JBR0VfS0VZU19TRVBBUkFUT1IpCgogICAgICAgICAgICAgICAgYnJpZGdlLnN0b3JhZ2UuZ2V0KGtleXMsIHN0b3JhZ2VUeXBlLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleXMubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlcyA9IFtdCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlID0gZGF0YVtpXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzLnB1c2godmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzLnB1c2goJycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25HZXRTdG9yYWdlRGF0YVN1Y2Nlc3MnLCBgJHtrZXl9JHtTVE9SQUdFX0RBVEFfU0VQQVJBVE9SfSR7dmFsdWVzLmpvaW4oU1RPUkFHRV9WQUxVRVNfU0VQQVJBVE9SKX1gKQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFbMF0gIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkdldFN0b3JhZ2VEYXRhU3VjY2VzcycsIGAke2tleX0ke1NUT1JBR0VfREFUQV9TRVBBUkFUT1J9JHtkYXRhfWApCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25HZXRTdG9yYWdlRGF0YUZhaWxlZCcsIGtleSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuc2V0U3RvcmFnZURhdGEgPSBmdW5jdGlvbihrZXksIHZhbHVlLCBzdG9yYWdlVHlwZSkgewogICAgICAgICAgICAgICAgbGV0IGtleXMgPSBrZXkuc3BsaXQoU1RPUkFHRV9LRVlTX1NFUEFSQVRPUikKICAgICAgICAgICAgICAgIGxldCB2YWx1ZXMgPSB2YWx1ZS5zcGxpdChTVE9SQUdFX1ZBTFVFU19TRVBBUkFUT1IpCgogICAgICAgICAgICAgICAgYnJpZGdlLnN0b3JhZ2Uuc2V0KGtleXMsIHZhbHVlcywgc3RvcmFnZVR5cGUpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uU2V0U3RvcmFnZURhdGFTdWNjZXNzJywga2V5KQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblNldFN0b3JhZ2VEYXRhRmFpbGVkJywga2V5KQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5kZWxldGVTdG9yYWdlRGF0YSA9IGZ1bmN0aW9uKGtleSwgc3RvcmFnZVR5cGUpIHsKICAgICAgICAgICAgICAgIGxldCBrZXlzID0ga2V5LnNwbGl0KFNUT1JBR0VfS0VZU19TRVBBUkFUT1IpCgogICAgICAgICAgICAgICAgYnJpZGdlLnN0b3JhZ2UuZGVsZXRlKGtleXMsIHN0b3JhZ2VUeXBlKQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkRlbGV0ZVN0b3JhZ2VEYXRhU3VjY2VzcycsIGtleSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25EZWxldGVTdG9yYWdlRGF0YUZhaWxlZCcsIGtleSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgoKICAgICAgICAgICAgLy8gYWR2ZXJ0aXNlbWVudAogICAgICAgICAgICB3aW5kb3cuZ2V0SW50ZXJzdGl0aWFsU3RhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGlmIChicmlkZ2UuYWR2ZXJ0aXNlbWVudC5pbnRlcnN0aXRpYWxTdGF0ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UuYWR2ZXJ0aXNlbWVudC5pbnRlcnN0aXRpYWxTdGF0ZQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldElzQmFubmVyU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLmFkdmVydGlzZW1lbnQuaXNCYW5uZXJTdXBwb3J0ZWQudG9TdHJpbmcoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICB3aW5kb3cuZ2V0TWluaW11bURlbGF5QmV0d2VlbkludGVyc3RpdGlhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5hZHZlcnRpc2VtZW50Lm1pbmltdW1EZWxheUJldHdlZW5JbnRlcnN0aXRpYWwudG9TdHJpbmcoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuc2V0TWluaW11bURlbGF5QmV0d2VlbkludGVyc3RpdGlhbCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LnNldE1pbmltdW1EZWxheUJldHdlZW5JbnRlcnN0aXRpYWwob3B0aW9ucykKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LnNob3dCYW5uZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7IH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoYnJpZGdlLnBsYXRmb3JtLmlkID09PSBicmlkZ2UuUExBVEZPUk1fSUQuQ1JBWllfR0FNRVMgfHwgYnJpZGdlLnBsYXRmb3JtLmlkID09PSBicmlkZ2UuUExBVEZPUk1fSUQuR0FNRV9ESVNUUklCVVRJT04pIHsKICAgICAgICAgICAgICAgICAgICBiYW5uZXJDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jaycKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBvcHRpb25zWydjcmF6eV9nYW1lcyddID0gewogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcklkOiAnYmFubmVyLWNvbnRhaW5lcicKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBvcHRpb25zWydnYW1lX2Rpc3RyaWJ1dGlvbiddID0gewogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcklkOiAnYmFubmVyLWNvbnRhaW5lcicKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmlkZ2UuYWR2ZXJ0aXNlbWVudC5zaG93QmFubmVyKG9wdGlvbnMpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5oaWRlQmFubmVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAoYnJpZGdlLnBsYXRmb3JtLmlkID09PSBicmlkZ2UuUExBVEZPUk1fSUQuQ1JBWllfR0FNRVMgfHwgYnJpZGdlLnBsYXRmb3JtLmlkID09PSBicmlkZ2UuUExBVEZPUk1fSUQuR0FNRV9ESVNUUklCVVRJT04pIHsKICAgICAgICAgICAgICAgICAgICBiYW5uZXJDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LmhpZGVCYW5uZXIoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuc2hvd0ludGVyc3RpdGlhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgYnJpZGdlLmFkdmVydGlzZW1lbnQuc2hvd0ludGVyc3RpdGlhbCgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5zaG93UmV3YXJkZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LnNob3dSZXdhcmRlZCgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5jaGVja0FkQmxvY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LmNoZWNrQWRCbG9jaygpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkNoZWNrQWRCbG9ja0NvbXBsZXRlZCcsIHJlc3VsdC50b1N0cmluZygpKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkNoZWNrQWRCbG9ja0NvbXBsZXRlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIHNvY2lhbAogICAgICAgICAgICB3aW5kb3cuZ2V0SXNTaGFyZVN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zb2NpYWwuaXNTaGFyZVN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0ludml0ZUZyaWVuZHNTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzSW52aXRlRnJpZW5kc1N1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0pvaW5Db21tdW5pdHlTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzSm9pbkNvbW11bml0eVN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0NyZWF0ZVBvc3RTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzQ3JlYXRlUG9zdFN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0FkZFRvSG9tZVNjcmVlblN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zb2NpYWwuaXNBZGRUb0hvbWVTY3JlZW5TdXBwb3J0ZWQudG9TdHJpbmcoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0SXNBZGRUb0Zhdm9yaXRlc1N1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zb2NpYWwuaXNBZGRUb0Zhdm9yaXRlc1N1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1JhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzUmF0ZVN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0V4dGVybmFsTGlua3NBbGxvd2VkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnNvY2lhbC5pc0V4dGVybmFsTGlua3NBbGxvd2VkLnRvU3RyaW5nKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LnNoYXJlID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwuc2hhcmUob3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25TaGFyZUNvbXBsZXRlZCcsICd0cnVlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25TaGFyZUNvbXBsZXRlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93Lmludml0ZUZyaWVuZHMgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwuaW52aXRlRnJpZW5kcyhvcHRpb25zKQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkludml0ZUZyaWVuZHNDb21wbGV0ZWQnLCAndHJ1ZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uSW52aXRlRnJpZW5kc0NvbXBsZXRlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmpvaW5Db21tdW5pdHkgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJpZGdlLnNvY2lhbC5qb2luQ29tbXVuaXR5KG9wdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uSm9pbkNvbW11bml0eUNvbXBsZXRlZCcsICd0cnVlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25Kb2luQ29tbXVuaXR5Q29tcGxldGVkJywgJ2ZhbHNlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuY3JlYXRlUG9zdCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmlkZ2Uuc29jaWFsLmNyZWF0ZVBvc3Qob3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25DcmVhdGVQb3N0Q29tcGxldGVkJywgJ3RydWUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkNyZWF0ZVBvc3RDb21wbGV0ZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5hZGRUb0hvbWVTY3JlZW4gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwuYWRkVG9Ib21lU2NyZWVuKCkKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25BZGRUb0hvbWVTY3JlZW5Db21wbGV0ZWQnLCAndHJ1ZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQWRkVG9Ib21lU2NyZWVuQ29tcGxldGVkJywgJ2ZhbHNlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuYWRkVG9GYXZvcml0ZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwuYWRkVG9GYXZvcml0ZXMoKQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFkZFRvRmF2b3JpdGVzQ29tcGxldGVkJywgJ3RydWUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFkZFRvRmF2b3JpdGVzQ29tcGxldGVkJywgJ2ZhbHNlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cucmF0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgYnJpZGdlLnNvY2lhbC5yYXRlKCkKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25SYXRlQ29tcGxldGVkJywgJ3RydWUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblJhdGVDb21wbGV0ZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAvLyBsZWFkZXJib2FyZAogICAgICAgICAgICB3aW5kb3cuZ2V0SXNMZWFkZXJib2FyZFN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5sZWFkZXJib2FyZC5pc1N1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0xlYWRlcmJvYXJkTmF0aXZlUG9wdXBTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UubGVhZGVyYm9hcmQuaXNOYXRpdmVQb3B1cFN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0xlYWRlcmJvYXJkU2V0U2NvcmVTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UubGVhZGVyYm9hcmQuaXNTZXRTY29yZVN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0xlYWRlcmJvYXJkR2V0U2NvcmVTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UubGVhZGVyYm9hcmQuaXNHZXRTY29yZVN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0xlYWRlcmJvYXJkR2V0RW50cmllc1N1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5sZWFkZXJib2FyZC5pc0dldEVudHJpZXNTdXBwb3J0ZWQudG9TdHJpbmcoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cubGVhZGVyYm9hcmRTZXRTY29yZSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmlkZ2UubGVhZGVyYm9hcmQuc2V0U2NvcmUob3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZFNldFNjb3JlQ29tcGxldGVkJywgJ3RydWUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkU2V0U2NvcmVDb21wbGV0ZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5sZWFkZXJib2FyZEdldFNjb3JlID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5sZWFkZXJib2FyZC5nZXRTY29yZShvcHRpb25zKQogICAgICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZEdldFNjb3JlQ29tcGxldGVkJywgZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZEdldFNjb3JlQ29tcGxldGVkJywgJycpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZEdldFNjb3JlQ29tcGxldGVkJywgJ2ZhbHNlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cubGVhZGVyYm9hcmRHZXRFbnRyaWVzID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5sZWFkZXJib2FyZC5nZXRFbnRyaWVzKG9wdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uTGVhZGVyYm9hcmRHZXRFbnRyaWVzQ29tcGxldGVkU3VjY2VzcycsIEpTT04uc3RyaW5naWZ5KGRhdGEpKQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkR2V0RW50cmllc0NvbXBsZXRlZFN1Y2Nlc3MnLCAnJykKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkR2V0RW50cmllc0NvbXBsZXRlZEZhaWxlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmxlYWRlcmJvYXJkU2hvd05hdGl2ZVBvcHVwID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5sZWFkZXJib2FyZC5zaG93TmF0aXZlUG9wdXAob3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZFNob3dOYXRpdmVQb3B1cENvbXBsZXRlZCcsICd0cnVlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZFNob3dOYXRpdmVQb3B1cENvbXBsZXRlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldElzUGF5bWVudHNTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGF5bWVudHMuaXNTdXBwb3J0ZWQudG9TdHJpbmcoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cuZ2V0SXNDYXRhbG9nU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnBheW1lbnRzLmlzR2V0Q2F0YWxvZ1N1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1B1cmNoYXNlTGlzdFN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5wYXltZW50cy5pc0dldFB1cmNoYXNlc1N1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1B1cmNoYXNlQ29uc3VtaW5nU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnBheW1lbnRzLmlzQ29uc3VtZVB1cmNoYXNlU3VwcG9ydGVkLnRvU3RyaW5nKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LnBheW1lbnRzUHVyY2hhc2UgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGJyaWRnZS5wYXltZW50cy5wdXJjaGFzZShvcHRpb25zKQogICAgICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25QYXltZW50c1B1cmNoYXNlQ29tcGxldGVkJywgZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25QYXltZW50c1B1cmNoYXNlQ29tcGxldGVkJywgJycpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25QYXltZW50c1B1cmNoYXNlRmFpbGVkJywgJycpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LnBheW1lbnRzQ29uc3VtZVB1cmNoYXNlID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBicmlkZ2UucGF5bWVudHMuY29uc3VtZVB1cmNoYXNlKG9wdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUGF5bWVudHNDb25zdW1lUHVyY2hhc2VDb21wbGV0ZWQnLCAndHJ1ZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUGF5bWVudHNDb25zdW1lUHVyY2hhc2VDb21wbGV0ZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5wYXltZW50c0dldENhdGFsb2cgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5wYXltZW50cy5nZXRDYXRhbG9nKCkKICAgICAgICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gSlNPTi5zdHJpbmdpZnkoZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUGF5bWVudHNHZXRDYXRhbG9nQ29tcGxldGVkU3VjY2VzcycsIGRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUGF5bWVudHNHZXRDYXRhbG9nQ29tcGxldGVkU3VjY2VzcycsICcnKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUGF5bWVudHNHZXRDYXRhbG9nQ29tcGxldGVkRmFpbGVkJywgJ2ZhbHNlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cucGF5bWVudHNHZXRQdXJjaGFzZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGJyaWRnZS5wYXltZW50cy5nZXRQdXJjaGFzZXMoKQogICAgICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25QYXltZW50c0dldFB1cmNoYXNlc0NvbXBsZXRlZFN1Y2Nlc3MnLCBkYXRhKQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblBheW1lbnRzR2V0UHVyY2hhc2VzQ29tcGxldGVkU3VjY2VzcycsICcnKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUGF5bWVudHNHZXRQdXJjaGFzZXNDb21wbGV0ZWRGYWlsZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1JlbW90ZUNvbmZpZ1N1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5yZW1vdGVDb25maWcuaXNTdXBwb3J0ZWQudG9TdHJpbmcoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB3aW5kb3cucmVtb3RlQ29uZmlnR2V0ID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyaWRnZS5yZW1vdGVDb25maWcuZ2V0KG9wdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUmVtb3RlQ29uZmlnR2V0U3VjY2VzcycsIGRhdGEpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUmVtb3RlQ29uZmlnR2V0RmFpbGVkJywgJycpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmdldElzQWNoaWV2ZW1lbnRzU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLmFjaGlldmVtZW50cy5pc1N1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0dldEFjaGlldmVtZW50c0xpc3RTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UuYWNoaWV2ZW1lbnRzLmlzR2V0TGlzdFN1cHBvcnRlZC50b1N0cmluZygpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0FjaGlldmVtZW50c05hdGl2ZVBvcHVwU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLmFjaGlldmVtZW50cy5pc05hdGl2ZVBvcHVwU3VwcG9ydGVkLnRvU3RyaW5nKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmFjaGlldmVtZW50c1VubG9jayA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmlkZ2UuYWNoaWV2ZW1lbnRzLnVubG9jayhvcHRpb25zKQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFjaGlldmVtZW50c1VubG9ja0NvbXBsZXRlZCcsICd0cnVlJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25BY2hpZXZlbWVudHNVbmxvY2tDb21wbGV0ZWQnLCAnZmFsc2UnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdpbmRvdy5hY2hpZXZlbWVudHNTaG93TmF0aXZlUG9wdXAgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGJyaWRnZS5hY2hpZXZlbWVudHMuc2hvd05hdGl2ZVBvcHVwKG9wdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQWNoaWV2ZW1lbnRzU2hvd05hdGl2ZVBvcHVwQ29tcGxldGVkJywgJ3RydWUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFjaGlldmVtZW50c1Nob3dOYXRpdmVQb3B1cENvbXBsZXRlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2luZG93LmFjaGlldmVtZW50c0dldExpc3QgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJpZGdlLmFjaGlldmVtZW50cy5nZXRMaXN0KG9wdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFjaGlldmVtZW50c0dldExpc3RDb21wbGV0ZWRTdWNjZXNzJywgZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25BY2hpZXZlbWVudHNHZXRMaXN0Q29tcGxldGVkU3VjY2VzcycsICcnKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQWNoaWV2ZW1lbnRzR2V0TGlzdENvbXBsZXRlZEZhaWxlZCcsICdmYWxzZScpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgIDwvc2NyaXB0PgogICAgPC9ib2R5Pgo8L2h0bWw+Cg==";
