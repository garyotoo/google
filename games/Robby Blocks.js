window.game = "PE1vZHVsZT4NCg0KDQo8IS0tIFVsdGltYXRlIEdhbWUgU3Rhc2ggZmlsZS0tPiANCjwhLS0gRm9yIHRoZSByZWd1bGFybHkgdXBkYXRpbmcgZG9jIGdvIHRvIGh0dHBzOi8vZG9jcy5nb29nbGUuY29tL2RvY3VtZW50L2QvMV9GbUgzQmxTQlFJN0ZHZ0FRTDU5LVpQZThlQ3hzMzV3ZWw2SlV5VmFHOFEvIC0tPg0KDQoNCg0KPCFET0NUWVBFIGh0bWw+DQoNCjxodG1sIGxhbmc9ImVuLXVzIj4NCjxoZWFkPg0KPG1ldGEgY2hhcnNldD0idXRmLTgiLz4NCjxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ii8+DQo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCwgdXNlci1zY2FsYWJsZT1ubyIvPg0KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvb3JnYW5pemF0aW9uLXNjaG9vZ2xzL3hAbWFpbi9zdHlsZS5jc3MiLz4NCjwhLS0gWWFuZGV4IEdhbWVzIFNESyAtLT4NCjxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvb3JnYW5pemF0aW9uLXNjaG9vZ2xzL3hAbWFpbi92Mi4xN2RiYTQ3YWM5NmIxNTYyZDE4NC5qcyI+PC9zY3JpcHQ+DQo8c3R5bGU+DQogICAgICAgIC8qINCj0LHQuNGA0LDQtdC8INCy0YvQtNC10LvQtdC90LjQtSDQv9C+INC90LDQttCw0YLQuNGOINC60LvQsNCy0LjRiCAqLw0KICAgICAgICBjYW52YXM6Zm9jdXMgew0KICAgICAgICAgICAgb3V0bGluZTogbm9uZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGh0bWwsIGJvZHkgew0KICAgICAgICAgICAgLyog0KPQsdC40YDQsNC10Lwg0L7RgtGB0YLRg9C/0YsgKi8NCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICAvKiDQntGC0LrQu9GO0YfQsNC10Lwg0YHQutGA0L7Qu9C7INC4INC70L7QvdCz0YLQsNC/INC90LAgSU9TICovDQogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgICAgICAgLXdlYmtpdC10b3VjaC1jYWxsb3V0OiBub25lOw0KICAgICAgICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgICAgICAgIC1raHRtbC11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgICAgICAgIC1tb3otdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAgICAgICAtbXMtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAgICAgICB1c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgICAgICAgIC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogcmdiYSgwLDAsMCwwKTsNCiAgICAgICAgICAgIC8qINCh0YLQsNCy0LjQvCDQstGL0YHQvtGC0YMg0L3QsCAxMDAlICovDQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgIH0NCiAgICA8L3N0eWxlPg0KPC9oZWFkPg0KPGJvZHkgY2xhc3M9ImxpZ2h0Ij4NCjxkaXYgaWQ9InVuaXR5LWNvbnRhaW5lciIgY2xhc3M9InVuaXR5LWRlc2t0b3AiPg0KPGNhbnZhcyBpZD0idW5pdHktY2FudmFzIiB0YWJpbmRleD0iLTEiPjwvY2FudmFzPg0KPC9kaXY+DQo8ZGl2IGlkPSJsb2FkaW5nLWNvdmVyIiBzdHlsZT0iZGlzcGxheTpub25lOyI+DQo8ZGl2IGlkPSJ1bml0eS1sb2FkaW5nLWJhciI+DQo8ZGl2IGlkPSJ1bml0eS1sb2dvIj48aW1nIHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2J1YmJscy9VR1MtZmlsZS1lbmNyeXB0aW9uQDc1NGE1NzgzN2U5MmJiNDU1MmU4MjQ3YzZhNDAxYmQ0Y2U4ZTRlZTcvaW1hZ2VzLmpwZyIvPjwvZGl2Pg0KPGRpdiBpZD0idW5pdHktcHJvZ3Jlc3MtYmFyLWVtcHR5IiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPg0KPGRpdiBpZD0idW5pdHktcHJvZ3Jlc3MtYmFyLWZ1bGwiPjwvZGl2Pg0KPC9kaXY+DQo8ZGl2IGNsYXNzPSJzcGlubmVyIj48L2Rpdj4NCjwvZGl2Pg0KPC9kaXY+DQo8IS0tIEFkZGl0aW9uYWwgYm9keSBtb2R1bGVzIC0tPg0KPHNjcmlwdD4NCiAgICAgICAgY29uc3QgaGlkZUZ1bGxTY3JlZW5CdXR0b24gPSAiIjsNCiAgICAgICAgY29uc3QgYnVpbGRVcmwgPSAiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL29yZ2FuaXphdGlvbi1zY2hvb2dscy94QG1haW4vQnVpbGQiOw0KICAgICAgICBjb25zdCBsb2FkZXJVcmwgPSBidWlsZFVybCArICIvZ2FtZS5sb2FkZXIuanMiOw0KICAgICAgICBjb25zdCBjb25maWcgPSB7DQogICAgICAgICAgICBkYXRhVXJsOiBidWlsZFVybCArICIvZ2FtZS5kYXRhLnVuaXR5d2ViIiwNCiAgICAgICAgICAgIGZyYW1ld29ya1VybDogYnVpbGRVcmwgKyAiL2dhbWUuZnJhbWV3b3JrLmpzLnVuaXR5d2ViIiwNCiAgICAgICAgICAgIGNvZGVVcmw6IGJ1aWxkVXJsICsgIi9nYW1lLndhc20udW5pdHl3ZWIiLA0KICAgICAgICBzdHJlYW1pbmdBc3NldHNVcmw6ICJTdHJlYW1pbmdBc3NldHMiLA0KICAgICAgICAgICAgY29tcGFueU5hbWU6ICJNaXJhZ2UgR2FtZXMiLA0KICAgICAgICAgICAgcHJvZHVjdE5hbWU6ICJMZXNvcnViIiwNCiAgICAgICAgICAgIHByb2R1Y3RWZXJzaW9uOiAiMC4wLjAuMSINCiAgICAgICAgfTsNCg0KICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjdW5pdHktY29udGFpbmVyIik7DQogICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1jYW52YXMiKTsNCiAgICAgICAgY29uc3QgbG9hZGluZ0NvdmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2xvYWRpbmctY292ZXIiKTsNCiAgICAgICAgY29uc3QgcHJvZ3Jlc3NCYXJFbXB0eSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1wcm9ncmVzcy1iYXItZW1wdHkiKTsNCiAgICAgICAgY29uc3QgcHJvZ3Jlc3NCYXJGdWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3VuaXR5LXByb2dyZXNzLWJhci1mdWxsIik7DQogICAgICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3Bpbm5lcicpOw0KDQogICAgICAgIGNvbnN0IGNhbkZ1bGxzY3JlZW4gPSAoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgWw0KICAgICAgICAgICAgICAgICdleGl0RnVsbHNjcmVlbicsDQogICAgICAgICAgICAgICAgJ3dlYmtpdEV4aXRGdWxsc2NyZWVuJywNCiAgICAgICAgICAgICAgICAnd2Via2l0Q2FuY2VsRnVsbFNjcmVlbicsDQogICAgICAgICAgICAgICAgJ21vekNhbmNlbEZ1bGxTY3JlZW4nLA0KICAgICAgICAgICAgICAgICdtc0V4aXRGdWxsc2NyZWVuJywNCiAgICAgICAgICAgIF0pIHsNCiAgICAgICAgICAgICAgICBpZiAoa2V5IGluIGRvY3VtZW50KSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSgpKTsNCg0KICAgICAgICBpZiAoL2lQaG9uZXxpUGFkfGlQb2R8QW5kcm9pZC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsNCiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSAidW5pdHktbW9iaWxlIjsNCiAgICAgICAgICAgIA0KICAgICAgICB9DQoNCiAgICAgICAgLy8g0KTQvtC90L7QstC+0LUg0LjQt9C+0LHRgNCw0LbQtdC90LjQtSDQv9GA0Lgg0LfQsNCz0YDRg9C30LrQtSDQuNCz0YDRiy4g0J/RgNC4INGB0LHQvtGA0LrQtSDQsdC40LvQtNCwINC60L7QtCDQvNC10L3Rj9C10YLRgdGPINCy0LfQsNCy0LjRgdC40LzQvtGB0YLQuCDQvtGCINC90LDRgdGC0YDQvtC10Log0L/RgNC+0LXQutGC0LAuDQogICAgICAgIA0KICAgICAgICBsb2FkaW5nQ292ZXIuc3R5bGUuYmFja2dyb3VuZCA9ICJ1cmwoJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9vcmdhbml6YXRpb24tc2Nob29nbHMveEBtYWluL2JhY2tncm91bmQuanBnJykgY2VudGVyIC8gY292ZXIiOw0KICAgICAgICBwcm9ncmVzc0JhckVtcHR5LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICIjMDAwMDAwIjsNCiAgICAgICAgbG9hZGluZ0NvdmVyLnN0eWxlLmRpc3BsYXkgPSAiIjsNCg0KICAgICAgICAvLyDQktGL0LrQu9GO0YfQsNC10Lwg0L/QvtGP0LLQu9C10L3QuNC1INC80LXQvdGOINC/0YDQuCDQv9GA0LDQstC+0Lwg0LrQu9C40LrQtSDQvNGL0YjQuA0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjb250ZXh0bWVudScsIGV2ZW50ID0+IGV2ZW50LnByZXZlbnREZWZhdWx0KCkpOw0KDQogICAgICAgIC8vINCS0L7Qt9Cy0YDQsNGJ0LDQtdC8INGE0L7QutGD0YEsINC10YHQu9C4INC60LvQuNC60L3Rg9C70Lgg0L/QviDRjdC60YDQsNC90YMNCiAgICAgICAgZnVuY3Rpb24gRm9jdXNHYW1lKCkgew0KICAgICAgICAgICAgd2luZG93LmZvY3VzKCk7DQogICAgICAgICAgICBjYW52YXMuZm9jdXMoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVyZG93bicsICgpID0+IHsNCiAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICB9KTsNCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCAoKSA9PiB7DQogICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndmlzaWJpbGl0eWNoYW5nZScsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICh5c2RrICE9PSBudWxsICYmIGluaXRHYW1lID09IHRydWUpIHsNCiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuaGlkZGVuKSB7DQogICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ09uVmlzaWJpbGl0eUdhbWVXaW5kb3cnLCAnZmFsc2UnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ09uVmlzaWJpbGl0eUdhbWVXaW5kb3cnLCAndHJ1ZScpOw0KDQogICAgICAgICAgICAgICAgICAgIGlmICgoeXNkay5kZXZpY2VJbmZvLmlzTW9iaWxlKCkgfHwgeXNkay5kZXZpY2VJbmZvLmlzVGFibGV0KCkpICYmIHlzZGsuc2NyZWVuLmZ1bGxzY3JlZW4uc3RhdHVzID09ICdvZmYnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgeXNkay5zY3JlZW4uZnVsbHNjcmVlbi5yZXF1ZXN0KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICBmdW5jdGlvbiBSZXN1bWVHYW1lKCkgew0KICAgICAgICAgICAgaWYgKG15R2FtZUluc3RhbmNlICYmIG15R2FtZUluc3RhbmNlLk1vZHVsZSkgew0KICAgICAgICAgICAgICAgIC8vINCS0L7Qt9C+0LHQvdC+0LLQu9C10L3QuNC1INCz0LvQsNCy0L3QvtCz0L4g0YbQuNC60LvQsCBVbml0eQ0KICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLk1vZHVsZS5yZXN1bWVNYWluTG9vcCgpOw0KDQogICAgICAgICAgICAgICAgLy8gKNCa0YPRgNGB0L7RgCDRgdC90L7QstCwINC80L7QttC10YIg0LHRi9GC0Ywg0YHQv9GA0Y/RgtCw0L0sINC10YHQu9C4INGN0YLQviDRgtGA0LXQsdGD0LXRgtGB0Y8g0LjQs9GA0L7QuSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbGV0IGF1ZGlvRWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhdWRpbywgdmlkZW8nKTsNCiAgICAgICAgICAgIGF1ZGlvRWxlbWVudHMuZm9yRWFjaChlbGVtZW50ID0+IHsNCiAgICAgICAgICAgICAgICBlbGVtZW50Lm11dGVkID0gZmFsc2U7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGxldCBTdGFydFVuaXR5SW5zdGFuY2U7DQogICAgICAgIGxldCBteUdhbWVJbnN0YW5jZSA9IG51bGw7DQogICAgICAgIGxldCB5c2RrID0gbnVsbDsNCiAgICAgICAgbGV0IHBsYXllciA9IG51bGw7DQogICAgICAgIGxldCBwYXltZW50cyA9IG51bGw7DQogICAgICAgIGxldCBpbml0R2FtZSA9IGZhbHNlOw0KICAgICAgICBsZXQgbm93RnVsbEFkT3BlbiA9IGZhbHNlOw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsNCiAgICAgICAgICAgIHNjcmlwdC5zcmMgPSBsb2FkZXJVcmw7DQogICAgICAgICAgICBzY3JpcHQub25sb2FkID0gKCkgPT4gew0KICAgICAgICAgICAgICAgIFN0YXJ0VW5pdHlJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlVW5pdHlJbnN0YW5jZShjYW52YXMsIGNvbmZpZywgKHByb2dyZXNzKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzcGlubmVyLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0JhckVtcHR5LnN0eWxlLmRpc3BsYXkgPSAiIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRnVsbC5zdHlsZS53aWR0aCA9IGAkezEwMCAqIHByb2dyZXNzfSVgOw0KICAgICAgICAgICAgICAgICAgICB9KS50aGVuKCh1bml0eUluc3RhbmNlKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZSA9IHVuaXR5SW5zdGFuY2U7DQogICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nQ292ZXIuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKG1lc3NhZ2UpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlVuaXR5IHnDvGtsZW1lIGhhdGFzxLE6IiwgbWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgU3RhcnRVbml0eUluc3RhbmNlKCk7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcigiQmHFn2xhdG1hIHPEsXJhc8SxbmRhIGhhdGE6IiwgZXJyb3IpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gU3RhcnRVbml0eUluc3RhbmNlX0lmVW5sb2FkZWQoKSB7DQogICAgICAgICAgICBpZiAoc3Bpbm5lci5zdHlsZS5kaXNwbGF5ICE9PSAibm9uZSIpDQogICAgICAgICAgICAgICAgU3RhcnRVbml0eUluc3RhbmNlKCk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBMb2NhbEhvc3QoKSB7DQogICAgICAgICAgICB2YXIgaG9zdCA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZTsNCiAgICAgICAgICAgIGlmIChob3N0ID09ICJsb2NhbGhvc3QiIHx8IGhvc3QgPT0gIjEyNy4wLjAuMSIpDQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICBlbHNlIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIEluaXRZU0RLKCk7DQogICAgICAgIGFzeW5jIGZ1bmN0aW9uIEluaXRZU0RLKCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBpZiAoTG9jYWxIb3N0KCkpIHJldHVybjsNCg0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJbml0IFlhbmRleCBTREsnKTsNCiAgICAgICAgICAgICAgICB5c2RrID0gYXdhaXQgWWFHYW1lcy5pbml0KCk7DQoNCiAgICAgICAgICAgICAgICBGdWxsQWRTaG93KCk7IC8vIEZpcnN0IGFkIHRydWUNCg0KICAgICAgICAgICAgICAgIC8vIEFkZGl0aW9uYWwgaW5pdCBtb2R1bGVzDQpjbG91ZFNhdmVzID0gYXdhaXQgTG9hZENsb3VkKCk7DQpjb25zb2xlLmxvZygnSW5pdCBTdG9yYWdlIHlzZGsnKTsNCg0KcGF5bWVudHNEYXRhID0gYXdhaXQgR2V0UGF5bWVudHMoKTsNCmNvbnNvbGUubG9nKCdJbml0IFBheW1lbnRzIHlzZGsnKTsNCg0KSW5pdExlYWRlcmJvYXJkcygpOw0KY29uc29sZS5sb2coJ0luaXQgTGVhZGVyYm9hcmRzJyk7DQoNCmVudmlyb25tZW50RGF0YSA9IGF3YWl0IFJlcXVlc3RpbmdFbnZpcm9ubWVudERhdGEoKTsNCmNvbnNvbGUubG9nKCdJbml0IEVudmlyIHlzZGsnKTsNCg0KcGxheWVyRGF0YSA9IGF3YWl0IEluaXRQbGF5ZXIoKTsNCmNvbnNvbGUubG9nKCdJbml0IFBsYXllciB5c2RrJyk7DQoNCg0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEluaXRpYWxpemF0aW9uIFNESzogJywgZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIFN0YXJ0VW5pdHlJbnN0YW5jZV9JZlVubG9hZGVkKCk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBJbml0R2FtZSgpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0luaXQgR2FtZSBTdWNjZXNzJyk7DQogICAgICAgICAgICAgICAgaW5pdEdhbWUgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGlmIChub3dGdWxsQWRPcGVuID09PSB0cnVlICYmIG15R2FtZUluc3RhbmNlICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnT3BlbkZ1bGxBZCcpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiSW5pdEdhbWUgc8SxcmFzxLFuZGEgaGF0YToiLCBlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBGdWxsQWRTaG93KCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBpZiAobm93RnVsbEFkT3BlbiAhPT0gdHJ1ZSAmJiB5c2RrICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHlzZGsuYWR2LnNob3dGdWxsc2NyZWVuQWR2KA0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrczogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbk9wZW46ICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdPcGVuIEFkIEludGVyc3RpdGlhbCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93RnVsbEFkT3BlbiA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdEdhbWUgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdPcGVuRnVsbEFkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6ICh3YXNTaG93bikgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93RnVsbEFkT3BlbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRHYW1lID09PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdhc1Nob3duKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ0Nsb3NlRnVsbEFkJywgJ3RydWUnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ0Nsb3NlRnVsbEFkJywgJ2ZhbHNlJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRXJyb3I6IChlcnJvcikgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgQWQgSW50ZXJzdGl0aWFsJywgZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnRXJyb3JGdWxsQWQnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBGdWxsQWQgU2hvdzogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIFJld2FyZGVkU2hvdyhpZCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICB5c2RrLmFkdi5zaG93UmV3YXJkZWRWaWRlbygNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzOg0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uT3BlbjogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnT3BlbmVkIFZpZGVvIEFkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ09wZW5WaWRlbycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQ2xvc2VkIFZpZGVvIEFkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ0Nsb3NlVmlkZW8nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblJld2FyZGVkOiAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXdhcmQgVmlkZW8gQWQnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnUmV3YXJkVmlkZW8nLCBpZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkVycm9yOiAoZSkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBWaWRlbyBBZCcsIGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdFcnJvclZpZGVvJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFJld2FyZGVkIFZpZGVvIEFkIFNob3c6ICcsIGVyci5tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIFN0aWNreUFkQWN0aXZpdHkoc2hvdykgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICB5c2RrLmFkdi5nZXRCYW5uZXJBZHZTdGF0dXMoKS50aGVuKCh7IHN0aWNreUFkdklzU2hvd2luZywgcmVhc29uIH0pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0aWNreUFkdklzU2hvd2luZykgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzaG93KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXNkay5hZHYuaGlkZUJhbm5lckFkdigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlYXNvbikgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1N0aWNreSBhZCBhcmUgbm90IHNob3duLiBSZWFzb246JywgcmVhc29uKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzaG93KSB7DQogICAgICAgICAgICAgICAgICAgICAgICB5c2RrLmFkdi5zaG93QmFubmVyQWR2KCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFN0aWNreSBBY3Rpdml0eTogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIFJldmlldygpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgeXNkay5mZWVkYmFjay5jYW5SZXZpZXcoKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbigoeyB2YWx1ZSwgcmVhc29uIH0pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlzZGsuZmVlZGJhY2sucmVxdWVzdFJldmlldygpLnRoZW4oKHsgZmVlZGJhY2tTZW50IH0pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZlZWRiYWNrU2VudCAnLCBmZWVkYmFja1NlbnQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmVlZGJhY2tTZW50KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdSZXZpZXdTZW50JywgJ3RydWUnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXZpZXcgbGVmdCcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdSZXZpZXdTZW50JywgJ2ZhbHNlJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUmV2aWV3IG5vdCBsZWZ0JywgcmVhc29uKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUmV2aWV3IGNhbiBzaG93ID0gZmFsc2UnLCByZWFzb24pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFJldmlldzogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIFByb21wdFNob3coKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHlzZGsuc2hvcnRjdXQuc2hvd1Byb21wdCgpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU2hvcnRjdXQgY3JlYXRlZD86JywgcmVzdWx0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQub3V0Y29tZSA9PT0gJ2FjY2VwdGVkJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9tcHQgU3VjY2VzcycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ09uUHJvbXB0U3VjY2VzcycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnT25Qcm9tcHRGYWlsJyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggUHJvbXB0IFNob3c6ICcsIGUubWVzc2FnZSk7DQogICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBBZGRpdGlvbmFsIHNjcmlwdCBtb2R1bGVzOg0KDQp2YXIgY2xvdWRTYXZlcyA9ICdub0RhdGEnOw0KDQpmdW5jdGlvbiBTYXZlQ2xvdWQoanNvbkRhdGEsIGZsdXNoKSB7DQogICAgaWYgKHBsYXllciA9PSBudWxsKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFNhdmUgQ2xvdWQ6ICcsICdEaWRudCBoYXZlIHRpbWUgdG8gbG9hZCcpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIHRyeSB7DQogICAgICAgIHBsYXllci5zZXREYXRhKHsNCiAgICAgICAgICAgIHNhdmVzOiBbanNvbkRhdGFdLA0KICAgICAgICB9LCBmbHVzaCk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBTYXZlIENsb3VkOiAnLCBlLm1lc3NhZ2UpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gTG9hZENsb3VkKHNlbmRiYWNrKSB7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgICAgIGlmICh5c2RrID09IG51bGwpIHsNCiAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRMb2FkU2F2ZXMnLCAnbm9EYXRhJyk7DQogICAgICAgICAgICByZXNvbHZlKCdub0RhdGEnKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgeXNkay5nZXRQbGF5ZXIoeyBzY29wZXM6IGZhbHNlIH0pDQogICAgICAgICAgICAgICAgLnRoZW4oX3BsYXllciA9PiB7DQogICAgICAgICAgICAgICAgICAgIF9wbGF5ZXIuZ2V0RGF0YShbInNhdmVzIl0pLnRoZW4oZGF0YSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zYXZlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0TG9hZFNhdmVzJywgSlNPTi5zdHJpbmdpZnkoZGF0YS5zYXZlcykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoSlNPTi5zdHJpbmdpZnkoZGF0YS5zYXZlcykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VuZGJhY2spDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1NldExvYWRTYXZlcycsICdub0RhdGEnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdub0RhdGEnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTG9hZCBDbG91ZCBFcnJvciEnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRMb2FkU2F2ZXMnLCAnbm9EYXRhJyk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdub0RhdGEnKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0xvYWQgQ2xvdWQgRXJyb3IhJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbmRiYWNrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0TG9hZFNhdmVzJywgJ25vRGF0YScpOw0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdub0RhdGEnKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggTG9hZCBzYXZlcyBDbG91ZDogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRMb2FkU2F2ZXMnLCAnbm9EYXRhJyk7DQogICAgICAgICAgICByZXNvbHZlKCdub0RhdGEnKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfQ0KDQoNCnZhciBwYXltZW50c0RhdGEgPSAnbm9uZSc7DQoNCmZ1bmN0aW9uIEdldFBheW1lbnRzKHNlbmRiYWNrKSB7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgcmVzb2x2ZSgnbm9uZScpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgeXNkay5nZXRQYXltZW50cygpLnRoZW4oX3BheW1lbnRzID0+IHsNCiAgICAgICAgICAgICAgICBwYXltZW50cyA9IF9wYXltZW50czsNCg0KICAgICAgICAgICAgICAgIHBheW1lbnRzLmdldENhdGFsb2coKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbihwcm9kdWN0cyA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJvZHVjdElEID0gW107DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGl0bGUgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkZXNjcmlwdGlvbiA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGltYWdlVVJJID0gW107DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJpY2UgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcmljZVZhbHVlID0gW107DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJpY2VDdXJyZW5jeUNvZGUgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjdXJyZW5jeUltYWdlVVJMID0gW107DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgY29uc3VtZWQgPSBbXTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudHMuZ2V0UHVyY2hhc2VzKCkudGhlbihwdXJjaGFzZXMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJvZHVjdHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdElEW2ldID0gcHJvZHVjdHNbaV0uaWQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlW2ldID0gcHJvZHVjdHNbaV0udGl0bGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uW2ldID0gcHJvZHVjdHNbaV0uZGVzY3JpcHRpb247DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlVVJJW2ldID0gcHJvZHVjdHNbaV0uaW1hZ2VVUkk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlW2ldID0gcHJvZHVjdHNbaV0ucHJpY2U7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlVmFsdWVbaV0gPSBwcm9kdWN0c1tpXS5wcmljZVZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZUN1cnJlbmN5Q29kZVtpXSA9IHByb2R1Y3RzW2ldLnByaWNlQ3VycmVuY3lDb2RlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUltYWdlVVJMW2ldID0gcHJvZHVjdHNbaV0uZ2V0UHJpY2VDdXJyZW5jeUltYWdlKCJtZWRpdW0iKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lZFtpXSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaTIgPSAwOyBpMiA8IHB1cmNoYXNlcy5sZW5ndGg7IGkyKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwdXJjaGFzZXNbaTJdLnByb2R1Y3RJRCA9PT0gcHJvZHVjdElEW2ldKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRbaV0gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBqc29uUGF5bWVudHMgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpZCI6IHByb2R1Y3RJRCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInRpdGxlIjogdGl0bGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6IGRlc2NyaXB0aW9uLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW1hZ2VVUkkiOiBpbWFnZVVSSSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInByaWNlIjogcHJpY2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwcmljZVZhbHVlIjogcHJpY2VWYWx1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInByaWNlQ3VycmVuY3lDb2RlIjogcHJpY2VDdXJyZW5jeUNvZGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjdXJyZW5jeUltYWdlVVJMIjogY3VycmVuY3lJbWFnZVVSTCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImNvbnN1bWVkIjogY29uc3VtZWQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsYW5ndWFnZSI6IHlzZGsuZW52aXJvbm1lbnQuaTE4bi5sYW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnUGF5bWVudHNFbnRyaWVzJywgSlNPTi5zdHJpbmdpZnkoanNvblBheW1lbnRzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShKU09OLnN0cmluZ2lmeShqc29uUGF5bWVudHMpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1B1cmNoYXNlcyBhcmUgbm90IGF2YWlsYWJsZScsIGUubWVzc2FnZSk7DQogICAgICAgICAgICAgICAgcmVzb2x2ZSgnbm9uZScpOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggSW5pdCBQYXltZW50czogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIHJlc29sdmUoJ25vbmUnKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfQ0KDQpmdW5jdGlvbiBCdXlQYXltZW50cyhpZCkgew0KICAgIHRyeSB7DQogICAgICAgIGlmIChwYXltZW50cyAhPSBudWxsKSB7DQogICAgICAgICAgICBwYXltZW50cy5wdXJjaGFzZShpZCkudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1B1cmNoYXNlIFN1Y2Nlc3MnKTsNCiAgICAgICAgICAgICAgICBDb25zdW1lUHVyY2hhc2UoaWQpOw0KICAgICAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignUHVyY2hhc2UgRmFpbGVkJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdPblB1cmNoYXNlRmFpbGVkJywgaWQpOw0KICAgICAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQYXltZW50cyA9PSBudWxsJyk7DQogICAgICAgIH0NCiAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEJ1eSBQYXltZW50czogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBDb25zdW1lUHVyY2hhc2UoaWQpIHsNCiAgICB0cnkgew0KICAgICAgICBpZiAocGF5bWVudHMgIT0gbnVsbCkgew0KICAgICAgICAgICAgcGF5bWVudHMuZ2V0UHVyY2hhc2VzKCkudGhlbihwdXJjaGFzZXMgPT4gew0KICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBwdXJjaGFzZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHB1cmNoYXNlc1tpXS5wcm9kdWN0SUQgPT09IGlkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50cy5jb25zdW1lUHVyY2hhc2UocHVyY2hhc2VzW2ldLnB1cmNoYXNlVG9rZW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnT25QdXJjaGFzZVN1Y2Nlc3MnLCBpZCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGNvbnNvbGUubG9nKCdDb25zdW1lIHB1cmNoYXNlOiBwYXltZW50cyBudWxsJyk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBDb25zdW1lIFB1cmNoYXNlOiAnLCBlLm1lc3NhZ2UpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gQ29uc3VtZVB1cmNoYXNlcygpIHsNCiAgICB0cnkgew0KICAgICAgICBpZiAocGF5bWVudHMgIT0gbnVsbCkgew0KICAgICAgICAgICAgcGF5bWVudHMuZ2V0UHVyY2hhc2VzKCkudGhlbihwdXJjaGFzZXMgPT4gew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdVbnByb2Nlc3NlZCBwdXJjaGFzZXM6ICcsIHB1cmNoYXNlcy5sZW5ndGgpOw0KICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBwdXJjaGFzZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgcGF5bWVudHMuY29uc3VtZVB1cmNoYXNlKHB1cmNoYXNlc1tpXS5wdXJjaGFzZVRva2VuKTsNCiAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnT25QdXJjaGFzZVN1Y2Nlc3MnLCBwdXJjaGFzZXNbaV0ucHJvZHVjdElEKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGNvbnNvbGUubG9nKCdDb25zdW1lIHB1cmNoYXNlczogcGF5bWVudHMgbnVsbCcpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggQ29uc3VtZSBwdXJjaGFzZXM6ICcsIGUubWVzc2FnZSk7DQogICAgfQ0KfQ0KDQoNCmxldCBsZWFkZXJib2FyZCA9IG51bGw7DQoNCmZ1bmN0aW9uIEluaXRMZWFkZXJib2FyZHMoKSB7DQogICAgeXNkay5nZXRMZWFkZXJib2FyZHMoKQ0KICAgICAgICAudGhlbihfbGIgPT4gbGVhZGVyYm9hcmQgPSBfbGIpOw0KfQ0KDQpmdW5jdGlvbiBXYWl0Rm9yTGVhZGVyYm9hcmQoKSB7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7DQogICAgICAgICAgICBpZiAobGVhZGVyYm9hcmQgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsKTsNCiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7DQogICAgICAgICAgICAgICAgcmVzb2x2ZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LCAxMDApOw0KDQogICAgICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpOw0KICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigiTGVhZGVyYm9hcmQgaW5pdGlhbGl6YXRpb24gdGltZW91dCIpKTsNCiAgICAgICAgfSwgNTAwMCk7DQogICAgfSk7DQp9DQoNCmFzeW5jIGZ1bmN0aW9uIEdldExlYWRlcmJvYXJkU2NvcmVzKG5hbWVMQiwgbWF4UGxheWVycywgcXVhbnRpdHlUb3AsIHF1YW50aXR5QXJvdW5kLCBwaG90b1NpemUsIGF1dGgpIHsNCiAgICB0cnkgew0KICAgICAgICBpZiAobGVhZGVyYm9hcmQgPT09IG51bGwpIHsNCiAgICAgICAgICAgIGF3YWl0IFdhaXRGb3JMZWFkZXJib2FyZCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGpzb25FbnRyaWVzID0gew0KICAgICAgICAgICAgdGVjaG5vTmFtZTogJycsDQogICAgICAgICAgICBpc0RlZmF1bHQ6IGZhbHNlLA0KICAgICAgICAgICAgaXNJbnZlcnRTb3J0T3JkZXI6IGZhbHNlLA0KICAgICAgICAgICAgZGVjaW1hbE9mZnNldDogMCwNCiAgICAgICAgICAgIHR5cGU6ICcnIC8vICwgdGl0bGU6ICcnDQogICAgICAgIH07DQoNCiAgICAgICAgeXNkay5nZXRMZWFkZXJib2FyZHMoKQ0KICAgICAgICAgICAgLnRoZW4obGVhZGVyYm9hcmQgPT4gbGVhZGVyYm9hcmQuZ2V0TGVhZGVyYm9hcmREZXNjcmlwdGlvbihuYW1lTEIpKQ0KICAgICAgICAgICAgLnRoZW4ocmVzID0+IHsNCiAgICAgICAgICAgICAgICBqc29uRW50cmllcy50ZWNobm9OYW1lID0gbmFtZUxCOw0KICAgICAgICAgICAgICAgIGpzb25FbnRyaWVzLmlzRGVmYXVsdCA9IHJlcy5kZWZhdWx0Ow0KICAgICAgICAgICAgICAgIGpzb25FbnRyaWVzLmlzSW52ZXJ0U29ydE9yZGVyID0gcmVzLmRlc2NyaXB0aW9uLmludmVydF9zb3J0X29yZGVyOw0KICAgICAgICAgICAgICAgIGpzb25FbnRyaWVzLmRlY2ltYWxPZmZzZXQgPSByZXMuZGVzY3JpcHRpb24uc2NvcmVfZm9ybWF0Lm9wdGlvbnMuZGVjaW1hbF9vZmZzZXQ7DQogICAgICAgICAgICAgICAganNvbkVudHJpZXMudHlwZSA9IHJlcy5kZXNjcmlwdGlvbi50eXBlOyAvLyDQndC1INC+0L/RgNC10LTQtdC70Y/QtdGC0YHRjyDQvdCwINC80L7QvNC10L3RgiAxOC4wNy4yMw0KICAgICAgICAgICAgICAgIC8vanNvbkVudHJpZXMudGl0bGUgPSByZXMudGl0bGU7IC8vINCg0LXQsNC70LjQt9GD0LnRgtC1INC/0L4g0L/RgNC10LTQv9C+0YfRgtC10L3QuNGP0LwNCg0KICAgICAgICAgICAgICAgIHJldHVybiBsZWFkZXJib2FyZC5nZXRMZWFkZXJib2FyZEVudHJpZXMobmFtZUxCLCB7DQogICAgICAgICAgICAgICAgICAgIHF1YW50aXR5VG9wOiBxdWFudGl0eVRvcCwNCiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZVVzZXI6IGF1dGgsDQogICAgICAgICAgICAgICAgICAgIHF1YW50aXR5QXJvdW5kOiBxdWFudGl0eUFyb3VuZA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7DQogICAgICAgICAgICAgICAgbGV0IGpzb25QbGF5ZXJzID0gRW50cmllc0xCKHJlcywgbWF4UGxheWVycywgcGhvdG9TaXplKTsNCiAgICAgICAgICAgICAgICBsZXQgY29tYmluZWRKc29uID0geyAuLi5qc29uRW50cmllcywgLi4uanNvblBsYXllcnMgfTsNCg0KICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ0xlYWRlcmJvYXJkRW50cmllcycsIEpTT04uc3RyaW5naWZ5KGNvbWJpbmVkSnNvbikpOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7DQogICAgICAgICAgICB9KTsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggR2V0IExlYWRlcmJvYXJkOiAnLCBlLm1lc3NhZ2UpOw0KICAgIH0NCn0NCg0KYXN5bmMgZnVuY3Rpb24gU2V0TGVhZGVyYm9hcmRTY29yZXMoX25hbWUsIHNjb3JlKSB7DQogICAgdHJ5IHsNCiAgICAgICAgaWYgKGxlYWRlcmJvYXJkID09PSBudWxsKSB7DQogICAgICAgICAgICBhd2FpdCBXYWl0Rm9yTGVhZGVyYm9hcmQoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHlzZGsuZ2V0TGVhZGVyYm9hcmRzKCkNCiAgICAgICAgICAgIC50aGVuKGxlYWRlcmJvYXJkID0+IHsNCiAgICAgICAgICAgICAgICBsZWFkZXJib2FyZC5zZXRMZWFkZXJib2FyZFNjb3JlKF9uYW1lLCBzY29yZSk7DQogICAgICAgICAgICB9KTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFNldCBMZWFkZXIgYm9hcmQgU2NvcmVzOiAnLCBlLm1lc3NhZ2UpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gRW50cmllc0xCKHJlcywgbWF4UGxheWVycywgcGhvdG9TaXplKSB7DQogICAgbGV0IExlYWRlcmJvYXJkRW50cmllc1RleHQgPSAnJzsNCiAgICBsZXQgcGxheWVyc0NvdW50Ow0KDQogICAgaWYgKHJlcy5lbnRyaWVzLmxlbmd0aCA8IG1heFBsYXllcnMpIHsNCiAgICAgICAgcGxheWVyc0NvdW50ID0gcmVzLmVudHJpZXMubGVuZ3RoOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHBsYXllcnNDb3VudCA9IG1heFBsYXllcnM7DQogICAgfQ0KDQogICAgbGV0IHJhbmtzID0gbmV3IEFycmF5KHBsYXllcnNDb3VudCk7DQogICAgbGV0IHBob3RvcyA9IG5ldyBBcnJheShwbGF5ZXJzQ291bnQpOw0KICAgIGxldCBtYW1lcyA9IG5ldyBBcnJheShwbGF5ZXJzQ291bnQpOw0KICAgIGxldCBzY29yZXMgPSBuZXcgQXJyYXkocGxheWVyc0NvdW50KTsNCiAgICBsZXQgdW5pcXVlSURzID0gbmV3IEFycmF5KHBsYXllcnNDb3VudCk7DQoNCiAgICBmb3IgKGkgPSAwOyBpIDwgcGxheWVyc0NvdW50OyBpKyspIHsNCiAgICAgICAgcmFua3NbaV0gPSByZXMuZW50cmllc1tpXS5yYW5rOw0KICAgICAgICBzY29yZXNbaV0gPSByZXMuZW50cmllc1tpXS5zY29yZTsNCiAgICAgICAgdW5pcXVlSURzW2ldID0gcmVzLmVudHJpZXNbaV0ucGxheWVyLnVuaXF1ZUlEOw0KICAgICAgICBwaG90b3NbaV0gPSByZXMuZW50cmllc1tpXS5wbGF5ZXIuZ2V0QXZhdGFyU3JjKHBob3RvU2l6ZSk7DQoNCiAgICAgICAgaWYgKHJlcy5lbnRyaWVzW2ldLnBsYXllci5zY29wZVBlcm1pc3Npb25zLnB1YmxpY19uYW1lICE9PSAiYWxsb3ciKQ0KICAgICAgICAgICAgbWFtZXNbaV0gPSAiYW5vbnltb3VzIjsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgbWFtZXNbaV0gPSByZXMuZW50cmllc1tpXS5wbGF5ZXIucHVibGljTmFtZTsNCg0KICAgICAgICBMZWFkZXJib2FyZEVudHJpZXNUZXh0ICs9IHJhbmtzW2ldICsgJy4gJyArIG1hbWVzW2ldICsgIjogIiArIHNjb3Jlc1tpXSArICdcbic7DQogICAgfQ0KDQogICAgaWYgKHBsYXllcnNDb3VudCA9PT0gMCkgew0KICAgICAgICBMZWFkZXJib2FyZEVudHJpZXNUZXh0ID0gJ25vIGRhdGEnOw0KICAgIH0NCg0KICAgIGxldCBqc29uUGxheWVycyA9IHsNCiAgICAgICAgImVudHJpZXMiOiBMZWFkZXJib2FyZEVudHJpZXNUZXh0LA0KICAgICAgICAicmFua3MiOiByYW5rcywNCiAgICAgICAgInBob3RvcyI6IHBob3RvcywNCiAgICAgICAgIm5hbWVzIjogbWFtZXMsDQogICAgICAgICJzY29yZXMiOiBzY29yZXMsDQogICAgICAgICJ1bmlxdWVJRHMiOiB1bmlxdWVJRHMNCiAgICB9Ow0KDQogICAgcmV0dXJuIGpzb25QbGF5ZXJzOw0KfQ0KDQoNCnZhciBlbnZpcm9ubWVudERhdGEgPSAnbnVsbCc7DQoNCmZ1bmN0aW9uIFJlcXVlc3RpbmdFbnZpcm9ubWVudERhdGEoc2VuZGJhY2spIHsNCiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsNCiAgICAgICAgaWYgKHlzZGsgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmVzb2x2ZSgnbnVsbCcpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICB2YXIgcHJvbXB0Q2FuU2hvdyA9IGZhbHNlOw0KICAgICAgICAgICAgdmFyIHJldmlld0NhblNob3cgPSBmYWxzZTsNCg0KICAgICAgICAgICAgeXNkay5mZWVkYmFjay5jYW5SZXZpZXcoKQ0KICAgICAgICAgICAgICAgIC50aGVuKCh7IHZhbHVlIH0pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV2aWV3Q2FuU2hvdyA9IHRydWU7DQoNCiAgICAgICAgICAgICAgICAgICAgeXNkay5zaG9ydGN1dC5jYW5TaG93UHJvbXB0KCkudGhlbihwcm9tcHQgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb21wdC5jYW5TaG93KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb21wdENhblNob3cgPSB0cnVlOw0KDQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnJvd3NlciA9IG5hdmlnYXRvci51c2VyQWdlbnQ7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnJvd3Nlci5pbmNsdWRlcygnWWFCcm93c2VyJykgfHwgYnJvd3Nlci5pbmNsdWRlcygnWWFTZWFyY2hCcm93c2VyJykpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJvd3NlciA9ICdZYW5kZXgnOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYnJvd3Nlci5pbmNsdWRlcygnT3BlcmEnKSB8fCBicm93c2VyLmluY2x1ZGVzKCdPUFInKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicm93c2VyID0gJ09wZXJhJzsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJyb3dzZXIuaW5jbHVkZXMoJ0ZpcmVmb3gnKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicm93c2VyID0gJ0ZpcmVmb3gnOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYnJvd3Nlci5pbmNsdWRlcygnTVNJRScpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnSUUnOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYnJvd3Nlci5pbmNsdWRlcygnRWRnZScpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnRWRnZSc7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChicm93c2VyLmluY2x1ZGVzKCdDaHJvbWUnKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicm93c2VyID0gJ0Nocm9tZSc7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChicm93c2VyLmluY2x1ZGVzKCdTYWZhcmknKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicm93c2VyID0gJ1NhZmFyaSc7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJvd3NlciA9ICdPdGhlcic7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBqc29uRW52aXIgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImxhbmd1YWdlIjogeXNkay5lbnZpcm9ubWVudC5pMThuLmxhbmcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImRvbWFpbiI6IHlzZGsuZW52aXJvbm1lbnQuaTE4bi50bGQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImRldmljZVR5cGUiOiB5c2RrLmRldmljZUluZm8udHlwZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXNNb2JpbGUiOiB5c2RrLmRldmljZUluZm8uaXNNb2JpbGUoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXNEZXNrdG9wIjogeXNkay5kZXZpY2VJbmZvLmlzRGVza3RvcCgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpc1RhYmxldCI6IHlzZGsuZGV2aWNlSW5mby5pc1RhYmxldCgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpc1RWIjogeXNkay5kZXZpY2VJbmZvLmlzVFYoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXBwSUQiOiB5c2RrLmVudmlyb25tZW50LmFwcC5pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYnJvd3NlckxhbmciOiB5c2RrLmVudmlyb25tZW50LmJyb3dzZXIubGFuZywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGF5bG9hZCI6IHlzZGsuZW52aXJvbm1lbnQucGF5bG9hZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicHJvbXB0Q2FuU2hvdyI6IHByb21wdENhblNob3csDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgInJldmlld0NhblNob3ciOiByZXZpZXdDYW5TaG93LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwbGF0Zm9ybSI6IG5hdmlnYXRvci5wbGF0Zm9ybSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYnJvd3NlciI6IGJyb3dzZXINCiAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VuZGJhY2spDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0RW52aXJEYXRhJywgSlNPTi5zdHJpbmdpZnkoanNvbkVudmlyKSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKEpTT04uc3RyaW5naWZ5KGpzb25FbnZpcikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkVudmlyb25tZW50IERhdGE6ICIgKyBKU09OLnN0cmluZ2lmeShqc29uRW52aXIpKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFJlcXVlc3RpbmcgRW52aXJvbm1lbnQgRGF0YTogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIHJlc29sdmUoJ251bGwnKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfQ0KDQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgKGV2ZW50KSA9PiB7DQogICAgaWYobXlHYW1lSW5zdGFuY2UgIT0gbnVsbCkgDQogICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ19TYXZlUHJvZ3Jlc3MnKTsgDQogICAgfSk7DQoNCg0KdmFyIHBsYXllckRhdGEgPSAnbm9EYXRhJzsNCg0KZnVuY3Rpb24gSW5pdFBsYXllcihzZW5kYmFjaykgew0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKHlzZGsgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIE5vdEF1dGhvcml6ZWQoKTsNCiAgICAgICAgICAgICAgICBpZiAoc2VuZGJhY2spDQogICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1NldEluaXRpYWxpemF0aW9uU0RLJywgTm90QXV0aG9yaXplZCgpKTsNCiAgICAgICAgICAgICAgICByZXNvbHZlKE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBsZXQgX3Njb3BlcyA9IHRydWU7DQogICAgICAgICAgICAgICAgeXNkay5nZXRQbGF5ZXIoeyBzY29wZXM6IF9zY29wZXMgfSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oX3BsYXllciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIgPSBfcGxheWVyOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGxheWVyTmFtZSA9IHBsYXllci5nZXROYW1lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGxheWVyUGhvdG8gPSBwbGF5ZXIuZ2V0UGhvdG8oJ3NtYWxsJyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX3Njb3Blcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllck5hbWUgPSAiYW5vbnltb3VzIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJQaG90byA9ICJudWxsIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5nZXRNb2RlKCkgPT09ICdsaXRlJykgew0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ05vdCBBdXRob3JpemVkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbmRiYWNrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRJbml0aWFsaXphdGlvblNESycsIE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShOb3RBdXRob3JpemVkKCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXV0aEpzb24gPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwbGF5ZXJBdXRoIjogInJlc29sdmVkIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBsYXllck5hbWUiOiBwbGF5ZXJOYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGxheWVySWQiOiBwbGF5ZXIuZ2V0VW5pcXVlSUQoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBsYXllclBob3RvIjogcGxheWVyUGhvdG8sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwYXlpbmdTdGF0dXMiOiBwbGF5ZXIuZ2V0UGF5aW5nU3RhdHVzKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0SW5pdGlhbGl6YXRpb25TREsnLCBKU09OLnN0cmluZ2lmeShhdXRoSnNvbikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoSlNPTi5zdHJpbmdpZnkoYXV0aEpzb24pKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBdXRob3JpemVkIGVycjogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRJbml0aWFsaXphdGlvblNESycsIE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBpbml0IFBsYXllcjogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRJbml0aWFsaXphdGlvblNESycsIE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICByZXNvbHZlKE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgIH0NCiAgICB9KTsNCn0NCg0KZnVuY3Rpb24gTm90QXV0aG9yaXplZCgpIHsNCiAgICBsZXQgYXV0aEpzb24gPSB7DQogICAgICAgICJwbGF5ZXJBdXRoIjogInJlamVjdGVkIiwNCiAgICAgICAgInBsYXllck5hbWUiOiAidW5hdXRob3JpemVkIiwNCiAgICAgICAgInBsYXllcklkIjogInVuYXV0aG9yaXplZCIsDQogICAgICAgICJwbGF5ZXJQaG90byI6ICJ1bmtub3duIiwNCiAgICAgICAgInBheWluZ1N0YXR1cyI6IHBsYXllci5nZXRQYXlpbmdTdGF0dXMoKQ0KICAgIH07DQogICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGF1dGhKc29uKTsNCn0NCg0KZnVuY3Rpb24gT3BlbkF1dGhEaWFsb2coKSB7DQogICAgaWYgKHlzZGsgIT09IG51bGwpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHlzZGsuYXV0aC5vcGVuQXV0aERpYWxvZygpLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgIEluaXRQbGF5ZXIodHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnR2V0RGF0YUludm9rZScpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnQ1JBU0ggT3BlbiBBdXRoIERpYWxvZzogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KDQogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsNCiAgICA8L3NjcmlwdD4NCjwvYm9keT4NCjwvaHRtbD4=";
