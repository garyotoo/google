window.game = "PCEtLSBVbHRpbWF0ZSBHYW1lIFN0YXNoIGZpbGUtLT4gDQo8IS0tIEZvciB0aGUgcmVndWxhcmx5IHVwZGF0aW5nIGRvYyBnbyB0byBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFfRm1IM0JsU0JRSTdGR2dBUUw1OS1aUGU4ZUN4czM1d2VsNkpVeVZhRzhRLyAtLT4NCg0KPCFET0NUWVBFIGh0bWw+DQoNCjxodG1sIGxhbmc9ImVuLXVzIj4NCjxoZWFkPg0KPGJhc2UgaHJlZj0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2dlbml6eS9icmFpbnJvdEBtYWluL21vbmV5LXJ1c2gvIj4NCjxtZXRhIGNoYXJzZXQ9InV0Zi04Ii8+DQo8bWV0YSBodHRwLWVxdWl2PSJDb250ZW50LVR5cGUiIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD11dGYtOCIvPg0KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAsIHVzZXItc2NhbGFibGU9bm8iLz4NCjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iLi9zdHlsZS5jc3MiLz4NCjwhLS0gWWFuZGV4IEdhbWVzIFNESyAtLT4NCjxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvZ24tbWF0aC9hc3NldHNAbWFpbi95YW5kZXgtc2RrLmpzP2xvbCI+PC9zY3JpcHQ+DQo8c3R5bGU+DQogICAgICAgIC8qINCj0LHQuNGA0LDQtdC8INCy0YvQtNC10LvQtdC90LjQtSDQv9C+INC90LDQttCw0YLQuNGOINC60LvQsNCy0LjRiCAqLw0KICAgICAgICBjYW52YXM6Zm9jdXMgew0KICAgICAgICAgICAgb3V0bGluZTogbm9uZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGh0bWwsIGJvZHkgew0KICAgICAgICAgICAgLyog0KPQsdC40YDQsNC10Lwg0L7RgtGB0YLRg9C/0YsgKi8NCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICAvKiDQntGC0LrQu9GO0YfQsNC10Lwg0YHQutGA0L7Qu9C7INC4INC70L7QvdCz0YLQsNC/INC90LAgSU9TICovDQogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgICAgICAgLXdlYmtpdC10b3VjaC1jYWxsb3V0OiBub25lOw0KICAgICAgICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgICAgICAgIC1raHRtbC11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgICAgICAgIC1tb3otdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAgICAgICAtbXMtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAgICAgICB1c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgICAgICAgIC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogcmdiYSgwLDAsMCwwKTsNCiAgICAgICAgICAgIC8qINCh0YLQsNCy0LjQvCDQstGL0YHQvtGC0YMg0L3QsCAxMDAlICovDQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgIH0NCiAgICA8L3N0eWxlPg0KPCEtLSBBZGRpdGlvbmFsIGhlYWQgbW9kdWxlcyAtLT4NCjwvaGVhZD4NCjxib2R5IGNsYXNzPSJkYXJrIj4NCjxkaXYgaWQ9InVuaXR5LWNvbnRhaW5lciIgY2xhc3M9InVuaXR5LWRlc2t0b3AiPg0KPGNhbnZhcyBpZD0idW5pdHktY2FudmFzIiB0YWJpbmRleD0iLTEiPjwvY2FudmFzPg0KPC9kaXY+DQo8ZGl2IGlkPSJsb2FkaW5nLWNvdmVyIiBzdHlsZT0iZGlzcGxheTpub25lOyI+DQo8ZGl2IGlkPSJ1bml0eS1sb2FkaW5nLWJhciI+DQo8ZGl2IGlkPSJ1bml0eS1sb2dvIj48aW1nIHNyYz0ibG9nby5wbmciLz48L2Rpdj4NCjxkaXYgaWQ9InVuaXR5LXByb2dyZXNzLWJhci1lbXB0eSIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4NCjxkaXYgaWQ9InVuaXR5LXByb2dyZXNzLWJhci1mdWxsIj48L2Rpdj4NCjwvZGl2Pg0KPGRpdiBjbGFzcz0ic3Bpbm5lciI+PC9kaXY+DQo8L2Rpdj4NCjwvZGl2Pg0KPCEtLSBBZGRpdGlvbmFsIGJvZHkgbW9kdWxlcyAtLT4NCjxzY3JpcHQ+DQogICAgICAgIGNvbnN0IGhpZGVGdWxsU2NyZWVuQnV0dG9uID0gIiI7DQogICAgICAgIGNvbnN0IGJ1aWxkVXJsID0gIkJ1aWxkIjsNCiAgICAgICAgY29uc3QgbG9hZGVyVXJsID0gYnVpbGRVcmwgKyAiL0J1aWxkLmxvYWRlci5qcyI7DQogICAgICAgIGNvbnN0IGNvbmZpZyA9IHsNCiAgICAgICAgICAgIGRhdGFVcmw6IGJ1aWxkVXJsICsgIi9CdWlsZC5kYXRhLnVuaXR5d2ViIiwNCiAgICAgICAgICAgIGZyYW1ld29ya1VybDogYnVpbGRVcmwgKyAiL0J1aWxkLmZyYW1ld29yay5qcy51bml0eXdlYiIsDQogICAgICAgICAgICBjb2RlVXJsOiBidWlsZFVybCArICIvQnVpbGQud2FzbS51bml0eXdlYiIsDQogICAgICAgIHN0cmVhbWluZ0Fzc2V0c1VybDogIlN0cmVhbWluZ0Fzc2V0cyIsDQogICAgICAgICAgICBjb21wYW55TmFtZTogIlBvY2tldCBTbmFrZSIsDQogICAgICAgICAgICBwcm9kdWN0TmFtZTogIk1vbmV5IFJvbGxlciIsDQogICAgICAgICAgICBwcm9kdWN0VmVyc2lvbjogIjAuMSINCiAgICAgICAgfTsNCg0KICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjdW5pdHktY29udGFpbmVyIik7DQogICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1jYW52YXMiKTsNCiAgICAgICAgY29uc3QgbG9hZGluZ0NvdmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2xvYWRpbmctY292ZXIiKTsNCiAgICAgICAgY29uc3QgcHJvZ3Jlc3NCYXJFbXB0eSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1wcm9ncmVzcy1iYXItZW1wdHkiKTsNCiAgICAgICAgY29uc3QgcHJvZ3Jlc3NCYXJGdWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3VuaXR5LXByb2dyZXNzLWJhci1mdWxsIik7DQogICAgICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3Bpbm5lcicpOw0KDQogICAgICAgIGNvbnN0IGNhbkZ1bGxzY3JlZW4gPSAoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgWw0KICAgICAgICAgICAgICAgICdleGl0RnVsbHNjcmVlbicsDQogICAgICAgICAgICAgICAgJ3dlYmtpdEV4aXRGdWxsc2NyZWVuJywNCiAgICAgICAgICAgICAgICAnd2Via2l0Q2FuY2VsRnVsbFNjcmVlbicsDQogICAgICAgICAgICAgICAgJ21vekNhbmNlbEZ1bGxTY3JlZW4nLA0KICAgICAgICAgICAgICAgICdtc0V4aXRGdWxsc2NyZWVuJywNCiAgICAgICAgICAgIF0pIHsNCiAgICAgICAgICAgICAgICBpZiAoa2V5IGluIGRvY3VtZW50KSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSgpKTsNCg0KICAgICAgICBpZiAoL2lQaG9uZXxpUGFkfGlQb2R8QW5kcm9pZC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsNCiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSAidW5pdHktbW9iaWxlIjsNCiAgICAgICAgICAgIA0KICAgICAgICB9DQoNCiAgICAgICAgLy8gVGhlIGJhY2tncm91bmQgaW1hZ2Ugd2hlbiBsb2FkaW5nIHRoZSBnYW1lLiBXaGVuIGJ1aWxkaW5nIGEgYnVpbGQsIHRoZSBjb2RlIGNoYW5nZXMgZGVwZW5kaW5nIG9uIHRoZSBwcm9qZWN0IHNldHRpbmdzLg0KICAgICAgICANCiAgICAgICAgbG9hZGluZ0NvdmVyLnN0eWxlLmJhY2tncm91bmQgPSAidXJsKCdiYWNrZ3JvdW5kLmpwZycpIGNlbnRlciAvIGNvdmVyIjsNCg0KICAgICAgICBsb2FkaW5nQ292ZXIuc3R5bGUuZGlzcGxheSA9ICIiOw0KDQogICAgICAgIGxldCBTdGFydFVuaXR5SW5zdGFuY2U7DQogICAgICAgIGxldCB5Z0dhbWVJbnN0YW5jZSA9IG51bGw7DQogICAgICAgIGxldCB5c2RrID0gbnVsbDsNCiAgICAgICAgbGV0IGluaXRZU0RLID0gZmFsc2U7DQogICAgICAgIGxldCBpbml0R2FtZSA9IGZhbHNlOw0KICAgICAgICBsZXQgc3luY0luaXQgPSBmYWxzZTsNCiAgICAgICAgY29uc3QgTk9fREFUQSA9ICdubyBkYXRhJzsNCg0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjb250ZXh0bWVudScsIGV2ZW50ID0+IGV2ZW50LnByZXZlbnREZWZhdWx0KCkpOw0KICAgICAgICBmdW5jdGlvbiBGb2N1c0dhbWUoKSB7DQogICAgICAgICAgICB3aW5kb3cuZm9jdXMoKTsNCiAgICAgICAgICAgIGNhbnZhcy5mb2N1cygpOw0KICAgICAgICB9DQogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVyZG93bicsICgpID0+IHsNCiAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICB9KTsNCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCAoKSA9PiB7DQogICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndmlzaWJpbGl0eWNoYW5nZScsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICh5c2RrICE9PSBudWxsICYmIGluaXRHYW1lID09IHRydWUpIHsNCiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuaGlkZGVuKSB7DQogICAgICAgICAgICAgICAgICAgIFlHMkluc3RhbmNlKCdTZXRGb2N1c1dpbmRvd0dhbWUnLCAnZmFsc2UnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIFlHMkluc3RhbmNlKCdTZXRGb2N1c1dpbmRvd0dhbWUnLCAndHJ1ZScpOw0KDQogICAgICAgICAgICAgICAgICAgIGlmICgoeXNkay5kZXZpY2VJbmZvLmlzTW9iaWxlKCkgfHwgeXNkay5kZXZpY2VJbmZvLmlzVGFibGV0KCkpICYmIHlzZGsuc2NyZWVuLmZ1bGxzY3JlZW4uc3RhdHVzID09ICdvZmYnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgeXNkay5zY3JlZW4uZnVsbHNjcmVlbi5yZXF1ZXN0KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsNCiAgICAgICAgc2NyaXB0LnNyYyA9IGxvYWRlclVybDsNCiAgICAgICAgc2NyaXB0Lm9ubG9hZCA9ICgpID0+IHsNCiAgICAgICAgICAgIFN0YXJ0VW5pdHlJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBjcmVhdGVVbml0eUluc3RhbmNlKGNhbnZhcywgY29uZmlnLCAocHJvZ3Jlc3MpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgc3Bpbm5lci5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc0JhckVtcHR5LnN0eWxlLmRpc3BsYXkgPSAiIjsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWRqdXN0ZWRQcm9ncmVzcyA9IE1hdGgubWF4KHByb2dyZXNzLCAwLjA1KTsNCiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJGdWxsLnN0eWxlLndpZHRoID0gYCR7MTAwICogYWRqdXN0ZWRQcm9ncmVzc30lYDsNCiAgICAgICAgICAgICAgICB9KS50aGVuKCh1bml0eUluc3RhbmNlKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHlnR2FtZUluc3RhbmNlID0gdW5pdHlJbnN0YW5jZTsNCiAgICAgICAgICAgICAgICAgICAgbG9hZGluZ0NvdmVyLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgICAgICAgICAgICAgfSkuY2F0Y2goKG1lc3NhZ2UpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICANCiAgICAgICAgICAgIFN0YXJ0VW5pdHlJbnN0YW5jZSgpOw0KICAgICAgICB9Ow0KDQogICAgICAgIGZ1bmN0aW9uIFN0YXJ0VW5pdHlJbnN0YW5jZV9JZlVubG9hZGVkKCkgew0KICAgICAgICAgICAgaWYgKHNwaW5uZXIuc3R5bGUuZGlzcGxheSAhPT0gIm5vbmUiKQ0KICAgICAgICAgICAgICAgIFN0YXJ0VW5pdHlJbnN0YW5jZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gSXNMb2NhbEhvc3QoKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBZRzJJbnN0YW5jZShtZXRob2QpIHsNCiAgICAgICAgICAgIGlmICh5Z0dhbWVJbnN0YW5jZSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICAgICAgaWYgKCFpbml0R2FtZSkgew0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoeWdHYW1lSW5zdGFuY2UpDQogICAgICAgICAgICAgICAgICAgICAgICB5Z0dhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWUcySW5zdGFuY2UnLCBtZXRob2QpOw0KICAgICAgICAgICAgICAgIH0sIDEwMCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB5Z0dhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWUcySW5zdGFuY2UnLCBtZXRob2QpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIFlHMkluc3RhbmNlKG1ldGhvZCwgYXJnKSB7DQogICAgICAgICAgICBpZiAoeWdHYW1lSW5zdGFuY2UgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgICAgIGlmICghaW5pdEdhbWUpIHsNCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgeWdHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lHMkluc3RhbmNlJywgbWV0aG9kLCBhcmcpOw0KICAgICAgICAgICAgICAgIH0sIDEwMCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB5Z0dhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWUcySW5zdGFuY2UnLCBtZXRob2QsIGFyZyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBMb2dTdHlsZWRNZXNzYWdlKG1lc3NhZ2UsIHN0eWxlKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnJWMnICsgbWVzc2FnZSwgc3R5bGUpOw0KICAgICAgICB9DQogICAgICAgIGZ1bmN0aW9uIExvZ1N0eWxlZE1lc3NhZ2UobWVzc2FnZSkgew0KICAgICAgICAgICAgY29uc29sZS5sb2coJyVjJyArIG1lc3NhZ2UsICdjb2xvcjogI0ZGREY3MzsgYmFja2dyb3VuZC1jb2xvcjogIzQ1NDU0NScpOw0KICAgICAgICB9DQoNCiAgICAgICAgSW5pdFlTREsoKTsNCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gSW5pdFlTREsoKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGlmIChJc0xvY2FsSG9zdCgpKSByZXR1cm47DQoNCiAgICAgICAgICAgICAgICB5c2RrID0gYXdhaXQgWWFHYW1lcy5pbml0KCk7DQoNCiAgICAgICAgICAgICAgICAvLyBBZGRpdGlvbmFsIGluaXQwIG1vZHVsZXMNCkludGVyQWR2U2hvdygpOw0KDQphd2FpdCBSZXF1ZXN0aW5nRW52aXJvbm1lbnREYXRhKCk7DQpMb2dTdHlsZWRNZXNzYWdlKCdJbml0IEVudmlyRGF0YSB5c2RrJyk7DQoNCg0KICAgICAgICAgICAgICAgIC8vIEFkZGl0aW9uYWwgaW5pdDEgbW9kdWxlcw0KDQogICAgICAgICAgICAgICAgLy8gQWRkaXRpb25hbCBpbml0MiBtb2R1bGVzDQphd2FpdCBJbml0UGxheWVyKCk7DQpMb2dTdHlsZWRNZXNzYWdlKCdJbml0IEF1dGhvcml6YXRpb24geXNkaycpOw0KDQoNCiAgICAgICAgICAgICAgICAvLyBBZGRpdGlvbmFsIGluaXQgbW9kdWxlcw0KVFZJbml0KCk7DQoNCmF3YWl0IExvYWRDbG91ZCgpOw0KTG9nU3R5bGVkTWVzc2FnZSgnSW5pdCBTdG9yYWdlIHlzZGsnKTsNCg0KYXdhaXQgSW5pdFJldmlldygpOw0KTG9nU3R5bGVkTWVzc2FnZSgnSW5pdCBSZXZpZXcgeXNkaycpOw0KDQphd2FpdCBHZXRTdGF0cygpOw0KTG9nU3R5bGVkTWVzc2FnZSgnSW5pdCBQbGF5ZXJTdGF0cyB5c2RrJyk7DQoNCmF3YWl0IEluaXRQYXltZW50cygpOw0KTG9nU3R5bGVkTWVzc2FnZSgnSW5pdCBQYXltZW50cyB5c2RrJyk7DQoNCmF3YWl0IEdldEFsbEdhbWVzKCk7DQpMb2dTdHlsZWRNZXNzYWdlKCdJbml0IE9wZW5VUkwgeXNkaycpOw0KDQphd2FpdCBJbml0TGVhZGVyYm9hcmRzKCk7DQpMb2dTdHlsZWRNZXNzYWdlKCdJbml0IExlYWRlcmJvYXJkcyB5c2RrJyk7DQoNCmF3YWl0IEluaXRHYW1lTGFiZWwoKTsNCkxvZ1N0eWxlZE1lc3NhZ2UoJ0luaXQgR2FtZUxhYmVsIHlzZGsnKTsNCg0KYXdhaXQgR2V0RmxhZ3MoKTsNCkxvZ1N0eWxlZE1lc3NhZ2UoJ0luaXQgRmxhZ3MgeXNkaycpOw0KDQoNCiAgICAgICAgICAgICAgICBpbml0WVNESyA9IHRydWU7DQogICAgICAgICAgICAgICAgaWYgKHlnR2FtZUluc3RhbmNlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHlnR2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZRzJJbnN0YW5jZScsICdJbml0U0RLQ29tcGxldGUnKTsNCg0KICAgICAgICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoJ0luaXQgWWFuZGV4U0RLIFN1Y2Nlc3MnKTsNCg0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEluaXRpYWxpemF0aW9uIFNESzogJywgZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICghSXNMb2NhbEhvc3QoKSAmJiAhc3luY0luaXQpDQogICAgICAgICAgICAgICAgU3RhcnRVbml0eUluc3RhbmNlX0lmVW5sb2FkZWQoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIEluaXRHYW1lKCkgew0KICAgICAgICAgICAgaW5pdEdhbWUgPSB0cnVlOw0KDQogICAgICAgICAgICAvLyBBZGRpdGlvbmFsIHN0YXJ0IG1vZHVsZXMNCnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgIGlmIChub3dGdWxsQWRPcGVuID09IHRydWUpDQogICAgICAgIFlHMkluc3RhbmNlKCdPcGVuSW50ZXJBZHYnKTsNCn0sIDEwMCk7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEFkZGl0aW9uYWwgc2NyaXB0IG1vZHVsZXMNCkxvZ1N0eWxlZE1lc3NhZ2UoJ1BsdWdpbllHMiB2Mi4wMDMyICBidWlsZDogNjknKTsNCg0KDQpsZXQgbGFzdEJhY2tQcmVzc1RpbWUgPSAwOw0KbGV0IHByZXZpb3VzQnV0dG9uU3RhdGUgPSB7fTsNCg0KZnVuY3Rpb24gVFZJbml0KCkgew0KICAgIExvZ1N0eWxlZE1lc3NhZ2UoJ0luaXQgVFYgeXNkaycpOw0KDQogICAgaWYgKHlzZGsuZGV2aWNlSW5mby5pc1RWKCkpIHsNCiAgICAgICAgeXNkay5vbkV2ZW50KHlzZGsuRVZFTlRTLkhJU1RPUllfQkFDSywgKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgY3VycmVudFRpbWUgPSBEYXRlLm5vdygpOw0KDQogICAgICAgICAgICBpZiAoIWluaXRHYW1lIHx8IGN1cnJlbnRUaW1lIC0gbGFzdEJhY2tQcmVzc1RpbWUgPCAzMDApIHsNCiAgICAgICAgICAgICAgICB5c2RrLmRpc3BhdGNoRXZlbnQoeXNkay5FVkVOVFMuRVhJVCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGxhc3RCYWNrUHJlc3NUaW1lID0gY3VycmVudFRpbWU7DQogICAgICAgICAgICAgICAgWUcySW5zdGFuY2UoJ1RWS2V5QmFjaycpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgKGUpID0+IHsNCiAgICAgICAgICAgIFlHMkluc3RhbmNlKCdUVktleURvd24nLCBlLmtleSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgKGUpID0+IHsNCiAgICAgICAgICAgIFlHMkluc3RhbmNlKCdUVktleVVwJywgZS5rZXkpOw0KICAgICAgICB9KTsNCg0KICAgICAgICBmdW5jdGlvbiBVcGRhdGVHYW1lcGFkU3RhdGUoKSB7DQogICAgICAgICAgICB2YXIgZ2FtZXBhZHMgPSBuYXZpZ2F0b3IuZ2V0R2FtZXBhZHMoKTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ2FtZXBhZHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICB2YXIgZ2FtZXBhZCA9IGdhbWVwYWRzW2ldOw0KICAgICAgICAgICAgICAgIGlmIChnYW1lcGFkKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChnYW1lcGFkLmJ1dHRvbnNbMTJdLnByZXNzZWQgJiYgIXByZXZpb3VzQnV0dG9uU3RhdGVbMTJdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgnVFZLZXlEb3duJywgJ1VwJyk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWdhbWVwYWQuYnV0dG9uc1sxMl0ucHJlc3NlZCAmJiBwcmV2aW91c0J1dHRvblN0YXRlWzEyXSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgWUcySW5zdGFuY2UoJ1RWS2V5VXAnLCAnVXAnKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZXBhZC5idXR0b25zWzEzXS5wcmVzc2VkICYmICFwcmV2aW91c0J1dHRvblN0YXRlWzEzXSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgWUcySW5zdGFuY2UoJ1RWS2V5RG93bicsICdEb3duJyk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWdhbWVwYWQuYnV0dG9uc1sxM10ucHJlc3NlZCAmJiBwcmV2aW91c0J1dHRvblN0YXRlWzEzXSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgWUcySW5zdGFuY2UoJ1RWS2V5VXAnLCAnRG93bicpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChnYW1lcGFkLmJ1dHRvbnNbMTRdLnByZXNzZWQgJiYgIXByZXZpb3VzQnV0dG9uU3RhdGVbMTRdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgnVFZLZXlEb3duJywgJ0xlZnQnKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghZ2FtZXBhZC5idXR0b25zWzE0XS5wcmVzc2VkICYmIHByZXZpb3VzQnV0dG9uU3RhdGVbMTRdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgnVFZLZXlVcCcsICdMZWZ0Jyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWVwYWQuYnV0dG9uc1sxNV0ucHJlc3NlZCAmJiAhcHJldmlvdXNCdXR0b25TdGF0ZVsxNV0pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFlHMkluc3RhbmNlKCdUVktleURvd24nLCAnUmlnaHQnKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghZ2FtZXBhZC5idXR0b25zWzE1XS5wcmVzc2VkICYmIHByZXZpb3VzQnV0dG9uU3RhdGVbMTVdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgnVFZLZXlVcCcsICdSaWdodCcpOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNCdXR0b25TdGF0ZVsxMl0gPSBnYW1lcGFkLmJ1dHRvbnNbMTJdLnByZXNzZWQ7DQogICAgICAgICAgICAgICAgICAgIHByZXZpb3VzQnV0dG9uU3RhdGVbMTNdID0gZ2FtZXBhZC5idXR0b25zWzEzXS5wcmVzc2VkOw0KICAgICAgICAgICAgICAgICAgICBwcmV2aW91c0J1dHRvblN0YXRlWzE0XSA9IGdhbWVwYWQuYnV0dG9uc1sxNF0ucHJlc3NlZDsNCiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNCdXR0b25TdGF0ZVsxNV0gPSBnYW1lcGFkLmJ1dHRvbnNbMTVdLnByZXNzZWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gR2FtZUxvb3AoKSB7DQogICAgICAgICAgICBVcGRhdGVHYW1lcGFkU3RhdGUoKTsNCiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShHYW1lTG9vcCk7DQogICAgICAgIH0NCg0KICAgICAgICBHYW1lTG9vcCgpOw0KICAgIH0NCn0NCg0KdmFyIGNsb3VkU2F2ZXMgPSBOT19EQVRBOw0KDQpmdW5jdGlvbiBTYXZlQ2xvdWQoanNvbkRhdGEsIGZsdXNoKSB7DQogICAgaWYgKHBsYXllciA9PSBudWxsKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFNhdmUgQ2xvdWQ6ICcsICdEaWRudCBoYXZlIHRpbWUgdG8gbG9hZCcpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIHRyeSB7DQogICAgICAgIHBsYXllci5zZXREYXRhKHsNCiAgICAgICAgICAgIHNhdmVzOiBbanNvbkRhdGFdLA0KICAgICAgICB9LCBmbHVzaCk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBTYXZlIENsb3VkOiAnLCBlLm1lc3NhZ2UpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gTG9hZENsb3VkKCkgew0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gew0KICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgICBGaW5hbChOT19EQVRBKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgcGxheWVyLmdldERhdGEoWyJzYXZlcyJdKS50aGVuKGRhdGEgPT4gew0KICAgICAgICAgICAgICAgIGlmIChkYXRhLnNhdmVzKSB7DQogICAgICAgICAgICAgICAgICAgIEZpbmFsKEpTT04uc3RyaW5naWZ5KGRhdGEuc2F2ZXMpKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBGaW5hbChOT19EQVRBKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTG9hZCBDbG91ZCBFcnJvciEnKTsNCiAgICAgICAgICAgICAgICBGaW5hbChOT19EQVRBKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBMb2FkIHNhdmVzIENsb3VkOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgRmluYWwoTk9fREFUQSk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBGaW5hbChyZXMpIHsNCiAgICAgICAgICAgIGNsb3VkU2F2ZXMgPSByZXM7DQogICAgICAgICAgICBZRzJJbnN0YW5jZSgnU2V0TG9hZFNhdmVzJywgcmVzKTsNCiAgICAgICAgICAgIHJlc29sdmUocmVzKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfQ0KDQoNCmZ1bmN0aW9uIFN0aWNreUFkQWN0aXZpdHkoc2hvdykgew0KICAgIHRyeSB7DQogICAgICAgIHlzZGsuYWR2LmdldEJhbm5lckFkdlN0YXR1cygpLnRoZW4oKHsgc3RpY2t5QWR2SXNTaG93aW5nLCByZWFzb24gfSkgPT4gew0KICAgICAgICAgICAgaWYgKHN0aWNreUFkdklzU2hvd2luZykgew0KICAgICAgICAgICAgICAgIGlmICghc2hvdykgew0KICAgICAgICAgICAgICAgICAgICB5c2RrLmFkdi5oaWRlQmFubmVyQWR2KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAocmVhc29uKSB7DQogICAgICAgICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgnU3RpY2t5QWR2IGFyZSBub3Qgc2hvd24uIFJlYXNvbjonLCByZWFzb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoc2hvdykgew0KICAgICAgICAgICAgICAgIHlzZGsuYWR2LnNob3dCYW5uZXJBZHYoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFN0aWNreUFkdiBhY3Rpdml0eTogJywgZS5tZXNzYWdlKTsNCiAgICB9DQp9DQoNCg0KZnVuY3Rpb24gUmV3YXJkZWRBZHZTaG93KGlkKSB7DQogICAgdHJ5IHsNCiAgICAgICAgeXNkay5hZHYuc2hvd1Jld2FyZGVkVmlkZW8oDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FsbGJhY2tzOg0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgb25PcGVuOiAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBMb2dTdHlsZWRNZXNzYWdlKCdPcGVuZWQgUmV3YXJkZWQgQWR2Jyk7DQogICAgICAgICAgICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgnT3BlblJld2FyZGVkQWR2Jyk7DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6ICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoJ0Nsb3NlZCBSZXdhcmRlZCBBZHYnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFlHMkluc3RhbmNlKCdDbG9zZVJld2FyZGVkQWR2Jyk7DQogICAgICAgICAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgb25SZXdhcmRlZDogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgWUcySW5zdGFuY2UoJ1Jld2FyZEFkdicsIGlkKTsNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgb25FcnJvcjogKGVycikgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgUmV3YXJkZWQgQWR2JywgZXJyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFlHMkluc3RhbmNlKCdFcnJvclJld2FyZGVkQWR2Jyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggUmV3YXJkZWQgQWR2IFNob3c6ICcsIGVyci5tZXNzYWdlKTsNCiAgICB9DQp9DQoNCnZhciByZXZpZXdEYXRhID0gJ2ZhbHNlJzsNCg0KZnVuY3Rpb24gSW5pdFJldmlldygpIHsNCiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsNCiAgICAgICAgaWYgKHlzZGsgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmVzb2x2ZSgnZmFsc2UnKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgeXNkay5mZWVkYmFjay5jYW5SZXZpZXcoKS50aGVuKCh7IHZhbHVlIH0pID0+IHsNCiAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV2aWV3RGF0YSA9ICd0cnVlJzsNCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgndHJ1ZScpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgnZmFsc2UnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggSW5pdCBSZXZpZXc6ICcsIGUubWVzc2FnZSk7DQogICAgICAgICAgICByZXNvbHZlKCdmYWxzZScpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoNCmZ1bmN0aW9uIFJldmlldygpIHsNCiAgICB0cnkgew0KICAgICAgICB5c2RrLmZlZWRiYWNrLmNhblJldmlldygpDQogICAgICAgICAgICAudGhlbigoeyB2YWx1ZSwgcmVhc29uIH0pID0+IHsNCiAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgeXNkay5mZWVkYmFjay5yZXF1ZXN0UmV2aWV3KCkudGhlbigoeyBmZWVkYmFja1NlbnQgfSkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgnZmVlZGJhY2tTZW50ICcsIGZlZWRiYWNrU2VudCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmVlZGJhY2tTZW50KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgnUmV2aWV3IFN1Y2Nlc3MnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFlHMkluc3RhbmNlKCdSZXZpZXdTZW50JywgJ3RydWUnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFlHMkluc3RhbmNlKCdSZXZpZXdTZW50JywgJ2ZhbHNlJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgnUmV2aWV3IEZhaWwnLCByZWFzb24pDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoJ1JldmlldyBjYW4gc2hvdyA9IGZhbHNlJywgcmVhc29uKTsNCiAgICAgICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFJldmlldzogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgfQ0KfQ0KDQoNCnZhciBzdGF0c1NhdmVzID0gTk9fREFUQTsNCg0KZnVuY3Rpb24gU2V0U3RhdGUoa2V5LCB2YWx1ZSkgew0KICAgIGlmIChwbGF5ZXIgPT0gbnVsbCkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdTZXRTdGF0czogUGxheWVyIGlzIG5vdCBkZWZpbmVkJyk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgdHJ5IHsNCiAgICAgICAgdmFyIGluY3JlbWVudHMgPSB7fTsNCiAgICAgICAgaW5jcmVtZW50c1trZXldID0gdmFsdWU7DQogICAgICAgIHBsYXllci5pbmNyZW1lbnRTdGF0cyhpbmNyZW1lbnRzKTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFNldCBTdGF0czogJywgZS5tZXNzYWdlKTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIEdldFN0YXRzKCkgew0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gew0KICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgICBGaW5hbChOT19EQVRBKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgcGxheWVyLmdldFN0YXRzKCkNCiAgICAgICAgICAgICAgICAudGhlbihzdGF0cyA9PiB7DQogICAgICAgICAgICAgICAgICAgIEZpbmFsKEpTT04uc3RyaW5naWZ5KHN0YXRzKSk7DQogICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0dldCBTdGF0cyBFcnJvciEnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICBGaW5hbChOT19EQVRBKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggR2V0IFN0YXRzIENsb3VkOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgRmluYWwoTk9fREFUQSk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBGaW5hbChyZXMpIHsNCiAgICAgICAgICAgIHN0YXRzU2F2ZXMgPSByZXM7DQogICAgICAgICAgICBZRzJJbnN0YW5jZSgnUmVjZWl2ZVN0YXRzJywgcmVzKTsNCiAgICAgICAgICAgIHJlc29sdmUocmVzKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfQ0KDQpmdW5jdGlvbiBTZXRBbGxTdGF0cyhqc29uU3RhdHMpIHsNCiAgICBpZiAoeXNkayA9PSBudWxsIHx8IHBsYXllciA9PSBudWxsKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1NldEFsbFN0YXRzOiBFcnJvciBpbml0aWFsaXphdGlvbicpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIHRyeSB7DQogICAgICAgIHBsYXllci5zZXRTdGF0cyhKU09OLnBhcnNlKGpzb25TdGF0cykpOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggU2V0IEFsbCBTdGF0czogJywgZS5tZXNzYWdlKTsNCiAgICB9DQp9DQoNCnZhciBwYXltZW50c0RhdGEgPSBOT19EQVRBOw0KbGV0IHBheW1lbnRzID0gbnVsbDsNCg0KZnVuY3Rpb24gSW5pdFBheW1lbnRzKHNlbmRiYWNrKSB7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgRmluYWwoTk9fREFUQSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB5c2RrLmdldFBheW1lbnRzKCkudGhlbihfcGF5bWVudHMgPT4gew0KICAgICAgICAgICAgICAgIHBheW1lbnRzID0gX3BheW1lbnRzOw0KDQogICAgICAgICAgICAgICAgcGF5bWVudHMuZ2V0Q2F0YWxvZygpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKHByb2R1Y3RzID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcm9kdWN0SUQgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0aXRsZSA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRlc2NyaXB0aW9uID0gW107DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW1hZ2VVUkkgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcmljZSA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHByaWNlVmFsdWUgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcmljZUN1cnJlbmN5Q29kZSA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGN1cnJlbmN5SW1hZ2VVUkwgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjb25zdW1lZCA9IFtdOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBwYXltZW50cy5nZXRQdXJjaGFzZXMoKS50aGVuKHB1cmNoYXNlcyA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcm9kdWN0cy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0SURbaV0gPSBwcm9kdWN0c1tpXS5pZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGVbaV0gPSBwcm9kdWN0c1tpXS50aXRsZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb25baV0gPSBwcm9kdWN0c1tpXS5kZXNjcmlwdGlvbjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VVUklbaV0gPSBwcm9kdWN0c1tpXS5pbWFnZVVSSTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2VbaV0gPSBwcm9kdWN0c1tpXS5wcmljZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2VWYWx1ZVtpXSA9IHByb2R1Y3RzW2ldLnByaWNlVmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlQ3VycmVuY3lDb2RlW2ldID0gcHJvZHVjdHNbaV0ucHJpY2VDdXJyZW5jeUNvZGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5SW1hZ2VVUkxbaV0gPSBwcm9kdWN0c1tpXS5nZXRQcmljZUN1cnJlbmN5SW1hZ2UoIm1lZGl1bSIpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVkW2ldID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpMiA9IDA7IGkyIDwgcHVyY2hhc2VzLmxlbmd0aDsgaTIrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHB1cmNoYXNlc1tpMl0ucHJvZHVjdElEID09PSBwcm9kdWN0SURbaV0pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lZFtpXSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGpzb25QYXltZW50cyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImlkIjogcHJvZHVjdElELA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidGl0bGUiOiB0aXRsZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogZGVzY3JpcHRpb24sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbWFnZVVSSSI6IGltYWdlVVJJLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicHJpY2UiOiBwcmljZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInByaWNlVmFsdWUiOiBwcmljZVZhbHVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicHJpY2VDdXJyZW5jeUNvZGUiOiBwcmljZUN1cnJlbmN5Q29kZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImN1cnJlbmN5SW1hZ2VVUkwiOiBjdXJyZW5jeUltYWdlVVJMLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY29uc3VtZWQiOiBjb25zdW1lZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImxhbmd1YWdlIjogeXNkay5lbnZpcm9ubWVudC5pMThuLmxhbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmluYWwoSlNPTi5zdHJpbmdpZnkoanNvblBheW1lbnRzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gew0KICAgICAgICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoJ1B1cmNoYXNlcyBhcmUgbm90IGF2YWlsYWJsZScsIGUubWVzc2FnZSk7DQogICAgICAgICAgICAgICAgRmluYWwoTk9fREFUQSk7DQogICAgICAgICAgICB9KQ0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBJbml0IFBheW1lbnRzOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgRmluYWwoTk9fREFUQSk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBGaW5hbChyZXMpIHsNCiAgICAgICAgICAgIHBheW1lbnRzRGF0YSA9IHJlczsNCiAgICAgICAgICAgIFlHMkluc3RhbmNlKCdQYXltZW50c0VudHJpZXMnLCByZXMpOw0KICAgICAgICAgICAgcmVzb2x2ZShyZXMpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoNCmZ1bmN0aW9uIEJ1eVBheW1lbnRzKGlkKSB7DQogICAgdHJ5IHsNCiAgICAgICAgaWYgKHBheW1lbnRzICE9IG51bGwpIHsNCiAgICAgICAgICAgIHBheW1lbnRzLnB1cmNoYXNlKGlkKS50aGVuKCgpID0+IHsNCiAgICAgICAgICAgICAgICBMb2dTdHlsZWRNZXNzYWdlKCdQdXJjaGFzZSBTdWNjZXNzJyk7DQogICAgICAgICAgICAgICAgQ29uc3VtZVB1cmNoYXNlKGlkLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1B1cmNoYXNlIEZhaWxlZCcsIGUubWVzc2FnZSk7DQogICAgICAgICAgICAgICAgWUcySW5zdGFuY2UoJ09uUHVyY2hhc2VGYWlsZWQnLCBpZCk7DQogICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICB9KQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgnUGF5bWVudHMgPT0gbnVsbCcpOw0KICAgICAgICAgICAgWUcySW5zdGFuY2UoJ09uUHVyY2hhc2VGYWlsZWQnLCBpZCk7DQogICAgICAgIH0NCiAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEJ1eSBQYXltZW50czogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgWUcySW5zdGFuY2UoJ09uUHVyY2hhc2VGYWlsZWQnLCBpZCk7DQogICAgICAgIEZvY3VzR2FtZSgpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gQ29uc3VtZVB1cmNoYXNlKGlkLCBvblB1cmNoYXNlU3VjY2Vzcykgew0KICAgIHRyeSB7DQogICAgICAgIGlmIChwYXltZW50cyAhPSBudWxsKSB7DQogICAgICAgICAgICBwYXltZW50cy5nZXRQdXJjaGFzZXMoKS50aGVuKHB1cmNoYXNlcyA9PiB7DQogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHB1cmNoYXNlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBpZiAocHVyY2hhc2VzW2ldLnByb2R1Y3RJRCA9PT0gaWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRzLmNvbnN1bWVQdXJjaGFzZShwdXJjaGFzZXNbaV0ucHVyY2hhc2VUb2tlbik7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvblB1cmNoYXNlU3VjY2VzcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgnT25QdXJjaGFzZVN1Y2Nlc3MnLCBpZCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoJ0NvbnN1bWUgcHVyY2hhc2U6IHBheW1lbnRzIG51bGwnKTsNCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggQ29uc3VtZSBQdXJjaGFzZTogJywgZS5tZXNzYWdlKTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIENvbnN1bWVQdXJjaGFzZXMob25QdXJjaGFzZVN1Y2Nlc3MpIHsNCiAgICB0cnkgew0KICAgICAgICBpZiAocGF5bWVudHMgIT0gbnVsbCkgew0KICAgICAgICAgICAgcGF5bWVudHMuZ2V0UHVyY2hhc2VzKCkudGhlbihwdXJjaGFzZXMgPT4gew0KICAgICAgICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoJ1VucHJvY2Vzc2VkIHB1cmNoYXNlczogJywgcHVyY2hhc2VzLmxlbmd0aCk7DQogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHB1cmNoYXNlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBwYXltZW50cy5jb25zdW1lUHVyY2hhc2UocHVyY2hhc2VzW2ldLnB1cmNoYXNlVG9rZW4pOw0KDQogICAgICAgICAgICAgICAgICAgIGlmIChvblB1cmNoYXNlU3VjY2VzcykNCiAgICAgICAgICAgICAgICAgICAgICAgIFlHMkluc3RhbmNlKCdPblB1cmNoYXNlU3VjY2VzcycsIHB1cmNoYXNlc1tpXS5wcm9kdWN0SUQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgnQ29uc3VtZSBwdXJjaGFzZXM6IHBheW1lbnRzIG51bGwnKTsNCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggQ29uc3VtZSBwdXJjaGFzZXM6ICcsIGUubWVzc2FnZSk7DQogICAgfQ0KfQ0KDQpsZXQgYWxsR2FtZXNEYXRhID0gTk9fREFUQTsNCg0KZnVuY3Rpb24gR2V0QWxsR2FtZXMoKSB7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgICAgIGlmICh5c2RrID09IG51bGwpIHsNCiAgICAgICAgICAgIEZpbmFsKE5PX0RBVEEpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICB5c2RrLmZlYXR1cmVzLkdhbWVzQVBJLmdldEFsbEdhbWVzKCkudGhlbigoeyBnYW1lcywgZGV2ZWxvcGVyVVJMIH0pID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgYXBwSUQgPSBuZXcgQXJyYXkoZ2FtZXMpOw0KICAgICAgICAgICAgICAgIGxldCB0aXRsZSA9IG5ldyBBcnJheShnYW1lcyk7DQogICAgICAgICAgICAgICAgbGV0IHVybCA9IG5ldyBBcnJheShnYW1lcyk7DQogICAgICAgICAgICAgICAgbGV0IGNvdmVyVVJMID0gbmV3IEFycmF5KGdhbWVzKTsNCiAgICAgICAgICAgICAgICBsZXQgaWNvblVSTCA9IG5ldyBBcnJheShnYW1lcyk7DQoNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdhbWVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIGFwcElEW2ldID0gZ2FtZXNbaV0uYXBwSUQ7DQogICAgICAgICAgICAgICAgICAgIHRpdGxlW2ldID0gZ2FtZXNbaV0udGl0bGU7DQogICAgICAgICAgICAgICAgICAgIHVybFtpXSA9IGdhbWVzW2ldLnVybDsNCiAgICAgICAgICAgICAgICAgICAgY292ZXJVUkxbaV0gPSBnYW1lc1tpXS5jb3ZlclVSTDsNCiAgICAgICAgICAgICAgICAgICAgaWNvblVSTFtpXSA9IGdhbWVzW2ldLmljb25VUkw7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgbGV0IGpzb25HYW1lcyA9IHsNCiAgICAgICAgICAgICAgICAgICAgImFwcElEIjogYXBwSUQsDQogICAgICAgICAgICAgICAgICAgICJ0aXRsZSI6IHRpdGxlLA0KICAgICAgICAgICAgICAgICAgICAidXJsIjogdXJsLA0KICAgICAgICAgICAgICAgICAgICAiY292ZXJVUkwiOiBjb3ZlclVSTCwNCiAgICAgICAgICAgICAgICAgICAgImljb25VUkwiOiBpY29uVVJMLA0KICAgICAgICAgICAgICAgICAgICAiZGV2ZWxvcGVyVVJMIjogZGV2ZWxvcGVyVVJMDQogICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgIEZpbmFsKEpTT04uc3RyaW5naWZ5KGpzb25HYW1lcykpOw0KDQogICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4gew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldEFsbEdhbWVzJywgZXJyKTsNCiAgICAgICAgICAgICAgICBGaW5hbChOT19EQVRBKTsNCiAgICAgICAgICAgIH0pDQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEdldCBBbGwgR2FtZXM6ICcsIGUubWVzc2FnZSk7DQogICAgICAgICAgICBGaW5hbChOT19EQVRBKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIEZpbmFsKHJlcykgew0KICAgICAgICAgICAgYWxsR2FtZXNEYXRhID0gcmVzOw0KICAgICAgICAgICAgcmVzb2x2ZShyZXMpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoNCmxldCBsZWFkZXJib2FyZHMgPSBudWxsOw0KDQpmdW5jdGlvbiBJbml0TGVhZGVyYm9hcmRzKCkgew0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gew0KICAgICAgICB5c2RrLmdldExlYWRlcmJvYXJkcygpDQogICAgICAgICAgICAudGhlbihfbGIgPT4gew0KICAgICAgICAgICAgICAgIGxlYWRlcmJvYXJkcyA9IF9sYg0KICAgICAgICAgICAgICAgIHJlc29sdmUoX2xiKTsNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW5pdCBMZWFkZXJib2FyZHMgZXJyOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7DQogICAgICAgICAgICB9KTsNCiAgICB9KTsNCn0NCg0KZnVuY3Rpb24gU2V0TGVhZGVyYm9hcmQobmFtZSwgc2NvcmUsIGV4dHJhRGF0YSkgew0KICAgIGlmIChsZWFkZXJib2FyZHMgPT0gbnVsbCkNCiAgICAgICAgcmV0dXJuOw0KDQogICAgdHJ5IHsNCiAgICAgICAgbGVhZGVyYm9hcmRzLnNldExlYWRlcmJvYXJkU2NvcmUobmFtZSwgc2NvcmUsIGV4dHJhRGF0YSk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBTZXQgTGVhZGVyYm9hcmQ6ICcsIGUubWVzc2FnZSk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBHZXRMZWFkZXJib2FyZChuYW1lTEIsIHF1YW50aXR5VG9wLCBxdWFudGl0eUFyb3VuZCwgcGhvdG9TaXplLCBhdXRoKSB7DQogICAgaWYgKGxlYWRlcmJvYXJkcyA9PSBudWxsKQ0KICAgICAgICByZXR1cm47DQoNCiAgICB0cnkgew0KICAgICAgICB2YXIganNvbkVudHJpZXMgPSB7DQogICAgICAgICAgICB0ZWNobm9OYW1lOiAnJywNCiAgICAgICAgICAgIGlzRGVmYXVsdDogZmFsc2UsDQogICAgICAgICAgICBpc0ludmVydFNvcnRPcmRlcjogZmFsc2UsDQogICAgICAgICAgICBkZWNpbWFsT2Zmc2V0OiAwLA0KICAgICAgICAgICAgdHlwZTogJycNCiAgICAgICAgfTsNCg0KICAgICAgICBsZWFkZXJib2FyZHMuZ2V0TGVhZGVyYm9hcmREZXNjcmlwdGlvbihuYW1lTEIpDQogICAgICAgICAgICAudGhlbihyZXMgPT4gew0KICAgICAgICAgICAgICAgIGpzb25FbnRyaWVzLnRlY2hub05hbWUgPSBuYW1lTEI7DQogICAgICAgICAgICAgICAganNvbkVudHJpZXMuaXNEZWZhdWx0ID0gcmVzLmRlZmF1bHQ7DQogICAgICAgICAgICAgICAganNvbkVudHJpZXMuaXNJbnZlcnRTb3J0T3JkZXIgPSByZXMuZGVzY3JpcHRpb24uaW52ZXJ0X3NvcnRfb3JkZXI7DQogICAgICAgICAgICAgICAganNvbkVudHJpZXMuZGVjaW1hbE9mZnNldCA9IHJlcy5kZXNjcmlwdGlvbi5zY29yZV9mb3JtYXQub3B0aW9ucy5kZWNpbWFsX29mZnNldDsNCiAgICAgICAgICAgICAgICBqc29uRW50cmllcy50eXBlID0gcmVzLmRlc2NyaXB0aW9uLnR5cGU7DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gbGVhZGVyYm9hcmRzLmdldExlYWRlcmJvYXJkRW50cmllcyhuYW1lTEIsIHsNCiAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHlUb3A6IHF1YW50aXR5VG9wLA0KICAgICAgICAgICAgICAgICAgICBpbmNsdWRlVXNlcjogYXV0aCwNCiAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHlBcm91bmQ6IHF1YW50aXR5QXJvdW5kDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgLnRoZW4ocmVzID0+IHsNCiAgICAgICAgICAgICAgICBsZXQganNvblBsYXllcnMgPSBFbnRyaWVzTEIocmVzLCBwaG90b1NpemUpOw0KICAgICAgICAgICAgICAgIGxldCBjb21iaW5lZEpzb24gPSB7IC4uLmpzb25FbnRyaWVzLCAuLi5qc29uUGxheWVycyB9Ow0KDQogICAgICAgICAgICAgICAgWUcySW5zdGFuY2UoJ0xlYWRlcmJvYXJkRW50cmllcycsIEpTT04uc3RyaW5naWZ5KGNvbWJpbmVkSnNvbikpOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4gew0KICAgICAgICAgICAgICAgIGlmIChlcnIuY29kZSA9PT0gJ0xFQURFUkJPQVJEX1BMQVlFUl9OT1RfUFJFU0VOVCcpDQogICAgICAgICAgICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoJ0xlYWRlcmJvYXJkIHBsYXllciBub3QgcHJlc2VudCcpOw0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsNCiAgICAgICAgICAgIH0pOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBHZXQgTGVhZGVyYm9hcmQ6ICcsIGUubWVzc2FnZSk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBFbnRyaWVzTEIocmVzLCBwaG90b1NpemUpIHsNCiAgICBsZXQgTGJkRW50cmllc1RleHQgPSAnJzsNCiAgICBsZXQgcGxDb3VudCA9IHJlcy5lbnRyaWVzLmxlbmd0aDsNCg0KICAgIGxldCByYW5rcyA9IG5ldyBBcnJheShwbENvdW50KTsNCiAgICBsZXQgcGhvdG9zID0gbmV3IEFycmF5KHBsQ291bnQpOw0KICAgIGxldCBtYW1lcyA9IG5ldyBBcnJheShwbENvdW50KTsNCiAgICBsZXQgc2NvcmVzID0gbmV3IEFycmF5KHBsQ291bnQpOw0KICAgIGxldCB1bmlxdWVJRHMgPSBuZXcgQXJyYXkocGxDb3VudCk7DQogICAgbGV0IGV4dHJhRGF0YUFycmF5ID0gbmV3IEFycmF5KHBsQ291bnQpOw0KDQogICAgZm9yIChpID0gMDsgaSA8IHBsQ291bnQ7IGkrKykgew0KICAgICAgICByYW5rc1tpXSA9IHJlcy5lbnRyaWVzW2ldLnJhbms7DQogICAgICAgIHNjb3Jlc1tpXSA9IHJlcy5lbnRyaWVzW2ldLnNjb3JlOw0KICAgICAgICB1bmlxdWVJRHNbaV0gPSByZXMuZW50cmllc1tpXS5wbGF5ZXIudW5pcXVlSUQ7DQogICAgICAgIHBob3Rvc1tpXSA9IHJlcy5lbnRyaWVzW2ldLnBsYXllci5nZXRBdmF0YXJTcmMocGhvdG9TaXplKTsNCg0KICAgICAgICBpZiAocmVzLmVudHJpZXNbaV0uZXh0cmFEYXRhID09ICIiIHx8IHJlcy5lbnRyaWVzW2ldLmV4dHJhRGF0YSA9PSBudWxsKQ0KICAgICAgICAgICAgZXh0cmFEYXRhQXJyYXlbaV0gPSBOT19EQVRBOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBleHRyYURhdGFBcnJheVtpXSA9IHJlcy5lbnRyaWVzW2ldLmV4dHJhRGF0YTsNCg0KICAgICAgICBpZiAocmVzLmVudHJpZXNbaV0ucGxheWVyLnNjb3BlUGVybWlzc2lvbnMucHVibGljX25hbWUgIT09ICJhbGxvdyIpDQogICAgICAgICAgICBtYW1lc1tpXSA9ICJhbm9ueW1vdXMiOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBtYW1lc1tpXSA9IHJlcy5lbnRyaWVzW2ldLnBsYXllci5wdWJsaWNOYW1lOw0KDQogICAgICAgIExiZEVudHJpZXNUZXh0ICs9IHJhbmtzW2ldICsgJy4gJyArIG1hbWVzW2ldICsgIjogIiArIHNjb3Jlc1tpXSArICdcbic7DQogICAgfQ0KDQogICAgaWYgKHBsQ291bnQgPT09IDApIHsNCiAgICAgICAgTGJkRW50cmllc1RleHQgPSAnbm8gZGF0YSc7DQogICAgfQ0KDQogICAgbGV0IGpzb25QbGF5ZXJzID0gew0KICAgICAgICAiZW50cmllcyI6IExiZEVudHJpZXNUZXh0LA0KICAgICAgICAicmFua3MiOiByYW5rcywNCiAgICAgICAgInBob3RvcyI6IHBob3RvcywNCiAgICAgICAgIm5hbWVzIjogbWFtZXMsDQogICAgICAgICJzY29yZXMiOiBzY29yZXMsDQogICAgICAgICJ1bmlxdWVJRHMiOiB1bmlxdWVJRHMsDQogICAgICAgICJleHRyYURhdGFBcnJheSI6IGV4dHJhRGF0YUFycmF5DQogICAgfTsNCg0KICAgIHJldHVybiBqc29uUGxheWVyczsNCn0NCg0KDQpsZXQgbm93RnVsbEFkT3BlbiA9IGZhbHNlOw0KDQpmdW5jdGlvbiBJbnRlckFkdlNob3coKSB7DQogICAgdHJ5IHsNCiAgICAgICAgaWYgKG5vd0Z1bGxBZE9wZW4gIT09IHRydWUgJiYgeXNkayAhPT0gbnVsbCkgew0KICAgICAgICAgICAgeXNkay5hZHYuc2hvd0Z1bGxzY3JlZW5BZHYoDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uT3BlbjogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoJ09wZW4gSW50ZXJzdGl0aWFsIEFkdicpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vd0Z1bGxBZE9wZW4gPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbml0R2FtZSA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgnT3BlbkludGVyQWR2Jyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6ICh3YXNTaG93bikgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vd0Z1bGxBZE9wZW4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdEdhbWUgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdhc1Nob3duKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgnQ2xvc2VJbnRlckFkdicsICd0cnVlJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBZRzJJbnN0YW5jZSgnQ2xvc2VJbnRlckFkdicsICdmYWxzZScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uRXJyb3I6IChlcnJvcikgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIEludGVyc3RpdGlhbCBBZHYnLCBlcnJvcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWUcySW5zdGFuY2UoJ0Vycm9ySW50ZXJBZHYnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEludGVyc3RpdGlhbCBBZHYgU2hvdzogJywgZS5tZXNzYWdlKTsNCiAgICB9DQp9DQoNCg0KdmFyIGdhbWVMYWJlbERhdGEgPSAnZmFsc2UnOw0KDQpmdW5jdGlvbiBJbml0R2FtZUxhYmVsKCkgew0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gew0KICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgICByZXNvbHZlKCdmYWxzZScpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICB5c2RrLnNob3J0Y3V0LmNhblNob3dQcm9tcHQoKS50aGVuKHByb21wdCA9PiB7DQogICAgICAgICAgICAgICAgaWYgKHByb21wdC5jYW5TaG93KSB7DQogICAgICAgICAgICAgICAgICAgIGdhbWVMYWJlbERhdGEgPSAndHJ1ZSc7DQogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ3RydWUnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ2ZhbHNlJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEluaXQgR2FtZSBMYWJlbDogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIHJlc29sdmUoJ2ZhbHNlJyk7DQogICAgICAgIH0NCiAgICB9KTsNCn0NCg0KZnVuY3Rpb24gR2FtZUxhYmVsU2hvd0RpYWxvZygpIHsNCiAgICB0cnkgew0KICAgICAgICB5c2RrLnNob3J0Y3V0LnNob3dQcm9tcHQoKQ0KICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHsNCiAgICAgICAgICAgICAgICBMb2dTdHlsZWRNZXNzYWdlKCdTaG9ydGN1dCBjcmVhdGVkPzonLCByZXN1bHQpOw0KICAgICAgICAgICAgICAgIGlmIChyZXN1bHQub3V0Y29tZSA9PT0gJ2FjY2VwdGVkJykgew0KICAgICAgICAgICAgICAgICAgICBMb2dTdHlsZWRNZXNzYWdlKCdHYW1lIExhYmVsIFN1Y2Nlc3MnKTsNCiAgICAgICAgICAgICAgICAgICAgWUcySW5zdGFuY2UoJ09uR2FtZUxhYmVsU3VjY2VzcycpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgWUcySW5zdGFuY2UoJ09uR2FtZUxhYmVsRmFpbCcpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgIH0pOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBHYW1lIExhYmVsIFNob3c6ICcsIGUubWVzc2FnZSk7DQogICAgICAgIEZvY3VzR2FtZSgpOw0KICAgIH0NCn0NCg0KbGV0IGZsYXNnc0RhdGEgPSBOT19EQVRBOw0KDQpmdW5jdGlvbiBHZXRGbGFncygpIHsNCiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsNCiAgICAgICAgaWYgKHlzZGsgPT0gbnVsbCkgew0KICAgICAgICAgICAgRmluYWwoTk9fREFUQSk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHlzZGsuZ2V0RmxhZ3MoKS50aGVuKGZsYWdzID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgbmFtZXMgPSBbXTsNCiAgICAgICAgICAgICAgICBsZXQgdmFsdWVzID0gW107DQoNCiAgICAgICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gZmxhZ3MpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGZsYWdzLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzLnB1c2goa2V5KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKGZsYWdzW2tleV0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgbGV0IGpzb25GbGFncyA9IHsNCiAgICAgICAgICAgICAgICAgICAgIm5hbWVzIjogbmFtZXMsDQogICAgICAgICAgICAgICAgICAgICJ2YWx1ZXMiOiB2YWx1ZXMNCiAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgICAgRmluYWwoSlNPTi5zdHJpbmdpZnkoanNvbkZsYWdzKSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggR2V0IEZsYWdzOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgRmluYWwoTk9fREFUQSk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBGaW5hbChyZXMpIHsNCiAgICAgICAgICAgIGZsYXNnc0RhdGEgPSByZXMNCiAgICAgICAgICAgIHJlc29sdmUocmVzKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfQ0KDQp2YXIgZW52aXJvbm1lbnREYXRhID0gTk9fREFUQTsNCg0KZnVuY3Rpb24gUmVxdWVzdGluZ0Vudmlyb25tZW50RGF0YSgpIHsNCiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsNCiAgICAgICAgaWYgKHlzZGsgPT0gbnVsbCkgew0KICAgICAgICAgICAgRmluYWwoTk9fREFUQSk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHZhciBicm93c2VyID0gJ090aGVyJzsNCiAgICAgICAgICAgIGlmIChicm93c2VyLmluY2x1ZGVzKCdZYUJyb3dzZXInKSB8fCBicm93c2VyLmluY2x1ZGVzKCdZYVNlYXJjaEJyb3dzZXInKSkNCiAgICAgICAgICAgICAgICBicm93c2VyID0gJ1lhbmRleCc7DQogICAgICAgICAgICBlbHNlIGlmIChicm93c2VyLmluY2x1ZGVzKCdPcGVyYScpIHx8IGJyb3dzZXIuaW5jbHVkZXMoJ09QUicpKQ0KICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnT3BlcmEnOw0KICAgICAgICAgICAgZWxzZSBpZiAoYnJvd3Nlci5pbmNsdWRlcygnRmlyZWZveCcpKQ0KICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnRmlyZWZveCc7DQogICAgICAgICAgICBlbHNlIGlmIChicm93c2VyLmluY2x1ZGVzKCdNU0lFJykpDQogICAgICAgICAgICAgICAgYnJvd3NlciA9ICdJRSc7DQogICAgICAgICAgICBlbHNlIGlmIChicm93c2VyLmluY2x1ZGVzKCdFZGdlJykpDQogICAgICAgICAgICAgICAgYnJvd3NlciA9ICdFZGdlJzsNCiAgICAgICAgICAgIGVsc2UgaWYgKGJyb3dzZXIuaW5jbHVkZXMoJ0Nocm9tZScpKQ0KICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnQ2hyb21lJzsNCiAgICAgICAgICAgIGVsc2UgaWYgKGJyb3dzZXIuaW5jbHVkZXMoJ1NhZmFyaScpKQ0KICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnU2FmYXJpJzsNCg0KICAgICAgICAgICAgbGV0IGpzb25FbnZpciA9IHsNCiAgICAgICAgICAgICAgICAibGFuZ3VhZ2UiOiB5c2RrLmVudmlyb25tZW50LmkxOG4ubGFuZywNCiAgICAgICAgICAgICAgICAiZG9tYWluIjogeXNkay5lbnZpcm9ubWVudC5pMThuLnRsZCwNCiAgICAgICAgICAgICAgICAiZGV2aWNlVHlwZSI6IHlzZGsuZGV2aWNlSW5mby50eXBlLA0KICAgICAgICAgICAgICAgICJpc01vYmlsZSI6IHlzZGsuZGV2aWNlSW5mby5pc01vYmlsZSgpLA0KICAgICAgICAgICAgICAgICJpc0Rlc2t0b3AiOiB5c2RrLmRldmljZUluZm8uaXNEZXNrdG9wKCksDQogICAgICAgICAgICAgICAgImlzVGFibGV0IjogeXNkay5kZXZpY2VJbmZvLmlzVGFibGV0KCksDQogICAgICAgICAgICAgICAgImlzVFYiOiB5c2RrLmRldmljZUluZm8uaXNUVigpLA0KICAgICAgICAgICAgICAgICJhcHBJRCI6IHlzZGsuZW52aXJvbm1lbnQuYXBwLmlkLA0KICAgICAgICAgICAgICAgICJicm93c2VyTGFuZyI6IHlzZGsuZW52aXJvbm1lbnQuYnJvd3Nlci5sYW5nLA0KICAgICAgICAgICAgICAgICJwYXlsb2FkIjogeXNkay5lbnZpcm9ubWVudC5wYXlsb2FkLA0KICAgICAgICAgICAgICAgICJwbGF0Zm9ybSI6IG5hdmlnYXRvci5wbGF0Zm9ybSwNCiAgICAgICAgICAgICAgICAiYnJvd3NlciI6IGJyb3dzZXINCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIEZpbmFsKEpTT04uc3RyaW5naWZ5KGpzb25FbnZpcikpOw0KICAgICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgiRW52aXJvbm1lbnQgRGF0YTogIiArIEpTT04uc3RyaW5naWZ5KGpzb25FbnZpcikpOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBSZXF1ZXN0aW5nIEVudmlyb25tZW50IERhdGE6ICcsIGUubWVzc2FnZSk7DQogICAgICAgICAgICBGaW5hbChOT19EQVRBKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIEZpbmFsKHJlcykgew0KICAgICAgICAgICAgZW52aXJvbm1lbnREYXRhID0gcmVzOw0KICAgICAgICAgICAgWUcySW5zdGFuY2UoJ1NldEVudmlyRGF0YScsIHJlcyk7DQogICAgICAgICAgICByZXNvbHZlKHJlcyk7DQogICAgICAgIH0NCiAgICB9KTsNCn0NCg0KdmFyIHBsYXllckRhdGEgPSBOT19EQVRBOw0KbGV0IHBsYXllciA9IG51bGw7DQoNCmZ1bmN0aW9uIEluaXRQbGF5ZXIoKSB7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgRmluYWwoTm90QXV0aG9yaXplZCgpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGxldCBfc2NvcGVzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB5c2RrLmdldFBsYXllcih7IHNjb3BlczogX3Njb3BlcyB9KQ0KICAgICAgICAgICAgICAgICAgICAudGhlbihfcGxheWVyID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllciA9IF9wbGF5ZXI7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwbGF5ZXJOYW1lID0gcGxheWVyLmdldE5hbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwbGF5ZXJQaG90byA9IHBsYXllci5nZXRQaG90bygnbWVkaXVtJyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX3Njb3Blcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllck5hbWUgPSAiYW5vbnltb3VzIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJQaG90byA9ICJOT19EQVRBIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5nZXRNb2RlKCkgPT09ICdsaXRlJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ1N0eWxlZE1lc3NhZ2UoJ05vdCBBdXRob3JpemVkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmluYWwoTm90QXV0aG9yaXplZCgpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhdXRoSnNvbiA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBsYXllckF1dGgiOiAicmVzb2x2ZWQiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGxheWVyTmFtZSI6IHBsYXllck5hbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwbGF5ZXJJZCI6IHBsYXllci5nZXRVbmlxdWVJRCgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGxheWVyUGhvdG8iOiBwbGF5ZXJQaG90bywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBheWluZ1N0YXR1cyI6IHBsYXllci5nZXRQYXlpbmdTdGF0dXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmluYWwoSlNPTi5zdHJpbmdpZnkoYXV0aEpzb24pKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBdXRob3JpemVkIGVycjogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIEZpbmFsKE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBpbml0IFBsYXllcjogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIEZpbmFsKE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBGaW5hbChyZXMpIHsNCiAgICAgICAgICAgIHBsYXllckRhdGEgPSByZXM7DQogICAgICAgICAgICBZRzJJbnN0YW5jZSgnU2V0QXV0aCcsIHJlcyk7DQogICAgICAgICAgICByZXNvbHZlKHJlcyk7DQogICAgICAgIH0NCiAgICB9KTsNCn0NCg0KZnVuY3Rpb24gTm90QXV0aG9yaXplZCgpIHsNCiAgICBsZXQgYXV0aEpzb24gPSB7DQogICAgICAgICJwbGF5ZXJBdXRoIjogInJlamVjdGVkIiwNCiAgICAgICAgInBsYXllck5hbWUiOiAidW5hdXRob3JpemVkIiwNCiAgICAgICAgInBsYXllcklkIjogInVuYXV0aG9yaXplZCIsDQogICAgICAgICJwbGF5ZXJQaG90byI6ICJudWxsIiwNCiAgICAgICAgInBheWluZ1N0YXR1cyI6ICJ1bmtub3duIg0KICAgIH07DQogICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGF1dGhKc29uKTsNCn0NCg0KZnVuY3Rpb24gT3BlbkF1dGhEaWFsb2coKSB7DQogICAgaWYgKHlzZGsgIT09IG51bGwpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHlzZGsuYXV0aC5vcGVuQXV0aERpYWxvZygpLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgIEluaXRQbGF5ZXIodHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgWUcySW5zdGFuY2UoJ0dldERhdGFJbnZva2UnKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgTG9nU3R5bGVkTWVzc2FnZSgnQ1JBU0ggT3BlbiBBdXRoIERpYWxvZzogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KDQogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsNCiAgICA8L3NjcmlwdD4NCjwvYm9keT4NCjwvaHRtbD4NCg==";
