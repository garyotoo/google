window.game = "DQoNCjwhLS0gVWx0aW1hdGUgR2FtZSBTdGFzaCBmaWxlLS0+IA0KPCEtLSBGb3IgdGhlIHJlZ3VsYXJseSB1cGRhdGluZyBkb2MgZ28gdG8gaHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vZG9jdW1lbnQvZC8xX0ZtSDNCbFNCUUk3RkdnQVFMNTktWlBlOGVDeHMzNXdlbDZKVXlWYUc4US8gLS0+DQoNCg0KDQo8IURPQ1RZUEUgSFRNTD4NCjxodG1sPg0KDQo8Ym9keT4NCiAgICA8Y2FudmFzIGlkPSdjYW52YXMnPjwvY2FudmFzPg0KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvYnViYmxzL1VHUy1Bc3NldHNAMWI5NjY3MGJiOTcxMWI0ZjBmYTZlOGY5NTM1NTRkNWNkMTJmYzhiOC9vcHBvc2l0ZSUyMGRheS9nYW1lLXNldHVwLmpzIj48L3NjcmlwdD4NCiAgICA8c2NyaXB0Pg0KICAgICAgICB2YXIgdGl0bGUgPSAnT3Bwb3NpdGUgRGF5JzsNCiAgICAgICAgdmFyIGRpbWVuc2lvbnMgPSB7IHdpZHRoOiAxMDAwLCBoZWlnaHQ6IDEwMDAgfTsNCiAgICAgICAgdmFyIGltYWdlcyA9IHt9Ow0KICAgICAgICB2YXIgYXVkaW9zID0ge307DQoNCiAgICAgICAgaW5pdGlhbGl6ZSgpOw0KICAgICAgICB3aW5kb3cuc2V0SW50ZXJ2YWwodXBkYXRlLCAxMCk7DQoNCiAgICAgICAgZnVuY3Rpb24gbWFpbigpIHsNCiAgICAgICAgICAgIGdhbWUudXBkYXRlKCk7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgZ2FtZSA9IHsNCiAgICAgICAgICAgIHN3aXRjaEtleXM6IGZhbHNlLA0KICAgICAgICAgICAgdGhyb3VnaHRDaGVja3BvaW50MTogZmFsc2UsDQogICAgICAgICAgICBjaGVja3BvaW50MTogZmFsc2UsDQogICAgICAgICAgICBsZXZlbFg6IDAsDQogICAgICAgICAgICBsZXZlbFk6IDAsDQogICAgICAgICAgICBwbGF5ZXJEZWFkOiBmYWxzZSwNCiAgICAgICAgICAgIHJlc3Bhd25UaW1lOiAwLA0KICAgICAgICAgICAgd29uOiBmYWxzZSwNCiAgICAgICAgICAgIGpvaG5idXRsZXJnYW1lczogZmFsc2UsDQogICAgICAgICAgICBzaG93VGltZXI6IHRydWUsDQogICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBpZiAod29yZC5lbmRzV2l0aCgiSk9ITkJVVExFUkdBTUVTIikpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5qb2huYnV0bGVyZ2FtZXMgPSAhdGhpcy5qb2huYnV0bGVyZ2FtZXM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChLZXlzLmtleXNbODJdKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHRoaXMubGV2ZWxYID09IC00ICYmIHRoaXMubGV2ZWxZID09IDAgJiYgcGxheWVyLnkgPCA1MDApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja3BvaW50MSA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghdGhpcy5wbGF5ZXJEZWFkKSB7DQogICAgICAgICAgICAgICAgICAgIHBsYXllci51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3Bhd25UaW1lLS07DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlc3Bhd25UaW1lID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzcGF3bigpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmxldmVsWCAhPSAtNSB8fCB0aGlzLmxldmVsWSAhPSAxKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoS2V5cyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50TGV2ZWwuZiAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudExldmVsLmYoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdmFyIG4gPSAwOw0KICAgICAgICAgICAgICAgIHdoaWxlIChuIDwgdGhpcy5jdXJyZW50TGV2ZWwuYmxvY2tzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMuY3VycmVudExldmVsLmJsb2Nrc1tuXTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGIuZiAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBiLmYoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBuKys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHBhcnRpY2xlcy51cGRhdGUoKTsNCiAgICAgICAgICAgICAgICB0aGlzLmRyYXcoKTsNCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMud29uICYmIHBsYXllci5tb3ZlZCkgew0KICAgICAgICAgICAgICAgICAgICB0aW1lcisrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoS2V5cy5kb3duWzg0XSkgew0KICAgICAgICAgICAgICAgICAgICBnYW1lLnNob3dUaW1lciA9ICFnYW1lLnNob3dUaW1lcjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZHJhdzogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmxldmVsWCA9PSAtNiAmJiBnYW1lLmxldmVsWSA9PSAxKSB7DQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnYmxhY2snOw0KICAgICAgICAgICAgICAgICAgICBjdHgudGV4dEFsaWduID0gJ2NlbnRlcic7DQogICAgICAgICAgICAgICAgICAgIGN0eC5mb250ID0gIjYwcHggQXJpYWwiOw0KICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFRleHQoJ05vdCBZb3VyIFRpbWU6ICcgKyB0aW1lciAvIDEwMCwgNTAwLCA0MDApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvL3RpbWUNCg0KICAgICAgICAgICAgICAgIHZhciBuID0gMDsNCiAgICAgICAgICAgICAgICB3aGlsZSAobiA8IHRoaXMuY3VycmVudExldmVsLmJsb2Nrcy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLmN1cnJlbnRMZXZlbC5ibG9ja3Nbbl07DQogICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhd0Jsb2NrKGIpOw0KICAgICAgICAgICAgICAgICAgICAvL2RyYXcgYmxvY2sNCiAgICAgICAgICAgICAgICAgICAgbisrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvL2RyYXcgYmxvY2tzDQoNCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucGxheWVyRGVhZCkgew0KICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuZHJhdygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvL2RyYXcgcGxheWVyDQoNCiAgICAgICAgICAgICAgICBwYXJ0aWNsZXMuZHJhdygpOw0KICAgICAgICAgICAgICAgIC8vZHJhdyBwYXJ0aWNsZXMNCg0KICAgICAgICAgICAgICAgIGlmIChnYW1lLnNob3dUaW1lcikgew0KICAgICAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IG5ldyBTdHJpbmcodGltZXIgLyAxMDApOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIXRleHQuaW5jbHVkZXMoIi4iKSkgdGV4dCArPSAiLjAwIjsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHNwbGl0ID0gdGV4dC5zcGxpdCgiLiIpWzFdOw0KICAgICAgICAgICAgICAgICAgICBpZiAoc3BsaXQubGVuZ3RoIDwgMikgdGV4dCArPSAiMCI7DQogICAgICAgICAgICAgICAgICAgIGN0eC5mb250ID0gIjMwcHggQXJpYWwiOw0KICAgICAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBjdHgubWVhc3VyZVRleHQodGV4dCkud2lkdGg7DQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAid2hpdGUiOw0KICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoOTgwIC0gd2lkdGgsIDAsIHdpZHRoICsgMjAsIDM3KTsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICJibGFjayI7DQogICAgICAgICAgICAgICAgICAgIGN0eC50ZXh0QWxpZ24gPSAicmlnaHQiOw0KICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFRleHQodGV4dCwgOTkwLCAzMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sZXZlbFggPSAwOw0KICAgICAgICAgICAgICAgIHRoaXMubGV2ZWxZID0gMDsNCiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrcG9pbnQxID0gZmFsc2U7DQogICAgICAgICAgICAgICAgcGxheWVyLnggPSA0ODA7DQogICAgICAgICAgICAgICAgcGxheWVyLnkgPSA1MDA7DQogICAgICAgICAgICAgICAgcGxheWVyLnhtb3ZlID0gMDsNCiAgICAgICAgICAgICAgICBwbGF5ZXIueW1vdmUgPSAwOw0KICAgICAgICAgICAgICAgIHBsYXllci5tb3ZlZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIHRpbWVyID0gMDsNCiAgICAgICAgICAgICAgICB0aGlzLndvbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIHRoaXMucGxheWVyRGVhZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaExldmVsKCk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgcmVzcGF3bjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHRoaXMubGV2ZWxYID0gMDsNCiAgICAgICAgICAgICAgICB0aGlzLmxldmVsWSA9IDA7DQogICAgICAgICAgICAgICAgcGxheWVyLnggPSA0ODA7DQogICAgICAgICAgICAgICAgcGxheWVyLnkgPSA1MDA7DQogICAgICAgICAgICAgICAgcGxheWVyLnhtb3ZlID0gMDsNCiAgICAgICAgICAgICAgICBwbGF5ZXIueW1vdmUgPSAwOw0KICAgICAgICAgICAgICAgIHRoaXMucGxheWVyRGVhZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaExldmVsKCk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgcmVmcmVzaExldmVsOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcGFydGljbGVzLnBhcnRpY2xlcyA9IFtdOw0KICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudExldmVsID0gdGhpcy5nZXRMZXZlbCh0aGlzLmxldmVsWCwgdGhpcy5sZXZlbFkpOw0KICAgICAgICAgICAgICAgIHZhciBuID0gMDsNCiAgICAgICAgICAgICAgICB3aGlsZSAobiA8IHRoaXMuY3VycmVudExldmVsLmJsb2Nrcy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLmN1cnJlbnRMZXZlbC5ibG9ja3Nbbl07DQogICAgICAgICAgICAgICAgICAgIGlmIChiLmNvbGxpZGUgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYi5jb2xsaWRlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBuKys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGdldExldmVsOiBmdW5jdGlvbiAoeCwgeSkgew0KICAgICAgICAgICAgICAgIHZhciBsZXZlbCA9IHsgeDogeCwgeTogeSwgYmxvY2tzOiBbXSB9Ow0KICAgICAgICAgICAgICAgIHZhciBuID0gMDsNCiAgICAgICAgICAgICAgICB3aGlsZSAobiA8IHRoaXMubGV2ZWxzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IHRoaXMubGV2ZWxzW25dOw0KICAgICAgICAgICAgICAgICAgICBpZiAobC54ID09IHggJiYgbC55ID09IHkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMobCk7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAobiA8IGtleXMubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxldmVsW2tleXNbbl1dID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWxba2V5c1tuXV0gPSBsW2tleXNbbl1dOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuKys7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAobiA8IGwuYmxvY2tzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsLmJsb2Nrcy5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobC5ibG9ja3Nbbl0pKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGwuYmxvY2tzW25dLmYgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXZlbC5ibG9ja3NbbGV2ZWwuYmxvY2tzLmxlbmd0aCAtIDFdLmYgPSBsLmJsb2Nrc1tuXS5mOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuKys7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBuKys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBsZXZlbDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBkcmF3QmxvY2s6IGZ1bmN0aW9uIChibG9jaykgew0KICAgICAgICAgICAgICAgIHZhciByZWQgPSAicmVkIjsNCiAgICAgICAgICAgICAgICB2YXIgemVyb1JlZCA9ICJyZ2JhKDI1NSwwLDAsMCkiOw0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmpvaG5idXRsZXJnYW1lcykgew0KICAgICAgICAgICAgICAgICAgICByZWQgPSAiYmx1ZSI7DQogICAgICAgICAgICAgICAgICAgIHplcm9SZWQgPSAicmdiYSgwLDAsMjU1LDApIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInOw0KICAgICAgICAgICAgICAgIGlmIChibG9jay50eXBlID09ICdibG9jaycpIHsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdibGFjayc7DQogICAgICAgICAgICAgICAgICAgIGlmIChibG9jay5pUmFkaXVzICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwID0gcGxheWVyOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdyZCA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudChwLnggKyBwLncgLyAyLCBwLnkgKyBwLmggLyAyLCA1MCwgcC54ICsgcC53IC8gMiwgcC55ICsgcC5oIC8gMiwgYmxvY2suaVJhZGl1cyk7DQogICAgICAgICAgICAgICAgICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAsICdibGFjaycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgxLCAncmdiYSgwLDAsMCwwKScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGdyZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2suc1JhZGl1cyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHBsYXllcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBncmQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQocC54ICsgcC53IC8gMiwgcC55ICsgcC5oIC8gMiwgNTAsIHAueCArIHAudyAvIDIsIHAueSArIHAuaCAvIDIsIGJsb2NrLnNSYWRpdXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLCAnYmxhY2snKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMSwgcmVkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrLmZSYWRpdXMgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBwbGF5ZXI7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ3JkID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KHAueCArIHAudyAvIDIsIHAueSArIHAuaCAvIDIsIDUwLCBwLnggKyBwLncgLyAyLCBwLnkgKyBwLmggLyAyLCBibG9jay5mUmFkaXVzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMSwgJ2JsYWNrJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAsICdyZ2IoMCwwLDAsMCknKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KGJsb2NrLngsIGJsb2NrLnksIGJsb2NrLncsIGJsb2NrLmgpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYmxvY2sudHlwZSA9PSAnbGF2YScpIHsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHJlZDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrLmlSYWRpdXMgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBwbGF5ZXI7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ3JkID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KHAueCArIHAudyAvIDIsIHAueSArIHAuaCAvIDIsIDUwLCBwLnggKyBwLncgLyAyLCBwLnkgKyBwLmggLyAyLCBibG9jay5pUmFkaXVzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMCwgcmVkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMSwgemVyb1JlZCk7DQogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZ3JkOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChibG9jay5zUmFkaXVzICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwID0gcGxheWVyOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdyZCA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudChwLnggKyBwLncgLyAyLCBwLnkgKyBwLmggLyAyLCA1MCwgcC54ICsgcC53IC8gMiwgcC55ICsgcC5oIC8gMiwgYmxvY2suc1JhZGl1cyk7DQogICAgICAgICAgICAgICAgICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDEsICdibGFjaycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLCByZWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGdyZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2suZlJhZGl1cyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHBsYXllcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBncmQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQocC54ICsgcC53IC8gMiwgcC55ICsgcC5oIC8gMiwgNTAsIHAueCArIHAudyAvIDIsIHAueSArIHAuaCAvIDIsIGJsb2NrLmZSYWRpdXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgxLCByZWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLCAncmdiKDAsMCwwLDApJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZ3JkOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdChibG9jay54LCBibG9jay55LCBibG9jay53LCBibG9jay5oKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJsb2NrLnR5cGUgPT0gJ3RleHQnKSB7DQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnYmxhY2snOw0KICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2suaVJhZGl1cyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHBsYXllcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBncmQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQocC54ICsgcC53IC8gMiwgcC55ICsgcC5oIC8gMiwgNTAsIHAueCArIHAudyAvIDIsIHAueSArIHAuaCAvIDIsIGJsb2NrLmlSYWRpdXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLCAnYmxhY2snKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMCwwLDAsMCknKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrLmZSYWRpdXMgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBwbGF5ZXI7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ3JkID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KHAueCArIHAudyAvIDIsIHAueSArIHAuaCAvIDIsIDUwLCBwLnggKyBwLncgLyAyLCBwLnkgKyBwLmggLyAyLCBibG9jay5mUmFkaXVzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMSwgJ2JsYWNrJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAsICdyZ2IoMCwwLDAsMCknKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY3R4LmZvbnQgPSBibG9jay5zaXplICsgJ3B4IEFyaWFsJzsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxUZXh0KGJsb2NrLnRleHQsIGJsb2NrLngsIGJsb2NrLnkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBjdXJyZW50TGV2ZWw6IHt9LA0KICAgICAgICAgICAgbGV2ZWxzOiBbDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4OiAwLCB5OiAwLCBmOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS53b24gJiYgcGxheWVyLnggPiA5NzUgJiYgcGxheWVyLnhtb3ZlID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUubGV2ZWxYID0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmxldmVsWSA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnggPSAtMTA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5yZWZyZXNoTGV2ZWwoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwgYmxvY2tzOiBbeyB4OiAwLCB5OiA3MDAsIHc6IDY1MCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNzUwLCB5OiA3MDAsIHc6IDEwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDY1MCwgeTogNzAwLCB3OiAxMDAsIGg6IDMwMCwgdHlwZTogJ2Jsb2NrJywgZjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLmNoZWNrcG9pbnQxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudyA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53ID0gMTAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLnkgPiA5NTApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnkgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIueCA9IDkwMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5sZXZlbFggPSAtNDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5sZXZlbFkgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnRocm91Z2hjaGVja3BvaW50MSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucmVmcmVzaExldmVsKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCB7IHg6IDg1MCwgeTogODUwLCB3OiAxNTAsIGg6IDE1MCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDUwMCwgeTogMjAwLCB0ZXh0OiAnT3Bwb3NpdGUgRGF5Jywgc2l6ZTogMTAwLCB0eXBlOiAndGV4dCcsIGNvbGxpZGU6IGZhbHNlIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDUwMCwgeTogNDAwLCB0ZXh0OiAnJywgc2l6ZTogNTAsIHR5cGU6ICd0ZXh0JywgY29sbGlkZTogZmFsc2UsIGY6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHQgPSAnR28gdGhpcyB3YXkgdG8gd2luJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS53b24pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXh0ID0gIk5vIGJvbnVzIGxldmVscyINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sIHsgeDogNTAwLCB5OiA0NTAsIHRleHQ6ICctLS0tLS0tLS0tPicsIHNpemU6IDUwLCB0eXBlOiAndGV4dCcsIGNvbGxpZGU6IGZhbHNlIH0sIHsgeDogMCwgeTogNjAwLCB3OiAxMDAsIGg6IDEwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7DQogICAgICAgICAgICAgICAgICAgICAgICB4OiA3MDAsIHk6IDY1MCwgdHlwZTogJ3RleHQnLCBjb2xsaWRlOiBmYWxzZSwgc2l6ZTogMjUsIHRleHQ6ICcnLCBmOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUuY2hlY2twb2ludDEgJiYgIWdhbWUudGhyb3VnaGNoZWNrcG9pbnQxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9ICJXaGF0J3MgaW4gaGVyZT8iOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9ICcnOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfV0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsgeDogMSwgeTogMCwgYmxvY2tzOiBbeyB4OiAwLCB5OiA5MDAsIHc6IDEwMDAsIGg6IDEwMCwgdHlwZTogJ2xhdmEnIH0sIHsgeDogNTAwLCB5OiAyMDAsIHRleHQ6ICJJdCdzIE9wcG9zaXRlIERheSIsIHNpemU6IDEwMCwgdHlwZTogJ3RleHQnLCBjb2xsaWRlOiBmYWxzZSB9LCB7IHg6IDUwMCwgeTogNDAwLCB0ZXh0OiAnV2hhdCBkaWQgeW91IGV4cGVjdD8nLCBzaXplOiA1MCwgdHlwZTogJ3RleHQnLCBjb2xsaWRlOiBmYWxzZSB9XSB9LA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeDogLTEsIHk6IDAsIGJsb2NrczogW3sgeDogNTAwLCB5OiAyMDAsIHR5cGU6ICd0ZXh0JywgdGV4dDogIllvdSBtdXN0IHRoaW5rIHlvdSdyZSBzbyBzbWFydC4iLCBzaXplOiA1MCwgY29sbGlkZTogZmFsc2UgfSwgeyB4OiAyNTAsIHk6IDgwMCwgdHlwZTogJ3RleHQnLCB0ZXh0OiAnbG9sJywgc2l6ZTogNDAsIGNvbGxpZGU6IGZhbHNlIH0sIHsgeDogNzAwLCB5OiA2MDAsIHc6IDQwMCwgaDogNDAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMTAwLCB5OiA5MDAsIHc6IDYwMCwgaDogMTAwLCB0eXBlOiAnbGF2YScgfSwgeyB4OiAwLCB5OiA2MDAsIHc6IDIwMCwgaDogNDAwLCB0eXBlOiAnYmxvY2snIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDIwMCwgeTogNjAwLCB3OiAxMDAsIGg6IDQwMCwgdHlwZTogJ2Jsb2NrJywgZjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIueSA+IDYwMCAmJiAhdGhpcy5sKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIueCA8IDUwMCAmJiAhdGhpcy5kKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53ID0gMjAwICogTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgKHBsYXllci54IC0gMzAwKSAvIDEwMCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudyA9IDIwMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDUwMCwgeTogNzAwLCB3OiAyMDAsIGg6IDUwLCB0eXBlOiAnYmxvY2snLCBjb2xsaWRlOiB0cnVlLCBmOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci54IDwgNTAwICYmICF0aGlzLmQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci55ID4gNjAwICYmICF0aGlzLmwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci55ID09IDY2MCAmJiAhdGhpcy5sKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLncgPSA0MDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueCA9IDMwMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIChwbGF5ZXIueSAtIDYwMCkgLyA4MCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLncgPSA0MDAgKiBuOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnggPSA3MDAgLSA0MDAgKiBuOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudyA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueCA9IDcwMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH1dDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHg6IC0yLCB5OiAwLCBibG9ja3M6IFt7IHg6IDUwMCwgeTogMTAwLCBzaXplOiA1MCwgdGV4dDogJ0p1bXAhJywgY29sbGlkZTogZmFsc2UsIHR5cGU6ICd0ZXh0JyB9LCB7IHg6IDcwMCwgeTogNjAwLCB3OiAzMDAsIGg6IDQwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDY1MCwgdzogNTAwLCBoOiA0OSwgdHlwZTogJ2xhdmEnIH0sIHsgeDogMCwgeTogNjk5LCB3OiA1MDAsIGg6IDEsIHR5cGU6ICdsYXZhJywgY29sbGlkZTogZmFsc2UgfSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgeDogMCwgeTogMzUwLCB3OiAxNDAsIGg6IDM1MCwgdHlwZTogJ2Jsb2NrJywgZjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gTWF0aC5tYXgoMCwgMjYwIC0gcGxheWVyLngpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIueSA+IDY1MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oID0gMzUwICsgbjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnkgPSAzNTAgLSBuOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCB7IHg6IDMwMCwgeTogNDUwLCB3OiA4MCwgaDogMjUwLCB0eXBlOiAnYmxvY2snIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDU0MCwgeTogNjUwLCB3OiAxNjAsIGg6IDUwLCB0eXBlOiAnbGF2YScsIGNvbGxpZGU6IGZhbHNlLCBmOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci54ID4gNTAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudyA9IDE2MCAqICgxIC0gTWF0aC5tYXgoMCwgcGxheWVyLnkgLSA1NjApIC8gMTAwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sIHsgeDogMCwgeTogODAwLCB3OiA4MDAsIGg6IDIwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7DQogICAgICAgICAgICAgICAgICAgICAgICB4OiAwLCB5OiA3MDAsIHc6IDgwMCwgaDogMTAwLCB0eXBlOiAnYmxvY2snLCBjb2xsaWRlOiBmYWxzZSwgZjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudyA9IDgwMCAqICgxIC0gTWF0aC5tYXgoMCwgcGxheWVyLnkgLSA2MDApIC8gMTAwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwgeyB4OiA1MDAsIHk6IDU1MCwgdzogODAsIGg6IDE1MCwgdHlwZTogJ2Jsb2NrJyB9XQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4OiAtMywgeTogMCwgYmxvY2tzOiBbeyB4OiA1MDAsIHk6IDEwMCwgc2l6ZTogNTAsIHRleHQ6ICdUaGUgcGF0aCBpcyBvYnZpb3VzOicsIGNvbGxpZGU6IGZhbHNlLCB0eXBlOiAndGV4dCcgfSwgeyB4OiAwLCB5OiA5NTAsIHc6IDEwMDAsIGg6IDUwLCB0eXBlOiAnbGF2YScgfSwgeyB4OiAwLCB5OiA0MDAsIHc6IDUwLCBoOiA2MDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA4MDAsIHk6IDgwMCwgdzogMjAwLCBoOiAyMDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA1NTAsIHk6IDc1MCwgdzogODAsIGg6IDIwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMzAwLCB5OiA2NTAsIHc6IDgwLCBoOiAyMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDI5MCwgeTogNjMwLCB3OiAxMCwgaDogNDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA0MDAsIHk6IDU1MCwgdzogODAsIGg6IDIwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMCwgeTogNDUwLCB3OiAzMDAsIGg6IDIwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNDYwLCB5OiAzODAsIHc6IDgwLCBoOiAyMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDU2MCwgeTogMjgwLCB3OiA4MCwgaDogMjAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA2MDAsIHk6IDE4MCwgdzogNDAsIGg6IDEyMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDYwMCwgeTogMTgwLCB3OiAzNDAsIGg6IDIwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogOTAwLCB5OiAxMDAsIHc6IDQwLCBoOiA4MCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDk0MCwgeTogMCwgdzogNDAsIGg6IDEyMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDk2MCwgeTogMzAwLCB3OiA0MCwgaDogNDAwLCB0eXBlOiAnYmxvY2snIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDAsIHk6IDEwMDAsIHc6IDgwMCwgaDogOTAsIHR5cGU6ICdibG9jaycsIGY6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnkgPSBNYXRoLm1heCgyNjAwIC0gcGxheWVyLnkgKiAyLCA5MTApDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDMyMCwgeTogOTAwLCBzaXplOiA0MCwgdGV4dDogIlRoZSBzdGFrZXMgYXJlbid0IHRoYXQgaGlnaC4uLiIsIHR5cGU6ICd0ZXh0JywgZjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueSA9IE1hdGgubWF4KDI1ODAgLSBwbGF5ZXIueSAqIDIsIDkwMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfV0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsgeDogLTMsIHk6IC0xLCBibG9ja3M6IFt7IHg6IDAsIHk6IDAsIHc6IDEwMDAsIGg6IDk2MCwgdHlwZTogJ2xhdmEnIH0sIHsgeDogNTAwLCB5OiA1MDAsIHR5cGU6ICd0ZXh0Jywgc2l6ZTogNTAsIHRleHQ6ICdJIHRob3VnaHQgeW91IHdvdWxkIGtub3cgYmV0dGVyIGJ5IG5vdy4nIH1dIH0sDQogICAgICAgICAgICAgICAgeyB4OiAtNCwgeTogMCwgYmxvY2tzOiBbeyB4OiA1MDAsIHk6IDEwMCwgc2l6ZTogNTAsIHRleHQ6ICJEb24ndCB3b3JyeSwgdGhpcyBsZXZlbCdzIGVhc3kuIiwgY29sbGlkZTogZmFsc2UsIHR5cGU6ICd0ZXh0JyB9LCB7IHg6IDkwMCwgeTogNDUwLCB3OiAxMDAsIGg6IDU1MCwgdHlwZTogJ2xhdmEnIH0sIHsgeDogOTAwLCB5OiA4MDAsIHc6IDIwMCwgaDogMjAwLCB0eXBlOiAnbGF2YScgfSwgeyB4OiA4MDAsIHk6IDQwMCwgdzogMjAwLCBoOiA1MCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDU1MCwgeTogMjUwLCB3OiA1MCwgaDogNzUsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAwLCB5OiA5NTAsIHc6IDEwMDAsIGg6IDUwLCB0eXBlOiAnbGF2YScgfSwgeyB4OiA4MDAsIHk6IDMwMCwgdzogNTAsIGg6IDEwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDg5MCwgeTogNDUwLCB3OiAxMCwgaDogNTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA3NTAsIHk6IDIwMCwgdzogNTAsIGg6IDE1MCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDIwMCwgdzogNjAwLCBoOiA1MCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDAsIHc6IDUwLCBoOiAwLCB0eXBlOiAnbGF2YScsIGY6IGZ1bmN0aW9uICgpIHsgaWYgKHBsYXllci55IDwgMjAwKSB7IHRoaXMuaCA9IE1hdGgubWluKE1hdGgubWF4KDAsICgyNTAgLSBwbGF5ZXIueCkgKiAyKSwgMjAwKSB9IH0gfSwgeyB4OiAxNjAsIHk6IC0xMDAsIHNpemU6IDMwLCB0ZXh0OiAnTm90IHRoYXQgZWFzeScsIHR5cGU6ICd0ZXh0JywgZjogZnVuY3Rpb24gKCkgeyBpZiAocGxheWVyLnkgPCAyMDApIHsgdGhpcy55ID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgKDI1MCAtIHBsYXllci54KSAqIDIpLCAyMDApIC0gMTYwIH0gfSB9LCB7IHg6IDcwMCwgeTogODAwLCB3OiA1MCwgaDogMTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAzNTAsIHk6IDgwMCwgdzogMTAwLCBoOiA1MCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDkwMCwgdzogMjUwLCBoOiA1MCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDI1MCwgdzogNTAsIGg6IDUwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDQ1MCwgeTogNzAwLCB3OiAxMDAsIGg6IDEwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiA1MDAsIHk6IDYwMCwgdzogNTAsIGg6IDEwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiA0NTAsIHk6IDUwMCwgdzogNTAsIGg6IDEwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiAzMDAsIHk6IDQwMCwgdzogNTAsIGg6IDQ1MCwgdHlwZTogJ2xhdmEnLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiA1NTAsIHk6IDI1MCwgdzogNTAsIGg6IDUwMCwgdHlwZTogJ2Jsb2NrJywgaVJhZGl1czogMTUwIH0sIHsgeDogNTUwLCB5OiA3NTAsIHc6IDI0OS45LCBoOiA1MCwgdHlwZTogJ2xhdmEnLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiA3NTAsIHk6IDU1MCwgdzogNTAsIGg6IDIwMCwgdHlwZTogJ2Jsb2NrJywgaVJhZGl1czogMTUwIH0sIHsgeDogNzUwLCB5OiA1MDAsIHc6IDc1LCBoOiA1MCwgdHlwZTogJ2Jsb2NrJywgaVJhZGl1czogMTMwIH0sIHsgeDogNDUwLCB5OiA5MDAsIHc6IDI1MCwgaDogNTAsIHR5cGU6ICdibG9jaycsIGlSYWRpdXM6IDE1MCB9LCB7IHg6IDc1MCwgeTogOTAwLCB3OiAxNTAsIGg6IDUwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiAyMDAsIHk6IDM5OS45LCB3OiAyNTAsIGg6IDEwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiA1MCwgeTogNTAwLCB3OiAxMDAsIGg6IDEwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiAxNTAsIHk6IDYwMCwgdzogMTUwLCBoOiAxMCwgdHlwZTogJ2Jsb2NrJywgaVJhZGl1czogMTUwIH0sIHsgeDogNTAsIHk6IDcwMCwgdzogMTAwLCBoOiAxMCwgdHlwZTogJ2Jsb2NrJywgaVJhZGl1czogMTUwIH0sIHsgeDogMTUwLCB5OiA4MDAsIHc6IDE1MCwgaDogMTAsIHR5cGU6ICdibG9jaycsIGlSYWRpdXM6IDE1MCB9LCB7IHg6IDY3MCwgeTogNzMwLCBzaXplOiAzMCwgdGV4dDogJzpQJywgdHlwZTogJ3RleHQnLCBpUmFkaXVzOiAxMzAgfSwgeyB4OiA2NzAsIHk6IDQ1MCwgc2l6ZTogMzAsIHRleHQ6ICdHbyBsZWZ0JywgdHlwZTogJ3RleHQnLCBpUmFkaXVzOiAxNTAgfV0gfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHg6IC01LCB5OiAwLCBwOiBmYWxzZSwgZjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci54IDwgOTAwICYmIHBsYXllci55ID4gODUwICYmICFnYW1lLnBsYXllckRlYWQgJiYgdGhpcy5wID09PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucCA9IDE7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci54IDwgOTAwICYmIHRoaXMucCAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAgPSBNYXRoLm1heCgoODAwIC0gcGxheWVyLngpIC8gMS41LCB0aGlzLnApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCBibG9ja3M6IFt7IHg6IDkwMCwgeTogOTAwLCB3OiAxMDAsIGg6IDEwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDkxMCwgdzogODAwLCBoOiA5MCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDg5MCwgeTogNzkwLCB3OiAxMCwgaDogMjEwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogODAwLCB5OiA2NTAsIHc6IDEwLCBoOiAyMDAsIHR5cGU6ICdibG9jaycgfSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgeDogMCwgeTogMCwgdzogMTAwMCwgaDogMCwgdHlwZTogJ2xhdmEnLCBmOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUuY3VycmVudExldmVsLnAgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaCA9IGdhbWUuY3VycmVudExldmVsLnAgKiAyIC0gMTUwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmggPSBNYXRoLm1pbig5MDAsIHRoaXMuaCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaCA9IE1hdGgubWluKHBsYXllci55LCB0aGlzLmgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgeDogLTUwMCwgeTogMTAwLCB0ZXh0OiAnUlVOISEhJywgc2l6ZTogMTAwLCB0eXBlOiAndGV4dCcsIGY6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS5jdXJyZW50TGV2ZWwucCAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy54ID0gZ2FtZS5jdXJyZW50TGV2ZWwucCAqIDIwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnggPSBNYXRoLm1pbig1MDAsIHRoaXMueCAtIDUwMCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCB7DQogICAgICAgICAgICAgICAgICAgICAgICB4OiA4MDAsIHk6IDkxMCwgdzogOTAsIGg6IDEwMCwgdHlwZTogJ2Jsb2NrJywgbDogZmFsc2UsIGY6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLnggPCA3MDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUuY3VycmVudExldmVsLnAgIT09IGZhbHNlICYmICF0aGlzLmwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55ID0gOTEwICsgTWF0aC5tYXgoMCwgZ2FtZS5jdXJyZW50TGV2ZWwucCAqIDIgLSA5MDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfV0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeDogLTUsIHk6IDEsIGY6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIueSA+IDg1MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuc3dpdGNoS2V5cyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sIGJsb2NrczogW3sgeDogNDAwLCB5OiA3MCwgdHlwZTogJ3RleHQnLCB0ZXh0OiAnTm8gdHJpY2tzIGhlcmUgOyknLCBzaXplOiA1MCB9LCB7IHg6IDc5MCwgeTogMCwgdzogMTAsIGg6IDgwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDkwMCwgeTogMCwgdzogMTAwLCBoOiA5MDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAwLCB5OiA5MDAsIHc6IDEwMDAsIGg6IDEwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDMwMCwgdzogMTAwLCBoOiA2MDAsIHR5cGU6ICdsYXZhJyB9LCB7IHg6IDcwMCwgeTogODAwLCB3OiAxMDAsIGg6IDEwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNTAwLCB5OiA3MDAsIHc6IDEwMCwgaDogMTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAxMDAsIHk6IDY1MCwgdzogMjAwLCBoOiAxMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDQ1MCwgeTogNTUwLCB3OiAxMDAsIGg6IDEwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNzAwLCB5OiA1MDAsIHc6IDQwLCBoOiAxMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDUwMCwgeTogNDAwLCB3OiAxMDAsIGg6IDEwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMjAwLCB5OiAzMDAsIHc6IDEwMCwgaDogMTAsIHR5cGU6ICdibG9jaycgfV0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeDogLTYsIHk6IDEsIGY6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUud29uID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfSwgYmxvY2tzOiBbeyB4OiAwLCB5OiA5MDAsIHc6IDEwMDAsIGg6IDEwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDEwMTksIHk6IDAsIHc6IDEwLCBoOiAxMDAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNTAwLCB5OiAxNTAsIHR5cGU6ICd0ZXh0Jywgc2l6ZTogMTAwLCB0ZXh0OiAnWW91IExvc2UhJyB9LCB7IHg6IDUwMCwgeTogMjUwLCB0eXBlOiAndGV4dCcsIHNpemU6IDYwLCB0ZXh0OiAnQ29uZ3JhdHVsYXRpb25zIScgfSwgeyB4OiA1MDAsIHk6IDUwMCwgdHlwZTogJ3RleHQnLCBzaXplOiA1MCwgdGV4dDogIkkgaG9wZSB5b3UgZGlkbid0IGxpa2UgdGhpcyBnYW1lLiIgfSwgeyB4OiA1MDAsIHk6IDgwMCwgdHlwZTogJ3RleHQnLCBzaXplOiA1MCwgdGV4dDogJ05vdCBieSBKb2huIEJ1dGxlci4nIH0sIHsgeDogMCwgeTogMCwgdzogMTAsIGg6IDkwMCwgdHlwZTogJ2xhdmEnIH1dDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHg6IDIsIHk6IDAsIGY6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIueCA8IC0xNSAmJiBwbGF5ZXIueG1vdmUgPCAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnggPSA5Nzk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5sZXZlbFggPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucmVmcmVzaExldmVsKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sIGJsb2NrczogW3sgeDogMCwgeTogODUwLCB3OiA1MDAsIGg6IDE1MCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDUwMCwgeTogODAwLCB3OiA1MDAsIGg6IDIwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDUwMCwgeTogMjAwLCBzaXplOiAxMDAsIHRleHQ6ICdUaGUgTGFuZCBPZiBJbGx1c2lvbicsIHR5cGU6ICd0ZXh0JyB9LCB7IHg6IDUwMCwgeTogNDAwLCB0ZXh0OiAnKE5vdCBib251cyBsZXZlbHMpJywgc2l6ZTogNTAsIHR5cGU6ICd0ZXh0JyB9XQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4OiAzLCB5OiAwLCBmOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLnggPiA4MDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmxldmVsWCA9IDQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5yZWZyZXNoTGV2ZWwoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwgYmxvY2tzOiBbeyB4OiAwLCB5OiA4MDAsIHc6IDk1MCwgaDogMjAwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiAzMDAsIHk6IDc1MCwgc2l6ZTogNTAsIHRleHQ6ICdZb3VyIENob2ljZTonLCB0eXBlOiAndGV4dCcsIGlSYWRpdXM6IDE1MCB9LCB7IHg6IDQ1MCwgeTogNzUwLCB3OiA1MDAsIGg6IDUwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiA1NTAsIHk6IDY1MCwgdzogNDAwLCBoOiA1MCwgdHlwZTogJ2Jsb2NrJywgaVJhZGl1czogMTUwIH0sIHsgeDogNjAwLCB5OiA1NTAsIHc6IDM1MCwgaDogNTAsIHR5cGU6ICdibG9jaycsIGlSYWRpdXM6IDE1MCB9LCB7IHg6IDYwMCwgeTogMCwgdzogMzUwLCBoOiA1MDAsIHR5cGU6ICdibG9jaycsIGlSYWRpdXM6IDE1MCB9LCB7IHg6IDk1MCwgeTogMCwgdzogNTAsIGg6IDEwMDAsIHR5cGU6ICdibG9jaycsIGlSYWRpdXM6IDE1MCB9XQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4OiA0LCB5OiAwLCBmOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLnggPCAyMDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmxldmVsWCA9IDU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5yZWZyZXNoTGV2ZWwoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwgYmxvY2tzOiBbeyB4OiA1MCwgeTogODAwLCB3OiA5MDAsIGg6IDIwMCwgdHlwZTogJ2Jsb2NrJywgaVJhZGl1czogMTUwIH0sIHsgeDogNTAsIHk6IDc1MCwgdzogOTAwLCBoOiA1MCwgdHlwZTogJ2Jsb2NrJywgaVJhZGl1czogMTUwIH0sIHsgeDogNTAsIHk6IDY1MCwgdzogOTAwLCBoOiA1MCwgdHlwZTogJ2Jsb2NrJywgaVJhZGl1czogMTUwIH0sIHsgeDogNTAsIHk6IDU1MCwgdzogOTAwLCBoOiA1MCwgdHlwZTogJ2Jsb2NrJywgaVJhZGl1czogMTUwIH0sIHsgeDogNTAsIHk6IDAsIHc6IDkwMCwgaDogNTAwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiA5NTAsIHk6IDAsIHc6IDUwLCBoOiAxMDAwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiAwLCB5OiAwLCB3OiA1MCwgaDogMTAwMCwgdHlwZTogJ2Jsb2NrJywgaVJhZGl1czogMTUwIH1dDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7IHg6IDUsIHk6IDAsIGJsb2NrczogW3sgeDogMCwgeTogMCwgdzogNTAsIGg6IDEwMDAsIHR5cGU6ICdibG9jaycsIGlSYWRpdXM6IDE1MCB9LCB7IHg6IDUwLCB5OiA4MDAsIHc6IDk1MCwgaDogMjAwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiA1MCwgeTogNzUwLCB3OiA1MDAsIGg6IDUwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiA1MCwgeTogNjUwLCB3OiA1MDAsIGg6IDUwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiA1MCwgeTogNTUwLCB3OiA1MDAsIGg6IDUwLCB0eXBlOiAnYmxvY2snLCBpUmFkaXVzOiAxNTAgfSwgeyB4OiA1MCwgeTogMCwgdzogNTAwLCBoOiA1MDAsIHR5cGU6ICdibG9jaycsIGlSYWRpdXM6IDE1MCB9LCB7IHg6IDgwMCwgeTogNzAwLCBzaXplOiA1MCwgdGV4dDogJ0FuZCB0aGlzIGlzIGp1c3QnLCB0eXBlOiAndGV4dCcsIGlSYWRpdXM6IDE1MCB9LCB7IHg6IDgwMCwgeTogNzUwLCBzaXplOiA1MCwgdGV4dDogJ3RoZSBiZWdpbm5pbmcuLi4nLCB0eXBlOiAndGV4dCcsIGlSYWRpdXM6IDE1MCB9XSB9LA0KICAgICAgICAgICAgICAgIHsgeDogNiwgeTogMCwgYmxvY2tzOiBbeyB4OiA1MDAsIHk6IDIwMCwgc2l6ZTogNTAsIHR5cGU6ICd0ZXh0JywgdGV4dDogJ0JlaG9sZCwgdGhlIG1vdW50YWluJyB9LCB7IHg6IDUwMCwgeTogMjUwLCBzaXplOiA1MCwgdHlwZTogJ3RleHQnLCB0ZXh0OiAnb2YgcGVyc2lzdGVuY2U6JyB9LCB7IHg6IDAsIHk6IDgwMCwgdzogMTAwMCwgaDogMjAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogOTAwLCB5OiA3MDAsIHc6IDEwMCwgaDogMTAwLCB0eXBlOiAnYmxvY2snIH1dIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4OiA3LCB5OiAwLCBmOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLnggPCAtMTUgJiYgcGxheWVyLnhtb3ZlIDwgMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUubGV2ZWxYID0gODsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmxldmVsWSA9IDI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnggPSA5NzA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5yZWZyZXNoTGV2ZWwoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwgYmxvY2tzOiBbeyB4OiAwLCB5OiA3MDAsIHc6IDEwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMTAwLCB5OiA2MDAsIHc6IDEwMCwgaDogNDAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMjAwLCB5OiA1MDAsIHc6IDEwMCwgaDogNTAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMzAwLCB5OiA0MDAsIHc6IDEwMCwgaDogNjAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNDAwLCB5OiAzMDAsIHc6IDEwMCwgaDogNzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNTAwLCB5OiAyMDAsIHc6IDEwMCwgaDogODAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNjAwLCB5OiAxMDAsIHc6IDEwMCwgaDogOTAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNzAwLCB5OiAwLCB3OiAzMDAsIGg6IDEwMDAsIHR5cGU6ICdibG9jaycgfV0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeDogNywgeTogLTEsIGY6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIueCA+IDk3MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUubGV2ZWxZID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIueCA9IC0xOTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnJlZnJlc2hMZXZlbCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCBibG9ja3M6IFt7IHg6IDcwMCwgeTogOTk4LCB3OiAxMDAsIGg6IDIsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA4MDAsIHk6IDkwMCwgdzogMTAwLCBoOiAxMDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA5MDAsIHk6IDgwMCwgdzogMTAwLCBoOiAyMDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA5OTgsIHk6IDcwMCwgdzogMiwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH1dDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHg6IDgsIHk6IDIsIGY6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIueCA+IDk3NSAmJiBwbGF5ZXIueG1vdmUgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnggPSAtMTk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5sZXZlbFggPSA3Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUubGV2ZWxZID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnJlZnJlc2hMZXZlbCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCBibG9ja3M6IFt7IHg6IDAsIHk6IDcwMCwgdzogMTAwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNTAwLCB5OiAyMDAsIHNpemU6IDUwLCB0eXBlOiAndGV4dCcsIHRleHQ6ICdIb3cgbG9uZyB3ZXJlIHlvdSBnb2luZyB0byBjbGltYj8nIH1dDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHg6IDcsIHk6IDIsIGJsb2NrczogW3sgeDogMCwgeTogNzAwLCB3OiA0MDAsIGg6IDMwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDYwMCwgeTogNzAwLCB3OiA0MDAsIGg6IDMwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDUwMCwgeTogMjAwLCBzaXplOiA1MCwgdHlwZTogJ3RleHQnLCB0ZXh0OiAnMiB0cnV0aHMgYW5kIGEgbGllOicgfSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgeDogMCwgeTogMCwgdzogNTAsIGg6IDAsIHR5cGU6ICdsYXZhJywgZjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaCA9IE1hdGgubWluKDcwMCwgKDE1MCAtIHBsYXllci54KSAqIDEwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgeDogMTIwLCB5OiAwLCBzaXplOiA1MCwgdGV4dDogJ05vLicsIHR5cGU6ICd0ZXh0JywgZjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueSA9IE1hdGgubWluKDcwMCwgKDE1MCAtIHBsYXllci54KSAqIDEwKSAtIDMwMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfV0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsgeDogNywgeTogMywgYmxvY2tzOiBbeyB4OiAwLCB5OiAwLCB3OiA0MDAsIGg6IDMwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDYwMCwgeTogMCwgdzogNDAwLCBoOiAzMDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA0MDAsIHk6IDUwMCwgdzogMjAwLCBoOiAxMDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAwLCB5OiAzMDAsIHc6IDUwLCBoOiAzNTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAwLCB5OiA2NTAsIHc6IDQ1MCwgaDogNTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA5NTAsIHk6IDMwMCwgdzogNTAsIGg6IDM1MCwgdHlwZTogJ2xhdmEnIH0sIHsgeDogNTUwLCB5OiA2NTAsIHc6IDQ1MCwgaDogNTAsIHR5cGU6ICdsYXZhJyB9LCB7IHg6IDAsIHk6IDcwMCwgdzogNDAwLCBoOiAzMDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA2MDAsIHk6IDcwMCwgdzogNDAwLCBoOiAzMDAsIHR5cGU6ICdibG9jaycgfV0gfSwNCiAgICAgICAgICAgICAgICB7IHg6IDcsIHk6IDQsIGJsb2NrczogW3sgeDogMCwgeTogMCwgdzogNDAwLCBoOiAzMDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA2MDAsIHk6IDAsIHc6IDQwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNDAwLCB5OiA1MDAsIHc6IDIwMCwgaDogMTAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMCwgeTogMzAwLCB3OiA1MCwgaDogMzUwLCB0eXBlOiAnbGF2YScgfSwgeyB4OiAwLCB5OiA2NTAsIHc6IDQ1MCwgaDogNTAsIHR5cGU6ICdsYXZhJyB9LCB7IHg6IDk1MCwgeTogMzAwLCB3OiA1MCwgaDogMzUwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNTUwLCB5OiA2NTAsIHc6IDQ1MCwgaDogNTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAwLCB5OiA3MDAsIHc6IDQwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNjAwLCB5OiA3MDAsIHc6IDQwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH1dIH0sDQogICAgICAgICAgICAgICAgeyB4OiA3LCB5OiA1LCBibG9ja3M6IFt7IHg6IDAsIHk6IDAsIHc6IDQwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNjAwLCB5OiAwLCB3OiA0MDAsIGg6IDMwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDQwMCwgeTogNTAwLCB3OiAyMDAsIGg6IDEwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDMwMCwgdzogNTAsIGg6IDM1MCwgdHlwZTogJ2xhdmEnLCBzUmFkaXVzOiAxMDAgfSwgeyB4OiAwLCB5OiA2NTAsIHc6IDQ1MCwgaDogNTAsIHR5cGU6ICdsYXZhJywgc1JhZGl1czogMTAwIH0sIHsgeDogOTUwLCB5OiAzMDAsIHc6IDUwLCBoOiAzNTAsIHR5cGU6ICdibG9jaycsIHNSYWRpdXM6IDEwMCB9LCB7IHg6IDU1MCwgeTogNjUwLCB3OiA0NTAsIGg6IDUwLCB0eXBlOiAnYmxvY2snLCBzUmFkaXVzOiAxMDAgfSwgeyB4OiAwLCB5OiA3MDAsIHc6IDQwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNjAwLCB5OiA3MDAsIHc6IDQwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH1dIH0sDQogICAgICAgICAgICAgICAgeyB4OiA3LCB5OiA2LCBibG9ja3M6IFt7IHg6IDAsIHk6IDcwMCwgdzogMTAwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMCwgeTogMCwgdzogNTAsIGg6IDcwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDgwMCwgeTogMCwgdzogMjAwLCBoOiA1MDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA0MDAsIHk6IDYwMCwgc2l6ZTogNTAsIHR5cGU6ICd0ZXh0JywgdGV4dDogJ1RoZSBDYXZlcyBvZiBEZWNlcHRpb246JyB9LCB7IHg6IDgwMCwgeTogNTAwLCB3OiAyMDAsIGg6IDIwMCwgdHlwZTogJ2Jsb2NrJywgZlJhZGl1czogMTUwLCBjb2xsaWRlOiBmYWxzZSB9XSB9LA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgeDogOCwgeTogNiwgZjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci54ID4gODAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5sZXZlbFggPSA5Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucmVmcmVzaExldmVsKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sIGJsb2NrczogW3sgeDogMCwgeTogMCwgdzogMTAwMCwgaDogMTAwMCwgdHlwZTogJ2Jsb2NrJywgY29sbGlkZTogZmFsc2UsIGZSYWRpdXM6IDE1MCB9LCB7IHg6IDAsIHk6IDcwMCwgdzogMTAwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMCwgeTogMzAwLCB3OiAxMDAwLCBoOiAyMDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA5NTAsIHk6IDUwMCwgdzogNTAsIGg6IDIwMCwgdHlwZTogJ2Jsb2NrJyB9XQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4OiA5LCB5OiA2LCBmOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLnggPCAyMDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmxldmVsWCA9IDEwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucmVmcmVzaExldmVsKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sIGJsb2NrczogW3sgeDogMCwgeTogMCwgdzogMTAwMCwgaDogMTAwMCwgdHlwZTogJ2Jsb2NrJywgY29sbGlkZTogZmFsc2UsIGZSYWRpdXM6IDE1MCB9LCB7IHg6IDAsIHk6IDcwMCwgdzogMTAwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMCwgeTogMzAwLCB3OiAxMDAwLCBoOiAyMDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA5NTAsIHk6IDUwMCwgdzogNTAsIGg6IDIwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDUwMCwgdzogNTAsIGg6IDIwMCwgdHlwZTogJ2Jsb2NrJyB9XQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4OiAxMCwgeTogNiwgZjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci54ID4gODAwICYmIHBsYXllci55IDwgNTAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5sZXZlbFggPSAxMTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnJlZnJlc2hMZXZlbCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCBibG9ja3M6IFt7IHg6IDAsIHk6IDAsIHc6IDEwMDAsIGg6IDEwMDAsIHR5cGU6ICdibG9jaycsIGNvbGxpZGU6IGZhbHNlLCBmUmFkaXVzOiAxNTAgfSwgeyB4OiAwLCB5OiA3MDAsIHc6IDEwMDAsIGg6IDMwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDMwMCwgdzogNDAwLCBoOiAyMDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA5NTAsIHk6IDAsIHc6IDUwLCBoOiA3MDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAwLCB5OiA1MDAsIHc6IDUwLCBoOiAyMDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA0NTAsIHk6IDYwMCwgdzogMTAwLCBoOiAxMDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA1NTAsIHk6IDUwMCwgdzogNTAwLCBoOiAxMCwgdHlwZTogJ2Jsb2NrJyB9XQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4OiAxMSwgeTogNiwgZjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci54ID4gNTAwICYmIHBsYXllci55IDwgMTAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5sZXZlbFggPSAxMjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnJlZnJlc2hMZXZlbCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCBibG9ja3M6IFt7IHg6IDAsIHk6IDAsIHc6IDEwMDAsIGg6IDEwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMCwgeTogMCwgdzogMTAwMCwgaDogMTAwMCwgdHlwZTogJ2Jsb2NrJywgY29sbGlkZTogZmFsc2UsIGZSYWRpdXM6IDE1MCB9LCB7IHg6IDAsIHk6IDcwMCwgdzogMTAwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogOTUwLCB5OiAwLCB3OiA1MCwgaDogNzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMCwgeTogMCwgdzogNTAsIGg6IDcwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDUwMCwgdzogMTAwMCwgaDogMTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAyMDAsIHk6IDEwMCwgdzogNTAsIGg6IDMwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDUwLCB5OiA0MDAsIHc6IDUwLCBoOiAxMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDE1MCwgeTogMzAwLCB3OiA1MCwgaDogMTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA1MCwgeTogMjAwLCB3OiA1MCwgaDogMTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAxNTAsIHk6IDEwMCwgdzogNzAwLCBoOiAxMCwgdHlwZTogJ2Jsb2NrJyB9XQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB4OiAxMiwgeTogNiwgZjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci54ID4gMjM1ICYmIHBsYXllci54IDwgNDAwICYmIHBsYXllci55IDwgMzAwICYmIHBsYXllci55ID4gMTAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5sZXZlbFggPSAxMzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnJlZnJlc2hMZXZlbCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LCBibG9ja3M6IFt7IHg6IDAsIHk6IDAsIHc6IDEwMDAsIGg6IDEwMDAsIHR5cGU6ICdibG9jaycsIGNvbGxpZGU6IGZhbHNlLCBmUmFkaXVzOiAxNTAgfSwgeyB4OiAwLCB5OiAwLCB3OiAxMCwgaDogMTAwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDEwMCwgdzogOTAwLCBoOiAxMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDkwMCwgeTogMTAwLCB3OiAxMCwgaDogODAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogOTkwLCB5OiAwLCB3OiAxMCwgaDogMTAwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDk5MCwgdzogMTAwMCwgaDogMTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAwLCB5OiAwLCB3OiAxMDAwLCBoOiAxMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDEwMCwgeTogOTAwLCB3OiA4MTAsIGg6IDEwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMCwgeTogODAwLCB3OiA4MTAsIGg6IDEwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMTAwLCB5OiA3MDAsIHc6IDgxMCwgaDogMTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAwLCB5OiA2MDAsIHc6IDgxMCwgaDogMTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiAxMDAsIHk6IDUwMCwgdzogODEwLCBoOiAxMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDQwMCwgdzogODEwLCBoOiAxMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDEwMCwgeTogMzAwLCB3OiA4MTAsIGg6IDEwLCB0eXBlOiAnYmxvY2snIH1dDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7IHg6IDEzLCB5OiA2LCBibG9ja3M6IFt7IHg6IDAsIHk6IDAsIHc6IDEwMDAsIGg6IDEwMDAsIHR5cGU6ICdibG9jaycsIGNvbGxpZGU6IGZhbHNlLCBmUmFkaXVzOiAxNTAgfSwgeyB4OiAwLCB5OiAzMDAsIHc6IDQwMCwgaDogMTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA2MDAsIHk6IDMwMCwgdzogNDAwLCBoOiAxMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDAsIHc6IDEwLCBoOiAxMDAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMCwgeTogNDAwLCB3OiA0MDAsIGg6IDEwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNjAwLCB5OiA0MDAsIHc6IDQwMCwgaDogMTAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA5OTAsIHk6IDAsIHc6IDEwLCBoOiAxMDAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogNDAwLCB5OiAzMDAsIHc6IDEwLCBoOiA3MDAsIHR5cGU6ICdibG9jaycgfSwgeyB4OiA2MDAsIHk6IDMwMCwgdzogMTAsIGg6IDcwMCwgdHlwZTogJ2Jsb2NrJyB9LCB7IHg6IDAsIHk6IDEwMCwgdzogMTAwMCwgaDogMTAsIHR5cGU6ICdibG9jaycgfV0gfSwNCiAgICAgICAgICAgICAgICB7IHg6IDEzLCB5OiA3LCBibG9ja3M6IFt7IHg6IDAsIHk6IDcwMCwgdzogMTAwMCwgaDogMzAwLCB0eXBlOiAnYmxvY2snIH0sIHsgeDogMCwgeTogMCwgdzogMTAsIGg6IDcwMCwgdHlwZTogJ2xhdmEnIH0sIHsgeDogOTkwLCB5OiAwLCB3OiAxMCwgaDogNzAwLCB0eXBlOiAnbGF2YScgfSwgeyB4OiA1MDAsIHk6IDE1MCwgdHlwZTogJ3RleHQnLCBzaXplOiAxMDAsIHRleHQ6ICdZb3UgTG9zZSEnIH0sIHsgeDogNTAwLCB5OiAyNTAsIHR5cGU6ICd0ZXh0Jywgc2l6ZTogNjAsIHRleHQ6ICdDb25ncmF0dWxhdGlvbnMhJyB9LCB7IHg6IDUwMCwgeTogNTAwLCB0eXBlOiAndGV4dCcsIHNpemU6IDUwLCB0ZXh0OiAiSSBob3BlIHlvdSBoYXRlZCB0aGVzZSBib251cyBsZXZlbHMuIiB9LCB7IHg6IDUwMCwgeTogNjAwLCB0eXBlOiAndGV4dCcsIHNpemU6IDUwLCB0ZXh0OiAnTm90IGJ5IEpvaG4gQnV0bGVyLicgfV0gfQ0KICAgICAgICAgICAgXQ0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIHBsYXllciA9IHsNCiAgICAgICAgICAgIHg6IDAsDQogICAgICAgICAgICB5OiAwLA0KICAgICAgICAgICAgdzogNDAsDQogICAgICAgICAgICBoOiA0MCwNCiAgICAgICAgICAgIHhtb3ZlOiAwLA0KICAgICAgICAgICAgeW1vdmU6IDAsDQogICAgICAgICAgICByZXN0aW5nOiBmYWxzZSwNCiAgICAgICAgICAgIG1vdmVkOiBmYWxzZSwNCiAgICAgICAgICAgIGRpZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllckRlYWQpIHJldHVybjsNCiAgICAgICAgICAgICAgICBnYW1lLnBsYXllckRlYWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGdhbWUucmVzcGF3blRpbWUgPSAxNTA7DQogICAgICAgICAgICAgICAgdmFyIG4gPSAwOw0KICAgICAgICAgICAgICAgIHdoaWxlIChuIDwgMjApIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnRpY2xlID0ge307DQogICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnggPSB0aGlzLnggKyB0aGlzLncgLyAyIC0gNSArIE1hdGgucmFuZG9tKCkgKiAxMCAtIDU7DQogICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnkgPSB0aGlzLnkgKyB0aGlzLmggLyAyIC0gNSArIE1hdGgucmFuZG9tKCkgKiAxMCAtIDU7DQogICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLncgPSAxMDsNCiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUuaCA9IDEwOw0KICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5jb2xvciA9ICdibHVlJzsNCiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUuYWxwaGEgPSAyOw0KICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5kZWNheSA9IDAuMDggLSBNYXRoLnJhbmRvbSgpIC8gMjA7DQogICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnhtb3ZlID0gTWF0aC5yYW5kb20oKSAqIDMwIC0gMTU7DQogICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnltb3ZlID0gTWF0aC5yYW5kb20oKSAqIDMwIC0gMjA7DQogICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlcy5wYXJ0aWNsZXMucHVzaChwYXJ0aWNsZSk7DQogICAgICAgICAgICAgICAgICAgIG4rKzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdmFyIG4gPSAwOw0KICAgICAgICAgICAgICAgIHdoaWxlIChuIDwgMikgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcGFydGljbGUgPSB7fTsNCiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUueCA9IHRoaXMueCArIHRoaXMudyAvIDI7DQogICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnkgPSB0aGlzLnkgKyB0aGlzLmggLyAyOw0KICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5yID0gNTsNCiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUudyA9IDEwOw0KICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5oID0gMTA7DQogICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLmNvbG9yID0gJ2JsYWNrJzsNCiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUuc2hhcGUgPSAnY2lyY2xlJzsNCiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUuYWxwaGEgPSAxNTA7DQogICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLmRlY2F5ID0gMTsNCiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUueG1vdmUgPSBNYXRoLnJhbmRvbSgpICogNy41ICogKG4gKiAyIC0gMSk7DQogICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnltb3ZlID0gTWF0aC5yYW5kb20oKSAqIDE1IC0gMTA7DQogICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlcy5wYXJ0aWNsZXMucHVzaChwYXJ0aWNsZSk7DQogICAgICAgICAgICAgICAgICAgIG4rKzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdmFyIG4gPSAwOw0KICAgICAgICAgICAgICAgIHdoaWxlIChuIDwgZ2FtZS5jdXJyZW50TGV2ZWwuYmxvY2tzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGdhbWUuY3VycmVudExldmVsLmJsb2Nrc1tuXTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGIuY29sbGlkZSAmJiBiLnR5cGUgPT0gJ2xhdmEnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2tzQ29sbGlkaW5nRWRnZSh0aGlzLCBiKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5kaWUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBuKys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vY2hlY2sgZm9yIGxhdmEgY29sbGlzaW9ucw0KDQogICAgICAgICAgICAgICAgdGhpcy55bW92ZSArPSAwLjA4Ow0KICAgICAgICAgICAgICAgIGlmIChLZXlzLmtleXNbMzddIHx8IEtleXMua2V5c1s2NV0pIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUuc3dpdGNoS2V5cykgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy54bW92ZSArPSAwLjE1Ow0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy54bW92ZSAtPSAwLjE1Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoS2V5cy5rZXlzWzM5XSB8fCBLZXlzLmtleXNbNjhdKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLnN3aXRjaEtleXMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueG1vdmUgLT0gMC4xNTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueG1vdmUgKz0gMC4xNTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB1cGRhdGVCbG9jayh0aGlzLCBnYW1lLmN1cnJlbnRMZXZlbC5ibG9ja3MpOw0KICAgICAgICAgICAgICAgIC8vcGh5c2ljcw0KDQogICAgICAgICAgICAgICAgdGhpcy5yZXN0aW5nID0gZmFsc2U7DQogICAgICAgICAgICAgICAgdmFyIG4gPSAwOw0KICAgICAgICAgICAgICAgIHdoaWxlIChuIDwgZ2FtZS5jdXJyZW50TGV2ZWwuYmxvY2tzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGdhbWUuY3VycmVudExldmVsLmJsb2Nrc1tuXTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2Nrc0NvbGxpZGluZ0VkZ2UodGhpcywgYikgJiYgYi5jb2xsaWRlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54ID49IGIueCArIGIudyB8fCB0aGlzLnggKyB0aGlzLncgPD0gYi54KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy54bW92ZSA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy55ICsgdGhpcy5oIDw9IGIueSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBiLnggKyBiLncgJiYgdGhpcy54ICsgdGhpcy53ID4gYi54KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzdGluZyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnggPCBiLnggKyBiLncgJiYgdGhpcy54ICsgdGhpcy53ID4gYi54KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55bW92ZSA9IDEgLyAxMDAwMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBuKys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlc3RpbmcpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy55bW92ZSA9IDA7DQogICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLnN3aXRjaEtleXMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChLZXlzLmtleXNbNDBdIHx8IEtleXMua2V5c1s4M10pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnltb3ZlID0gLTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoS2V5cy5rZXlzWzM4XSB8fCBLZXlzLmtleXNbODddKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55bW92ZSA9IC02Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vY2FsY3VsYXRlIHBsYXllciBtb3ZlDQoNCiAgICAgICAgICAgICAgICB0aGlzLnhtb3ZlICo9IDAuOTY7DQogICAgICAgICAgICAgICAgdGhpcy55bW92ZSAqPSAwLjk4Ow0KICAgICAgICAgICAgICAgIC8vZGFtcGVuDQoNCiAgICAgICAgICAgICAgICBpZiAodGhpcy54IDwgLXRoaXMudyAvIDIpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy54ICs9IDEwMDA7DQogICAgICAgICAgICAgICAgICAgIGdhbWUubGV2ZWxYLS07DQogICAgICAgICAgICAgICAgICAgIGdhbWUucmVmcmVzaExldmVsKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPiAxMDAwIC0gdGhpcy53IC8gMikgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnggLT0gMTAwMDsNCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5sZXZlbFgrKzsNCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5yZWZyZXNoTGV2ZWwoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHRoaXMueSA8IC10aGlzLmggLyAyKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMueSArPSAxMDAwOw0KICAgICAgICAgICAgICAgICAgICBnYW1lLmxldmVsWS0tOw0KICAgICAgICAgICAgICAgICAgICBnYW1lLnJlZnJlc2hMZXZlbCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodGhpcy55ID4gMTAwMCAtIHRoaXMuaCAvIDIpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy55IC09IDEwMDA7DQogICAgICAgICAgICAgICAgICAgIGdhbWUubGV2ZWxZKys7DQogICAgICAgICAgICAgICAgICAgIGdhbWUucmVmcmVzaExldmVsKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vbW92ZSBwbGF5ZXIgdGhyb3VnaCBsZXZlbCB3YWxscw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGRyYXc6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ2JsdWUnOw0KICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdCh0aGlzLngsIHRoaXMueSwgdGhpcy53LCB0aGlzLmgpOw0KICAgICAgICAgICAgICAgIC8vZHJhdyBibG9jaw0KDQogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdibGFjayc7DQogICAgICAgICAgICAgICAgdmFyIGRpciA9IGRpclRvKDAsIDAsIHRoaXMueG1vdmUsIHRoaXMueW1vdmUpOw0KICAgICAgICAgICAgICAgIHZhciBzcGVlZCA9IGRpc3RUbygwLCAwLCB0aGlzLnhtb3ZlLCB0aGlzLnltb3ZlKTsNCiAgICAgICAgICAgICAgICBzcGVlZCA9IE1hdGgubWluKHNwZWVkLCA1KTsNCiAgICAgICAgICAgICAgICB2YXIgbW92ZSA9IGRpc3RUb01vdmUoc3BlZWQsIGRpcik7DQogICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOw0KICAgICAgICAgICAgICAgIGN0eC5hcmMobW92ZS54ICogMS41ICsgdGhpcy54ICsgdGhpcy53IC8gMiAtIDcsIG1vdmUueSAqIDIgKyB0aGlzLnkgKyB0aGlzLmggLyAyIC0gNywgMy43LCAwLCAyICogTWF0aC5QSSk7DQogICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsNCiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7DQogICAgICAgICAgICAgICAgY3R4LmFyYyhtb3ZlLnggKiAxLjUgKyB0aGlzLnggKyB0aGlzLncgLyAyICsgNywgbW92ZS55ICogMiArIHRoaXMueSArIHRoaXMuaCAvIDIgLSA3LCAzLjcsIDAsIDIgKiBNYXRoLlBJKTsNCiAgICAgICAgICAgICAgICBjdHguZmlsbCgpOw0KICAgICAgICAgICAgICAgIC8vZHJhdyBleWVzDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgcGFydGljbGVzID0gew0KICAgICAgICAgICAgcGFydGljbGVzOiBbXSwNCiAgICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciBuID0gMDsNCiAgICAgICAgICAgICAgICB3aGlsZSAobiA8IHRoaXMucGFydGljbGVzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHRoaXMucGFydGljbGVzW25dOw0KICAgICAgICAgICAgICAgICAgICBwLmFuZ2xlICs9IHAudHVybjsNCiAgICAgICAgICAgICAgICAgICAgcC55bW92ZSArPSAwLjA4Ow0KICAgICAgICAgICAgICAgICAgICBwLnhtb3ZlICo9IDAuOTY7DQogICAgICAgICAgICAgICAgICAgIHAueW1vdmUgKj0gMC45ODsNCiAgICAgICAgICAgICAgICAgICAgcC5hbHBoYSAtPSBwLmRlY2F5Ow0KICAgICAgICAgICAgICAgICAgICB1cGRhdGVCbG9jayhwLCBnYW1lLmN1cnJlbnRMZXZlbC5ibG9ja3MpOw0KICAgICAgICAgICAgICAgICAgICBpZiAocC5hbHBoYSA8PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2xlcy5zcGxpY2UobiwgMSk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBuKys7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZHJhdzogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciBuID0gMDsNCiAgICAgICAgICAgICAgICB3aGlsZSAobiA8IHRoaXMucGFydGljbGVzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHRoaXMucGFydGljbGVzW25dOw0KICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gcC5jb2xvcjsNCiAgICAgICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gTWF0aC5taW4ocC5hbHBoYSwgMSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChwLnNoYXBlID09ICdjaXJjbGUnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBjdHguYXJjKHAueCArIHAuciwgcC55ICsgcC5yLCBwLnIsIDAsIDIgKiBNYXRoLlBJKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QocC54LCBwLnksIHAudywgcC5oKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBuKys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiB1cGRhdGVCbG9jayhibG9jaywgc3RhdGljQmxvY2tzKSB7DQogICAgICAgICAgICBibG9jay54ICs9IGJsb2NrLnhtb3ZlOw0KICAgICAgICAgICAgdmFyIG4gPSAwOw0KICAgICAgICAgICAgd2hpbGUgKG4gPCBzdGF0aWNCbG9ja3MubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgdmFyIGIgPSBzdGF0aWNCbG9ja3Nbbl07DQogICAgICAgICAgICAgICAgaWYgKGJsb2Nrc0NvbGxpZGluZyhibG9jaywgYikgJiYgYi5jb2xsaWRlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChibG9jay54ICsgYmxvY2sudyAvIDIgPCBiLnggKyBiLncgLyAyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBibG9jay54ID0gYi54IC0gYmxvY2sudzsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrLnggPSBiLnggKyBiLnc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgbisrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy9yZXNvbHZlIHggY29sbGlzaW9ucw0KDQogICAgICAgICAgICBibG9jay55ICs9IGJsb2NrLnltb3ZlOw0KICAgICAgICAgICAgdmFyIG4gPSAwOw0KICAgICAgICAgICAgd2hpbGUgKG4gPCBzdGF0aWNCbG9ja3MubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgdmFyIGIgPSBzdGF0aWNCbG9ja3Nbbl07DQogICAgICAgICAgICAgICAgaWYgKGJsb2Nrc0NvbGxpZGluZyhibG9jaywgYikgJiYgYi5jb2xsaWRlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChibG9jay55ICsgYmxvY2suaCAvIDIgPCBiLnkgKyBiLmggLyAyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBibG9jay55ID0gYi55IC0gYmxvY2suaDsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrLnkgPSBiLnkgKyBiLmg7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgbisrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy9yZXNvbHZlIHkgY29sbGlzaW9ucw0KICAgICAgICB9DQoNCiAgICAgICAgZ2FtZS5yZXNldCgpOw0KDQogICAgICAgIHZhciB0aW1lciA9IDA7DQogICAgPC9zY3JpcHQ+DQogICAgPHNjcmlwdD4NCiAgICAgICAgLy8gQ29uZmlndXJhdGlvbiBvYmplY3QNCiAgICAgICAgdmFyIGNvbmZpZyA9IHsNCiAgICAgICAgICAgIHlNb3ZlSW5jcmVtZW50OiAwLjA4LA0KICAgICAgICAgICAgeE1vdmVJbmNyZW1lbnQ6IDAuMTUsDQogICAgICAgICAgICB4TW92ZURhbXBpbmc6IDAuOTYsDQogICAgICAgICAgICB5TW92ZURhbXBpbmc6IDAuOTgsDQogICAgICAgICAgICB5TW92ZVJlc3RpbmdKdW1wOiAtNiwNCiAgICAgICAgICAgIGVkZ2VZTW92ZTogMSAvIDEwMDAwLA0KICAgICAgICAgICAgbGV2ZWxXaWR0aDogMTAwMCwNCiAgICAgICAgICAgIGxldmVsSGVpZ2h0OiAxMDAwLA0KICAgICAgICAgICAgbGV2ZWxPZmZzZXQ6IDAuNSwNCiAgICAgICAgICAgIGZhc3REZXNjZW5kTXVsdGlwbGllcjogMCwgLy8gTmV3IGNvbmZpZ3VyYXRpb24gZm9yIGZhc3QgZGVzY2VuZGluZw0KICAgICAgICAgICAgZ3Jhdml0eURpcmVjdGlvbjogMSAvLyAxIGZvciBkb3duLCAtMSBmb3IgdXANCiAgICAgICAgfTsNCg0KICAgICAgICBmdW5jdGlvbiBtb2RpZnlQbGF5ZXJEcmF3KCkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBwbGF5ZXIgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBwbGF5ZXIuZHJhdyA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICAgICAgICAgIHBsYXllci5kcmF3ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYigyNTUsMCwwKSc7DQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdCh0aGlzLngsIHRoaXMueSwgdGhpcy53LCB0aGlzLmgpOw0KDQogICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7DQogICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUodGhpcy54LCB0aGlzLnkpOw0KICAgICAgICAgICAgICAgICAgICBjdHguc2NhbGUodGhpcy53IC8gNDAsIHRoaXMuaCAvIDQwKTsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICJibGFjayI7DQogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbygzNCwgMCk7DQogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oNDAsIDApOw0KICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKDM2LCA3KTsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbyg0MCwgNyk7DQogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oMzYsIDE1KTsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbygzNiwgMTApOw0KICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKDMyLCAxMCk7DQogICAgICAgICAgICAgICAgICAgIGN0eC5jbG9zZVBhdGgoKTsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsNCiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gRHJhdyB0aGUgbGlnaHRuaW5nIHRoaW5nDQoNCiAgICAgICAgICAgICAgICAgICAgLy8gRHJhdyB0aGUgb3JpZ2luYWwgYmxhY2sgZmlsbA0KICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYigwLDAsMCknOw0KICAgICAgICAgICAgICAgICAgICB2YXIgZGlyID0gZGlyVG8oMCwgMCwgdGhpcy54bW92ZSwgdGhpcy55bW92ZSk7DQogICAgICAgICAgICAgICAgICAgIHZhciBzcGVlZCA9IGRpc3RUbygwLCAwLCB0aGlzLnhtb3ZlLCB0aGlzLnltb3ZlKTsNCiAgICAgICAgICAgICAgICAgICAgc3BlZWQgPSBNYXRoLm1pbihzcGVlZCwgNSk7DQogICAgICAgICAgICAgICAgICAgIHZhciBtb3ZlID0gZGlzdFRvTW92ZShzcGVlZCwgZGlyKTsNCg0KICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7DQogICAgICAgICAgICAgICAgICAgIGN0eC5hcmMobW92ZS54ICogMS41ICsgdGhpcy54ICsgdGhpcy53IC8gMiAtIDcsIG1vdmUueSAqIDIgKyB0aGlzLnkgKyB0aGlzLmggLyAyIC0gNywgMy43LCAwLCAyICogTWF0aC5QSSk7DQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7DQogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhtb3ZlLnggKiAxLjUgKyB0aGlzLnggKyB0aGlzLncgLyAyICsgNywgbW92ZS55ICogMiArIHRoaXMueSArIHRoaXMuaCAvIDIgLSA3LCAzLjcsIDAsIDIgKiBNYXRoLlBJKTsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJQbGF5ZXIncyBkcmF3IG1ldGhvZCBtb2RpZmllZC4iKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlBsYXllciBvYmplY3Qgb3IgZHJhdyBtZXRob2Qgbm90IGZvdW5kLiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUGxheWVyIHVwZGF0ZSBmdW5jdGlvbg0KICAgICAgICBwbGF5ZXIudXBkYXRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIG4gPSAwOw0KICAgICAgICAgICAgd2hpbGUgKG4gPCBnYW1lLmN1cnJlbnRMZXZlbC5ibG9ja3MubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgdmFyIGIgPSBnYW1lLmN1cnJlbnRMZXZlbC5ibG9ja3Nbbl07DQogICAgICAgICAgICAgICAgaWYgKGIuY29sbGlkZSAmJiBiLnR5cGUgPT0gJ2xhdmEnKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChibG9ja3NDb2xsaWRpbmdFZGdlKHRoaXMsIGIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuZGllKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgbisrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGxhdmEgY29sbGlzaW9ucw0KDQogICAgICAgICAgICB0aGlzLnltb3ZlICs9IGNvbmZpZy55TW92ZUluY3JlbWVudCAqIGNvbmZpZy5ncmF2aXR5RGlyZWN0aW9uOw0KICAgICAgICAgICAgaWYgKEtleXMua2V5c1szN10gfHwgS2V5cy5rZXlzWzY1XSkgew0KICAgICAgICAgICAgICAgIGlmIChnYW1lLnN3aXRjaEtleXMpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy54bW92ZSArPSBjb25maWcueE1vdmVJbmNyZW1lbnQ7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy54bW92ZSAtPSBjb25maWcueE1vdmVJbmNyZW1lbnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRoaXMubW92ZWQgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKEtleXMua2V5c1szOV0gfHwgS2V5cy5rZXlzWzY4XSkgew0KICAgICAgICAgICAgICAgIGlmIChnYW1lLnN3aXRjaEtleXMpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy54bW92ZSAtPSBjb25maWcueE1vdmVJbmNyZW1lbnQ7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy54bW92ZSArPSBjb25maWcueE1vdmVJbmNyZW1lbnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRoaXMubW92ZWQgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB1cGRhdGVCbG9jayh0aGlzLCBnYW1lLmN1cnJlbnRMZXZlbC5ibG9ja3MpOw0KICAgICAgICAgICAgLy8gUGh5c2ljcw0KDQogICAgICAgICAgICB0aGlzLnJlc3RpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgIHRoaXMud2FsbEp1bXBMZWZ0ID0gZmFsc2U7DQogICAgICAgICAgICB0aGlzLndhbGxKdW1wUmlnaHQgPSBmYWxzZTsNCiAgICAgICAgICAgIHZhciBuID0gMDsNCiAgICAgICAgICAgIHdoaWxlIChuIDwgZ2FtZS5jdXJyZW50TGV2ZWwuYmxvY2tzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgIHZhciBiID0gZ2FtZS5jdXJyZW50TGV2ZWwuYmxvY2tzW25dOw0KICAgICAgICAgICAgICAgIGlmIChibG9ja3NDb2xsaWRpbmdFZGdlKHRoaXMsIGIpICYmIGIuY29sbGlkZSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54ID49IGIueCArIGIudyB8fCB0aGlzLnggKyB0aGlzLncgPD0gYi54KSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnhtb3ZlID0gMDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy55ICsgdGhpcy5oIDw9IGIueSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueCA8IGIueCArIGIudyAmJiB0aGlzLnggKyB0aGlzLncgPiBiLngpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3RpbmcgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMueCA8IGIueCArIGIudyAmJiB0aGlzLnggKyB0aGlzLncgPiBiLngpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueW1vdmUgPSAxIC8gMTAwMDA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueCArIHRoaXMudyA9PSBiLngpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud2FsbEp1bXBMZWZ0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54ID09IGIueCArIGIudykgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53YWxsSnVtcFJpZ2h0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBuKys7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFdhbGwganVtcCBsb2dpYw0KICAgICAgICAgICAgaWYgKGNvbmZpZy53YWxsSnVtcEVuYWJsZWQgJiYgKHRoaXMud2FsbEp1bXBMZWZ0IHx8IHRoaXMud2FsbEp1bXBSaWdodCkpIHsNCiAgICAgICAgICAgICAgICBpZiAoS2V5cy5rZXlzWzM4XSB8fCBLZXlzLmtleXNbODddKSB7IC8vIEp1bXAga2V5IHByZXNzZWQNCiAgICAgICAgICAgICAgICAgICAgdGhpcy55bW92ZSA9IC01OyAvLyBBcHBseSB1cHdhcmQgaW1wdWxzZQ0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy53YWxsSnVtcExlZnQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueG1vdmUgPSAtMzsgLy8gQXBwbHkgZm9yY2UgdG8gdGhlIGxlZnQgZm9yIHdhbGwganVtcCBsZWZ0DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy53YWxsSnVtcFJpZ2h0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnhtb3ZlID0gMzsgLy8gQXBwbHkgZm9yY2UgdG8gdGhlIHJpZ2h0IGZvciB3YWxsIGp1bXAgcmlnaHQNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHRoaXMucmVzdGluZykgew0KICAgICAgICAgICAgICAgIHRoaXMueW1vdmUgPSAwOw0KICAgICAgICAgICAgICAgIGlmIChnYW1lLnN3aXRjaEtleXMpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKEtleXMua2V5c1s0MF0gfHwgS2V5cy5rZXlzWzgzXSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55bW92ZSA9IGNvbmZpZy55TW92ZVJlc3RpbmdKdW1wICogY29uZmlnLmdyYXZpdHlEaXJlY3Rpb247DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChLZXlzLmtleXNbMzhdIHx8IEtleXMua2V5c1s4N10pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueW1vdmUgPSBjb25maWcueU1vdmVSZXN0aW5nSnVtcCAqIGNvbmZpZy5ncmF2aXR5RGlyZWN0aW9uOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEZhc3QgZGVzY2VuZCAob3IgYXNjZW5kIGlmIGdyYXZpdHkgaXMgcmV2ZXJzZWQpIHdoZW4gaG9sZGluZyBkb3duIChvciB1cCBpZiBzd2l0Y2hLZXlzIGlzIGFjdGl2ZSkNCiAgICAgICAgICAgIGlmIChnYW1lLnN3aXRjaEtleXMpIHsNCiAgICAgICAgICAgICAgICBpZiAoS2V5cy5rZXlzWzM4XSB8fCBLZXlzLmtleXNbODddKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMueW1vdmUgKz0gY29uZmlnLnlNb3ZlSW5jcmVtZW50ICogY29uZmlnLmZhc3REZXNjZW5kTXVsdGlwbGllciAqIGNvbmZpZy5ncmF2aXR5RGlyZWN0aW9uOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKEtleXMua2V5c1s0MF0gfHwgS2V5cy5rZXlzWzgzXSkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnltb3ZlICs9IGNvbmZpZy55TW92ZUluY3JlbWVudCAqIGNvbmZpZy5mYXN0RGVzY2VuZE11bHRpcGxpZXIgKiBjb25maWcuZ3Jhdml0eURpcmVjdGlvbjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBwbGF5ZXIgbW92ZQ0KDQogICAgICAgICAgICB0aGlzLnhtb3ZlICo9IGNvbmZpZy54TW92ZURhbXBpbmc7DQogICAgICAgICAgICB0aGlzLnltb3ZlICo9IGNvbmZpZy55TW92ZURhbXBpbmc7DQogICAgICAgICAgICAvLyBEYW1wZW4NCg0KICAgICAgICAgICAgaWYgKHRoaXMueCA8IC10aGlzLncgKiBjb25maWcubGV2ZWxPZmZzZXQpIHsNCiAgICAgICAgICAgICAgICB0aGlzLnggKz0gY29uZmlnLmxldmVsV2lkdGg7DQogICAgICAgICAgICAgICAgZ2FtZS5sZXZlbFgtLTsNCiAgICAgICAgICAgICAgICBnYW1lLnJlZnJlc2hMZXZlbCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHRoaXMueCA+IGNvbmZpZy5sZXZlbFdpZHRoIC0gdGhpcy53ICogY29uZmlnLmxldmVsT2Zmc2V0KSB7DQogICAgICAgICAgICAgICAgdGhpcy54IC09IGNvbmZpZy5sZXZlbFdpZHRoOw0KICAgICAgICAgICAgICAgIGdhbWUubGV2ZWxYKys7DQogICAgICAgICAgICAgICAgZ2FtZS5yZWZyZXNoTGV2ZWwoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0aGlzLnkgPCAtdGhpcy5oICogY29uZmlnLmxldmVsT2Zmc2V0KSB7DQogICAgICAgICAgICAgICAgdGhpcy55ICs9IGNvbmZpZy5sZXZlbEhlaWdodDsNCiAgICAgICAgICAgICAgICBnYW1lLmxldmVsWS0tOw0KICAgICAgICAgICAgICAgIGdhbWUucmVmcmVzaExldmVsKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy55ID4gY29uZmlnLmxldmVsSGVpZ2h0IC0gdGhpcy5oICogY29uZmlnLmxldmVsT2Zmc2V0KSB7DQogICAgICAgICAgICAgICAgdGhpcy55IC09IGNvbmZpZy5sZXZlbEhlaWdodDsNCiAgICAgICAgICAgICAgICBnYW1lLmxldmVsWSsrOw0KICAgICAgICAgICAgICAgIGdhbWUucmVmcmVzaExldmVsKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBNb3ZlIHBsYXllciB0aHJvdWdoIGxldmVsIHdhbGxzDQogICAgICAgIH0NCg0KICAgICAgICB2YXIgaXNGaXJzdE9wZW4gPSB0cnVlOw0KDQogICAgICAgIGZ1bmN0aW9uIHRvZ2dsZURlYnVnTWVudSgpIHsNCiAgICAgICAgICAgIGlmIChkZWJ1Z01lbnUuc3R5bGUuZGlzcGxheSA9PSAibm9uZSIpIHsNCiAgICAgICAgICAgICAgICBkZWJ1Z01lbnUuc3R5bGUuZGlzcGxheSA9ICJibG9jayINCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZGVidWdNZW51LnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAiYCIpIHsNCiAgICAgICAgICAgICAgICB0b2dnbGVEZWJ1Z01lbnUoKTsNCiAgICAgICAgICAgICAgICBpZiAoaXNGaXJzdE9wZW4pIHsNCiAgICAgICAgICAgICAgICAgICAgbW9kaWZ5UGxheWVyRHJhdygpOw0KDQogICAgICAgICAgICAgICAgICAgIHZhciB3ZWxjb21lQm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICAgICAgICAgIHdlbGNvbWVCb3guc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiMzMzMiOyAvLyBkYXJrIGJhY2tncm91bmQNCiAgICAgICAgICAgICAgICAgICAgd2VsY29tZUJveC5zdHlsZS5wYWRkaW5nID0gIjVweCI7DQogICAgICAgICAgICAgICAgICAgIHdlbGNvbWVCb3guc3R5bGUuYm9yZGVyQm90dG9tID0gIjFweCBzb2xpZCAjNjY2IjsgLy8gZ3JleSBib3JkZXINCiAgICAgICAgICAgICAgICAgICAgd2VsY29tZUJveC5zdHlsZS5ib3JkZXJSYWRpdXMgPSAiNXB4IjsNCg0KICAgICAgICAgICAgICAgICAgICB2YXIgbG9nb0ltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7DQogICAgICAgICAgICAgICAgICAgIGxvZ29JbWFnZS5zcmMgPSAiIjsNCiAgICAgICAgICAgICAgICAgICAgbG9nb0ltYWdlLnN0eWxlLndpZHRoID0gIjIwcHgiOw0KICAgICAgICAgICAgICAgICAgICBsb2dvSW1hZ2Uuc3R5bGUuaGVpZ2h0ID0gIjIwcHgiOw0KICAgICAgICAgICAgICAgICAgICBsb2dvSW1hZ2Uuc3R5bGUubWFyZ2luUmlnaHQgPSAiMTBweCI7DQogICAgICAgICAgICAgICAgICAgIHdlbGNvbWVCb3guYXBwZW5kQ2hpbGQobG9nb0ltYWdlKTsNCg0KICAgICAgICAgICAgICAgICAgICB2YXIgd2VsY29tZVRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7DQogICAgICAgICAgICAgICAgICAgIHdlbGNvbWVUZXh0LnRleHRDb250ZW50ID0gIlNjcmlwdCBNYWRlIEJ5IHBwb3VnaiI7DQogICAgICAgICAgICAgICAgICAgIHdlbGNvbWVUZXh0LnN0eWxlLmNvbG9yID0gIiNmZmYiOw0KICAgICAgICAgICAgICAgICAgICB3ZWxjb21lVGV4dC5zdHlsZS5mb250U2l6ZSA9ICIxNHB4IjsNCiAgICAgICAgICAgICAgICAgICAgd2VsY29tZUJveC5hcHBlbmRDaGlsZCh3ZWxjb21lVGV4dCk7DQoNCiAgICAgICAgICAgICAgICAgICAgdmFyIGNsb3NlQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7DQogICAgICAgICAgICAgICAgICAgIGNsb3NlQnV0dG9uLnRleHRDb250ZW50ID0gIlgiOw0KICAgICAgICAgICAgICAgICAgICBjbG9zZUJ1dHRvbi5zdHlsZS5mbG9hdCA9ICJyaWdodCI7DQogICAgICAgICAgICAgICAgICAgIGNsb3NlQnV0dG9uLnN0eWxlLmZvbnRTaXplID0gIjEycHgiOw0KICAgICAgICAgICAgICAgICAgICBjbG9zZUJ1dHRvbi5zdHlsZS5wYWRkaW5nID0gIjVweCI7DQogICAgICAgICAgICAgICAgICAgIGNsb3NlQnV0dG9uLnN0eWxlLmJvcmRlciA9ICJub25lIjsNCiAgICAgICAgICAgICAgICAgICAgY2xvc2VCdXR0b24uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiM0NDQiOw0KICAgICAgICAgICAgICAgICAgICBjbG9zZUJ1dHRvbi5zdHlsZS5jb2xvciA9ICIjZmZmIjsNCiAgICAgICAgICAgICAgICAgICAgY2xvc2VCdXR0b24uc3R5bGUuY3Vyc29yID0gInBvaW50ZXIiOw0KICAgICAgICAgICAgICAgICAgICBjbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdlbGNvbWVCb3guc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIHdlbGNvbWVCb3guYXBwZW5kQ2hpbGQoY2xvc2VCdXR0b24pOw0KDQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQod2VsY29tZUJveCk7DQogICAgICAgICAgICAgICAgICAgIGlzRmlyc3RPcGVuID0gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBBZGQgYSBjb250YWluZXIgZm9yIHRoZSBkZWJ1ZyBtZW51DQogICAgICAgIHZhciBkZWJ1Z01lbnUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgZGVidWdNZW51LnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsNCiAgICAgICAgZGVidWdNZW51LnN0eWxlLnRvcCA9ICIxMHB4IjsNCiAgICAgICAgZGVidWdNZW51LnN0eWxlLmxlZnQgPSAiMTBweCI7DQogICAgICAgIGRlYnVnTWVudS5zdHlsZS5mb250U2l6ZSA9ICIxNnB4IjsNCiAgICAgICAgZGVidWdNZW51LnN0eWxlLmNvbG9yID0gIndoaXRlIjsNCiAgICAgICAgZGVidWdNZW51LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICJyZ2JhKDAsIDAsIDAsIDAuNSkiOw0KICAgICAgICBkZWJ1Z01lbnUuc3R5bGUucGFkZGluZyA9ICIxMHB4IjsNCiAgICAgICAgZGVidWdNZW51LnN0eWxlLmJvcmRlclJhZGl1cyA9ICI1cHgiOw0KICAgICAgICBkZWJ1Z01lbnUuc3R5bGUuZGlzcGxheSA9ICJub25lIjsgLy8gSW5pdGlhbGx5IGhpZGRlbg0KICAgICAgICBkZWJ1Z01lbnUuc3R5bGUucmVzaXplID0gImJvdGgiOyAvLyBNYWtlIHJlc2l6YWJsZQ0KICAgICAgICBkZWJ1Z01lbnUuc3R5bGUub3ZlcmZsb3cgPSAiYXV0byI7IC8vIEFkZCBvdmVyZmxvdyBmb3IgcmVzaXppbmcNCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkZWJ1Z01lbnUpOw0KDQogICAgICAgIC8vIEFkZCBhIGhlYWRlciBmb3IgdGhlIGRlYnVnIG1lbnUgKGZvciBkcmFnZ2luZykNCiAgICAgICAgdmFyIGRlYnVnTWVudUhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICBkZWJ1Z01lbnVIZWFkZXIuc3R5bGUuY3Vyc29yID0gIm1vdmUiOw0KICAgICAgICBkZWJ1Z01lbnVIZWFkZXIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiMzMzMiOw0KICAgICAgICBkZWJ1Z01lbnVIZWFkZXIuc3R5bGUuY29sb3IgPSAiI2ZmZiI7DQogICAgICAgIGRlYnVnTWVudUhlYWRlci5zdHlsZS5wYWRkaW5nID0gIjVweCI7DQogICAgICAgIGRlYnVnTWVudUhlYWRlci5zdHlsZS5mb250V2VpZ2h0ID0gImJvbGQiOw0KICAgICAgICBkZWJ1Z01lbnVIZWFkZXIudGV4dENvbnRlbnQgPSAiRGVidWcgTWVudSI7DQogICAgICAgIGRlYnVnTWVudS5hcHBlbmRDaGlsZChkZWJ1Z01lbnVIZWFkZXIpOw0KDQogICAgICAgIC8vIEFkZCBlbGVtZW50cyBmb3IgdmFyaW91cyBkZWJ1ZyBpbmZvcm1hdGlvbg0KICAgICAgICB2YXIgcG9zaXRpb25UcmFja2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgIHBvc2l0aW9uVHJhY2tlci50ZXh0Q29udGVudCA9ICJQb3NpdGlvbjogKFg6IDAuMDAwLCBZOiAwLjAwMCkiOw0KICAgICAgICBkZWJ1Z01lbnUuYXBwZW5kQ2hpbGQocG9zaXRpb25UcmFja2VyKTsNCg0KICAgICAgICB2YXIgdmVsb2NpdHlUcmFja2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgIHZlbG9jaXR5VHJhY2tlci50ZXh0Q29udGVudCA9ICJWZWxvY2l0eTogKFg6IDAuMDAwLCBZOiAwLjAwMCkiOw0KICAgICAgICBkZWJ1Z01lbnUuYXBwZW5kQ2hpbGQodmVsb2NpdHlUcmFja2VyKTsNCg0KICAgICAgICB2YXIgY2h1bmtUcmFja2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgIGNodW5rVHJhY2tlci50ZXh0Q29udGVudCA9ICJDaHVuazogKFg6IDAsIFk6IDApIjsNCiAgICAgICAgZGVidWdNZW51LmFwcGVuZENoaWxkKGNodW5rVHJhY2tlcik7DQoNCiAgICAgICAgdmFyIGZwc1RyYWNrZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgZnBzVHJhY2tlci50ZXh0Q29udGVudCA9ICJGUFM6IDAiOw0KICAgICAgICBkZWJ1Z01lbnUuYXBwZW5kQ2hpbGQoZnBzVHJhY2tlcik7DQoNCiAgICAgICAgdmFyIGdhbWVUaW1lVHJhY2tlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICBnYW1lVGltZVRyYWNrZXIudGV4dENvbnRlbnQgPSAiR2FtZSBUaW1lOiAwcyI7DQogICAgICAgIGRlYnVnTWVudS5hcHBlbmRDaGlsZChnYW1lVGltZVRyYWNrZXIpOw0KDQogICAgICAgIC8vIEFkZCBhIGNvbnRhaW5lciBmb3IgcG9zaXRpb24gaW5wdXRzIGFuZCBidXR0b24NCiAgICAgICAgdmFyIHBvc2l0aW9uQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgIHBvc2l0aW9uQ29udGFpbmVyLnN0eWxlLm1hcmdpblRvcCA9ICIxMHB4IjsNCiAgICAgICAgZGVidWdNZW51LmFwcGVuZENoaWxkKHBvc2l0aW9uQ29udGFpbmVyKTsNCg0KICAgICAgICAvLyBJbnB1dCBmaWVsZHMgZm9yIHNldHRpbmcgcG9zaXRpb24NCiAgICAgICAgdmFyIHBvc1hJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQogICAgICAgIHBvc1hJbnB1dC50eXBlID0gInRleHQiOw0KICAgICAgICBwb3NYSW5wdXQucGxhY2Vob2xkZXIgPSAiRW50ZXIgWCBwb3NpdGlvbiI7DQogICAgICAgIHBvc2l0aW9uQ29udGFpbmVyLmFwcGVuZENoaWxkKHBvc1hJbnB1dCk7DQoNCiAgICAgICAgdmFyIHBvc1lJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQogICAgICAgIHBvc1lJbnB1dC50eXBlID0gInRleHQiOw0KICAgICAgICBwb3NZSW5wdXQucGxhY2Vob2xkZXIgPSAiRW50ZXIgWSBwb3NpdGlvbiI7DQogICAgICAgIHBvc2l0aW9uQ29udGFpbmVyLmFwcGVuZENoaWxkKHBvc1lJbnB1dCk7DQoNCiAgICAgICAgLy8gQnV0dG9uIHRvIHNldCBwb3NpdGlvbg0KICAgICAgICB2YXIgc2V0UG9zaXRpb25CdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsNCiAgICAgICAgc2V0UG9zaXRpb25CdXR0b24udGV4dENvbnRlbnQgPSAiU2V0IFBvc2l0aW9uIjsNCiAgICAgICAgc2V0UG9zaXRpb25CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgbmV3WCA9IHBhcnNlRmxvYXQocG9zWElucHV0LnZhbHVlKTsNCiAgICAgICAgICAgIHZhciBuZXdZID0gcGFyc2VGbG9hdChwb3NZSW5wdXQudmFsdWUpOw0KICAgICAgICAgICAgaWYgKCFpc05hTihuZXdYKSAmJiAhaXNOYU4obmV3WSkpIHsNCiAgICAgICAgICAgICAgICBwbGF5ZXIueCA9IG5ld1g7DQogICAgICAgICAgICAgICAgcGxheWVyLnkgPSBuZXdZOw0KICAgICAgICAgICAgICAgIHBvc2l0aW9uVHJhY2tlci50ZXh0Q29udGVudCA9ICJQb3NpdGlvbjogKFg6ICIgKyBuZXdYLnRvRml4ZWQoMykgKyAiLCBZOiAiICsgbmV3WS50b0ZpeGVkKDMpICsgIikiOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBhbGVydCgiSW52YWxpZCBpbnB1dCEgUGxlYXNlIGVudGVyIHZhbGlkIG51bWJlcnMgZm9yIFggYW5kIFkgcG9zaXRpb25zLiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgcG9zaXRpb25Db250YWluZXIuYXBwZW5kQ2hpbGQoc2V0UG9zaXRpb25CdXR0b24pOw0KDQogICAgICAgIC8vIEFkZCBhIGNvbnRhaW5lciBmb3IgdGhlIHRpbWVyIGlucHV0IGFuZCBidXR0b24NCiAgICAgICAgdmFyIHRpbWVyQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgIHRpbWVyQ29udGFpbmVyLnN0eWxlLm1hcmdpblRvcCA9ICIxMHB4IjsNCiAgICAgICAgZGVidWdNZW51LmFwcGVuZENoaWxkKHRpbWVyQ29udGFpbmVyKTsNCg0KICAgICAgICAvLyBJbnB1dCBmaWVsZCBmb3Igc2V0dGluZyB0aGUgdGltZXIgdmFsdWUNCiAgICAgICAgdmFyIHRpbWVySW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOw0KICAgICAgICB0aW1lcklucHV0LnR5cGUgPSAidGV4dCI7DQogICAgICAgIHRpbWVySW5wdXQucGxhY2Vob2xkZXIgPSAiRW50ZXIgVGltZXIgVmFsdWUgKHMpIjsNCiAgICAgICAgdGltZXJDb250YWluZXIuYXBwZW5kQ2hpbGQodGltZXJJbnB1dCk7DQoNCiAgICAgICAgLy8gQnV0dG9uIHRvIHNldCB0aGUgdGltZXIgdmFsdWUNCiAgICAgICAgdmFyIHNldFRpbWVyQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7DQogICAgICAgIHNldFRpbWVyQnV0dG9uLnRleHRDb250ZW50ID0gIlNldCBUaW1lciI7DQogICAgICAgIHNldFRpbWVyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIG5ld1RpbWUgPSBwYXJzZUZsb2F0KHRpbWVySW5wdXQudmFsdWUpOw0KICAgICAgICAgICAgaWYgKCFpc05hTihuZXdUaW1lKSkgew0KICAgICAgICAgICAgICAgIHRpbWVyID0gbmV3VGltZTsNCiAgICAgICAgICAgICAgICBzdGFydFRpbWUgPSBEYXRlLm5vdygpIC0gKG5ld1RpbWUgKiAxMDAwKTsNCiAgICAgICAgICAgICAgICBnYW1lVGltZVRyYWNrZXIudGV4dENvbnRlbnQgPSAiR2FtZSBUaW1lOiAiICsgbmV3VGltZS50b0ZpeGVkKDEpICsgInMiOw0KICAgICAgICAgICAgICAgIHRpbWVyUnVubmluZyA9IGZhbHNlOyAvLyBQYXVzZSB0aGUgdGltZXINCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYWxlcnQoIkludmFsaWQgaW5wdXQhIFBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlciBmb3IgdGhlIHRpbWVyIHZhbHVlLiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgdGltZXJDb250YWluZXIuYXBwZW5kQ2hpbGQoc2V0VGltZXJCdXR0b24pOw0KDQogICAgICAgIC8vIENyZWF0ZSBhIGNvbnRhaW5lciBmb3IgdGhlIHJlc2V0IGFuZCByZXNwYXduIGNvbmZpZ3VyYXRpb24NCiAgICAgICAgdmFyIGNvbmZpZ0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICBjb25maWdDb250YWluZXIuc3R5bGUubWFyZ2luQm90dG9tID0gIjIwcHgiOw0KICAgICAgICBkZWJ1Z01lbnUuYXBwZW5kQ2hpbGQoY29uZmlnQ29udGFpbmVyKTsNCg0KICAgICAgICAvLyBDcmVhdGUgaW5wdXQgZmllbGRzIGFuZCBsYWJlbHMgZm9yIGVhY2ggdmFsdWUNCiAgICAgICAgdmFyIGNvbmZpZ0ZpZWxkcyA9IFsNCiAgICAgICAgICAgIHsgbGFiZWw6ICJMZXZlbCBYIiwgaWQ6ICJsZXZlbFgiLCBkZWZhdWx0VmFsdWU6IDAgfSwNCiAgICAgICAgICAgIHsgbGFiZWw6ICJMZXZlbCBZIiwgaWQ6ICJsZXZlbFkiLCBkZWZhdWx0VmFsdWU6IDAgfSwNCiAgICAgICAgICAgIHsgbGFiZWw6ICJQbGF5ZXIgWCIsIGlkOiAicGxheWVyWCIsIGRlZmF1bHRWYWx1ZTogNDgwIH0sDQogICAgICAgICAgICB7IGxhYmVsOiAiUGxheWVyIFkiLCBpZDogInBsYXllclkiLCBkZWZhdWx0VmFsdWU6IDUwMCB9LA0KICAgICAgICAgICAgeyBsYWJlbDogIlBsYXllciBYIE1vdmUiLCBpZDogInBsYXllclhNb3ZlIiwgZGVmYXVsdFZhbHVlOiAwIH0sDQogICAgICAgICAgICB7IGxhYmVsOiAiUGxheWVyIFkgTW92ZSIsIGlkOiAicGxheWVyWU1vdmUiLCBkZWZhdWx0VmFsdWU6IDAgfQ0KICAgICAgICBdOw0KDQogICAgICAgIGNvbmZpZ0ZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHsNCiAgICAgICAgICAgIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7DQogICAgICAgICAgICBsYWJlbC50ZXh0Q29udGVudCA9IGZpZWxkLmxhYmVsOw0KICAgICAgICAgICAgbGFiZWwuc3R5bGUubWFyZ2luUmlnaHQgPSAiMTBweCI7DQogICAgICAgICAgICBjb25maWdDb250YWluZXIuYXBwZW5kQ2hpbGQobGFiZWwpOw0KDQogICAgICAgICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOw0KICAgICAgICAgICAgaW5wdXQudHlwZSA9ICJ0ZXh0IjsNCiAgICAgICAgICAgIGlucHV0LmlkID0gZmllbGQuaWQ7DQogICAgICAgICAgICBpbnB1dC52YWx1ZSA9IGZpZWxkLmRlZmF1bHRWYWx1ZTsNCiAgICAgICAgICAgIGlucHV0LnN0eWxlLm1hcmdpblJpZ2h0ID0gIjEwcHgiOw0KICAgICAgICAgICAgY29uZmlnQ29udGFpbmVyLmFwcGVuZENoaWxkKGlucHV0KTsNCg0KICAgICAgICAgICAgY29uZmlnQ29udGFpbmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIikpOw0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBDcmVhdGUgYSBidXR0b24gdG8gYXBwbHkgdGhlIGNoYW5nZXMgdG8gcmVzZXQgZnVuY3Rpb24NCiAgICAgICAgdmFyIGFwcGx5UmVzZXRDb25maWdCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsNCiAgICAgICAgYXBwbHlSZXNldENvbmZpZ0J1dHRvbi50ZXh0Q29udGVudCA9ICJBcHBseSBSZXNldCBDb25maWciOw0KICAgICAgICBhcHBseVJlc2V0Q29uZmlnQnV0dG9uLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjEwcHgiOw0KICAgICAgICBhcHBseVJlc2V0Q29uZmlnQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGxldmVsWCA9IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsZXZlbFgiKS52YWx1ZSk7DQogICAgICAgICAgICB2YXIgbGV2ZWxZID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxldmVsWSIpLnZhbHVlKTsNCiAgICAgICAgICAgIHZhciBwbGF5ZXJYID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllclgiKS52YWx1ZSk7DQogICAgICAgICAgICB2YXIgcGxheWVyWSA9IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwbGF5ZXJZIikudmFsdWUpOw0KICAgICAgICAgICAgdmFyIHBsYXllclhNb3ZlID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllclhNb3ZlIikudmFsdWUpOw0KICAgICAgICAgICAgdmFyIHBsYXllcllNb3ZlID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllcllNb3ZlIikudmFsdWUpOw0KDQogICAgICAgICAgICBpZiAoIWlzTmFOKGxldmVsWCkgJiYgIWlzTmFOKGxldmVsWSkgJiYgIWlzTmFOKHBsYXllclgpICYmICFpc05hTihwbGF5ZXJZKSAmJiAhaXNOYU4ocGxheWVyWE1vdmUpICYmICFpc05hTihwbGF5ZXJZTW92ZSkpIHsNCiAgICAgICAgICAgICAgICBnYW1lLnJlc2V0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLmxldmVsWCA9IGxldmVsWDsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5sZXZlbFkgPSBsZXZlbFk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2twb2ludDEgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgcGxheWVyLnggPSBwbGF5ZXJYOw0KICAgICAgICAgICAgICAgICAgICBwbGF5ZXIueSA9IHBsYXllclk7DQogICAgICAgICAgICAgICAgICAgIHBsYXllci54bW92ZSA9IHBsYXllclhNb3ZlOw0KICAgICAgICAgICAgICAgICAgICBwbGF5ZXIueW1vdmUgPSBwbGF5ZXJZTW92ZTsNCiAgICAgICAgICAgICAgICAgICAgcGxheWVyLm1vdmVkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIHRpbWVyID0gMDsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy53b24gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJEZWFkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaExldmVsKCk7DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBhbGVydCgiUmVzZXQgY29uZmlndXJhdGlvbiBhcHBsaWVkISIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBhbGVydCgiSW52YWxpZCBpbnB1dCB2YWx1ZXMhIik7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBjb25maWdDb250YWluZXIuYXBwZW5kQ2hpbGQoYXBwbHlSZXNldENvbmZpZ0J1dHRvbik7DQoNCiAgICAgICAgLy8gQ3JlYXRlIGEgYnV0dG9uIHRvIGFwcGx5IHRoZSBjaGFuZ2VzIHRvIHJlc3Bhd24gZnVuY3Rpb24NCiAgICAgICAgdmFyIGFwcGx5UmVzcGF3bkNvbmZpZ0J1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOw0KICAgICAgICBhcHBseVJlc3Bhd25Db25maWdCdXR0b24udGV4dENvbnRlbnQgPSAiQXBwbHkgUmVzcGF3biBDb25maWciOw0KICAgICAgICBhcHBseVJlc3Bhd25Db25maWdCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgbGV2ZWxYID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxldmVsWCIpLnZhbHVlKTsNCiAgICAgICAgICAgIHZhciBsZXZlbFkgPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGV2ZWxZIikudmFsdWUpOw0KICAgICAgICAgICAgdmFyIHBsYXllclggPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGxheWVyWCIpLnZhbHVlKTsNCiAgICAgICAgICAgIHZhciBwbGF5ZXJZID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllclkiKS52YWx1ZSk7DQogICAgICAgICAgICB2YXIgcGxheWVyWE1vdmUgPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGxheWVyWE1vdmUiKS52YWx1ZSk7DQogICAgICAgICAgICB2YXIgcGxheWVyWU1vdmUgPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGxheWVyWU1vdmUiKS52YWx1ZSk7DQoNCiAgICAgICAgICAgIGlmICghaXNOYU4obGV2ZWxYKSAmJiAhaXNOYU4obGV2ZWxZKSAmJiAhaXNOYU4ocGxheWVyWCkgJiYgIWlzTmFOKHBsYXllclkpICYmICFpc05hTihwbGF5ZXJYTW92ZSkgJiYgIWlzTmFOKHBsYXllcllNb3ZlKSkgew0KICAgICAgICAgICAgICAgIGdhbWUucmVzcGF3biA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5sZXZlbFggPSBsZXZlbFg7DQogICAgICAgICAgICAgICAgICAgIHRoaXMubGV2ZWxZID0gbGV2ZWxZOw0KICAgICAgICAgICAgICAgICAgICBwbGF5ZXIueCA9IHBsYXllclg7DQogICAgICAgICAgICAgICAgICAgIHBsYXllci55ID0gcGxheWVyWTsNCiAgICAgICAgICAgICAgICAgICAgcGxheWVyLnhtb3ZlID0gcGxheWVyWE1vdmU7DQogICAgICAgICAgICAgICAgICAgIHBsYXllci55bW92ZSA9IHBsYXllcllNb3ZlOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXllckRlYWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoTGV2ZWwoKTsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGFsZXJ0KCJSZXNwYXduIGNvbmZpZ3VyYXRpb24gYXBwbGllZCEiKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYWxlcnQoIkludmFsaWQgaW5wdXQgdmFsdWVzISIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgY29uZmlnQ29udGFpbmVyLmFwcGVuZENoaWxkKGFwcGx5UmVzcGF3bkNvbmZpZ0J1dHRvbik7DQoNCiAgICAgICAgLy8gRnVuY3Rpb24gdG8gY3JlYXRlIGFuIGlucHV0IGZpZWxkIGZvciBjb25maWd1cmF0aW9uDQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNvbmZpZ0lucHV0RmllbGQobGFiZWxUZXh0LCBjb25maWdLZXkpIHsNCiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCg0KICAgICAgICAgICAgdmFyIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTsNCiAgICAgICAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gbGFiZWxUZXh0Ow0KICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGxhYmVsKTsNCg0KICAgICAgICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsNCiAgICAgICAgICAgIGlucHV0LnR5cGUgPSAibnVtYmVyIjsNCiAgICAgICAgICAgIGlucHV0LnZhbHVlID0gY29uZmlnW2NvbmZpZ0tleV07DQogICAgICAgICAgICBpbnB1dC5zdHlsZS5tYXJnaW5MZWZ0ID0gIjEwcHgiOw0KICAgICAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciBuZXdWYWx1ZSA9IHBhcnNlRmxvYXQoaW5wdXQudmFsdWUpOw0KICAgICAgICAgICAgICAgIGlmICghaXNOYU4obmV3VmFsdWUpKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbmZpZ1tjb25maWdLZXldID0gbmV3VmFsdWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXQpOw0KDQogICAgICAgICAgICBkZWJ1Z01lbnUuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEFkZCBpbnB1dCBmaWVsZHMgZm9yIGNvbmZpZ3VyYXRpb24gdmFsdWVzDQogICAgICAgIGNyZWF0ZUNvbmZpZ0lucHV0RmllbGQoIlggTW92ZSBEYW1waW5nOiIsICJ4TW92ZURhbXBpbmciKTsNCiAgICAgICAgY3JlYXRlQ29uZmlnSW5wdXRGaWVsZCgiWSBNb3ZlIERhbXBpbmc6IiwgInlNb3ZlRGFtcGluZyIpOw0KICAgICAgICBjcmVhdGVDb25maWdJbnB1dEZpZWxkKCJTcGVlZDoiLCAieE1vdmVJbmNyZW1lbnQiKTsNCiAgICAgICAgY3JlYXRlQ29uZmlnSW5wdXRGaWVsZCgiSnVtcCBoaWdodDoiLCAieU1vdmVSZXN0aW5nSnVtcCIpOw0KICAgICAgICBjcmVhdGVDb25maWdJbnB1dEZpZWxkKCJFZGdlIFkgTW92ZToiLCAiZWRnZVlNb3ZlIik7DQogICAgICAgIGNyZWF0ZUNvbmZpZ0lucHV0RmllbGQoIkxldmVsIFdpZHRoOiIsICJsZXZlbFdpZHRoIik7DQogICAgICAgIGNyZWF0ZUNvbmZpZ0lucHV0RmllbGQoIkxldmVsIEhlaWdodDoiLCAibGV2ZWxIZWlnaHQiKTsNCiAgICAgICAgY3JlYXRlQ29uZmlnSW5wdXRGaWVsZCgiTGV2ZWwgT2Zmc2V0OiIsICJsZXZlbE9mZnNldCIpOw0KICAgICAgICBjcmVhdGVDb25maWdJbnB1dEZpZWxkKCJGYXN0IEZhbGw6IiwgImZhc3REZXNjZW5kTXVsdGlwbGllciIpOw0KDQogICAgICAgIC8vIEZ1bmN0aW9uIHRvIHN0b3JlIHRoZSBvcmlnaW5hbCBibG9jayB0eXBlcw0KICAgICAgICB2YXIgb3JpZ2luYWxCbG9ja3MgPSBbXTsNCg0KICAgICAgICBmdW5jdGlvbiBzdG9yZU9yaWdpbmFsQmxvY2tzKCkgew0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gMjk7IGkrKykgeyAvLyBMb29wIHRocm91Z2ggbGV2ZWxzIDAgdG8gMjkNCiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5sZXZlbHNbaV0gJiYgZ2FtZS5sZXZlbHNbaV0uYmxvY2tzKSB7DQogICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsQmxvY2tzW2ldID0gW107DQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IDMzOyBqKyspIHsgLy8gTG9vcCB0aHJvdWdoIGJsb2NrcyAwIHRvIDMzDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS5sZXZlbHNbaV0uYmxvY2tzW2pdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxCbG9ja3NbaV1bal0gPSBnYW1lLmxldmVsc1tpXS5ibG9ja3Nbal0udHlwZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEZ1bmN0aW9uIHRvIHJlc3RvcmUgdGhlIG9yaWdpbmFsIGJsb2NrIHR5cGVzDQogICAgICAgIGZ1bmN0aW9uIHJlc3RvcmVPcmlnaW5hbEJsb2NrcygpIHsNCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IDI5OyBpKyspIHsNCiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5sZXZlbHNbaV0gJiYgZ2FtZS5sZXZlbHNbaV0uYmxvY2tzKSB7DQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IDMzOyBqKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLmxldmVsc1tpXS5ibG9ja3Nbal0pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLmxldmVsc1tpXS5ibG9ja3Nbal0udHlwZSA9IG9yaWdpbmFsQmxvY2tzW2ldW2pdOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc29sZS5sb2coIkFsbCBibG9ja3MgaGF2ZSBiZWVuIHJlc3RvcmVkIHRvIHRoZWlyIG9yaWdpbmFsIHR5cGVzLiIpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gY2hhbmdlTGF2YVRvQmxvY2soKSB7DQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSAyOTsgaSsrKSB7IC8vIExvb3AgdGhyb3VnaCBsZXZlbHMgMCB0byAyOQ0KICAgICAgICAgICAgICAgIGlmIChnYW1lLmxldmVsc1tpXSAmJiBnYW1lLmxldmVsc1tpXS5ibG9ja3MpIHsNCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gMzM7IGorKykgeyAvLyBMb29wIHRocm91Z2ggYmxvY2tzIDAgdG8gMzMNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLmxldmVsc1tpXS5ibG9ja3Nbal0gJiYgZ2FtZS5sZXZlbHNbaV0uYmxvY2tzW2pdLnR5cGUgPT09ICdsYXZhJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUubGV2ZWxzW2ldLmJsb2Nrc1tqXS50eXBlID0gJ2Jsb2NrJzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJBbGwgbGF2YSBibG9ja3MgaGF2ZSBiZWVuIGNoYW5nZWQgdG8gYmxvY2sgYmxvY2tzLiIpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQWRkIGEgY29udGFpbmVyIGZvciB0aGUgdG9nZ2xlIGJ1dHRvbnMNCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVG9nZ2xlQnV0dG9uKGxhYmVsLCBpbml0aWFsU3RhdGUsIHRvZ2dsZUZ1bmN0aW9uKSB7DQogICAgICAgICAgICB2YXIgYnV0dG9uQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICBidXR0b25Db250YWluZXIuc3R5bGUubWFyZ2luQm90dG9tID0gIjVweCI7DQoNCiAgICAgICAgICAgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsNCiAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGxhYmVsOw0KICAgICAgICAgICAgYnV0dG9uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGluaXRpYWxTdGF0ZSA/ICJncmVlbiIgOiAicmVkIjsgLy8gU2V0IGluaXRpYWwgY29sb3IgYmFzZWQgb24gc3RhdGUNCg0KICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHRvZ2dsZUZ1bmN0aW9uKGZ1bmN0aW9uIChuZXdTdGF0ZSkgew0KICAgICAgICAgICAgICAgICAgICBidXR0b24uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gbmV3U3RhdGUgPyAiZ3JlZW4iIDogInJlZCI7IC8vIENoYW5nZSBjb2xvciBiYXNlZCBvbiBuZXcgc3RhdGUNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBidXR0b25Db250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbkNvbnRhaW5lcjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFRvZ2dsZSB3YWxsIGp1bXAgc3RhdGUNCiAgICAgICAgdmFyIHdhbGxKdW1wRW5hYmxlZCA9IGNvbmZpZy53YWxsSnVtcEVuYWJsZWQgfHwgZmFsc2U7DQogICAgICAgIHZhciB0b2dnbGVXYWxsSnVtcEJ1dHRvbiA9IGNyZWF0ZVRvZ2dsZUJ1dHRvbigNCiAgICAgICAgICAgICJUb2dnbGUgV2FsbCBKdW1wIiwNCiAgICAgICAgICAgIHdhbGxKdW1wRW5hYmxlZCwNCiAgICAgICAgICAgIGZ1bmN0aW9uIChjYWxsYmFjaykgew0KICAgICAgICAgICAgICAgIHdhbGxKdW1wRW5hYmxlZCA9ICF3YWxsSnVtcEVuYWJsZWQ7DQogICAgICAgICAgICAgICAgY29uZmlnLndhbGxKdW1wRW5hYmxlZCA9IHdhbGxKdW1wRW5hYmxlZDsNCiAgICAgICAgICAgICAgICBjYWxsYmFjayh3YWxsSnVtcEVuYWJsZWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICApOw0KICAgICAgICBkZWJ1Z01lbnUuYXBwZW5kQ2hpbGQodG9nZ2xlV2FsbEp1bXBCdXR0b24pOw0KDQogICAgICAgIC8vIFRvZ2dsZSBncmF2aXR5IGRpcmVjdGlvbg0KICAgICAgICB2YXIgZ3Jhdml0eURpcmVjdGlvbiA9IGNvbmZpZy5ncmF2aXR5RGlyZWN0aW9uIHx8IDE7DQogICAgICAgIHZhciB0b2dnbGVHcmF2aXR5QnV0dG9uID0gY3JlYXRlVG9nZ2xlQnV0dG9uKA0KICAgICAgICAgICAgIlRvZ2dsZSBHcmF2aXR5IiwNCiAgICAgICAgICAgIGdyYXZpdHlEaXJlY3Rpb24gPT09IDEsDQogICAgICAgICAgICBmdW5jdGlvbiAoY2FsbGJhY2spIHsNCiAgICAgICAgICAgICAgICBncmF2aXR5RGlyZWN0aW9uICo9IC0xOw0KICAgICAgICAgICAgICAgIGNvbmZpZy5ncmF2aXR5RGlyZWN0aW9uID0gZ3Jhdml0eURpcmVjdGlvbjsNCiAgICAgICAgICAgICAgICBjYWxsYmFjayhncmF2aXR5RGlyZWN0aW9uID09PSAxKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgKTsNCiAgICAgICAgZGVidWdNZW51LmFwcGVuZENoaWxkKHRvZ2dsZUdyYXZpdHlCdXR0b24pOw0KDQogICAgICAgIC8vIEFkZCBhIHRvZ2dsZSBidXR0b24gZm9yIGxhdmENCiAgICAgICAgdmFyIG5vTGF2YUVuYWJsZWQgPSBmYWxzZTsNCiAgICAgICAgdmFyIGxhdmFUb2dnbGVCdXR0b24gPSBjcmVhdGVUb2dnbGVCdXR0b24oDQogICAgICAgICAgICAiVG9nZ2xlIE5vIExhdmEiLA0KICAgICAgICAgICAgbm9MYXZhRW5hYmxlZCwNCiAgICAgICAgICAgIGZ1bmN0aW9uIChjYWxsYmFjaykgew0KICAgICAgICAgICAgICAgIGlmICghbm9MYXZhRW5hYmxlZCkgew0KICAgICAgICAgICAgICAgICAgICBzdG9yZU9yaWdpbmFsQmxvY2tzKCk7DQogICAgICAgICAgICAgICAgICAgIGNoYW5nZUxhdmFUb0Jsb2NrKCk7DQogICAgICAgICAgICAgICAgICAgIG5vTGF2YUVuYWJsZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJlc3RvcmVPcmlnaW5hbEJsb2NrcygpOw0KICAgICAgICAgICAgICAgICAgICBub0xhdmFFbmFibGVkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5vTGF2YUVuYWJsZWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICApOw0KICAgICAgICBkZWJ1Z01lbnUuYXBwZW5kQ2hpbGQobGF2YVRvZ2dsZUJ1dHRvbik7DQoNCiAgICAgICAgLy8gQWRkIGEgY29udGFpbmVyIGZvciB0aGUgZ2FtZS53b24gZHJvcGRvd24NCiAgICAgICAgdmFyIGdhbWVXb25Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgZ2FtZVdvbkNvbnRhaW5lci5zdHlsZS5tYXJnaW5Ub3AgPSAiMTBweCI7DQogICAgICAgIGRlYnVnTWVudS5hcHBlbmRDaGlsZChnYW1lV29uQ29udGFpbmVyKTsNCg0KICAgICAgICAvLyBBZGQgdGhlIGdhbWUud29uIGRyb3Bkb3duIHRvIHRoZSBjb250YWluZXINCiAgICAgICAgdmFyIGdhbWVXb25MYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7DQogICAgICAgIGdhbWVXb25MYWJlbC50ZXh0Q29udGVudCA9ICJHYW1lIFdvbjogIjsNCiAgICAgICAgZ2FtZVdvbkxhYmVsLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjVweCI7DQogICAgICAgIGdhbWVXb25Db250YWluZXIuYXBwZW5kQ2hpbGQoZ2FtZVdvbkxhYmVsKTsNCg0KICAgICAgICB2YXIgZ2FtZVdvbkRyb3Bkb3duID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2VsZWN0Iik7DQogICAgICAgIHZhciBvcHRpb25UcnVlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7DQogICAgICAgIG9wdGlvblRydWUudmFsdWUgPSAidHJ1ZSI7DQogICAgICAgIG9wdGlvblRydWUudGV4dENvbnRlbnQgPSAiVHJ1ZSI7DQogICAgICAgIGdhbWVXb25Ecm9wZG93bi5hcHBlbmRDaGlsZChvcHRpb25UcnVlKTsNCg0KICAgICAgICB2YXIgb3B0aW9uRmFsc2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsNCiAgICAgICAgb3B0aW9uRmFsc2UudmFsdWUgPSAiZmFsc2UiOw0KICAgICAgICBvcHRpb25GYWxzZS50ZXh0Q29udGVudCA9ICJGYWxzZSI7DQogICAgICAgIG9wdGlvbkZhbHNlLnNlbGVjdGVkID0gdHJ1ZTsNCiAgICAgICAgZ2FtZVdvbkRyb3Bkb3duLmFwcGVuZENoaWxkKG9wdGlvbkZhbHNlKTsNCg0KICAgICAgICBnYW1lV29uRHJvcGRvd24uYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgZ2FtZS53b24gPSAodGhpcy52YWx1ZSA9PT0gInRydWUiKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgZ2FtZVdvbkNvbnRhaW5lci5hcHBlbmRDaGlsZChnYW1lV29uRHJvcGRvd24pOw0KDQogICAgICAgIC8vIEFkZCBidXR0b25zIGZvciBzYXZlIGFuZCBsb2FkIHN0YXRlcw0KICAgICAgICB2YXIgc2F2ZVN0YXRlQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7DQogICAgICAgIHNhdmVTdGF0ZUJ1dHRvbi50ZXh0Q29udGVudCA9ICJTYXZlIFN0YXRlIjsNCiAgICAgICAgc2F2ZVN0YXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIHN0YXRlID0gew0KICAgICAgICAgICAgICAgIHBsYXllcjogew0KICAgICAgICAgICAgICAgICAgICB4OiBwbGF5ZXIueCwNCiAgICAgICAgICAgICAgICAgICAgeTogcGxheWVyLnksDQogICAgICAgICAgICAgICAgICAgIHhtb3ZlOiBwbGF5ZXIueG1vdmUsDQogICAgICAgICAgICAgICAgICAgIHltb3ZlOiBwbGF5ZXIueW1vdmUsDQogICAgICAgICAgICAgICAgICAgIHJlc3Rpbmc6IHBsYXllci5yZXN0aW5nLA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgZ2FtZTogew0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGV2ZWw6IGdhbWUuY3VycmVudExldmVsLA0KICAgICAgICAgICAgICAgICAgICBsZXZlbFg6IGdhbWUubGV2ZWxYLA0KICAgICAgICAgICAgICAgICAgICBsZXZlbFk6IGdhbWUubGV2ZWxZLA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnc2F2ZVN0YXRlJywgSlNPTi5zdHJpbmdpZnkoc3RhdGUpKTsNCiAgICAgICAgfSk7DQogICAgICAgIGRlYnVnTWVudS5hcHBlbmRDaGlsZChzYXZlU3RhdGVCdXR0b24pOw0KDQogICAgICAgIHZhciBsb2FkU3RhdGVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsNCiAgICAgICAgbG9hZFN0YXRlQnV0dG9uLnRleHRDb250ZW50ID0gIkxvYWQgU3RhdGUiOw0KICAgICAgICBsb2FkU3RhdGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgc3RhdGUgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdzYXZlU3RhdGUnKSk7DQogICAgICAgICAgICBpZiAoc3RhdGUpIHsNCiAgICAgICAgICAgICAgICBwbGF5ZXIueCA9IHN0YXRlLnBsYXllci54Ow0KICAgICAgICAgICAgICAgIHBsYXllci55ID0gc3RhdGUucGxheWVyLnk7DQogICAgICAgICAgICAgICAgcGxheWVyLnhtb3ZlID0gc3RhdGUucGxheWVyLnhtb3ZlOw0KICAgICAgICAgICAgICAgIHBsYXllci55bW92ZSA9IHN0YXRlLnBsYXllci55bW92ZTsNCiAgICAgICAgICAgICAgICBwbGF5ZXIucmVzdGluZyA9IHN0YXRlLnBsYXllci5yZXN0aW5nOw0KDQogICAgICAgICAgICAgICAgZ2FtZS5jdXJyZW50TGV2ZWwgPSBzdGF0ZS5nYW1lLmN1cnJlbnRMZXZlbDsNCiAgICAgICAgICAgICAgICBnYW1lLmxldmVsWCA9IHN0YXRlLmdhbWUubGV2ZWxYOw0KICAgICAgICAgICAgICAgIGdhbWUubGV2ZWxZID0gc3RhdGUuZ2FtZS5sZXZlbFk7DQogICAgICAgICAgICAgICAgZ2FtZS5yZWZyZXNoTGV2ZWwoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIGRlYnVnTWVudS5hcHBlbmRDaGlsZChsb2FkU3RhdGVCdXR0b24pOw0KDQogICAgICAgIC8vIEFkZCBhIGNvbnRhaW5lciBmb3IgR29kIE1vZGUNCiAgICAgICAgdmFyIEdvZE1vZGVDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgR29kTW9kZUNvbnRhaW5lci5zdHlsZS5tYXJnaW5Cb3R0b20gPSAiMjBweCI7DQogICAgICAgIGRlYnVnTWVudS5hcHBlbmRDaGlsZChHb2RNb2RlQ29udGFpbmVyKTsNCg0KICAgICAgICAvLyBBZGQgYSBidXR0b24gZm9yIEdvZCBNb2RlDQogICAgICAgIHZhciBHb2RNb2RlQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7DQogICAgICAgIEdvZE1vZGVCdXR0b24udGV4dENvbnRlbnQgPSAiR29kIE1vZGUiOw0KICAgICAgICBHb2RNb2RlQnV0dG9uLnN0eWxlLm1hcmdpblRvcCA9ICIxMHB4IjsNCiAgICAgICAgR29kTW9kZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIE92ZXJyaWRlIHRoZSBzZXR0ZXIgZm9yIGdhbWUucGxheWVyRGVhZA0KICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGdhbWUsICdwbGF5ZXJEZWFkJywgew0KICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkgew0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBnYW1lLmRpZSgpOw0KICAgICAgICAgICAgY29uc29sZS5sb2coIkdvZCBNb2RlIGVuYWJsZWQhIik7DQogICAgICAgIH0pOw0KICAgICAgICBHb2RNb2RlQ29udGFpbmVyLmFwcGVuZENoaWxkKEdvZE1vZGVCdXR0b24pOw0KDQogICAgICAgIC8vIEFkZCBhIGJ1dHRvbiB0byB0dXJuIG9mZiBHb2QgTW9kZQ0KICAgICAgICB2YXIgdHVybk9mZkdvZE1vZGVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsNCiAgICAgICAgdHVybk9mZkdvZE1vZGVCdXR0b24udGV4dENvbnRlbnQgPSAiVHVybiBPZmYgR29kIE1vZGUiOw0KICAgICAgICB0dXJuT2ZmR29kTW9kZUJ1dHRvbi5zdHlsZS5tYXJnaW5Ub3AgPSAiMTBweCI7DQogICAgICAgIHR1cm5PZmZHb2RNb2RlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgLy8gUmVzdG9yZSB0aGUgb3JpZ2luYWwgYmVoYXZpb3Igb2YgZ2FtZS5wbGF5ZXJEZWFkDQogICAgICAgICAgICBkZWxldGUgZ2FtZS5wbGF5ZXJEZWFkOw0KICAgICAgICAgICAgY29uc29sZS5sb2coIkdvZCBNb2RlIGRpc2FibGVkISIpOw0KICAgICAgICB9KTsNCiAgICAgICAgR29kTW9kZUNvbnRhaW5lci5hcHBlbmRDaGlsZCh0dXJuT2ZmR29kTW9kZUJ1dHRvbik7DQoNCiAgICAgICAgLy8gQWRkIGEgY29udGFpbmVyIGZvciBzd2l0Y2hLZXlzDQogICAgICAgIHZhciBzd2l0Y2hLZXlzQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgIHN3aXRjaEtleXNDb250YWluZXIuc3R5bGUubWFyZ2luQm90dG9tID0gIjIwcHgiOw0KICAgICAgICBkZWJ1Z01lbnUuYXBwZW5kQ2hpbGQoc3dpdGNoS2V5c0NvbnRhaW5lcik7DQoNCiAgICAgICAgLy8gQWRkIGEgYnV0dG9uIHRvIGVuYWJsZSBzd2l0Y2hLZXlzDQogICAgICAgIHZhciBlbmFibGVTd2l0Y2hLZXlzQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7DQogICAgICAgIGVuYWJsZVN3aXRjaEtleXNCdXR0b24udGV4dENvbnRlbnQgPSAiRW5hYmxlIHN3aXRjaEtleXMiOw0KICAgICAgICBlbmFibGVTd2l0Y2hLZXlzQnV0dG9uLnN0eWxlLm1hcmdpblRvcCA9ICIxMHB4IjsNCiAgICAgICAgZW5hYmxlU3dpdGNoS2V5c0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIE92ZXJyaWRlIHRoZSBnZXR0ZXIgYW5kIHNldHRlciBmb3IgZ2FtZS5zd2l0Y2hLZXlzDQogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZ2FtZSwgJ3N3aXRjaEtleXMnLCB7DQogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIGFueSBhdHRlbXB0IHRvIGNoYW5nZSB0aGUgdmFsdWUNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgY29uc29sZS5sb2coInN3aXRjaEtleXMgZW5hYmxlZCEiKTsNCiAgICAgICAgfSk7DQogICAgICAgIHN3aXRjaEtleXNDb250YWluZXIuYXBwZW5kQ2hpbGQoZW5hYmxlU3dpdGNoS2V5c0J1dHRvbik7DQoNCiAgICAgICAgLy8gQWRkIGEgYnV0dG9uIHRvIGRpc2FibGUgc3dpdGNoS2V5cw0KICAgICAgICB2YXIgZGlzYWJsZVN3aXRjaEtleXNCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsNCiAgICAgICAgZGlzYWJsZVN3aXRjaEtleXNCdXR0b24udGV4dENvbnRlbnQgPSAiRGlzYWJsZSBzd2l0Y2hLZXlzIjsNCiAgICAgICAgZGlzYWJsZVN3aXRjaEtleXNCdXR0b24uc3R5bGUubWFyZ2luVG9wID0gIjEwcHgiOw0KICAgICAgICBkaXNhYmxlU3dpdGNoS2V5c0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIFJlc3RvcmUgdGhlIG9yaWdpbmFsIGJlaGF2aW9yIG9mIGdhbWUuc3dpdGNoS2V5cw0KICAgICAgICAgICAgZGVsZXRlIGdhbWUuc3dpdGNoS2V5czsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJzd2l0Y2hLZXlzIGRpc2FibGVkISIpOw0KICAgICAgICB9KTsNCiAgICAgICAgc3dpdGNoS2V5c0NvbnRhaW5lci5hcHBlbmRDaGlsZChkaXNhYmxlU3dpdGNoS2V5c0J1dHRvbik7DQoNCiAgICAgICAgLy8gU2V0dGluZ3MgYnV0dG9uIHRvIG9wZW4gdGhlIHNldHRpbmdzIHRhYg0KICAgICAgICB2YXIgc2V0dGluZ3NCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsNCiAgICAgICAgc2V0dGluZ3NCdXR0b24udGV4dENvbnRlbnQgPSAiU2V0dGluZ3MiOw0KICAgICAgICBzZXR0aW5nc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHNldHRpbmdzVGFiLnN0eWxlLmRpc3BsYXkgPSBzZXR0aW5nc1RhYi5zdHlsZS5kaXNwbGF5ID09PSAibm9uZSIgPyAiYmxvY2siIDogIm5vbmUiOw0KICAgICAgICB9KTsNCiAgICAgICAgZGVidWdNZW51LmFwcGVuZENoaWxkKHNldHRpbmdzQnV0dG9uKTsNCg0KICAgICAgICAvLyBIaWRlL3Nob3cgbWVkaWEgdGFiDQogICAgICAgIHZhciBtZWRpYVRhYkJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOw0KICAgICAgICBtZWRpYVRhYkJ1dHRvbi50ZXh0Q29udGVudCA9ICJNZWRpYSBTZXR0aW5ncyI7DQogICAgICAgIG1lZGlhVGFiQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgbWVkaWFUYWIuc3R5bGUuZGlzcGxheSA9IG1lZGlhVGFiLnN0eWxlLmRpc3BsYXkgPT09ICJub25lIiA/ICJibG9jayIgOiAibm9uZSI7DQogICAgICAgIH0pOw0KICAgICAgICBkZWJ1Z01lbnUuYXBwZW5kQ2hpbGQobWVkaWFUYWJCdXR0b24pOw0KDQogICAgICAgIC8vIFNldHRpbmdzIHRhYiBjb250YWluZXINCiAgICAgICAgdmFyIHNldHRpbmdzVGFiID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgIHNldHRpbmdzVGFiLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsNCiAgICAgICAgc2V0dGluZ3NUYWIuc3R5bGUudG9wID0gIjEwcHgiOw0KICAgICAgICBzZXR0aW5nc1RhYi5zdHlsZS5sZWZ0ID0gIjEwcHgiOw0KICAgICAgICBzZXR0aW5nc1RhYi5zdHlsZS5mb250U2l6ZSA9ICIxNnB4IjsNCiAgICAgICAgc2V0dGluZ3NUYWIuc3R5bGUuY29sb3IgPSAid2hpdGUiOyAvLyBGaXhlZCBxdW90YXRpb24gbWFya3MNCiAgICAgICAgc2V0dGluZ3NUYWIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gInJnYmEoMCwgMCwgMCwgMC41KSI7DQogICAgICAgIHNldHRpbmdzVGFiLnN0eWxlLnBhZGRpbmcgPSAiMTBweCI7DQogICAgICAgIHNldHRpbmdzVGFiLnN0eWxlLmJvcmRlclJhZGl1cyA9ICI1cHgiOw0KICAgICAgICBzZXR0aW5nc1RhYi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOyAvLyBJbml0aWFsbHkgaGlkZGVuDQogICAgICAgIHNldHRpbmdzVGFiLnN0eWxlLnJlc2l6ZSA9ICJib3RoIjsgLy8gTWFrZSByZXNpemFibGUNCiAgICAgICAgc2V0dGluZ3NUYWIuc3R5bGUub3ZlcmZsb3cgPSAiYXV0byI7IC8vIEFkZCBvdmVyZmxvdyBmb3IgcmVzaXppbmcNCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzZXR0aW5nc1RhYik7DQoNCiAgICAgICAgLy8gU2V0dGluZ3MgdGFiIGhlYWRlcg0KICAgICAgICB2YXIgc2V0dGluZ3NIZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgc2V0dGluZ3NIZWFkZXIuc3R5bGUuY3Vyc29yID0gIm1vdmUiOw0KICAgICAgICBzZXR0aW5nc0hlYWRlci5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiIzMzMyI7DQogICAgICAgIHNldHRpbmdzSGVhZGVyLnN0eWxlLmNvbG9yID0gIiNmZmYiOw0KICAgICAgICBzZXR0aW5nc0hlYWRlci5zdHlsZS5wYWRkaW5nID0gIjVweCI7DQogICAgICAgIHNldHRpbmdzSGVhZGVyLnN0eWxlLmZvbnRXZWlnaHQgPSAiYm9sZCI7DQogICAgICAgIHNldHRpbmdzSGVhZGVyLnRleHRDb250ZW50ID0gIlNldHRpbmdzIjsNCiAgICAgICAgc2V0dGluZ3NUYWIuYXBwZW5kQ2hpbGQoc2V0dGluZ3NIZWFkZXIpOw0KDQogICAgICAgIC8vIElucHV0IGZvciBzZWxlY3RpbmcgYmFja2dyb3VuZCBjb2xvcg0KICAgICAgICB2YXIgYmdDb2xvcklucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsNCiAgICAgICAgYmdDb2xvcklucHV0LnR5cGUgPSAiY29sb3IiOw0KICAgICAgICBiZ0NvbG9ySW5wdXQudmFsdWUgPSAiIzAwMDAwMCI7IC8vIERlZmF1bHQgY29sb3INCiAgICAgICAgYmdDb2xvcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgZGVidWdNZW51LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGJnQ29sb3JJbnB1dC52YWx1ZTsNCiAgICAgICAgfSk7DQogICAgICAgIHNldHRpbmdzVGFiLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIikpOw0KICAgICAgICBzZXR0aW5nc1RhYi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiRGVidWcgTWVudSBCYWNrZ3JvdW5kIENvbG9yOiAiKSk7DQogICAgICAgIHNldHRpbmdzVGFiLmFwcGVuZENoaWxkKGJnQ29sb3JJbnB1dCk7DQoNCiAgICAgICAgLy8gSW5wdXQgZm9yIGNoYW5naW5nIHRleHQgY29sb3INCiAgICAgICAgdmFyIHRleHRDb2xvcklucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsNCiAgICAgICAgdGV4dENvbG9ySW5wdXQudHlwZSA9ICJjb2xvciI7DQogICAgICAgIHRleHRDb2xvcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgZGVidWdNZW51LnN0eWxlLmNvbG9yID0gdGV4dENvbG9ySW5wdXQudmFsdWU7DQogICAgICAgICAgICBzZXR0aW5nc1RhYi5zdHlsZS5jb2xvciA9IHRleHRDb2xvcklucHV0LnZhbHVlOyAvLyBDaGFuZ2UgdGV4dCBjb2xvciBmb3Igc2V0dGluZ3MgdGFiDQogICAgICAgIH0pOw0KICAgICAgICBzZXR0aW5nc1RhYi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpKTsNCiAgICAgICAgc2V0dGluZ3NUYWIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIlRleHQgQ29sb3I6ICIpKTsNCiAgICAgICAgc2V0dGluZ3NUYWIuYXBwZW5kQ2hpbGQodGV4dENvbG9ySW5wdXQpOw0KDQogICAgICAgIC8vIElucHV0IGZvciBhZGp1c3RpbmcgYmFja2dyb3VuZCBjb2xvciBhbmQgaW1hZ2Ugb3BhY2l0eQ0KICAgICAgICB2YXIgYmdPcGFjaXR5SW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOw0KICAgICAgICBiZ09wYWNpdHlJbnB1dC50eXBlID0gInJhbmdlIjsNCiAgICAgICAgYmdPcGFjaXR5SW5wdXQubWluID0gIjAiOw0KICAgICAgICBiZ09wYWNpdHlJbnB1dC5tYXggPSAiMSI7DQogICAgICAgIGJnT3BhY2l0eUlucHV0LnN0ZXAgPSAiMC4xIjsNCiAgICAgICAgYmdPcGFjaXR5SW5wdXQudmFsdWUgPSAiMSI7IC8vIERlZmF1bHQgdmFsdWUNCiAgICAgICAgYmdPcGFjaXR5SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgY3VycmVudENvbG9yID0gZGVidWdNZW51LnN0eWxlLmJhY2tncm91bmRDb2xvcjsNCiAgICAgICAgICAgIHZhciBjdXJyZW50SW1hZ2UgPSBkZWJ1Z01lbnUuc3R5bGUuYmFja2dyb3VuZEltYWdlOw0KICAgICAgICAgICAgdmFyIGN1cnJlbnRPcGFjaXR5ID0gYmdPcGFjaXR5SW5wdXQudmFsdWU7DQogICAgICAgICAgICBkZWJ1Z01lbnUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gcmdiYVRvUmdiYUEoY3VycmVudENvbG9yLCBjdXJyZW50T3BhY2l0eSk7DQogICAgICAgICAgICBpZiAoY3VycmVudEltYWdlICYmIGN1cnJlbnRJbWFnZSAhPT0gJ25vbmUnKSB7DQogICAgICAgICAgICAgICAgZGVidWdNZW51LnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IHJnYmFUb1JnYmFBKGN1cnJlbnRJbWFnZSwgY3VycmVudE9wYWNpdHkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgc2V0dGluZ3NUYWIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7DQogICAgICAgIHNldHRpbmdzVGFiLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJCYWNrZ3JvdW5kIENvbG9yIE9wYWNpdHk6ICIpKTsNCiAgICAgICAgc2V0dGluZ3NUYWIuYXBwZW5kQ2hpbGQoYmdPcGFjaXR5SW5wdXQpOw0KDQogICAgICAgIC8vIEZ1bmN0aW9uIHRvIGNvbnZlcnQgUkdCQSBjb2xvciB0byBSR0JBIHdpdGggc3BlY2lmaWVkIG9wYWNpdHkNCiAgICAgICAgZnVuY3Rpb24gcmdiYVRvUmdiYUEocmdiYSwgb3BhY2l0eSkgew0KICAgICAgICAgICAgcmV0dXJuIHJnYmEucmVwbGFjZSgvcmdiYT9cKChbXildKylcKS8sIChtYXRjaCwgY29sb3JzKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgW3IsIGcsIGIsIGFdID0gY29sb3JzLnNwbGl0KCIsIikubWFwKGMgPT4gYy50cmltKCkpOw0KICAgICAgICAgICAgICAgIHJldHVybiBgcmdiYSgke3J9LCAke2d9LCAke2J9LCAke29wYWNpdHl9KWA7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIENyZWF0ZSBhIHRhYiBmb3IgaW1hZ2UgYW5kIHZpZGVvIHNldHRpbmdzDQogICAgICAgIHZhciBtZWRpYVRhYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICBtZWRpYVRhYi5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7DQogICAgICAgIG1lZGlhVGFiLnN0eWxlLnRvcCA9ICIxMHB4IjsNCiAgICAgICAgbWVkaWFUYWIuc3R5bGUubGVmdCA9ICIxMHB4IjsNCiAgICAgICAgbWVkaWFUYWIuc3R5bGUuZm9udFNpemUgPSAiMTZweCI7DQogICAgICAgIG1lZGlhVGFiLnN0eWxlLmNvbG9yID0gIndoaXRlIjsNCiAgICAgICAgbWVkaWFUYWIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gInJnYmEoMCwgMCwgMCwgMC41KSI7DQogICAgICAgIG1lZGlhVGFiLnN0eWxlLnBhZGRpbmcgPSAiMTBweCI7DQogICAgICAgIG1lZGlhVGFiLnN0eWxlLmJvcmRlclJhZGl1cyA9ICI1cHgiOw0KICAgICAgICBtZWRpYVRhYi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOyAvLyBJbml0aWFsbHkgaGlkZGVuDQogICAgICAgIG1lZGlhVGFiLnN0eWxlLnJlc2l6ZSA9ICJib3RoIjsgLy8gTWFrZSByZXNpemFibGUNCiAgICAgICAgbWVkaWFUYWIuc3R5bGUub3ZlcmZsb3cgPSAiYXV0byI7IC8vIEFkZCBvdmVyZmxvdyBmb3IgcmVzaXppbmcNCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtZWRpYVRhYik7DQoNCiAgICAgICAgLy8gTWVkaWEgdGFiIGhlYWRlcg0KICAgICAgICB2YXIgbWVkaWFIZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgbWVkaWFIZWFkZXIuc3R5bGUuY3Vyc29yID0gIm1vdmUiOw0KICAgICAgICBtZWRpYUhlYWRlci5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiIzMzMyI7DQogICAgICAgIG1lZGlhSGVhZGVyLnN0eWxlLmNvbG9yID0gIiNmZmYiOw0KICAgICAgICBtZWRpYUhlYWRlci5zdHlsZS5wYWRkaW5nID0gIjVweCI7DQogICAgICAgIG1lZGlhSGVhZGVyLnN0eWxlLmZvbnRXZWlnaHQgPSAiYm9sZCI7DQogICAgICAgIG1lZGlhSGVhZGVyLnRleHRDb250ZW50ID0gIk1lZGlhIFNldHRpbmdzIjsNCiAgICAgICAgbWVkaWFUYWIuYXBwZW5kQ2hpbGQobWVkaWFIZWFkZXIpOw0KDQogICAgICAgIC8vIElucHV0IGZvciB1cGxvYWRpbmcgYmFja2dyb3VuZCB2aWRlbyBmaWxlIHRvIHRoZSBkZWJ1ZyBtZW51DQogICAgICAgIHZhciBkZWJ1Z01lbnVCZ1ZpZGVvSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOw0KICAgICAgICBkZWJ1Z01lbnVCZ1ZpZGVvSW5wdXQudHlwZSA9ICJmaWxlIjsNCiAgICAgICAgZGVidWdNZW51QmdWaWRlb0lucHV0LmFjY2VwdCA9ICJ2aWRlby9tcDQiOw0KICAgICAgICBkZWJ1Z01lbnVCZ1ZpZGVvSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICB2YXIgZmlsZSA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsNCiAgICAgICAgICAgIGlmIChmaWxlKSB7DQogICAgICAgICAgICAgICAgdmFyIHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSk7DQoNCiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgZXhpc3RpbmcgdmlkZW8gaWYgcHJlc2VudA0KICAgICAgICAgICAgICAgIHZhciBleGlzdGluZ1ZpZGVvID0gZGVidWdNZW51LnF1ZXJ5U2VsZWN0b3IoInZpZGVvIik7DQogICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nVmlkZW8pIHsNCiAgICAgICAgICAgICAgICAgICAgZGVidWdNZW51LnJlbW92ZUNoaWxkKGV4aXN0aW5nVmlkZW8pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB2aWRlbyBlbGVtZW50DQogICAgICAgICAgICAgICAgdmFyIHZpZGVvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidmlkZW8iKTsNCiAgICAgICAgICAgICAgICB2aWRlby5zcmMgPSB1cmw7DQogICAgICAgICAgICAgICAgdmlkZW8uYXV0b3BsYXkgPSB0cnVlOw0KICAgICAgICAgICAgICAgIHZpZGVvLmxvb3AgPSB0cnVlOw0KICAgICAgICAgICAgICAgIHZpZGVvLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsNCiAgICAgICAgICAgICAgICB2aWRlby5zdHlsZS50b3AgPSAiMCI7DQogICAgICAgICAgICAgICAgdmlkZW8uc3R5bGUubGVmdCA9ICIwIjsNCiAgICAgICAgICAgICAgICB2aWRlby5zdHlsZS53aWR0aCA9ICIxMDAlIjsNCiAgICAgICAgICAgICAgICB2aWRlby5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7DQogICAgICAgICAgICAgICAgdmlkZW8uc3R5bGUub2JqZWN0Rml0ID0gImNvdmVyIjsNCiAgICAgICAgICAgICAgICB2aWRlby5zdHlsZS56SW5kZXggPSAiLTEiOyAvLyBFbnN1cmUgdGhlIHZpZGVvIGlzIGJlaGluZCB0aGUgY29udGVudA0KICAgICAgICAgICAgICAgIGRlYnVnTWVudS5hcHBlbmRDaGlsZCh2aWRlbyk7DQoNCiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYXVkaW8gc2xpZGVyIGZvciB2b2x1bWUgY29udHJvbA0KICAgICAgICAgICAgICAgIHZhciBhdWRpb1NsaWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQogICAgICAgICAgICAgICAgYXVkaW9TbGlkZXIudHlwZSA9ICJyYW5nZSI7DQogICAgICAgICAgICAgICAgYXVkaW9TbGlkZXIubWluID0gIjAiOw0KICAgICAgICAgICAgICAgIGF1ZGlvU2xpZGVyLm1heCA9ICIxIjsNCiAgICAgICAgICAgICAgICBhdWRpb1NsaWRlci5zdGVwID0gIjAuMDEiOw0KICAgICAgICAgICAgICAgIGF1ZGlvU2xpZGVyLnZhbHVlID0gIjAuNSI7IC8vIERlZmF1bHQgdm9sdW1lIGF0IDUwJQ0KICAgICAgICAgICAgICAgIGF1ZGlvU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICB2aWRlby52b2x1bWUgPSBhdWRpb1NsaWRlci52YWx1ZTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBtZWRpYVRhYi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpKTsNCiAgICAgICAgICAgICAgICBtZWRpYVRhYi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiRGVidWcgTWVudSBCYWNrZ3JvdW5kIFZpZGVvIFZvbHVtZTogIikpOw0KICAgICAgICAgICAgICAgIG1lZGlhVGFiLmFwcGVuZENoaWxkKGF1ZGlvU2xpZGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIG1lZGlhVGFiLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIikpOw0KICAgICAgICBtZWRpYVRhYi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiRGVidWcgTWVudSBCYWNrZ3JvdW5kIFZpZGVvOiAiKSk7DQogICAgICAgIG1lZGlhVGFiLmFwcGVuZENoaWxkKGRlYnVnTWVudUJnVmlkZW9JbnB1dCk7DQoNCiAgICAgICAgLy8gSW5wdXQgZm9yIGFkZGluZyBiYWNrZ3JvdW5kIGltYWdlKFVSTCkgdG8gdGhlIGRlYnVnIG1lbnUNCiAgICAgICAgdmFyIGJnSW1hZ2VJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQogICAgICAgIGJnSW1hZ2VJbnB1dC50eXBlID0gInRleHQiOw0KICAgICAgICBiZ0ltYWdlSW5wdXQucGxhY2Vob2xkZXIgPSAiRW50ZXIgYmFja2dyb3VuZCBpbWFnZSBVUkwiOw0KICAgICAgICBiZ0ltYWdlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBkZWJ1Z01lbnUuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgke2JnSW1hZ2VJbnB1dC52YWx1ZX0pYDsNCiAgICAgICAgfSk7DQogICAgICAgIG1lZGlhVGFiLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIikpOw0KICAgICAgICBtZWRpYVRhYi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiQmFja2dyb3VuZCBJbWFnZSBVUkwoRGVidWcgTWVudSk6ICIpKTsNCiAgICAgICAgbWVkaWFUYWIuYXBwZW5kQ2hpbGQoYmdJbWFnZUlucHV0KTsNCg0KICAgICAgICAvLyBJbnB1dCBmb3IgYWRkaW5nIGJhY2tncm91bmQgaW1hZ2UgdG8gdGhlIGRlYnVnIG1lbnUNCiAgICAgICAgdmFyIGJnSW1hZ2VJbnB1dERlYnVnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsNCiAgICAgICAgYmdJbWFnZUlucHV0RGVidWcudHlwZSA9ICJmaWxlIjsNCiAgICAgICAgYmdJbWFnZUlucHV0RGVidWcuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgY29uc3QgZmlsZSA9IGJnSW1hZ2VJbnB1dERlYnVnLmZpbGVzWzBdOw0KICAgICAgICAgICAgaWYgKGZpbGUpIHsNCiAgICAgICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOw0KICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgICAgICAgICBkZWJ1Z01lbnUuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgke2UudGFyZ2V0LnJlc3VsdH0pYDsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgbWVkaWFUYWIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7DQogICAgICAgIG1lZGlhVGFiLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJCYWNrZ3JvdW5kIEltYWdlIChEZWJ1ZyBNZW51KTogIikpOw0KICAgICAgICBtZWRpYVRhYi5hcHBlbmRDaGlsZChiZ0ltYWdlSW5wdXREZWJ1Zyk7DQoNCiAgICAgICAgLy8gSW5wdXQgZm9yIGFkZGluZyBiYWNrZ3JvdW5kIGltYWdlIChVUkwpIHRvIHRoZSBzZXR0aW5ncyBtZW51DQogICAgICAgIHZhciBzZXR0aW5nc1RhYkJnSW1hZ2VJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQogICAgICAgIHNldHRpbmdzVGFiQmdJbWFnZUlucHV0LnR5cGUgPSAidGV4dCI7DQogICAgICAgIHNldHRpbmdzVGFiQmdJbWFnZUlucHV0LnBsYWNlaG9sZGVyID0gIkVudGVyIGJhY2tncm91bmQgaW1hZ2UgVVJMIGZvciBzZXR0aW5ncyBtZW51IjsNCiAgICAgICAgc2V0dGluZ3NUYWJCZ0ltYWdlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBzZXR0aW5nc1RhYi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKCR7c2V0dGluZ3NUYWJCZ0ltYWdlSW5wdXQudmFsdWV9KWA7DQogICAgICAgIH0pOw0KICAgICAgICBtZWRpYVRhYi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpKTsNCiAgICAgICAgbWVkaWFUYWIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIkJhY2tncm91bmQgSW1hZ2UgVVJMKHNldHRpbmdzKTogIikpOw0KICAgICAgICBtZWRpYVRhYi5hcHBlbmRDaGlsZChzZXR0aW5nc1RhYkJnSW1hZ2VJbnB1dCk7DQoNCiAgICAgICAgLy8gSW5wdXQgZm9yIGFkZGluZyBiYWNrZ3JvdW5kIGltYWdlIHRvIHRoZSBzZXR0aW5ncyBtZW51DQogICAgICAgIHZhciBiZ0ltYWdlSW5wdXRTZXR0aW5ncyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQogICAgICAgIGJnSW1hZ2VJbnB1dFNldHRpbmdzLnR5cGUgPSAiZmlsZSI7DQogICAgICAgIGJnSW1hZ2VJbnB1dFNldHRpbmdzLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBiZ0ltYWdlSW5wdXRTZXR0aW5ncy5maWxlc1swXTsNCiAgICAgICAgICAgIGlmIChmaWxlKSB7DQogICAgICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsNCiAgICAgICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NUYWIuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgke2UudGFyZ2V0LnJlc3VsdH0pYDsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgbWVkaWFUYWIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7DQogICAgICAgIG1lZGlhVGFiLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJCYWNrZ3JvdW5kIEltYWdlIChTZXR0aW5ncyBNZW51KTogIikpOw0KICAgICAgICBtZWRpYVRhYi5hcHBlbmRDaGlsZChiZ0ltYWdlSW5wdXRTZXR0aW5ncyk7DQoNCiAgICAgICAgLy8gSW5wdXQgZm9yIGJhY2tncm91bmQgc2l6ZQ0KICAgICAgICB2YXIgYmdTaXplU2VsZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2VsZWN0Iik7DQogICAgICAgIGJnU2l6ZVNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBkZWJ1Z01lbnUuc3R5bGUuYmFja2dyb3VuZFNpemUgPSBiZ1NpemVTZWxlY3QudmFsdWU7DQogICAgICAgIH0pOw0KICAgICAgICB2YXIgYmdTaXplT3B0aW9ucyA9IFsNCiAgICAgICAgICAgICJjb3ZlciIsDQogICAgICAgICAgICAiY29udGFpbiIsDQogICAgICAgICAgICAiYXV0byINCiAgICAgICAgXTsNCiAgICAgICAgYmdTaXplT3B0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChvcHRpb24pIHsNCiAgICAgICAgICAgIHZhciBiZ1NpemVPcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsNCiAgICAgICAgICAgIGJnU2l6ZU9wdGlvbi50ZXh0Q29udGVudCA9IG9wdGlvbjsNCiAgICAgICAgICAgIGJnU2l6ZVNlbGVjdC5hcHBlbmRDaGlsZChiZ1NpemVPcHRpb24pOw0KICAgICAgICB9KTsNCiAgICAgICAgbWVkaWFUYWIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7DQogICAgICAgIG1lZGlhVGFiLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJCYWNrZ3JvdW5kIFNpemU6ICIpKTsNCiAgICAgICAgbWVkaWFUYWIuYXBwZW5kQ2hpbGQoYmdTaXplU2VsZWN0KTsNCg0KICAgICAgICAvLyBJbnB1dCBmb3IgYmFja2dyb3VuZCByZXBlYXQNCiAgICAgICAgdmFyIGJnUmVwZWF0U2VsZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2VsZWN0Iik7DQogICAgICAgIGJnUmVwZWF0U2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGRlYnVnTWVudS5zdHlsZS5iYWNrZ3JvdW5kUmVwZWF0ID0gYmdSZXBlYXRTZWxlY3QudmFsdWUgPT09ICJ0cnVlIiA/ICJyZXBlYXQiIDogIm5vLXJlcGVhdCI7DQogICAgICAgIH0pOw0KICAgICAgICB2YXIgYmdSZXBlYXRPcHRpb25zID0gWw0KICAgICAgICAgICAgInRydWUiLA0KICAgICAgICAgICAgImZhbHNlIg0KICAgICAgICBdOw0KICAgICAgICBiZ1JlcGVhdE9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAob3B0aW9uKSB7DQogICAgICAgICAgICB2YXIgYmdSZXBlYXRPcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsNCiAgICAgICAgICAgIGJnUmVwZWF0T3B0aW9uLnRleHRDb250ZW50ID0gb3B0aW9uOw0KICAgICAgICAgICAgYmdSZXBlYXRTZWxlY3QuYXBwZW5kQ2hpbGQoYmdSZXBlYXRPcHRpb24pOw0KICAgICAgICB9KTsNCiAgICAgICAgbWVkaWFUYWIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7DQogICAgICAgIG1lZGlhVGFiLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJCYWNrZ3JvdW5kIFJlcGVhdDogIikpOw0KICAgICAgICBtZWRpYVRhYi5hcHBlbmRDaGlsZChiZ1JlcGVhdFNlbGVjdCk7DQoNCiAgICAgICAgLy8gTWFrZSB0aGUgbWVkaWEgdGFiIGRyYWdnYWJsZQ0KICAgICAgICBsZXQgaXNNZWRpYURyYWdnaW5nID0gZmFsc2U7DQogICAgICAgIGxldCBtZWRpYU9mZnNldFgsIG1lZGlhT2Zmc2V0WTsNCg0KICAgICAgICBtZWRpYUhlYWRlci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgaXNNZWRpYURyYWdnaW5nID0gdHJ1ZTsNCiAgICAgICAgICAgIG1lZGlhT2Zmc2V0WCA9IGUuY2xpZW50WCAtIG1lZGlhVGFiLm9mZnNldExlZnQ7DQogICAgICAgICAgICBtZWRpYU9mZnNldFkgPSBlLmNsaWVudFkgLSBtZWRpYVRhYi5vZmZzZXRUb3A7DQogICAgICAgIH0pOw0KDQogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICBpZiAoaXNNZWRpYURyYWdnaW5nKSB7DQogICAgICAgICAgICAgICAgbWVkaWFUYWIuc3R5bGUubGVmdCA9IChlLmNsaWVudFggLSBtZWRpYU9mZnNldFgpICsgJ3B4JzsNCiAgICAgICAgICAgICAgICBtZWRpYVRhYi5zdHlsZS50b3AgPSAoZS5jbGllbnRZIC0gbWVkaWFPZmZzZXRZKSArICdweCc7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBpc01lZGlhRHJhZ2dpbmcgPSBmYWxzZTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gSW5wdXQgZm9yIGNoYW5naW5nIGZvbnQgZmFtaWx5DQogICAgICAgIHZhciBmb250U2VsZWN0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKTsNCiAgICAgICAgZm9udFNlbGVjdG9yLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBzZWxlY3RlZEZvbnQgPSBmb250U2VsZWN0b3IudmFsdWU7DQogICAgICAgICAgICBkZWJ1Z01lbnUuc3R5bGUuZm9udEZhbWlseSA9IHNlbGVjdGVkRm9udDsNCiAgICAgICAgICAgIHNldHRpbmdzVGFiLnN0eWxlLmZvbnRGYW1pbHkgPSBzZWxlY3RlZEZvbnQ7DQogICAgICAgIH0pOw0KICAgICAgICB2YXIgZm9udE9wdGlvbnMgPSBbDQogICAgICAgICAgICAiQWJhZGkgTVQgQ29uZGVuc2VkIExpZ2h0IiwNCiAgICAgICAgICAgICJBbGJlcnR1cyBFeHRyYSBCb2xkIiwNCiAgICAgICAgICAgICJBbGJlcnR1cyBNZWRpdW0iLA0KICAgICAgICAgICAgIkFudGlxdWUgT2xpdmUiLA0KICAgICAgICAgICAgIkFyaWFsIiwNCiAgICAgICAgICAgICJBcmlhbCBCbGFjayIsDQogICAgICAgICAgICAiQXJpYWwgTVQiLA0KICAgICAgICAgICAgIkFyaWFsIE5hcnJvdyIsDQogICAgICAgICAgICAiQmF6b29rYSIsDQogICAgICAgICAgICAiQm9vayBBbnRpcXVhIiwNCiAgICAgICAgICAgICJCb29rbWFuIE9sZCBTdHlsZSIsDQogICAgICAgICAgICAiQm91bGRlciIsDQogICAgICAgICAgICAiQ2FsaXN0byBNVCIsDQogICAgICAgICAgICAiQ2FsbGlncmFwaGVyIiwNCiAgICAgICAgICAgICJDZW50dXJ5IEdvdGhpYyIsDQogICAgICAgICAgICAiQ2VudHVyeSBTY2hvb2xib29rIiwNCiAgICAgICAgICAgICJDZXphbm5lIiwNCiAgICAgICAgICAgICJDRyBPbWVnYSIsDQogICAgICAgICAgICAiQ0cgVGltZXMiLA0KICAgICAgICAgICAgIkNoYXJsZXN3b3J0aCIsDQogICAgICAgICAgICAiQ2hhdWNlciIsDQogICAgICAgICAgICAiQ2xhcmVuZG9uIENvbmRlbnNlZCIsDQogICAgICAgICAgICAiQ29taWMgU2FucyBNUyIsDQogICAgICAgICAgICAiQ29wcGVycGxhdGUgR290aGljIEJvbGQiLA0KICAgICAgICAgICAgIkNvcHBlcnBsYXRlIEdvdGhpYyBMaWdodCIsDQogICAgICAgICAgICAiQ29ybmVyc3RvbmUiLA0KICAgICAgICAgICAgIkhhZXR0ZW5zY2h3ZWlsZXIiLA0KICAgICAgICAgICAgIkhlYXRoZXIiLA0KICAgICAgICAgICAgIkhlbHZldGljYSIsDQogICAgICAgICAgICAiTWFyaWdvbGQiLA0KICAgICAgICAgICAgIk1hcmtldCIsDQogICAgICAgICAgICAiTWF0aXNzZSBJVEMiLA0KICAgICAgICAgICAgIk1TIExpbmVEcmF3IiwNCiAgICAgICAgICAgICJOZXdzIEdvdGhpY01UIiwNCiAgICAgICAgICAgICJPQ1IgQSBFeHRlbmRlZCIsDQogICAgICAgICAgICAiT2xkIENlbnR1cnkiLA0KICAgICAgICAgICAgIlBlZ2FzdXMiLA0KICAgICAgICAgICAgIlBpY2t3aWNrIiwNCiAgICAgICAgICAgICJQb3N0ZXIiLA0KICAgICAgICAgICAgIlB5dGhhZ29yYXMiLA0KICAgICAgICAgICAgIlNjZXB0cmUiLA0KICAgICAgICAgICAgIlNoZXJ3b29kIiwNCiAgICAgICAgICAgICJTaWduYm9hcmQiLA0KICAgICAgICAgICAgIlNvY2tldCIsDQogICAgICAgICAgICAiU3RlYW1lciIsDQogICAgICAgICAgICAiU3Rvcnlib29rIiwNCiAgICAgICAgICAgICJTdWJ3YXkiLA0KICAgICAgICAgICAgIlRhaG9tYSIsDQogICAgICAgICAgICAiVGVjaG5pY2FsIiwNCiAgICAgICAgICAgICJUZWxldHlwZSIsDQogICAgICAgICAgICAiVGVtcHVzIFNhbnMgSVRDIiwNCiAgICAgICAgICAgICJUaW1lcyIsDQogICAgICAgICAgICAiVGltZXMgTmV3IFJvbWFuIiwNCiAgICAgICAgICAgICJUaW1lcyBOZXcgUm9tYW4gUFMiLA0KICAgICAgICAgICAgIlRyZWJ1Y2hldCBNUyIsDQogICAgICAgICAgICAiVmVyZGFuYSIsDQogICAgICAgICAgICAiV2VzdG1pbnN0ZXIiDQogICAgICAgIF07DQogICAgICAgIGZvbnRPcHRpb25zLmZvckVhY2goZnVuY3Rpb24gKG9wdGlvbikgew0KICAgICAgICAgICAgdmFyIGZvbnRPcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsNCiAgICAgICAgICAgIGZvbnRPcHRpb24udGV4dENvbnRlbnQgPSBvcHRpb247DQogICAgICAgICAgICBmb250U2VsZWN0b3IuYXBwZW5kQ2hpbGQoZm9udE9wdGlvbik7DQogICAgICAgIH0pOw0KICAgICAgICBzZXR0aW5nc1RhYi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpKTsNCiAgICAgICAgc2V0dGluZ3NUYWIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIkZvbnQgRmFtaWx5OiAiKSk7DQogICAgICAgIHNldHRpbmdzVGFiLmFwcGVuZENoaWxkKGZvbnRTZWxlY3Rvcik7DQoNCiAgICAgICAgLy8gU2V0IGRlZmF1bHQgZm9udCBmYW1pbHkgZm9yIGRlYnVnIGFuZCBzZXR0aW5ncyBtZW51DQogICAgICAgIGRlYnVnTWVudS5zdHlsZS5mb250RmFtaWx5ID0gIkFyaWFsIjsNCiAgICAgICAgc2V0dGluZ3NUYWIuc3R5bGUuZm9udEZhbWlseSA9ICJBcmlhbCI7DQoNCiAgICAgICAgLy8gQ3JlYXRlIGEgY29udGFpbmVyIGZvciB0aGUgaW5wdXQgdHJhY2tlcg0KICAgICAgICB2YXIgaW5wdXRUcmFja2VyQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgIGlucHV0VHJhY2tlckNvbnRhaW5lci5zdHlsZS5tYXJnaW5Ub3AgPSAiMjBweCI7DQogICAgICAgIGRlYnVnTWVudS5hcHBlbmRDaGlsZChpbnB1dFRyYWNrZXJDb250YWluZXIpOw0KDQogICAgICAgIC8vIENyZWF0ZSBsYWJlbHMgZm9yIFcsIEEsIFMsIEQNCiAgICAgICAgdmFyIHdMYWJlbCA9IGNyZWF0ZUlucHV0TGFiZWwoIlciKTsNCiAgICAgICAgdmFyIGFMYWJlbCA9IGNyZWF0ZUlucHV0TGFiZWwoIkEiKTsNCiAgICAgICAgdmFyIHNMYWJlbCA9IGNyZWF0ZUlucHV0TGFiZWwoIlMiKTsNCiAgICAgICAgdmFyIGRMYWJlbCA9IGNyZWF0ZUlucHV0TGFiZWwoIkQiKTsNCiAgICAgICAgdmFyIHJMYWJlbCA9IGNyZWF0ZUlucHV0TGFiZWwoIlJlc2V0IiwgIjYwcHgiKTsNCg0KICAgICAgICAvLyBDcmVhdGUgbGFiZWxzIGZvciBhcnJvdyBrZXlzDQogICAgICAgIHZhciB1cExhYmVsID0gY3JlYXRlSW5wdXRMYWJlbCgiw6LigKDigJgiKTsNCiAgICAgICAgdmFyIGxlZnRMYWJlbCA9IGNyZWF0ZUlucHV0TGFiZWwoIsOi4oCgwpAiKTsNCiAgICAgICAgdmFyIGRvd25MYWJlbCA9IGNyZWF0ZUlucHV0TGFiZWwoIsOi4oCg4oCcIik7DQogICAgICAgIHZhciByaWdodExhYmVsID0gY3JlYXRlSW5wdXRMYWJlbCgiw6LigKDigJkiKTsNCg0KICAgICAgICAvLyBBcHBlbmQgbGFiZWxzIHRvIHRoZSBpbnB1dCB0cmFja2VyIGNvbnRhaW5lcg0KICAgICAgICBbaW5wdXRUcmFja2VyQ29udGFpbmVyLCBpbnB1dFRyYWNrZXJDb250YWluZXJdLmZvckVhY2goY29udGFpbmVyID0+IHsNCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh3TGFiZWwpOw0KICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGFMYWJlbCk7DQogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc0xhYmVsKTsNCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkTGFiZWwpOw0KICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHJMYWJlbCk7DQogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7IC8vIEFkZCBsaW5lIGJyZWFrDQogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodXBMYWJlbCk7DQogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobGVmdExhYmVsKTsNCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkb3duTGFiZWwpOw0KICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHJpZ2h0TGFiZWwpOw0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBGdW5jdGlvbiB0byBjcmVhdGUgaW5wdXQgbGFiZWxzDQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUlucHV0TGFiZWwoa2V5LCB3aWR0aCA9ICIzMHB4Iikgew0KICAgICAgICAgICAgdmFyIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICBsYWJlbC50ZXh0Q29udGVudCA9IGtleTsNCiAgICAgICAgICAgIGxhYmVsLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsNCiAgICAgICAgICAgIGxhYmVsLnN0eWxlLndpZHRoID0gd2lkdGg7IC8vIFNldCB0aGUgd2lkdGggYmFzZWQgb24gdGhlIHBhcmFtZXRlcg0KICAgICAgICAgICAgbGFiZWwuc3R5bGUuaGVpZ2h0ID0gIjMwcHgiOw0KICAgICAgICAgICAgbGFiZWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gImJsYWNrIjsNCiAgICAgICAgICAgIGxhYmVsLnN0eWxlLmNvbG9yID0gIndoaXRlIjsNCiAgICAgICAgICAgIGxhYmVsLnN0eWxlLnRleHRBbGlnbiA9ICJjZW50ZXIiOw0KICAgICAgICAgICAgbGFiZWwuc3R5bGUucGFkZGluZ1RvcCA9ICI4cHgiOw0KICAgICAgICAgICAgbGFiZWwuc3R5bGUuYm9yZGVyUmFkaXVzID0gIjVweCI7DQogICAgICAgICAgICBsYWJlbC5zdHlsZS5tYXJnaW5SaWdodCA9ICI1cHgiOw0KICAgICAgICAgICAgcmV0dXJuIGxhYmVsOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gRnVuY3Rpb24gdG8gdG9nZ2xlIHRoZSBiYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBsYWJlbHMgd2hlbiBjb3JyZXNwb25kaW5nIGtleXMgYXJlIHByZXNzZWQNCiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlTGFiZWxDb2xvcihsYWJlbCwgaXNBY3RpdmUpIHsNCiAgICAgICAgICAgIGlmIChpc0FjdGl2ZSkgew0KICAgICAgICAgICAgICAgIGxhYmVsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICJncmVlbiI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGxhYmVsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICJibGFjayI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXJzIHRvIHRyYWNrIGtleWRvd24gYW5kIGtleXVwIGV2ZW50cyBmb3IgVywgQSwgUywgRA0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAidyIpIHsNCiAgICAgICAgICAgICAgICB0b2dnbGVMYWJlbENvbG9yKHdMYWJlbCwgdHJ1ZSk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gImEiKSB7DQogICAgICAgICAgICAgICAgdG9nZ2xlTGFiZWxDb2xvcihhTGFiZWwsIHRydWUpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXkgPT09ICJzIikgew0KICAgICAgICAgICAgICAgIHRvZ2dsZUxhYmVsQ29sb3Ioc0xhYmVsLCB0cnVlKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5ID09PSAiZCIpIHsNCiAgICAgICAgICAgICAgICB0b2dnbGVMYWJlbENvbG9yKGRMYWJlbCwgdHJ1ZSk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gInIiKSB7DQogICAgICAgICAgICAgICAgdG9nZ2xlTGFiZWxDb2xvcihyTGFiZWwsIHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXl1cCIsIGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gInciKSB7DQogICAgICAgICAgICAgICAgdG9nZ2xlTGFiZWxDb2xvcih3TGFiZWwsIGZhbHNlKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5ID09PSAiYSIpIHsNCiAgICAgICAgICAgICAgICB0b2dnbGVMYWJlbENvbG9yKGFMYWJlbCwgZmFsc2UpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXkgPT09ICJzIikgew0KICAgICAgICAgICAgICAgIHRvZ2dsZUxhYmVsQ29sb3Ioc0xhYmVsLCBmYWxzZSk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gImQiKSB7DQogICAgICAgICAgICAgICAgdG9nZ2xlTGFiZWxDb2xvcihkTGFiZWwsIGZhbHNlKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5ID09PSAiciIpIHsNCiAgICAgICAgICAgICAgICB0b2dnbGVMYWJlbENvbG9yKHJMYWJlbCwgZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXJzIHRvIHRyYWNrIGtleWRvd24gYW5kIGtleXVwIGV2ZW50cyBmb3IgYXJyb3cga2V5cw0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAiQXJyb3dVcCIpIHsNCiAgICAgICAgICAgICAgICB0b2dnbGVMYWJlbENvbG9yKHVwTGFiZWwsIHRydWUpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXkgPT09ICJBcnJvd0xlZnQiKSB7DQogICAgICAgICAgICAgICAgdG9nZ2xlTGFiZWxDb2xvcihsZWZ0TGFiZWwsIHRydWUpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXkgPT09ICJBcnJvd0Rvd24iKSB7DQogICAgICAgICAgICAgICAgdG9nZ2xlTGFiZWxDb2xvcihkb3duTGFiZWwsIHRydWUpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXkgPT09ICJBcnJvd1JpZ2h0Iikgew0KICAgICAgICAgICAgICAgIHRvZ2dsZUxhYmVsQ29sb3IocmlnaHRMYWJlbCwgdHJ1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAiQXJyb3dVcCIpIHsNCiAgICAgICAgICAgICAgICB0b2dnbGVMYWJlbENvbG9yKHVwTGFiZWwsIGZhbHNlKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5ID09PSAiQXJyb3dMZWZ0Iikgew0KICAgICAgICAgICAgICAgIHRvZ2dsZUxhYmVsQ29sb3IobGVmdExhYmVsLCBmYWxzZSk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gIkFycm93RG93biIpIHsNCiAgICAgICAgICAgICAgICB0b2dnbGVMYWJlbENvbG9yKGRvd25MYWJlbCwgZmFsc2UpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXkgPT09ICJBcnJvd1JpZ2h0Iikgew0KICAgICAgICAgICAgICAgIHRvZ2dsZUxhYmVsQ29sb3IocmlnaHRMYWJlbCwgZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICB2YXIgbGFzdEZyYW1lVGltZSA9IERhdGUubm93KCk7DQogICAgICAgIHZhciBmcmFtZUNvdW50ID0gMDsNCg0KICAgICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgY3VycmVudFRpbWUgPSBEYXRlLm5vdygpOw0KICAgICAgICAgICAgdmFyIGRlbHRhVGltZSA9IChjdXJyZW50VGltZSAtIGxhc3RGcmFtZVRpbWUpIC8gMTAwMDsgLy8gY29udmVydCBtaWxsaXNlY29uZHMgdG8gc2Vjb25kcw0KICAgICAgICAgICAgdmFyIGZwcyA9IE1hdGgucm91bmQoMSAvIGRlbHRhVGltZSk7IC8vIGNhbGN1bGF0ZSBmcmFtZXMgcGVyIHNlY29uZA0KDQogICAgICAgICAgICBmcHNUcmFja2VyLnRleHRDb250ZW50ID0gIkZQUzogIiArIGZwczsgLy8gdXBkYXRlIEZQUyBjb3VudGVyDQoNCiAgICAgICAgICAgIGxhc3RGcmFtZVRpbWUgPSBjdXJyZW50VGltZTsNCiAgICAgICAgfSwgMTAwMCAvIDYwKTsgLy8gdXBkYXRlIEZQUyBldmVyeSBzZWNvbmQNCg0KICAgICAgICB2YXIgbGFzdFggPSBwbGF5ZXIueDsNCiAgICAgICAgdmFyIGxhc3RZID0gcGxheWVyLnk7DQogICAgICAgIHZhciBsYXN0VGltZSA9IERhdGUubm93KCk7DQogICAgICAgIHZhciBjaHVua1NpemUgPSAxMDAwOyAvLyBBZGp1c3RlZCBjaHVuayBzaXplIHRvIDEwMDANCiAgICAgICAgdmFyIHN0YXJ0VGltZSA9IERhdGUubm93KCk7DQogICAgICAgIHZhciBsYXN0RnJhbWVUaW1lID0gRGF0ZS5ub3coKTsNCiAgICAgICAgdmFyIGZyYW1lQ291bnQgPSAwOw0KICAgICAgICB2YXIgdGltZXJSdW5uaW5nID0gdHJ1ZTsNCg0KICAgICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgY3VycmVudFRpbWUgPSBEYXRlLm5vdygpOw0KICAgICAgICAgICAgdmFyIGRlbHRhVGltZSA9IChjdXJyZW50VGltZSAtIGxhc3RUaW1lKSAvIDEwMDA7IC8vIGNvbnZlcnQgbWlsbGlzZWNvbmRzIHRvIHNlY29uZHMNCg0KICAgICAgICAgICAgdmFyIHggPSBwbGF5ZXIueC50b0ZpeGVkKDMpOw0KICAgICAgICAgICAgdmFyIHkgPSBwbGF5ZXIueS50b0ZpeGVkKDMpOw0KDQogICAgICAgICAgICB2YXIgdmVsb2NpdHlYID0gKChwbGF5ZXIueCAtIGxhc3RYKSAvIGRlbHRhVGltZSkudG9GaXhlZCgzKTsNCiAgICAgICAgICAgIHZhciB2ZWxvY2l0eVkgPSAoKHBsYXllci55IC0gbGFzdFkpIC8gZGVsdGFUaW1lKS50b0ZpeGVkKDMpOw0KDQogICAgICAgICAgICB2YXIgY2h1bmtYID0gTWF0aC5mbG9vcihwbGF5ZXIueCAvIGNodW5rU2l6ZSk7DQogICAgICAgICAgICB2YXIgY2h1bmtZID0gTWF0aC5mbG9vcihwbGF5ZXIueSAvIGNodW5rU2l6ZSk7DQoNCiAgICAgICAgICAgIGlmICh0aW1lclJ1bm5pbmcpIHsNCiAgICAgICAgICAgICAgICB2YXIgZWxhcHNlZFRpbWUgPSAoY3VycmVudFRpbWUgLSBzdGFydFRpbWUpIC8gMTAwMDsgLy8gY29udmVydCBtaWxsaXNlY29uZHMgdG8gc2Vjb25kcw0KICAgICAgICAgICAgICAgIGdhbWVUaW1lVHJhY2tlci50ZXh0Q29udGVudCA9ICJHYW1lIFRpbWU6ICIgKyBlbGFwc2VkVGltZS50b0ZpeGVkKDEpICsgInMiOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwb3NpdGlvblRyYWNrZXIudGV4dENvbnRlbnQgPSAiUG9zaXRpb246IChYOiAiICsgeCArICIsIFk6ICIgKyB5ICsgIikiOw0KICAgICAgICAgICAgdmVsb2NpdHlUcmFja2VyLnRleHRDb250ZW50ID0gIlZlbG9jaXR5OiAoWDogIiArIHZlbG9jaXR5WCArICIsIFk6ICIgKyB2ZWxvY2l0eVkgKyAiKSI7DQogICAgICAgICAgICBjaHVua1RyYWNrZXIudGV4dENvbnRlbnQgPSAiQ2h1bms6IChYOiAiICsgY2h1bmtYICsgIiwgWTogIiArIGNodW5rWSArICIpIjsNCg0KICAgICAgICAgICAgaWYgKHBsYXllci54ICE9PSBsYXN0WCB8fCBwbGF5ZXIueSAhPT0gbGFzdFkpIHsNCiAgICAgICAgICAgICAgICB0aW1lclJ1bm5pbmcgPSB0cnVlOyAvLyBTdGFydCB0aGUgdGltZXIgd2hlbiB0aGUgcGxheWVyIG1vdmVzDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxhc3RYID0gcGxheWVyLng7DQogICAgICAgICAgICBsYXN0WSA9IHBsYXllci55Ow0KICAgICAgICAgICAgbGFzdFRpbWUgPSBjdXJyZW50VGltZTsNCiAgICAgICAgfSwgMTAwKTsNCg0KICAgICAgICAoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgJ3VzZSBzdHJpY3QnOw0KDQogICAgICAgICAgICAvLyBGdW5jdGlvbiB0byBtb2RpZnkgdGhlIHBsYXllcidzIGRpZSBtZXRob2QNCiAgICAgICAgICAgIGZ1bmN0aW9uIG1vZGlmeVBsYXllckRpZSgpIHsNCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBsYXllciAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHBsYXllci5kaWUgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgICAgICAgICAgcGxheWVyLmRpZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLnBsYXllckRlYWQpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyRGVhZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnJlc3Bhd25UaW1lID0gMTUwOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgcmVkIGV4cGxvc2lvbiBwYXJ0aWNsZXMNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgMjA7IG4rKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRpY2xlID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiB0aGlzLnggKyB0aGlzLncgLyAyIC0gNSArIE1hdGgucmFuZG9tKCkgKiAxMCAtIDUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IHRoaXMueSArIHRoaXMuaCAvIDIgLSA1ICsgTWF0aC5yYW5kb20oKSAqIDEwIC0gNSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdzogMTAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGg6IDEwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJ3JnYigyNTUsMCwwKScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhOiAyLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNheTogMC4wOCAtIE1hdGgucmFuZG9tKCkgLyAyMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeG1vdmU6IE1hdGgucmFuZG9tKCkgKiAzMCAtIDE1LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5bW92ZTogTWF0aC5yYW5kb20oKSAqIDMwIC0gMjANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlcy5wYXJ0aWNsZXMucHVzaChwYXJ0aWNsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBibGFjayBjaXJjbGUgcGFydGljbGVzDQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IDI7IG4rKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRpY2xlID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiB0aGlzLnggKyB0aGlzLncgLyAyLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiB0aGlzLnkgKyB0aGlzLmggLyAyLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByOiA1LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3OiAxMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaDogMTAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnYmxhY2snLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFwZTogJ2NpcmNsZScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhOiAxNTAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY2F5OiAxLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4bW92ZTogTWF0aC5yYW5kb20oKSAqIDcuNSAqIChuICogMiAtIDEpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5bW92ZTogTWF0aC5yYW5kb20oKSAqIDE1IC0gMTANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlcy5wYXJ0aWNsZXMucHVzaChwYXJ0aWNsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJQbGF5ZXIncyBkaWUgbWV0aG9kIG1vZGlmaWVkLiIpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJQbGF5ZXIgb2JqZWN0IG9yIGRpZSBtZXRob2Qgbm90IGZvdW5kLiIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gV2FpdCBmb3IgdGhlIHBsYXllciBvYmplY3QgdG8gYmUgZGVmaW5lZA0KICAgICAgICAgICAgZnVuY3Rpb24gd2FpdEZvclBsYXllcigpIHsNCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBsYXllciAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHBsYXllci5kaWUgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgICAgICAgICAgbW9kaWZ5UGxheWVyRGllKCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCh3YWl0Rm9yUGxheWVyLCAxMDApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2FpdEZvclBsYXllcigpOw0KICAgICAgICB9KSgpOw0KDQogICAgICAgIC8vIEZ1bmN0aW9uIHRvIHVwZGF0ZSB0aGUgZGVidWcgbWVudSBwb3NpdGlvbiBiYXNlZCBvbiB3aW5kb3cgc2l6ZQ0KICAgICAgICBmdW5jdGlvbiB1cGRhdGVEZWJ1Z01lbnVQb3NpdGlvbigpIHsNCiAgICAgICAgICAgIHZhciB0b3BQb3MgPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxOw0KICAgICAgICAgICAgdmFyIGxlZnRQb3MgPSB3aW5kb3cuaW5uZXJXaWR0aCAqIDAuMDE7DQogICAgICAgICAgICBkZWJ1Z01lbnUuc3R5bGUudG9wID0gdG9wUG9zICsgJ3B4JzsNCiAgICAgICAgICAgIGRlYnVnTWVudS5zdHlsZS5sZWZ0ID0gbGVmdFBvcyArICdweCc7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBJbml0aWFsIHBvc2l0aW9uIHVwZGF0ZQ0KICAgICAgICB1cGRhdGVEZWJ1Z01lbnVQb3NpdGlvbigpOw0KDQogICAgICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lciBmb3Igd2luZG93IHJlc2l6ZSB0byB1cGRhdGUgZGVidWcgbWVudSBwb3NpdGlvbg0KICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdXBkYXRlRGVidWdNZW51UG9zaXRpb24pOw0KDQogICAgICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lciBmb3Iga2V5ZG93biB0byB0b2dnbGUgdGhlIGRlYnVnIG1lbnUgdmlzaWJpbGl0eQ0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAncScgfHwgZXZlbnQua2V5ID09PSAnUScpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRGVidWcgbWVudSB0b2dnbGUgZXZlbnQnKTsNCiAgICAgICAgICAgICAgICBpZiAoZGVidWdNZW51LnN0eWxlLmRpc3BsYXkgPT09ICdub25lJykgew0KICAgICAgICAgICAgICAgICAgICBkZWJ1Z01lbnUuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZGVidWdNZW51LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBGbGFnIHRvIGluZGljYXRlIHdoZXRoZXIgcmVzaXppbmcgb3IgZHJhZ2dpbmcgaXMgYWN0aXZlDQogICAgICAgIHZhciBpc1Jlc2l6aW5nID0gZmFsc2U7DQogICAgICAgIHZhciBpc0RyYWdnaW5nID0gZmFsc2U7DQoNCiAgICAgICAgLy8gTWFrZSB0aGUgZGVidWcgbWVudSBkcmFnZ2FibGUNCiAgICAgICAgZnVuY3Rpb24gbWFrZURyYWdnYWJsZShlbGVtZW50KSB7DQogICAgICAgICAgICB2YXIgcG9zMyA9IDAsIHBvczQgPSAwLCBwb3MxID0gMCwgcG9zMiA9IDA7DQogICAgICAgICAgICBlbGVtZW50Lm9ubW91c2Vkb3duID0gZHJhZ01vdXNlRG93bjsNCg0KICAgICAgICAgICAgZnVuY3Rpb24gZHJhZ01vdXNlRG93bihlKSB7DQogICAgICAgICAgICAgICAgZSA9IGUgfHwgd2luZG93LmV2ZW50Ow0KICAgICAgICAgICAgICAgIGlmIChpc1Jlc2l6aW5nKSByZXR1cm47DQogICAgICAgICAgICAgICAgaXNEcmFnZ2luZyA9IHRydWU7DQogICAgICAgICAgICAgICAgcG9zMyA9IGUuY2xpZW50WDsNCiAgICAgICAgICAgICAgICBwb3M0ID0gZS5jbGllbnRZOw0KICAgICAgICAgICAgICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IGNsb3NlRHJhZ0VsZW1lbnQ7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQub25tb3VzZW1vdmUgPSBlbGVtZW50RHJhZzsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZnVuY3Rpb24gZWxlbWVudERyYWcoZSkgew0KICAgICAgICAgICAgICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDsNCiAgICAgICAgICAgICAgICBpZiAoIWlzRHJhZ2dpbmcgfHwgaXNSZXNpemluZykgcmV0dXJuOw0KICAgICAgICAgICAgICAgIHBvczEgPSBwb3MzIC0gZS5jbGllbnRYOw0KICAgICAgICAgICAgICAgIHBvczIgPSBwb3M0IC0gZS5jbGllbnRZOw0KICAgICAgICAgICAgICAgIHBvczMgPSBlLmNsaWVudFg7DQogICAgICAgICAgICAgICAgcG9zNCA9IGUuY2xpZW50WTsNCiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLnRvcCA9IChlbGVtZW50Lm9mZnNldFRvcCAtIHBvczIpICsgInB4IjsNCiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmxlZnQgPSAoZWxlbWVudC5vZmZzZXRMZWZ0IC0gcG9zMSkgKyAicHgiOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBmdW5jdGlvbiBjbG9zZURyYWdFbGVtZW50KCkgew0KICAgICAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5vbm1vdXNldXAgPSBudWxsOw0KICAgICAgICAgICAgICAgIGRvY3VtZW50Lm9ubW91c2Vtb3ZlID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGRlYnVnTWVudUhlYWRlci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgaXNEcmFnZ2luZyA9IHRydWU7DQogICAgICAgICAgICBvZmZzZXRYID0gZS5jbGllbnRYIC0gZGVidWdNZW51Lm9mZnNldExlZnQ7DQogICAgICAgICAgICBvZmZzZXRZID0gZS5jbGllbnRZIC0gZGVidWdNZW51Lm9mZnNldFRvcDsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgIGlmIChpc0RyYWdnaW5nKSB7DQogICAgICAgICAgICAgICAgZGVidWdNZW51LnN0eWxlLmxlZnQgPSAoZS5jbGllbnRYIC0gb2Zmc2V0WCkgKyAncHgnOw0KICAgICAgICAgICAgICAgIGRlYnVnTWVudS5zdHlsZS50b3AgPSAoZS5jbGllbnRZIC0gb2Zmc2V0WSkgKyAncHgnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgaXNEcmFnZ2luZyA9IGZhbHNlOw0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBNYWtlIHRoZSBzZXR0aW5ncyB0YWIgZHJhZ2dhYmxlDQogICAgICAgIGxldCBpc1NldHRpbmdzRHJhZ2dpbmcgPSBmYWxzZTsNCiAgICAgICAgbGV0IHNldHRpbmdzT2Zmc2V0WCwgc2V0dGluZ3NPZmZzZXRZOw0KDQogICAgICAgIHNldHRpbmdzSGVhZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICBpc1NldHRpbmdzRHJhZ2dpbmcgPSB0cnVlOw0KICAgICAgICAgICAgc2V0dGluZ3NPZmZzZXRYID0gZS5jbGllbnRYIC0gc2V0dGluZ3NUYWIub2Zmc2V0TGVmdDsNCiAgICAgICAgICAgIHNldHRpbmdzT2Zmc2V0WSA9IGUuY2xpZW50WSAtIHNldHRpbmdzVGFiLm9mZnNldFRvcDsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgIGlmIChpc1NldHRpbmdzRHJhZ2dpbmcpIHsNCiAgICAgICAgICAgICAgICBzZXR0aW5nc1RhYi5zdHlsZS5sZWZ0ID0gKGUuY2xpZW50WCAtIHNldHRpbmdzT2Zmc2V0WCkgKyAncHgnOw0KICAgICAgICAgICAgICAgIHNldHRpbmdzVGFiLnN0eWxlLnRvcCA9IChlLmNsaWVudFkgLSBzZXR0aW5nc09mZnNldFkpICsgJ3B4JzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlzU2V0dGluZ3NEcmFnZ2luZyA9IGZhbHNlOw0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBFdmVudCBsaXN0ZW5lciBmb3IgbW91c2Vkb3duIG9uIGRlYnVnTWVudSB0byBpbml0aWF0ZSByZXNpemluZw0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQgPT09IGRlYnVnTWVudSkgew0KICAgICAgICAgICAgICAgIHZhciBzdGFydFggPSBldmVudC5jbGllbnRYOw0KICAgICAgICAgICAgICAgIHZhciBzdGFydFkgPSBldmVudC5jbGllbnRZOw0KICAgICAgICAgICAgICAgIHZhciBzdGFydFdpZHRoID0gZGVidWdNZW51Lm9mZnNldFdpZHRoOw0KICAgICAgICAgICAgICAgIHZhciBzdGFydEhlaWdodCA9IGRlYnVnTWVudS5vZmZzZXRIZWlnaHQ7DQoNCiAgICAgICAgICAgICAgICAvLyBTZXQgcmVzaXppbmcgZmxhZw0KICAgICAgICAgICAgICAgIGlzUmVzaXppbmcgPSB0cnVlOw0KDQogICAgICAgICAgICAgICAgLy8gRXZlbnQgbGlzdGVuZXIgZm9yIG1vdXNlbW92ZSBkdXJpbmcgcmVzaXppbmcNCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVNb3VzZU1vdmUoZXZlbnQpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVzaXplRGVidWdNZW51KHN0YXJ0WCwgc3RhcnRZLCBzdGFydFdpZHRoLCBzdGFydEhlaWdodCwgZXZlbnQpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIEV2ZW50IGxpc3RlbmVyIGZvciBtb3VzZXVwIHRvIHN0b3AgcmVzaXppbmcNCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVNb3VzZVVwKCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBSZXNldCByZXNpemluZyBmbGFnDQogICAgICAgICAgICAgICAgICAgIGlzUmVzaXppbmcgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgaGFuZGxlTW91c2VNb3ZlKTsNCiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGhhbmRsZU1vdXNlVXApOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGhhbmRsZU1vdXNlTW92ZSk7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGhhbmRsZU1vdXNlVXApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBFdmVudCBsaXN0ZW5lciBmb3IgbW91c2Vkb3duIG9uIHNldHRpbmdzVGFiIHRvIGluaXRpYXRlIHJlc2l6aW5nDQogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gc2V0dGluZ3NUYWIpIHsNCiAgICAgICAgICAgICAgICB2YXIgc3RhcnRYID0gZXZlbnQuY2xpZW50WDsNCiAgICAgICAgICAgICAgICB2YXIgc3RhcnRZID0gZXZlbnQuY2xpZW50WTsNCiAgICAgICAgICAgICAgICB2YXIgc3RhcnRXaWR0aCA9IHNldHRpbmdzVGFiLm9mZnNldFdpZHRoOw0KICAgICAgICAgICAgICAgIHZhciBzdGFydEhlaWdodCA9IHNldHRpbmdzVGFiLm9mZnNldEhlaWdodDsNCg0KICAgICAgICAgICAgICAgIC8vIFNldCByZXNpemluZyBmbGFnDQogICAgICAgICAgICAgICAgaXNSZXNpemluZyA9IHRydWU7DQoNCiAgICAgICAgICAgICAgICAvLyBFdmVudCBsaXN0ZW5lciBmb3IgbW91c2Vtb3ZlIGR1cmluZyByZXNpemluZw0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZU1vdXNlTW92ZShldmVudCkgew0KICAgICAgICAgICAgICAgICAgICByZXNpemVTZXR0aW5nc1RhYihzdGFydFgsIHN0YXJ0WSwgc3RhcnRXaWR0aCwgc3RhcnRIZWlnaHQsIGV2ZW50KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBFdmVudCBsaXN0ZW5lciBmb3IgbW91c2V1cCB0byBzdG9wIHJlc2l6aW5nDQogICAgICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlTW91c2VVcCgpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgcmVzaXppbmcgZmxhZw0KICAgICAgICAgICAgICAgICAgICBpc1Jlc2l6aW5nID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGhhbmRsZU1vdXNlTW92ZSk7DQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBoYW5kbGVNb3VzZVVwKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBoYW5kbGVNb3VzZU1vdmUpOw0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBoYW5kbGVNb3VzZVVwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgPC9zY3JpcHQ+DQo8L2JvZHk+DQoNCjwvaHRtbD4=";
