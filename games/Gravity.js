window.game = "PCFET0NUWVBFIGh0bWw+DQoNCg0KPCEtLSBVbHRpbWF0ZSBHYW1lIFN0YXNoIGZpbGUtLT4gDQo8IS0tIEZvciB0aGUgcmVndWxhcmx5IHVwZGF0aW5nIGRvYyBnbyB0byBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFfRm1IM0JsU0JRSTdGR2dBUUw1OS1aUGU4ZUN4czM1d2VsNkpVeVZhRzhRLyAtLT4NCg0KDQoNCjxodG1sPg0KPGJhc2UgaHJlZj0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2J1YmJscy9VR1MtQXNzZXRzQG1haW4vZ3Jhdml0eS8iPg0KPGhlYWQ+DQoNCiAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvanF1ZXJ5LzEuMTAuMS9qcXVlcnkubWluLmpzIiB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPjwvc2NyaXB0Pg0KICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQogICAgdmFyIF9nYXEgPSBfZ2FxIHx8IFtdOw0KICAgIF9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTI3OTI0MDU2LTEnXSk7DQogICAgX2dhcS5wdXNoKFsnX3RyYWNrUGFnZXZpZXcnXSk7DQogICAgKGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIGdhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQogICAgICBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7DQogICAgICBnYS5hc3luYyA9IHRydWU7DQogICAgICBnYS5zcmMgPSAoJ2h0dHBzOicgPT0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgPyAnaHR0cHM6Ly9zc2wnIDogJ2h0dHA6Ly93d3cnKSArICcuZ29vZ2xlLWFuYWx5dGljcy5jb20vZ2EuanMnOw0KICAgICAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07DQogICAgICBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTsNCiAgICB9KSgpOw0KICA8L3NjcmlwdD4NCiAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iZ3Jhdml0eUxldmVscy5qcyI+PC9zY3JpcHQ+DQogIDx0aXRsZT5GaXJlY2FzdGVyOiBHcmF2aXR5PC90aXRsZT4NCjwvaGVhZD4NCg0KPGJvZHkgc3R5bGU9ImZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7Zm9udC1zaXplOjEycHg7YmFja2dyb3VuZC1jb2xvcjpyZ2IoMTUsMTUsMTUpOyI+DQogIDwhLS0JPGRpdiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7dG9wOjBweDtsZWZ0OjBweDt3aWR0aDoxMDAlO2hlaWdodDo1MCU7YmFja2dyb3VuZC1jb2xvcjpyZ2IoMTUsMTUsMTUpOyI+PC9kaXY+LS0+DQogIDxkaXYgaWQ9ImFsbCIgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO2xlZnQ6MHB4O3RvcDowcHg7LXdlYmtpdC11c2VyLXNlbGVjdDpub25lIj4NCiAgICA8c3BhbiBzdHlsZT0icG9zaXRpb246cmVsYXRpdmU7ei1pbmRleDo1O2NvbG9yOndoaXRlO2xlZnQ6MTBweDt0b3A6MTBweDsiPjxhIGhyZWY9Ii8iPjxpbWcgaWQ9ImxvZ28iIGJvcmRlcj0iMCIgc3JjPSIvZmlyZWNhc3RlcndoaXRlc21hbGwucG5nIiAvPjwvYT4NCiAgICAgIDwhLS08YnI+PGI+Q29udHJvbHM8L2I+PGJyPkFycm93IEtleXM8YnI+VXAgdG8gSnVtcDxicj5Eb3duIHRvIEp1bXA8YnI+V0FTRDxicj48YnI+PGI+RGVzY3JpcHRpb248L2I+PGJyPkdldCB0byB0aGUgeWVsbG93IGJsb2NrLS0+DQogICAgICA8YnI+DQogICAgICA8YnV0dG9uIG9uQ2xpY2s9ImZ1bGw9IWZ1bGw7cmVzaXplKCk7Ij5GdWxsc2NyZWVuIFRvZ2dsZTwvYnV0dG9uPjwvc3Bhbj4NCiAgICA8Y2FudmFzIHN0eWxlPSJ6LWluZGV4OjE7bWFyZ2luLWxlZnQ6NTAlO3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6LTQwMHB4O3RvcDowcHg7IiB3aWR0aD04MDAgaGVpZ2h0PTYwMCBpZD0ic2NyZWVuIj48L2NhbnZhcz4NCiAgPC9kaXY+DQogIDwhLS08ZGl2IHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTtyaWdodDoxMHB4O3RvcDowOy13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZSI+DQoJCTxzcGFuIHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTt6LWluZGV4OjU7Y29sb3I6d2hpdGU7dG9wOjEwcHg7Ij4NCgkJCTxidXR0b24gb25DbGljaz0ibWVudSgpOyI+TWFpbiBNZW51PC9idXR0b24+DQoJCTwvc3Bhbj4NCgkNCjwvZGl2Pi0tPg0KICA8c2NyaXB0Pg0KICAgIHZhciBzY2FsZSA9IDEuMDsNCiAgICB2YXIgZnVsbCA9IGZhbHNlOw0KICAgIHJlc2l6ZSgpOw0KDQogICAgZnVuY3Rpb24gcmVzaXplKCkgew0KICAgICAgdmFyIHNjYWxleCA9IDEuMDsNCiAgICAgIHZhciBzY2FsZXkgPSAxLjA7DQogICAgICBzY2FsZXggPSAkKHdpbmRvdykud2lkdGgoKSAvIDgwMDsNCiAgICAgIHNjYWxleSA9ICQod2luZG93KS5oZWlnaHQoKSAvIDYwMDsNCiAgICAgIGlmIChzY2FsZXggPiBzY2FsZXkpIHsNCiAgICAgICAgc2NhbGUgPSBzY2FsZXk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzY2FsZSA9IHNjYWxleDsNCiAgICAgIH0NCiAgICAgIGlmIChzY2FsZSA+IDEgJiYgIWZ1bGwpIHsNCiAgICAgICAgc2NhbGUgPSAxOw0KICAgICAgfQ0KICAgICAgdmFyIHNpZGViYXIgPSAwOw0KICAgICAgJCgnI2FsbCcpLndpZHRoKCQod2luZG93KS53aWR0aCgpIC0gc2lkZWJhcik7DQogICAgICAkKCcjc2NyZWVuJykud2lkdGgoODAwICogc2NhbGUpOw0KICAgICAgJCgnI3NjcmVlbicpLmhlaWdodChNYXRoLnJvdW5kKDYwMCAqIHNjYWxlKSk7DQogICAgICAkKCcjc2NyZWVuJykuYXR0cigid2lkdGgiLCA4MDAgKiBzY2FsZSk7DQogICAgICAkKCcjc2NyZWVuJykuYXR0cigiaGVpZ2h0IiwgTWF0aC5yb3VuZCg2MDAgKiBzY2FsZSkpOw0KICAgICAgJCgnI3NjcmVlbicpLmNzcygibGVmdCIsIC1zY2FsZSAqIDgwMCAvIDIgKyAicHgiKTsNCiAgICAgIGlmIChmdWxsICYmIHNjYWxleCA+IHNjYWxleSkgew0KICAgICAgICAkKCcjc2NyZWVuJykuY3NzKCd0b3AnLCAwKTsNCg0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgJCgnI3NjcmVlbicpLmNzcygidG9wIiwgJCh3aW5kb3cpLmhlaWdodCgpIC8gMiAtIHNjYWxlICogNjAwIC8gMiArICJweCIpOw0KICAgICAgfQ0KICAgIH0NCiAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCkgew0KICAgICAgcmVzaXplKCk7DQogICAgfSk7DQogICAgdmFyIGZpcmUxID0gbmV3IEltYWdlKCk7DQogICAgZmlyZTEuc3JjID0gImZpcmUxLnBuZyI7DQogICAgdmFyIGZpcmUyID0gbmV3IEltYWdlKCk7DQogICAgZmlyZTIuc3JjID0gImZpcmUyLnBuZyI7DQogICAgdmFyIGZpcmUzID0gbmV3IEltYWdlKCk7DQogICAgZmlyZTMuc3JjID0gImZpcmUzLnBuZyI7DQogICAgdmFyIHN3aXRjaDEgPSBuZXcgSW1hZ2UoKTsNCiAgICBzd2l0Y2gxLnNyYyA9ICJzd2l0Y2gxLnBuZyI7DQogICAgdmFyIHN3aXRjaDIgPSBuZXcgSW1hZ2UoKTsNCiAgICBzd2l0Y2gyLnNyYyA9ICJzd2l0Y2gyLnBuZyI7DQogICAgdmFyIHBhdXNlV2hpdGUgPSBuZXcgSW1hZ2UoKTsNCiAgICBwYXVzZVdoaXRlLnNyYyA9ICJwYXVzZXdoaXRlLnBuZyI7DQogICAgdmFyIHBhdXNlQmxhY2sgPSBuZXcgSW1hZ2UoKTsNCiAgICBwYXVzZUJsYWNrLnNyYyA9ICJwYXVzZWJsYWNrLnBuZyI7DQogICAgLy92YXIgdHJlYXN1cmUgPSBuZXcgSW1hZ2UoKTsNCiAgICAvL3RyZWFzdXJlLnNyYyA9ICJ0cmVhc3VyZS5wbmciOw0KICAgIC8vdmFyIHRyZWFzdXJlZnVsbCA9IG5ldyBJbWFnZSgpOw0KICAgIC8vdHJlYXN1cmVmdWxsLnNyYyA9ICJ0cmVhc3VyZWZ1bGwucG5nIjsNCiAgICB2YXIgZmFkZSA9IDE7DQogICAgdmFyIGVuZGluZyA9ICJ3YXYiOw0KICAgIHZhciBzb3VuZCA9IFtdOw0KICAgIC8qc291bmQucHVzaChuZXcgQXVkaW8oImdyYXZpdHlfbGV2ZWwxX3RyYWNrMS4iICsgZW5kaW5nKSk7DQogICAgc291bmQucHVzaChuZXcgQXVkaW8oImdyYXZpdHlfbGV2ZWwxX3RyYWNrMi4iICsgZW5kaW5nKSk7DQogICAgc291bmQucHVzaChuZXcgQXVkaW8oImdyYXZpdHlfbGV2ZWwxX3RyYWNrMy4iICsgZW5kaW5nKSk7Ki8NCiAgICB2YXIgY2hlY2sgPSBmYWxzZTsNCiAgICB2YXIgZmFkZWNvbG9yID0gInJnYmEoMCwwLDAsIjsNCiAgICB2YXIgeCA9IDA7DQogICAgdmFyIHkgPSAwOw0KICAgIHZhciBibG9ja3ggPSA1MDsNCiAgICB2YXIgYmxvY2t5ID0gMjUwOw0KICAgIHZhciBibG9ja2hlaWdodCA9IDEwMDsNCiAgICB2YXIgYmxvY2t3aWR0aCA9IDQwMDsNCiAgICB2YXIgeHNwZWVkID0gMDsNCiAgICB2YXIgeXNwZWVkID0gMDsNCiAgICB2YXIgcmlnaHREb3duID0gZmFsc2U7DQogICAgdmFyIGxlZnREb3duID0gZmFsc2U7DQogICAgdmFyIHVwRG93biA9IGZhbHNlOw0KICAgIHZhciBkb3duRG93biA9IGZhbHNlOw0KICAgIHZhciBibG9jayA9IG5ldyBBcnJheSgpOw0KICAgIHZhciBwYXJ0ID0gbmV3IEFycmF5KCk7DQogICAgdmFyIHNldCA9ICJwYXJ0T25lIjsNCiAgICB2YXIgdG9wYmxvY2sgPSAwOw0KICAgIHZhciByb3RhdGUgPSBmYWxzZTsNCiAgICB2YXIgZ3JhcHBsZW9uID0gZmFsc2U7DQogICAgdmFyIGFuZ2xlID0gMDsNCiAgICB2YXIgdyA9IC4wMTsNCiAgICB2YXIgcGF1c2VkID0gZmFsc2U7DQogICAgdmFyIGQgPSA1MDsNCiAgICB2YXIgZ3JhcHBsZXggPSAxMDA7DQogICAgdmFyIGdyYXBwbGV5ID0gMzAwOw0KICAgIHZhciBmcmljdGlvbiA9IC45MTsNCiAgICB2YXIganVtcCA9IDE1Ow0KICAgIHZhciBncmF2aXR5ID0gMTsNCiAgICB2YXIgdmlldyA9IDA7DQogICAgdmFyIHZpZXd5ID0gMDsNCiAgICB2YXIgdG9wcGFydCA9IDA7DQogICAgdmFyIG9uaWNlID0gZmFsc2U7DQogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOw0KICAgIHZhciBkZWx0YXRpbWUgPSBkLmdldFRpbWUoKTsNCiAgICB2YXIgZnBzID0gMDsNCiAgICB2YXIgYXZnZnBzID0gMDsNCiAgICB2YXIgZnBzY291bnQgPSAwOw0KICAgIHZhciB0b3BzdGFyOw0KICAgIHZhciB0b3Bjc3RhcjsNCiAgICB2YXIgc3RhciA9IG5ldyBBcnJheSgpOw0KICAgIHZhciBjc3RhciA9IG5ldyBBcnJheSgpOw0KICAgIHZhciBidXR0b25vbm9mZiA9IGZhbHNlOw0KICAgIHZhciBpbmdhbWUgPSB0cnVlOw0KICAgIHZhciBjQiA9IGNyZWF0ZUJsb2NrOw0KICAgIHZhciBjVyA9IGNyZWF0ZVdpbjsNCiAgICB2YXIgY0sgPSBjcmVhdGVLaWxsOw0KICAgIHZhciBjR3IgPSBjcmVhdGVHcmFwcGxlOw0KICAgIHZhciBjRyA9IGNyZWF0ZUdyYWRpZW50Ow0KICAgIHZhciBjQkcgPSBjcmVhdGVCR3JhZGllbnQ7DQogICAgdmFyIGNCbiA9IGNyZWF0ZUJvdW5jZTsNCiAgICB2YXIgY0kgPSBjcmVhdGVJY2U7DQogICAgdmFyIGNCeCA9IGNyZWF0ZUJveDsNCiAgICB2YXIgY0N2ID0gY3JlYXRlQ29udmV5b3I7DQogICAgdmFyIGNCQ3YgPSBjcmVhdGVCQ29udmV5b3I7DQogICAgdmFyIHRleHQgPSBbXTsNCiAgICB2YXIgYm94ID0gW107DQogICAgdmFyIGJvdHNwZWVkID0gMDsNCiAgICB2YXIgYmVzdHRpbWUgPSAiIjsNCiAgICB2YXIgc3RhcnR0aW1lID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsNCiAgICB2YXIgbGVhbmxlZnQgPSBmYWxzZTsNCiAgICB2YXIgbGVhbnJpZ2h0ID0gZmFsc2U7DQogICAgdmFyIGdyYXZvZmYgPSBmYWxzZTsNCiAgICB2YXIgc3dpdGNoeCA9IGZhbHNlOw0KICAgIHZhciBzd2l0Y2h5ID0gZmFsc2U7DQogICAgdmFyIHRvdWNpbmcgPSBmYWxzZTsNCiAgICB2YXIgZ3JlZW54ID0gZmFsc2U7DQogICAgdmFyIGdyZWVueSA9IGZhbHNlOw0KICAgIHZhciBncmVlbnhzcGVlZCA9IDA7DQogICAgdmFyIGdyZWVueXNwZWVkID0gMDsNCiAgICB2YXIgbWVudUNvbG9yID0gInJnYigyNTUsMCwwKSI7DQogICAgdmFyIGFnMSA9ICJyZ2IoMjU1LDI1NSwyNTUpIjsNCiAgICB2YXIgYWcyID0gInJnYigwLDAsMCkiOw0KICAgIHZhciBsYXN0Z3JlZW54ID0gMDsNCiAgICB2YXIgbGFzdGdyZWVueSA9IDA7DQogICAgdmFyIHN0YXJ0eCA9IDA7DQogICAgdmFyIHN0YXJ0eSA9IDA7DQogICAgdmFyIGxhc3RsZXZlbCA9IGZhbHNlOw0KICAgIHZhciB2ZXJ5Y2hlYXQgPSBmYWxzZTsNCiAgICB2YXIgaW5pdGZpbmFsID0gdHJ1ZTsNCiAgICB2YXIgaW5pdGZpbmFsMiA9IHRydWU7DQogICAgdmFyIHRyZWFzdXJleCA9IDUwMDsNCiAgICB2YXIgdHJlYXN1cmV5ID0gMjUwOw0KICAgIHZhciBtb3ZlZnJlZCA9IGZhbHNlOw0KICAgIHZhciB1cEhlcmUgPSBmYWxzZTsNCiAgICB2YXIgZG93bkhlcmUgPSBmYWxzZTsNCiAgICB2YXIgY0xpZ2h0ID0gMDsNCiAgICB2YXIgbGFzdGJsb2NrID0gMDsNCg0KICAgIGZ1bmN0aW9uIEJveCgpIHsNCiAgICAgIHRoaXMueCA9IDA7DQogICAgICB0aGlzLnkgPSAwOw0KICAgICAgdGhpcy53aWR0aCA9IDMyOw0KICAgICAgdGhpcy5oZWlnaHQgPSAzMjsNCiAgICAgIHRoaXMueHNwZWVkID0gMDsNCiAgICAgIHRoaXMueXNwZWVkID0gMDsNCiAgICAgIHRoaXMuZmlyZSA9IC0xOw0KICAgIH0NCiAgICB2YXIgZmlyZSA9IGZhbHNlOw0KICAgIHZhciBsZXZlbCA9IC0xOw0KICAgIGlmICghbG9jYWxTdG9yYWdlKSB7DQogICAgICBsb2NhbFN0b3JhZ2UgPSB7fTsNCiAgICB9DQogICAgaWYgKCFsb2NhbFN0b3JhZ2UucGFydE9uZSkgew0KICAgICAgbG9jYWxTdG9yYWdlLnBhcnRPbmUgPSAwOw0KICAgIH0NCiAgICBpZiAoIWxvY2FsU3RvcmFnZS5wYXJ0VHdvKSB7DQogICAgICBsb2NhbFN0b3JhZ2UucGFydFR3byA9IDA7DQogICAgfQ0KICAgIGlmICghbG9jYWxTdG9yYWdlLnBhcnRUaHJlZSkgew0KICAgICAgbG9jYWxTdG9yYWdlLnBhcnRUaHJlZSA9IDA7DQogICAgfQ0KICAgIGlmICghbG9jYWxTdG9yYWdlLnBhcnRGb3VyKSB7DQogICAgICBsb2NhbFN0b3JhZ2UucGFydEZvdXIgPSAwOw0KICAgIH0NCg0KICAgIGluZ2FtZSA9IGZhbHNlOw0KICAgIHZhciBzZWxlY3RpbmcgPSBmYWxzZTsNCg0KICAgIHZhciBjdHggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NyZWVuJykuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICBsW2xldmVsXSgpOw0KICAgIHN0YXJ0eCA9IHg7DQogICAgc3RhcnR5ID0geTsNCiAgICBsYXN0Z3JlZW54ID0gZ3JlZW54Ow0KICAgIGxhc3RncmVlbnkgPSBncmVlbnk7DQogICAgdmFyIG9sZGJveCA9IChKU09OLnN0cmluZ2lmeShib3gpKTsNCg0KICAgIGZ1bmN0aW9uIFN0YXIoKSB7DQogICAgICB0aGlzLnggPSAwOw0KICAgICAgdGhpcy55ID0gMDsNCiAgICAgIHRoaXMub24gPSBmYWxzZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBDU3RhcigpIHsNCiAgICAgIHRoaXMueCA9IDA7DQogICAgICB0aGlzLnkgPSAwOw0KICAgICAgdGhpcy54c3BlZWQgPSAwOw0KICAgICAgdGhpcy55c3BlZWQgPSAwOw0KICAgICAgdGhpcy5kZXN0eCA9IDA7DQogICAgICB0aGlzLmRlc3R5ID0gMDsNCiAgICAgIHRoaXMub24gPSBmYWxzZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBCbG9jaygpIHsNCiAgICAgIHRoaXMueCA9IDA7DQogICAgICB0aGlzLnkgPSAwOw0KICAgICAgdGhpcy53aWR0aCA9IDA7DQogICAgICB0aGlzLmhlaWdodCA9IDA7DQogICAgICB0aGlzLmtpbGwgPSBmYWxzZTsNCiAgICAgIHRoaXMuZ3JhcHBsZSA9IGZhbHNlOw0KICAgICAgdGhpcy5ib3VuY2UgPSBmYWxzZTsNCiAgICAgIHRoaXMubW92ZSA9IGZhbHNlOw0KICAgICAgdGhpcy5pY2UgPSBmYWxzZTsNCiAgICAgIHRoaXMuZGlyID0gZmFsc2U7DQogICAgICB0aGlzLndpbiA9IGZhbHNlOw0KICAgICAgdGhpcy5jb3VudCA9IDUwOw0KICAgICAgdGhpcy5ncmFkaWVudCA9IGZhbHNlOw0KICAgICAgdGhpcy5tYXggPSAxMDA7DQogICAgICB0aGlzLmJ1dHRvbm1vZGUgPSAwOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIFBhcnQoKSB7DQogICAgICB0aGlzLnN0eWxlID0gIiI7DQogICAgICB0aGlzLnggPSAwOw0KICAgICAgdGhpcy55ID0gMDsNCiAgICAgIHRoaXMub24gPSBmYWxzZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBvbktleURvd24oZXZ0KSB7DQogICAgICBpZiAoaW5nYW1lKSB7DQogICAgICAgIGlmIChldnQua2V5Q29kZSA9PSAzOSB8fCBldnQua2V5Q29kZSA9PSA2OCkgcmlnaHREb3duID0gdHJ1ZTsNCiAgICAgICAgaWYgKGV2dC5rZXlDb2RlID09IDM3IHx8IGV2dC5rZXlDb2RlID09IDY1KSBsZWZ0RG93biA9IHRydWU7DQogICAgICAgIGlmIChldnQua2V5Q29kZSA9PSAzOCB8fCBldnQua2V5Q29kZSA9PSA4NykgdXBEb3duID0gdHJ1ZTsNCiAgICAgICAgaWYgKGV2dC5rZXlDb2RlID09IDQwIHx8IGV2dC5rZXlDb2RlID09IDgzKSBkb3duRG93biA9IHRydWU7DQogICAgICAgIC8qaWYgKGV2dC5rZXlDb2RlID09IDMyKXsNCiAgICAgICAgCWlmICghY2hlY2spew0KICAgICAgICAJCWNoZWNrID0ge307DQogICAgICAgIAkJY2hlY2suYm94ID0gSlNPTi5zdHJpbmdpZnkoYm94KTsNCiAgICAgICAgCQljaGVjay5jb3VudCA9IFtdOw0KICAgICAgICAJCWNoZWNrLmRpciA9IFtdOw0KICAgICAgICAJCWNoZWNrLm14ID0gW107DQogICAgICAgIAkJY2hlY2subXkgPSBbXTsNCiAgICAgICAgCQlmb3IgKHZhciBpID0gMDsgaSA8IGJsb2NrLmxlbmd0aDsgaSsrKXsNCiAgICAgICAgCQkJaWYgKGJsb2NrW2ldLm1vdmUpew0KICAgICAgICAJCQkJaWYgKGkgPiBsYXN0YmxvY2spewkNCiAgICAgICAgCQkJCQlpZiAoYmxvY2tbaV0uZGlyKQ0KICAgICAgICAJCQkJCXsNCiAgICAgICAgCQkJCQkJYmxvY2tbaV0ueSArPSAyOw0KICAgICAgICAJCQkJCQlibG9ja1tpXS5jb3VudCAtPTI7DQogICAgICAgIAkJCQkJCWlmIChibG9ja1tpXS5jb3VudCA8PSAwKQ0KICAgICAgICAJCQkJCQl7DQogICAgICAgIAkJCQkJCQlibG9ja1tpXS5kaXIgPSAhYmxvY2tbaV0uZGlyOw0KICAgICAgICAJCQkJCQl9DQogICAgICAgIAkJCQkJfQ0KICAgICAgICAJCQkJCWVsc2UNCiAgICAgICAgCQkJCQl7DQogICAgICAgIAkJCQkJCWJsb2NrW2ldLnkgLT0yOw0KICAgICAgICAJCQkJCQlibG9ja1tpXS5jb3VudCArPTI7DQogICAgICAgIAkJCQkJCWlmIChibG9ja1tpXS5jb3VudCA+PSBibG9ja1tpXS5tYXgpDQogICAgICAgIAkJCQkJCXsNCiAgICAgICAgCQkJCQkJCWJsb2NrW2ldLmRpciA9ICFibG9ja1tpXS5kaXI7DQogICAgICAgIAkJCQkJCX0NCiAgICAgICAgCQkJCQl9DQogICAgICAgIAkJCQl9DQogICAgICAgIAkJCQljaGVjay5jb3VudFtpXSA9IGJsb2NrW2ldLmNvdW50Ow0KICAgICAgICAJCQkJY2hlY2suZGlyW2ldID0gYmxvY2tbaV0uZGlyOw0KICAgICAgICAJCQkJY2hlY2subXhbaV0gPSBibG9ja1tpXS54Ow0KICAgICAgICAJCQkJY2hlY2subXlbaV0gPSBibG9ja1tpXS55Ow0KICAgICAgICAJCQl9DQogICAgICAgIAkJfQ0KICAgICAgICAJCWNoZWNrLnggPSB4Ow0KICAgICAgICAJCWNoZWNrLnkgPSB5Ow0KICAgICAgICAJCWNoZWNrLnhzcGVlZCA9IHhzcGVlZDsNCiAgICAgICAgCQljaGVjay55c3BlZWQgPSB5c3BlZWQ7DQogICAgICAgIAkJY2hlY2suY0xpZ2h0ID0gY0xpZ2h0Ow0KICAgICAgICAJfQ0KICAgICAgICB9Ki8NCiAgICAgICAgaWYgKGV2dC5rZXlDb2RlID09IDgyKSB7DQogICAgICAgICAgY2hlY2sgPSBmYWxzZTsNCiAgICAgICAgICBraWxsKCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGlmIChldnQua2V5Q29kZSA9PSAyNyB8fCBldnQua2V5Q29kZSA9PSAzMikgew0KICAgICAgICBwYXVzZWQgPSAhcGF1c2VkOw0KICAgICAgfQ0KICAgICAgaWYgKGV2dC5rZXlDb2RlID09IDg4ICYmIGV2dC5zaGlmdEtleSAmJiBldnQuY3RybEtleSkgew0KICAgICAgICBjdHguc2hhZG93Q29sb3IgPSAicmdiKDAsMCwwKSI7DQogICAgICAgIGN0eC5zaGFkb3dCbHVyID0gMTA7DQogICAgICB9DQogICAgfQ0KICAgIC8vYW5kIHVuc2V0IHRoZW0gd2hlbiB0aGUgcmlnaHQgb3IgbGVmdCBrZXkgaXMgcmVsZWFzZWQNCiAgICBmdW5jdGlvbiBvbktleVVwKGV2dCkgew0KICAgICAgaWYgKGluZ2FtZSkgew0KICAgICAgICBpZiAoZXZ0LmtleUNvZGUgPT0gMzkgfHwgZXZ0LmtleUNvZGUgPT0gNjgpIHJpZ2h0RG93biA9IGZhbHNlOw0KICAgICAgICBpZiAoZXZ0LmtleUNvZGUgPT0gMzcgfHwgZXZ0LmtleUNvZGUgPT0gNjUpIGxlZnREb3duID0gZmFsc2U7DQogICAgICAgIGlmIChldnQua2V5Q29kZSA9PSAzOCB8fCBldnQua2V5Q29kZSA9PSA4NykgdXBEb3duID0gZmFsc2U7DQogICAgICAgIGlmIChldnQua2V5Q29kZSA9PSA0MCB8fCBldnQua2V5Q29kZSA9PSA4MykgZG93bkRvd24gPSBmYWxzZTsNCiAgICAgIH0NCiAgICB9DQogICAgLy90b3VjaGVzDQogICAgZnVuY3Rpb24gaGFuZGxlVG91Y2goZSkgew0KICAgICAgbGVmdERvd24gPSBmYWxzZTsNCiAgICAgIHJpZ2h0RG93biA9IGZhbHNlOw0KICAgICAgdXBEb3duID0gZmFsc2U7DQogICAgICBkb3duRG93biA9IGZhbHNlOw0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlLnRhcmdldFRvdWNoZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgaWYgKGUudGFyZ2V0VG91Y2hlc1tpXS5wYWdlWCA8ICQoZG9jdW1lbnQpLndpZHRoKCkgLyAzKSB7DQogICAgICAgICAgbGVmdERvd24gPSB0cnVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlmIChlLnRhcmdldFRvdWNoZXNbaV0ucGFnZVggPiAyICogJChkb2N1bWVudCkud2lkdGgoKSAvIDMpIHsNCiAgICAgICAgICAgIHJpZ2h0RG93biA9IHRydWU7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHVwRG93biA9IHRydWU7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInRvdWNoc3RhcnQiLCBoYW5kbGVUb3VjaCwgZmFsc2UpOw0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInRvdWNobW92ZSIsIGhhbmRsZVRvdWNoLCBmYWxzZSk7DQogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hlbmQiLCBoYW5kbGVUb3VjaCwgZmFsc2UpOw0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInRvdWNoY2FuY2VsIiwgaGFuZGxlVG91Y2gsIGZhbHNlKTsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaGxlYXZlIiwgaGFuZGxlVG91Y2gsIGZhbHNlKTsNCg0KICAgIGZ1bmN0aW9uIG9uVG9wRG93bihldnQpIHsNCiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KDQogICAgICB2YXIgbXggPSBldnQucGFnZVggLSAkKCcjc2NyZWVuJykub2Zmc2V0KCkubGVmdDsNCiAgICAgIHZhciBteSA9IGV2dC5wYWdlWSAtICQoJyNzY3JlZW4nKS5vZmZzZXQoKS50b3A7DQogICAgICBteCA9IG14IC8gc2NhbGU7DQogICAgICBteSA9IG15IC8gc2NhbGU7DQogICAgICBpZiAocGF1c2VkKSB7DQogICAgICAgIGlmIChteSA+IDMwMCkgew0KICAgICAgICAgIG1lbnUoKTsNCiAgICAgICAgfQ0KICAgICAgICBwYXVzZWQgPSBmYWxzZTsNCg0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICBpZiAobXggPiA4MDAgLSAzMiAtIDYgJiYgbXggPCA4MDAgLSA2ICYmIG15ID4gNiAmJiBteSA8IDYgKyAzMikgew0KICAgICAgICBwYXVzZWQgPSB0cnVlOw0KICAgICAgICBkb3duSGVyZSA9IGZhbHNlOw0KICAgICAgICB1cEhlcmUgPSBmYWxzZTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgaWYgKGxldmVsID09IC0xKSB7DQogICAgICAgIGZvciAodmFyIGkgaW4gYmxvY2spIHsNCiAgICAgICAgICBpZiAoYmxvY2tbaV0ua2lsbCB8fCBibG9ja1tpXS5pY2UgfHwgYmxvY2tbaV0uYm91bmNlIHx8IGJsb2NrW2ldLndpbikgew0KICAgICAgICAgICAgaWYgKGJsb2NrW2ldLnggPCBteCAmJiBibG9ja1tpXS54ICsgYmxvY2tbaV0ud2lkdGggPiBteCAmJiBibG9ja1tpXS55IDwgbXkgJiYgYmxvY2tbaV0ueSArIGJsb2NrW2ldLmhlaWdodCA+IG15KSB7DQogICAgICAgICAgICAgIHRvcGJsb2NrID0gMDsNCiAgICAgICAgICAgICAgeCA9IDA7DQogICAgICAgICAgICAgIHkgPSAwOw0KICAgICAgICAgICAgICB4c3BlZWQgPSAwOw0KICAgICAgICAgICAgICB5c3BlZWQgPSAwOw0KICAgICAgICAgICAgICByaWdodERvd24gPSBmYWxzZTsNCiAgICAgICAgICAgICAgbGVmdERvd24gPSBmYWxzZTsNCiAgICAgICAgICAgICAgdXBEb3duID0gZmFsc2U7DQogICAgICAgICAgICAgIGRvd25Eb3duID0gZmFsc2U7DQogICAgICAgICAgICAgIHZhciB0eXBlID0gInVua25vd24iOw0KICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0uaWNlKSB7DQogICAgICAgICAgICAgICAgLy9sZXZlbCA9IDA7DQogICAgICAgICAgICAgICAgdHlwZSA9ICJpY2UiOw0KICAgICAgICAgICAgICAgIHNldCA9ICJwYXJ0T25lIjsNCiAgICAgICAgICAgICAgICBmYWRlY29sb3IgPSAicmdiYSgwLDI1NSwyNTUsIjsNCiAgICAgICAgICAgICAgICBtZW51Q29sb3IgPSAicmdiKDAsMjU1LDI1NSkiOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChibG9ja1tpXS5raWxsKSB7DQogICAgICAgICAgICAgICAgLy9sZXZlbCA9IDIwOw0KICAgICAgICAgICAgICAgIHR5cGUgPSAia2lsbCI7DQogICAgICAgICAgICAgICAgc2V0ID0gInBhcnRUd28iOw0KICAgICAgICAgICAgICAgIGZhZGVjb2xvciA9ICJyZ2JhKDI1NSwwLDAsIjsNCiAgICAgICAgICAgICAgICBtZW51Q29sb3IgPSAicmdiKDI1NSwwLDApIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0uYm91bmNlKSB7DQogICAgICAgICAgICAgICAgLy9sZXZlbCA9IDQwOw0KICAgICAgICAgICAgICAgIHR5cGUgPSAiYm91bmNlIjsNCiAgICAgICAgICAgICAgICBzZXQgPSAicGFydFRocmVlIjsNCiAgICAgICAgICAgICAgICBmYWRlY29sb3IgPSAicmdiYSgwLDI1NSwwLCI7DQogICAgICAgICAgICAgICAgbWVudUNvbG9yID0gInJnYigwLDI1NSwwKSI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLndpbikgew0KICAgICAgICAgICAgICAgIC8vbGV2ZWwgPSA0MDsNCiAgICAgICAgICAgICAgICB0eXBlID0gIndpbiI7DQogICAgICAgICAgICAgICAgc2V0ID0gInBhcnRGb3VyIjsNCiAgICAgICAgICAgICAgICBmYWRlY29sb3IgPSAicmdiYSgyNTUsMjU1LDAsIjsNCiAgICAgICAgICAgICAgICBtZW51Q29sb3IgPSAicmdiKDI1NSwyNTUsMCkiOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGZhZGUgPSAxOw0KICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCd3b28nKTsNCiAgICAgICAgICAgICAgaWYgKHNlbGVjdGluZykgew0KICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS5pY2UpIHsNCiAgICAgICAgICAgICAgICAgIGxldmVsID0gMDsNCiAgICAgICAgICAgICAgICAgIGZhZGVjb2xvciA9ICJyZ2JhKDAsMjU1LDI1NSwiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0ua2lsbCkgew0KICAgICAgICAgICAgICAgICAgbGV2ZWwgPSAyMDsNCiAgICAgICAgICAgICAgICAgIGZhZGVjb2xvciA9ICJyZ2JhKDI1NSwwLDAsIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmJvdW5jZSkgew0KICAgICAgICAgICAgICAgICAgbGV2ZWwgPSA0MDsNCiAgICAgICAgICAgICAgICAgIGZhZGVjb2xvciA9ICJyZ2JhKDAsMjU1LDAsIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLndpbikgew0KICAgICAgICAgICAgICAgICAgbGV2ZWwgPSA2MDsNCiAgICAgICAgICAgICAgICAgIGZhZGVjb2xvciA9ICJyZ2JhKDI1NSwyNTUsMCwiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGxldmVsKTsNCiAgICAgICAgICAgICAgICBsZXZlbCArPSBNYXRoLmZsb29yKChibG9ja1tpXS54IC0gMTYwKSAvIDk2KTsNCiAgICAgICAgICAgICAgICBsZXZlbCArPSA1ICogTWF0aC5mbG9vcigoYmxvY2tbaV0ueSAtIDEyOCkgLyA5Nik7DQogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhsZXZlbCk7DQogICAgICAgICAgICAgICAgaW5nYW1lID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBibG9jayA9IFtdOw0KICAgICAgICAgICAgICAgIGJveCA9IFtdOw0KICAgICAgICAgICAgICAgIGxbbGV2ZWxdKCk7DQogICAgICAgICAgICAgICAgc2VsZWN0aW5nID0gZmFsc2U7DQogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhsZXZlbCk7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgc2VsZWN0aW5nID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBibG9jayA9IFtdOw0KICAgICAgICAgICAgICAgIGJveCA9IFtdOw0KICAgICAgICAgICAgICAgIGxldmVsc2VsZWN0KCk7DQogICAgICAgICAgICAgICAgdmFyIG1heCA9IE51bWJlcihsb2NhbFN0b3JhZ2Vbc2V0XSk7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBibG9jaykgew0KICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmljZSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5mbG9vcigoYmxvY2tbaV0ueCAtIDE2MCkgLyA5NikgKyA1ICogTWF0aC5mbG9vcigoYmxvY2tbaV0ueSAtIDEyOCkgLyA5NikgPiBtYXgpIHsNCiAgICAgICAgICAgICAgICAgICAgICBibG9ja1tpXS54ICs9IDEwMDA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYmxvY2tbaV0uaWNlID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIGJsb2NrW2ldW3R5cGVdID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgc3RhcnR4ID0geDsNCiAgICAgICAgICAgICAgc3RhcnR5ID0geTsNCiAgICAgICAgICAgICAgb2xkYm94ID0gKEpTT04uc3RyaW5naWZ5KGJveCkpOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZvciAodmFyIGkgaW4gYm94KSB7DQogICAgICAgICAgaWYgKGJveFtpXS54IDwgbXggJiYgYm94W2ldLnggKyBib3hbaV0ud2lkdGggPiBteCAmJiBib3hbaV0ueSA8IG15ICYmIGJveFtpXS55ICsgYm94W2ldLmhlaWdodCA+IG15KSB7DQogICAgICAgICAgICB0b3BibG9jayA9IDA7DQogICAgICAgICAgICB4ID0gMDsNCiAgICAgICAgICAgIHkgPSAwOw0KICAgICAgICAgICAgeHNwZWVkID0gMDsNCiAgICAgICAgICAgIHlzcGVlZCA9IDA7DQogICAgICAgICAgICByaWdodERvd24gPSBmYWxzZTsNCiAgICAgICAgICAgIGxlZnREb3duID0gZmFsc2U7DQogICAgICAgICAgICB1cERvd24gPSBmYWxzZTsNCiAgICAgICAgICAgIGRvd25Eb3duID0gZmFsc2U7DQogICAgICAgICAgICBsZXZlbCA9IDgwOw0KICAgICAgICAgICAgc2V0ID0gInBhcnRGaXZlIjsNCiAgICAgICAgICAgIGZhZGVjb2xvciA9ICJyZ2JhKDEyOCwxMjgsMTI4LCI7DQogICAgICAgICAgICBmYWRlID0gMTsNCiAgICAgICAgICAgIGJveCA9IFtdOw0KICAgICAgICAgICAgYmxvY2sgPSBbXTsNCiAgICAgICAgICAgIGluZ2FtZSA9IHRydWU7DQogICAgICAgICAgICBsW2xldmVsXSgpOw0KICAgICAgICAgICAgc3RhcnR4ID0geDsNCiAgICAgICAgICAgIHN0YXJ0eSA9IHk7DQogICAgICAgICAgICBvbGRib3ggPSAoSlNPTi5zdHJpbmdpZnkoYm94KSk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChteCA+IDgwMCAtIDMyIC0gNiAmJiBteCA8IDgwMCAtIDYgJiYgbXkgPiA2ICYmIG15IDwgNiArIDMyKSB7DQogICAgICAgICAgcGF1c2VkID0gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICB9DQoNCiAgICB9DQogICAgJChkb2N1bWVudCkua2V5ZG93bihvbktleURvd24pOw0KICAgICQoZG9jdW1lbnQpLmtleXVwKG9uS2V5VXApOw0KICAgICQoJyNzY3JlZW4nKS5tb3VzZWRvd24ob25Ub3BEb3duKTsNCiAgICAkKCcjc2NyZWVuJykubW91c2Vtb3ZlKGZ1bmN0aW9uKGUpIHsNCiAgICAgIHZhciBteCA9IGUucGFnZVggLSAkKCcjc2NyZWVuJykub2Zmc2V0KCkubGVmdDsNCiAgICAgIHZhciBteSA9IGUucGFnZVkgLSAkKCcjc2NyZWVuJykub2Zmc2V0KCkudG9wOw0KICAgICAgbXggPSBteCAvIHNjYWxlOw0KICAgICAgbXkgPSBteSAvIHNjYWxlOw0KICAgICAgLy9jb25zb2xlLmxvZyhteCk7DQogICAgICBzZXRDdXJzb3IoImRlZmF1bHQiKTsNCiAgICAgIGlmIChwYXVzZWQpIHsNCiAgICAgICAgc2V0Q3Vyc29yKCJwb2ludGVyIik7DQogICAgICAgIGlmIChteSA8IDMwMCkgew0KICAgICAgICAgIHVwSGVyZSA9IHRydWU7DQogICAgICAgICAgZG93bkhlcmUgPSBmYWxzZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB1cEhlcmUgPSBmYWxzZTsNCiAgICAgICAgICBkb3duSGVyZSA9IHRydWU7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGlmIChteCA+IDgwMCAtIDMyIC0gNiAmJiBteCA8IDgwMCAtIDYgJiYgbXkgPiA2ICYmIG15IDwgNiArIDMyKSB7DQogICAgICAgIHNldEN1cnNvcigicG9pbnRlciIpOw0KICAgICAgfQ0KICAgICAgaWYgKGxldmVsID09IC0xKSB7DQogICAgICAgIGZvciAodmFyIGkgaW4gYmxvY2spIHsNCiAgICAgICAgICBpZiAoYmxvY2tbaV0ua2lsbCB8fCBibG9ja1tpXS5pY2UgfHwgYmxvY2tbaV0uYm91bmNlIHx8IGJsb2NrW2ldLndpbikgew0KICAgICAgICAgICAgaWYgKGJsb2NrW2ldLnggPCBteCAmJiBibG9ja1tpXS54ICsgYmxvY2tbaV0ud2lkdGggPiBteCAmJiBibG9ja1tpXS55IDwgbXkgJiYgYmxvY2tbaV0ueSArIGJsb2NrW2ldLmhlaWdodCA+IG15KSB7DQogICAgICAgICAgICAgIHNldEN1cnNvcigicG9pbnRlciIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmb3IgKHZhciBpIGluIGJveCkgew0KICAgICAgICAgIGlmIChib3hbaV0ueCA8IG14ICYmIGJveFtpXS54ICsgYm94W2ldLndpZHRoID4gbXggJiYgYm94W2ldLnkgPCBteSAmJiBib3hbaV0ueSArIGJveFtpXS5oZWlnaHQgPiBteSkgew0KICAgICAgICAgICAgc2V0Q3Vyc29yKCJwb2ludGVyIik7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgIH0NCiAgICB9KTsNCiAgICB2YXIgb3gxID0gMjAwOw0KICAgIHNldEludGVydmFsKHN0ZXAsIDMzKTsNCiAgICAvL3NldEludGVydmFsKGRyYXcsMzMpOw0KICAgIGZ1bmN0aW9uIHN0ZXAoKSB7DQogICAgICBpZiAocGF1c2VkKSB7DQogICAgICAgIGRyYXcoKTsNCiAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICJyZ2JhKDAsMCwwLC45NSkiOw0KICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgODAwICogc2NhbGUsIDYwMCAqIHNjYWxlKTsNCg0KICAgICAgICBjdHguZm9udCA9IDI1ICogc2NhbGUgKyAicHQgU2Fucy1TZXJpZiI7DQoNCiAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gInJnYigwLDAsMjU1KSI7DQogICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiKDI1NSwyNTUsMjU1KSI7DQogICAgICAgIGlmICh1cEhlcmUpIHsNCiAgICAgICAgICBjdHguc2hhZG93T2Zmc2V0WCA9IDU7DQogICAgICAgICAgY3R4LnNoYWRvd09mZnNldFkgPSA1Ow0KICAgICAgICAgIGN0eC5zaGFkb3dCbHVyID0gNTsNCiAgICAgICAgfQ0KICAgICAgICBjdHguZmlsbFRleHQoIkNsaWNrIHVwIGhlcmUgdG8gcmVzdW1lIHRoZSBnYW1lLiIsIDIwMCAqIHNjYWxlIC0gNDEgKiBzY2FsZSwgMjAwICogc2NhbGUpOw0KICAgICAgICBpZiAoZG93bkhlcmUpIHsNCg0KICAgICAgICAgIGN0eC5zaGFkb3dPZmZzZXRYID0gNTsNCiAgICAgICAgICBjdHguc2hhZG93T2Zmc2V0WSA9IDU7DQogICAgICAgICAgY3R4LnNoYWRvd0JsdXIgPSA1Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGN0eC5zaGFkb3dPZmZzZXRYID0gMDsNCiAgICAgICAgICBjdHguc2hhZG93T2Zmc2V0WSA9IDA7DQogICAgICAgICAgY3R4LnNoYWRvd0JsdXIgPSAwOw0KICAgICAgICB9DQogICAgICAgIGN0eC5maWxsVGV4dCgiQ2xpY2sgZG93biBoZXJlIGZvciB0aGUgbWFpbiBtZW51LiIsIDIwMCAqIHNjYWxlIC0gNDkgKiBzY2FsZSwgNDAwICogc2NhbGUpOw0KICAgICAgICBjdHguc2hhZG93Qmx1ciA9IDA7DQogICAgICAgIGN0eC5zaGFkb3dPZmZzZXRYID0gMDsNCiAgICAgICAgY3R4LnNoYWRvd09mZnNldFkgPSAwOw0KDQoNCiAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICJyZ2IoMjU1LDI1NSwyNTUpIjsNCg0KICAgICAgICBjdHguZm9udCA9IDE0ICogc2NhbGUgKyAicHQgU2Fucy1TZXJpZiI7DQogICAgICAgIGN0eC5maWxsVGV4dCgiR2FtZSBieSBKb2VsIEVpbmJpbmRlciwgRGVubmlzIEJyYWRmb3JkLCBhbmQgSnVzdGluIEZvcm1hbiIsIDI3NSAqIHNjYWxlLCA1OTUgKiBzY2FsZSk7DQoNCg0KICAgICAgICBjdHguZm9udCA9IDggKiBzY2FsZSArICJwdCBTYW5zLVNlcmlmIjsNCiAgICAgICAgdmFyIGkgPSAwOw0KICAgICAgICBjdHguZmlsbFRleHQoIlNwZWNpYWwgdGhhbmtzOiIsIDUgKiBzY2FsZSwgMTUgKiBzY2FsZSArIGkgKiBzY2FsZSk7DQogICAgICAgIGkgKz0gMTI7DQogICAgICAgIGN0eC5maWxsVGV4dCgiRXJpYyBMaXUiLCA1ICogc2NhbGUsIDE1ICogc2NhbGUgKyBpICogc2NhbGUpOw0KICAgICAgICBpICs9IDEyOw0KICAgICAgICBjdHguZmlsbFRleHQoIkFuZHJldyBNZWhyIiwgNSAqIHNjYWxlLCAxNSAqIHNjYWxlICsgaSAqIHNjYWxlKTsNCiAgICAgICAgaSArPSAxMjsNCiAgICAgICAgY3R4LmZpbGxUZXh0KCJKb2huIENvcmJldHQiLCA1ICogc2NhbGUsIDE1ICogc2NhbGUgKyBpICogc2NhbGUpOw0KICAgICAgICBpICs9IDEyOw0KICAgICAgICBjdHguZmlsbFRleHQoIlNldGggRWluYmluZGVyIiwgNSAqIHNjYWxlLCAxNSAqIHNjYWxlICsgaSAqIHNjYWxlKTsNCiAgICAgICAgaSArPSAxMjsNCiAgICAgICAgY3R4LmZpbGxUZXh0KCJFcmljIFNjaG5pZWRlciIsIDUgKiBzY2FsZSwgMTUgKiBzY2FsZSArIGkgKiBzY2FsZSk7DQogICAgICAgIGkgKz0gMTI7DQogICAgICAgIGN0eC5maWxsVGV4dCgiQWxleCBXZWlzbG93IiwgNSAqIHNjYWxlLCAxNSAqIHNjYWxlICsgaSAqIHNjYWxlKTsNCiAgICAgICAgaSArPSAxMjsNCiAgICAgICAgY3R4LmZpbGxUZXh0KCJBYXJvbiBGaXNoZXIiLCA1ICogc2NhbGUsIDE1ICogc2NhbGUgKyBpICogc2NhbGUpOw0KICAgICAgICBpICs9IDEyOw0KICAgICAgICBjdHguZmlsbFRleHQoIkFsZXggQ2hhbiIsIDUgKiBzY2FsZSwgMTUgKiBzY2FsZSArIGkgKiBzY2FsZSk7DQogICAgICAgIGkgKz0gMTI7DQogICAgICAgIGN0eC5maWxsVGV4dCgiUm9iIEtpbSIsIDUgKiBzY2FsZSwgMTUgKiBzY2FsZSArIGkgKiBzY2FsZSk7DQogICAgICAgIGkgKz0gMTI7DQogICAgICAgIGN0eC5maWxsVGV4dCgiSmFzb24gV2F5ZSIsIDUgKiBzY2FsZSwgMTUgKiBzY2FsZSArIGkgKiBzY2FsZSk7DQogICAgICAgIGkgKz0gMTI7DQogICAgICAgIGN0eC5maWxsVGV4dCgiSGlsbCBDaGFuZyIsIDUgKiBzY2FsZSwgMTUgKiBzY2FsZSArIGkgKiBzY2FsZSk7DQogICAgICAgIGkgKz0gMTI7DQogICAgICAgIGN0eC5maWxsVGV4dCgiQ2hyaXN0b3BoZXIgQ2hlZGVhdSIsIDUgKiBzY2FsZSwgMTUgKiBzY2FsZSArIGkgKiBzY2FsZSk7DQogICAgICAgIGkgKz0gMTI7DQogICAgICAgIGN0eC5maWxsVGV4dCgiSnVzdGluIFdvbmciLCA1ICogc2NhbGUsIDE1ICogc2NhbGUgKyBpICogc2NhbGUpOw0KICAgICAgICBpICs9IDEyOw0KICAgICAgICBjdHguZmlsbFRleHQoIkVyaWMgQ2hhbmciLCA1ICogc2NhbGUsIDE1ICogc2NhbGUgKyBpICogc2NhbGUpOw0KICAgICAgICBpICs9IDEyOw0KICAgICAgICBjdHguZmlsbFRleHQoIkRhbmllbCBQYWtob21vdiIsIDUgKiBzY2FsZSwgMTUgKiBzY2FsZSArIGkgKiBzY2FsZSk7DQogICAgICAgIGkgKz0gMTI7DQogICAgICAgIGN0eC5maWxsVGV4dCgiTWF0dGhldyBOaWVkZXJiZXJnZXIiLCA1ICogc2NhbGUsIDE1ICogc2NhbGUgKyBpICogc2NhbGUpOw0KICAgICAgICBpICs9IDEyOw0KICAgICAgICBjdHguZmlsbFRleHQoIkx1a2FzIFZsYWhvcyIsIDUgKiBzY2FsZSwgMTUgKiBzY2FsZSArIGkgKiBzY2FsZSk7DQoNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgaWYgKGxhc3RsZXZlbCAmJiBpbml0ZmluYWwpIHsNCiAgICAgICAgaW5pdGZpbmFsID0gZmFsc2U7DQogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgdGV4dFswXS50eHQgPSAiIjsNCiAgICAgICAgfSwgNDAwMCk7DQogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgZ3JlZW54ID0gLTMyOw0KICAgICAgICAgIGdyZWVueSA9IDIxMDsNCiAgICAgICAgICBsYXN0Z3JlZW54ID0gLTMyOw0KICAgICAgICAgIGxhc3RncmVlbnkgPSAyMTA7DQogICAgICAgIH0sIDUwMDApOw0KICAgICAgfQ0KICAgICAgY0xpZ2h0ICs9IDEwOw0KICAgICAgaWYgKGNMaWdodCA+IDMwMCkgew0KICAgICAgICBjTGlnaHQgLT0gMzAwOw0KICAgICAgfQ0KICAgICAgdmFyIGdyYXYgPSB0cnVlOw0KICAgICAgZCA9IG5ldyBEYXRlKCk7DQogICAgICBmcHMgKz0gMTAwMCAvIChkLmdldFRpbWUoKSAtIGRlbHRhdGltZSk7DQogICAgICBmcHNjb3VudCsrOw0KICAgICAgaWYgKGZwc2NvdW50ID09IDEwKSB7DQogICAgICAgIGF2Z2ZwcyA9IGZwcyAvIDEwOw0KICAgICAgICBmcHMgPSAwOw0KICAgICAgICBmcHNjb3VudCA9IDA7DQogICAgICB9DQogICAgICBkZWx0YXRpbWUgPSBkLmdldFRpbWUoKTsNCiAgICAgIGRyYXcoKTsNCiAgICAgIHZhciBsYXN0bGVmdCA9IGxlYW5sZWZ0Ow0KICAgICAgdmFyIGxhc3RyaWdodCA9IGxlYW5yaWdodDsNCiAgICAgIGxlYW5sZWZ0ID0gZmFsc2U7DQogICAgICBsZWFucmlnaHQgPSBmYWxzZTsNCiAgICAgIHZhciBzaWRlYm94ID0gMDsNCiAgICAgIGxhc3R4ID0geDsNCiAgICAgIGxhc3R5ID0geTsNCiAgICAgIGxhc3R4c3BlZWQgPSB4c3BlZWQ7DQogICAgICBpZiAoIWluZ2FtZSkgew0KICAgICAgICBpZiAocmlnaHREb3duKSB7DQogICAgICAgICAgaWYgKHggPiA1OTApIHsNCiAgICAgICAgICAgIHVwRG93biA9IHRydWU7DQogICAgICAgICAgICAvL2xlZnREb3duID0gdHJ1ZTsNCiAgICAgICAgICAgIC8vcmlnaHREb3duID0gZmFsc2U7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmICh4ID4gNjQwKSB7DQogICAgICAgICAgICByaWdodERvd24gPSBmYWxzZTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpZiAoeCA+IDY0MCkgew0KICAgICAgICAgICAgaWYgKHkgPCAzMDApIHsNCiAgICAgICAgICAgICAgbGVmdERvd24gPSB0cnVlOw0KICAgICAgICAgICAgICB1cERvd24gPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGxlZnREb3duKSB7DQogICAgICAgICAgaWYgKHggPCAxNTApIHsNCiAgICAgICAgICAgIHVwRG93biA9IHRydWU7DQogICAgICAgICAgICAvL2xlZnREb3duID0gZmFsc2U7DQogICAgICAgICAgICAvL3JpZ2h0RG93biA9IHRydWU7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmICh4IDwgMTAwKSB7DQogICAgICAgICAgICBsZWZ0RG93biA9IGZhbHNlOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpZiAoeCA8IDEwMCkgew0KICAgICAgICAgICAgaWYgKHkgPiAzMDApIHsNCiAgICAgICAgICAgICAgcmlnaHREb3duID0gdHJ1ZTsNCiAgICAgICAgICAgICAgdXBEb3duID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgICBpZiAoIXJvdGF0ZSkgew0KICAgICAgICBpZiAocmlnaHREb3duKSB7DQogICAgICAgICAgeHNwZWVkICs9IDE7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGxlZnREb3duKSB7DQogICAgICAgICAgeHNwZWVkIC09IDE7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFsYXN0bGV2ZWwgfHwgZ3JlZW54IDwgNDAwIHx8IGdyZWVueCA+IDUwMCkgew0KICAgICAgICAgIGdyZWVueHNwZWVkICs9IDE7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKGxhc3RsZXZlbCkgew0KICAgICAgICAgICAgaWYgKGluaXRmaW5hbDIpIHsNCiAgICAgICAgICAgICAgaW5pdGZpbmFsMiA9IGZhbHNlOw0KDQogICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgZ3JlZW55c3BlZWQgPSAtNjsNCiAgICAgICAgICAgICAgICB0ZXh0WzBdLnR4dCA9ICJXSEFUIT8iOw0KICAgICAgICAgICAgICB9LCAyNTApOw0KICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHRleHRbMV0gPSB7fTsNCiAgICAgICAgICAgICAgICB0ZXh0WzFdLmNvbG9yID0gMTsNCiAgICAgICAgICAgICAgICB0ZXh0WzFdLnR4dCA9ICJXaGVyZSBkaWQgdGhlIHRyZWFzdXJlIGdvPyEiOw0KICAgICAgICAgICAgICAgIHRleHRbMV0ueCA9IDEwMDsNCiAgICAgICAgICAgICAgICB0ZXh0WzFdLnkgPSB0ZXh0WzBdLnkgKyA0MDsNCiAgICAgICAgICAgICAgfSwgOTAwKTsNCg0KICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHRleHRbMF0udHh0ID0gIlRoaXMgaXMgaW1wb3NzaWJsZS4iOw0KICAgICAgICAgICAgICAgIHRleHRbMV0udHh0ID0gIiI7DQogICAgICAgICAgICAgIH0sIDI2MDApOw0KICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHRleHRbMF0udHh0ID0gIlRoaXMgaXMgaW1wb3NzaWJsZS4iOw0KICAgICAgICAgICAgICAgIHRleHRbMV0udHh0ID0gIkkgd2lsbCBraWxsIHdob2V2ZXIgaXMgcmVzcG9uc2libGUhIjsNCiAgICAgICAgICAgICAgfSwgMzYwMCk7DQogICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgZ3JlZW54c3BlZWQgPSAxMDsNCiAgICAgICAgICAgICAgfSwgNDEwMCk7DQogICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgdGV4dCA9IFtdOw0KICAgICAgICAgICAgICB9LCA4MDAwKTsNCiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICB2YXIgZnJlZCA9IGJveC5sZW5ndGg7DQogICAgICAgICAgICAgICAgY0J4KDc1MCwgNzAwLCAzMiwgMzIpOw0KICAgICAgICAgICAgICAgIGJveFtmcmVkXS5maXJlID0gMDsNCiAgICAgICAgICAgICAgICBtb3ZlZnJlZCA9IHRydWU7DQogICAgICAgICAgICAgIH0sIDEyMDAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvbmljZSkgew0KICAgICAgICAgIGlmICgoTWF0aC5hYnMoeHNwZWVkKSAtIE1hdGguYWJzKGJvdHNwZWVkKSkgKiAoMSAtIGZyaWN0aW9uKSA+IDEpIHsNCiAgICAgICAgICAgIGlmICh4c3BlZWQgPiAwKSB7DQogICAgICAgICAgICAgIHhzcGVlZCAtPSAxOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgeHNwZWVkICs9IDE7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChib3RzcGVlZCAhPSAwKSB7DQogICAgICAgICAgICAgIC8vY29uc29sZS5sb2coYm90c3BlZWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgeHNwZWVkID0gKHhzcGVlZCAtIGJvdHNwZWVkKSAqIGZyaWN0aW9uICsgYm90c3BlZWQ7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChNYXRoLmFicyhncmVlbnhzcGVlZCkgKiAoMSAtIGZyaWN0aW9uKSA+IDEpIHsNCiAgICAgICAgICAgIGlmIChncmVlbnhzcGVlZCA+IDApIHsNCiAgICAgICAgICAgICAgZ3JlZW54c3BlZWQgLT0gMTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGdyZWVueHNwZWVkICs9IDE7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChib3RzcGVlZCAhPSAwKSB7DQogICAgICAgICAgICAgIC8vY29uc29sZS5sb2coYm90c3BlZWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZ3JlZW54c3BlZWQgPSAoZ3JlZW54c3BlZWQpICogZnJpY3Rpb247DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGJvdHNwZWVkID0gMDsNCiAgICAgICAgeSArPSB5c3BlZWQ7DQogICAgICAgIGdyZWVueSArPSBncmVlbnlzcGVlZDsNCg0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaWYgKGRvd25Eb3duKSB7DQogICAgICAgICAgcm90YXRlID0gZmFsc2U7DQogICAgICAgICAgYW5nbGUgPSBhbmdsZSArIE1hdGguUEkgLyAyOw0KICAgICAgICAgIHhzcGVlZCA9IHcgKiBNYXRoLmNvcyhhbmdsZSkgKiBkOw0KICAgICAgICAgIHlzcGVlZCA9IHcgKiBNYXRoLnNpbihhbmdsZSkgKiBkOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIC8vcm90YXRpb24gY29kZQ0KICAgICAgICAgIGFuZ2xlICs9IHc7DQogICAgICAgICAgeSA9IHkgKyBkICogTWF0aC5zaW4oYW5nbGUpIC0gMTY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIG9uaWNlID0gZmFsc2U7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvcGJsb2NrOyBpKyspIHsNCiAgICAgICAgaWYgKGJsb2NrW2ldLm1vdmUpIHsNCiAgICAgICAgICBpZiAoYmxvY2tbaV0uZGlyKSB7DQogICAgICAgICAgICBibG9ja1tpXS55ICs9IDI7DQogICAgICAgICAgICBibG9ja1tpXS5jb3VudCAtPSAyOw0KICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmNvdW50IDw9IDApIHsNCiAgICAgICAgICAgICAgYmxvY2tbaV0uZGlyID0gIWJsb2NrW2ldLmRpcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgYmxvY2tbaV0ueSAtPSAyOw0KICAgICAgICAgICAgYmxvY2tbaV0uY291bnQgKz0gMjsNCiAgICAgICAgICAgIGlmIChibG9ja1tpXS5jb3VudCA+PSBibG9ja1tpXS5tYXgpIHsNCiAgICAgICAgICAgICAgYmxvY2tbaV0uZGlyID0gIWJsb2NrW2ldLmRpcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgbGFzdGJsb2NrID0gaTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICh4ICsgMzIgPiBibG9ja1tpXS54KSB7DQoNCiAgICAgICAgICBpZiAoYmxvY2tbaV0uZ3JhZGllbnQpIHsNCiAgICAgICAgICAgIGlmIChibG9ja1tpXS54ICsgYmxvY2tbaV0ud2lkdGggPiB4KSB7DQogICAgICAgICAgICAgIGlmIChibG9ja1tpXS55IDw9IHkgKyAxNiAmJiBibG9ja1tpXS55ICsgYmxvY2tbaV0uaGVpZ2h0ID49IHkgKyAxNikgew0KICAgICAgICAgICAgICAgIC8veXNwZWVkKz0xMCpibG9ja1tpXS5oZWlnaHQvKHktYmxvY2tbaV0uaGVpZ2h0LWJsb2NrW2ldLnkpOw0KICAgICAgICAgICAgICAgIC8veXNwZWVkIC09ICh5LWJsb2NrW2ldLnkpKih5LWJsb2NrW2ldLnkpLzEwMDsNCiAgICAgICAgICAgICAgICBpZiAoeSArIDE2ID4gMzAwKSB7DQogICAgICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0uYikgew0KICAgICAgICAgICAgICAgICAgICB5c3BlZWQgLT0gMTsNCiAgICAgICAgICAgICAgICAgICAgZ3JhdiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgeXNwZWVkICs9IDE7DQogICAgICAgICAgICAgICAgICAgIGdyYXYgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmIpIHsNCiAgICAgICAgICAgICAgICAgICAgeXNwZWVkICs9IDE7DQogICAgICAgICAgICAgICAgICAgIGdyYXYgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHlzcGVlZCAtPSAxOw0KICAgICAgICAgICAgICAgICAgICBncmF2ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmICh5ICsgMzIgPj0gYmxvY2tbaV0ueSkgew0KICAgICAgICAgICAgaWYgKGJsb2NrW2ldLnggKyBibG9ja1tpXS53aWR0aCA+IHgpIHsNCiAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLnkgKyBibG9ja1tpXS5oZWlnaHQgPj0geSkgew0KICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS5ncmFwcGxlIHx8IGJsb2NrW2ldLmdyYWRpZW50KSB7DQogICAgICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0uZ3JhcHBsZSkgew0KICAgICAgICAgICAgICAgICAgICBncmFwcGxlb24gPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCg0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0ua2lsbCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIXZlcnljaGVhdCkgew0KICAgICAgICAgICAgICAgICAgICAgIGlmIChjaXJjbGVDb2xsaWRlKGJsb2NrW2ldKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAga2lsbCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFyb3RhdGUpIHsNCg0KICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS5pY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9uaWNlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0ud2luKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB3aW4oKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmNvbnZleW9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0uYmMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgYm90c3BlZWQgPSAtMTI7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICBib3RzcGVlZCA9IDEyOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAvL3lzcGVlZCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3R5IDwgYmxvY2tbaV0ueSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmJvdW5jZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICB5c3BlZWQgPSAteXNwZWVkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB5ICs9IHlzcGVlZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBibG9ja1tpXS55IC0gMzI7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS54IDwgeCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYW5yaWdodCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lkZWJveCA9IGk7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLnggKyBibG9ja1tpXS53aWR0aCA+IHggKyAzMikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYW5sZWZ0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWRlYm94ID0gaTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeXNwZWVkID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlzcGVlZCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVwRG93biB8fCBkb3duRG93bikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlzcGVlZCA9IC1qdW1wOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmJvdW5jZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICB5c3BlZWQgPSAteXNwZWVkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB5ICs9IHlzcGVlZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBibG9ja1tpXS55ICsgYmxvY2tbaV0uaGVpZ2h0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0ueCA8IHgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFucmlnaHQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZGVib3ggPSBpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS54ICsgYmxvY2tbaV0ud2lkdGggPiB4ICsgMzIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFubGVmdCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lkZWJveCA9IGk7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHlzcGVlZCA8IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5c3BlZWQgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1cERvd24gfHwgZG93bkRvd24pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5c3BlZWQgPSBqdW1wOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgIGFuZ2xlIC09IHc7DQogICAgICAgICAgICAgICAgICAgICAgeSA9IGdyYXBwbGV5ICsgZCAqIE1hdGguc2luKGFuZ2xlKSAtIDE2Ow0KICAgICAgICAgICAgICAgICAgICAgIHcgPSAwOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgICAvL2dyZWVuIHZlcnRpY2FsDQogICAgICBpZiAoZ3JlZW54KSB7DQoNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b3BibG9jazsgaSsrKSB7DQogICAgICAgICAgaWYgKGdyZWVueCArIDMyID4gYmxvY2tbaV0ueCkgew0KICAgICAgICAgICAgaWYgKGdyZWVueSArIDMyID49IGJsb2NrW2ldLnkpIHsNCiAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLnggKyBibG9ja1tpXS53aWR0aCA+IGdyZWVueCkgew0KICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS55ICsgYmxvY2tbaV0uaGVpZ2h0ID49IGdyZWVueSkgew0KICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmdyYXBwbGUgfHwgYmxvY2tbaV0uZ3JhZGllbnQpIHt9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0ua2lsbCkgew0KICAgICAgICAgICAgICAgICAgICAgIGdyZWVueCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgIGlmICghcm90YXRlKSB7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS53aW4pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JlZW54ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIC8veXNwZWVkID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncmVlbnkgPCBibG9ja1tpXS55KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS5ib3VuY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmVlbnlzcGVlZCA9IC1ncmVlbnlzcGVlZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmVlbnkgKz0gZ3JlZW55c3BlZWQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JlZW55ID0gYmxvY2tbaV0ueSAtIDMyOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncmVlbnlzcGVlZCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyZWVueXNwZWVkID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmJvdW5jZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyZWVueXNwZWVkID0gLWdyZWVueXNwZWVkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyZWVueSArPSBncmVlbnlzcGVlZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmVlbnkgPSBibG9ja1tpXS55ICsgYmxvY2tbaV0uaGVpZ2h0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncmVlbnlzcGVlZCA8IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyZWVueXNwZWVkID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8vY2hlY2sgaWYgd2UgbmVlZCB0byBtb3ZlIGZyZWQ7DQogICAgICBpZiAobW92ZWZyZWQpIHsNCiAgICAgICAgaWYgKGJveFsxXS55IDwgMzAwKSB7DQogICAgICAgICAgYm94WzFdLnhzcGVlZCAtPSAuNDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoYm94WzFdLnggPCA5Nikgew0KICAgICAgICAgIGJveFsxXS55c3BlZWQgPSAtMTA7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8vY2hlY2sgYm94ZXMgZm9yIHZlcnRpY2FsIGNvbGxpc2lvbg0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBib3gubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgYm94W2ldLm9uaWNlID0gZmFsc2U7DQogICAgICAgIGJveFtpXS5ib3RzcGVlZCA9IDA7DQogICAgICAgIGJveFtpXS5ib3Rjb3VudCA9IDA7DQogICAgICAgIGJveFtpXS5sYXN0eSA9IGJveFtpXS55Ow0KICAgICAgICBib3hbaV0ueSArPSBib3hbaV0ueXNwZWVkOw0KICAgICAgICAvL2NoZWNrIGZvciBibG9jayBjb2xsaXNpb25zDQogICAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgdG9wYmxvY2s7IGIrKykgew0KICAgICAgICAgIGlmICghYmxvY2tbYl0ua2lsbCkgew0KICAgICAgICAgICAgaWYgKGJsb2NrW2JdLnggKyBibG9ja1tiXS53aWR0aCA+IGJveFtpXS54KSB7DQogICAgICAgICAgICAgIGlmIChib3hbaV0ueCArIGJveFtpXS53aWR0aCA+IGJsb2NrW2JdLngpIHsNCiAgICAgICAgICAgICAgICBpZiAoYmxvY2tbYl0ueSArIGJsb2NrW2JdLmhlaWdodCA+PSBib3hbaV0ueSkgew0KICAgICAgICAgICAgICAgICAgaWYgKGJveFtpXS55ICsgYm94W2ldLmhlaWdodCA+PSBibG9ja1tiXS55KSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tiXS53aW4pIHsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAobW92ZWZyZWQpIHsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgd2luKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGJveFtpXS5sYXN0eSA8IGJsb2NrW2JdLnkpIHsNCg0KICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tiXS5ib3VuY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJveFtpXS55c3BlZWQgKj0gLTE7DQogICAgICAgICAgICAgICAgICAgICAgICBib3hbaV0ueSArPSBib3hbaV0ueXNwZWVkOw0KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBib3hbaV0ueSA9IGJsb2NrW2JdLnkgLSBib3hbaV0uaGVpZ2h0Ow0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm94W2ldLnlzcGVlZCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgYm94W2ldLnlzcGVlZCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tiXS5pY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJveFtpXS5vbmljZSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tiXS5jb252ZXlvcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2JdLmJjKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGJveFtpXS5ib3Rjb3VudC0tOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgYm94W2ldLmJvdGNvdW50Kys7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tiXS5ib3VuY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJveFtpXS55c3BlZWQgKj0gLTE7DQogICAgICAgICAgICAgICAgICAgICAgICBib3hbaV0ueSArPSBib3hbaV0ueXNwZWVkOw0KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBib3hbaV0ueSA9IGJsb2NrW2JdLnkgKyBibG9ja1tiXS5oZWlnaHQ7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm94W2ldLnlzcGVlZCA8IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgYm94W2ldLnlzcGVlZCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tiXS5pY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJveFtpXS5vbmljZSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tiXS5jb252ZXlvcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2JdLmJjKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGJveFtpXS5ib3Rjb3VudC0tOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgYm94W2ldLmJvdGNvdW50Kys7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vY2hlY2sgZm9yIGNvbGxpc2lvbnMgd2l0aCBvdGhlciBib3hlcw0KICAgICAgICBmb3IgKHZhciBiID0gMDsgYiA8IGJveC5sZW5ndGg7IGIrKykgew0KICAgICAgICAgIGlmIChpICE9IGIpIHsNCiAgICAgICAgICAgIGlmIChib3hbaV0ueCArIGJveFtpXS53aWR0aCA+IGJveFtiXS54KSB7DQogICAgICAgICAgICAgIGlmIChib3hbYl0ueCArIGJveFtiXS53aWR0aCA+IGJveFtpXS54KSB7DQogICAgICAgICAgICAgICAgaWYgKGJveFtpXS55ICsgYm94W2ldLmhlaWdodCA+IGJveFtiXS55KSB7DQogICAgICAgICAgICAgICAgICBpZiAoYm94W2JdLnkgKyBib3hbYl0uaGVpZ2h0ID4gYm94W2ldLnkpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGJveFtpXS5sYXN0eSA8IGJveFtiXS5sYXN0eSkgew0KICAgICAgICAgICAgICAgICAgICAgIGJveFtpXS55ID0gYm94W2JdLnkgLSBib3hbaV0uaGVpZ2h0Ow0KICAgICAgICAgICAgICAgICAgICAgIGlmIChib3hbaV0ueXNwZWVkID4gYm94W2JdLnlzcGVlZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYm94W2ldLnlzcGVlZCA9IGJveFtiXS55c3BlZWQ7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgIGJveFtpXS55ID0gYm94W2JdLnkgKyBib3hbYl0uaGVpZ2h0Ow0KICAgICAgICAgICAgICAgICAgICAgIGlmIChib3hbaV0ueXNwZWVkIDwgYm94W2JdLnlzcGVlZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYm94W2ldLnlzcGVlZCA9IGJveFtiXS55c3BlZWQ7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoeCArIDMyID4gYm94W2ldLngpIHsNCiAgICAgICAgICBpZiAoYm94W2ldLnggKyBib3hbaV0ud2lkdGggPiB4KSB7DQogICAgICAgICAgICBpZiAoeSArIDMyID49IGJveFtpXS55KSB7DQogICAgICAgICAgICAgIGlmIChib3hbaV0ueSArIGJveFtpXS5oZWlnaHQgPj0geSkgew0KICAgICAgICAgICAgICAgIGlmIChsYXN0eSA8IGJveFtpXS5sYXN0eSkgew0KICAgICAgICAgICAgICAgICAgeSA9IGJveFtpXS55IC0gMzI7DQogICAgICAgICAgICAgICAgICBib3RzcGVlZCArPSBib3hbaV0ueHNwZWVkOw0KICAgICAgICAgICAgICAgICAgaWYgKHlzcGVlZCA+IGJveFtpXS55c3BlZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgeXNwZWVkID0gYm94W2ldLnlzcGVlZDsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmICh1cERvd24gfHwgZG93bkRvd24pIHsNCiAgICAgICAgICAgICAgICAgICAgeXNwZWVkID0gLWp1bXA7DQogICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KDQogICAgICAgICAgICAgICAgICB5ID0gYm94W2ldLnkgKyBib3hbaV0uaGVpZ2h0Ow0KICAgICAgICAgICAgICAgICAgYm90c3BlZWQgKz0gYm94W2ldLnhzcGVlZDsNCiAgICAgICAgICAgICAgICAgIGlmICh5c3BlZWQgPCBib3hbaV0ueXNwZWVkKSB7DQogICAgICAgICAgICAgICAgICAgIHlzcGVlZCA9IGJveFtpXS55c3BlZWQ7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBpZiAodXBEb3duIHx8IGRvd25Eb3duKSB7DQogICAgICAgICAgICAgICAgICAgIHlzcGVlZCA9IGp1bXA7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChib3hbaV0ueSArIGJveFtpXS5oZWlnaHQgLyAyIDwgMzAwIHx8IGdyYXZvZmYpIHsNCiAgICAgICAgICBib3hbaV0ueXNwZWVkICs9IGdyYXZpdHk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgYm94W2ldLnlzcGVlZCAtPSBncmF2aXR5Ow0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIC8vZmluYWwgY2hlY2sNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdG9wYmxvY2s7IGkrKykgew0KICAgICAgICBpZiAoeCArIDMyID4gYmxvY2tbaV0ueCkgew0KICAgICAgICAgIGlmICh5ICsgMzIgPiBibG9ja1tpXS55KSB7DQogICAgICAgICAgICBpZiAoYmxvY2tbaV0ueCArIGJsb2NrW2ldLndpZHRoID4geCkgew0KICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0ueSArIGJsb2NrW2ldLmhlaWdodCA+IHkpIHsNCiAgICAgICAgICAgICAgICBpZiAoIWJsb2NrW2ldLndpbiAmJiAhYmxvY2tbaV0uYm91bmNlICYmICFibG9ja1tpXS5ncmFkaWVudCkgew0KICAgICAgICAgICAgICAgICAga2lsbCgpOw0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKHJvdGF0ZSkgew0KICAgICAgICB4ID0gZ3JhcHBsZXggKyBkICogTWF0aC5jb3MoYW5nbGUpIC0gMTY7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB4ICs9IHhzcGVlZDsNCiAgICAgICAgaWYgKGdyZWVueCkgew0KICAgICAgICAgIGdyZWVueCArPSBncmVlbnhzcGVlZDsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKGZpcmUpIHsNCiAgICAgICAgaWYgKHggPiBmaXJlICYmIGJveFswXS5maXJlIDwgMCkgew0KICAgICAgICAgIGJveFswXS5maXJlID0gMDsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKHggPCAwKSB7DQogICAgICAgIHggPSAwOw0KICAgICAgICB4c3BlZWQgPSAwOw0KICAgICAgfQ0KICAgICAgaWYgKGdyZWVueCkgew0KICAgICAgICBpZiAoZ3JlZW54IDwgMCkgew0KICAgICAgICAgIC8vCQkJZ3JlZW54PSAwOw0KICAgICAgICAgIC8vCQkJZ3JlZW54c3BlZWQgPSAwOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvcGJsb2NrOyBpKyspIHsNCiAgICAgICAgaWYgKHggKyAzMiA+IGJsb2NrW2ldLngpIHsNCiAgICAgICAgICBpZiAoeSArIDMyID4gYmxvY2tbaV0ueSkgew0KICAgICAgICAgICAgaWYgKGJsb2NrW2ldLnggKyBibG9ja1tpXS53aWR0aCA+IHgpIHsNCiAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLnkgKyBibG9ja1tpXS5oZWlnaHQgPiB5KSB7DQogICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmdyYXBwbGUgfHwgYmxvY2tbaV0uZ3JhZGllbnQpIHsNCiAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS5ncmFwcGxlKSB7DQogICAgICAgICAgICAgICAgICAgIGdyYXBwbGVvbiA9IHRydWU7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS5raWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICghdmVyeWNoZWF0KSB7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKGNpcmNsZUNvbGxpZGUoYmxvY2tbaV0pKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBraWxsKCk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KDQogICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS53aW4pIHsNCg0KICAgICAgICAgICAgICAgICAgICAgIHdpbigpOw0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoIXJvdGF0ZSkgew0KICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0eCA8IGJsb2NrW2ldLngpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHggPSBibG9ja1tpXS54IC0gMzI7DQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHggPSBibG9ja1tpXS54ICsgYmxvY2tbaV0ud2lkdGg7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS5ib3VuY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHhzcGVlZCA9IC14c3BlZWQ7DQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHhzcGVlZCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgIGFuZ2xlIC09IHc7DQogICAgICAgICAgICAgICAgICAgICAgeCA9IGdyYXBwbGV4ICsgZCAqIE1hdGguY29zKGFuZ2xlKSAtIDE2Ow0KICAgICAgICAgICAgICAgICAgICAgIHcgPSAwOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgICAvL2dyZWVuIGhvcml6b250YWwNCiAgICAgIGlmIChncmVlbngpIHsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b3BibG9jazsgaSsrKSB7DQogICAgICAgICAgaWYgKGdyZWVueCArIDMyID4gYmxvY2tbaV0ueCkgew0KICAgICAgICAgICAgaWYgKGdyZWVueSArIDMyID4gYmxvY2tbaV0ueSkgew0KICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0ueCArIGJsb2NrW2ldLndpZHRoID4gZ3JlZW54KSB7DQogICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLnkgKyBibG9ja1tpXS5oZWlnaHQgPiBncmVlbnkpIHsNCiAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS5ncmFwcGxlIHx8IGJsb2NrW2ldLmdyYWRpZW50KSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS5ncmFwcGxlKSB7DQogICAgICAgICAgICAgICAgICAgICAgZ3JhcHBsZW9uID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmtpbGwpIHsNCiAgICAgICAgICAgICAgICAgICAgICBncmVlbnggPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCg0KICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS53aW4pIHsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgZ3JlZW54ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGlmICghcm90YXRlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ3JlZW54IDwgYmxvY2tbaV0ueCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICBncmVlbnggPSBibG9ja1tpXS54IC0gMzI7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICBncmVlbnggPSBibG9ja1tpXS54ICsgYmxvY2tbaV0ud2lkdGg7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0uYm91bmNlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGdyZWVueHNwZWVkID0gLWdyZWVueHNwZWVkOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JlZW54c3BlZWQgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLy9jaGVjayBib3ggZm9yIGhvcml6b250YWwgY29sbGlzaW9uDQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJveC5sZW5ndGg7IGkrKykgew0KICAgICAgICBib3hbaV0ubGFzdHggPSBib3hbaV0ueDsNCiAgICAgICAgYm94W2ldLnggKz0gYm94W2ldLnhzcGVlZDsNCiAgICAgICAgaWYgKCFib3hbaV0ub25pY2UpIHsNCiAgICAgICAgICBpZiAoYm94W2ldLmJvdGNvdW50ID4gMCkgew0KICAgICAgICAgICAgYm94W2ldLmJvdHNwZWVkID0gNTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKGJveFtpXS5ib3Rjb3VudCA8IDApIHsNCiAgICAgICAgICAgIGJveFtpXS5ib3RzcGVlZCAtPSA1Ow0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGJveFtpXS54c3BlZWQgPSAoYm94W2ldLnhzcGVlZCAtIGJveFtpXS5ib3RzcGVlZCkgKiBmcmljdGlvbiArIGJveFtpXS5ib3RzcGVlZDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoeCArIDMyID4gYm94W2ldLngpIHsNCiAgICAgICAgICBpZiAoYm94W2ldLnggKyBib3hbaV0ud2lkdGggPiB4KSB7DQogICAgICAgICAgICBpZiAoeSArIDMyID4gYm94W2ldLnkpIHsNCiAgICAgICAgICAgICAgaWYgKGJveFtpXS55ICsgYm94W2ldLmhlaWdodCA+IHkpIHsNCiAgICAgICAgICAgICAgICB2YXIgbGFzdGJveHggPSBib3hbaV0ueDsNCiAgICAgICAgICAgICAgICBpZiAobGFzdHggPCBib3hbaV0ueCkgew0KICAgICAgICAgICAgICAgICAgYm94W2ldLnggPSB4ICsgMzI7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGJveFtpXS54ID0geCAtIGJveFtpXS53aWR0aDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYm94W2ldLnhzcGVlZCA9IHhzcGVlZDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vY2hlY2sgZm9yIGJsb2NrIGNvbGxpc2lvbnMNCiAgICAgICAgZm9yICh2YXIgYiA9IDA7IGIgPCB0b3BibG9jazsgYisrKSB7DQogICAgICAgICAgaWYgKCFibG9ja1tiXS5raWxsKSB7DQogICAgICAgICAgICBpZiAoYmxvY2tbYl0ueCArIGJsb2NrW2JdLndpZHRoID4gYm94W2ldLngpIHsNCiAgICAgICAgICAgICAgaWYgKGJveFtpXS54ICsgYm94W2ldLndpZHRoID4gYmxvY2tbYl0ueCkgew0KICAgICAgICAgICAgICAgIGlmIChibG9ja1tiXS55ICsgYmxvY2tbYl0uaGVpZ2h0ID4gYm94W2ldLnkpIHsNCiAgICAgICAgICAgICAgICAgIGlmIChib3hbaV0ueSArIGJveFtpXS5oZWlnaHQgPiBibG9ja1tiXS55KSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChib3hbaV0ubGFzdHggPCBibG9ja1tiXS54KSB7DQogICAgICAgICAgICAgICAgICAgICAgYm94W2ldLnggPSBibG9ja1tiXS54IC0gYm94W2ldLndpZHRoOw0KDQogICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2JdLmJvdW5jZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYm94W2ldLnhzcGVlZCAqPSAtMTsNCiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJveFtpXS54c3BlZWQgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGJveFtpXS54c3BlZWQgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICBpZiAoeCArIDMyID4gYm94W2ldLngpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChib3hbaV0ueCArIGJveFtpXS53aWR0aCA+IHgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHkgKyAzMiA+IGJveFtpXS55KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJveFtpXS55ICsgYm94W2ldLmhlaWdodCA+IHkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggPSBib3hbaV0ueCAtIDMyOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHNwZWVkID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgYm94W2ldLnggPSBibG9ja1tiXS54ICsgYmxvY2tbYl0ud2lkdGg7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrW2JdLmJvdW5jZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYm94W2ldLnhzcGVlZCAqPSAtMTsNCiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJveFtpXS54c3BlZWQgPCAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGJveFtpXS54c3BlZWQgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICBpZiAoeCArIDMyID4gYm94W2ldLngpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChib3hbaV0ueCArIGJveFtpXS53aWR0aCA+IHgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHkgKyAzMiA+IGJveFtpXS55KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJveFtpXS55ICsgYm94W2ldLmhlaWdodCA+IHkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggPSBib3hbaV0ueCArIGJveFtpXS53aWR0aDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhzcGVlZCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgICAvL2NoZWNrIGZvciBsZWFuIGp1bXBpbmcNCiAgICAgIGlmIChsZWFubGVmdCA9PSAhbGFzdGxlZnQpIHsNCiAgICAgICAgaWYgKGxlYW5yaWdodCA9PSAhbGFzdHJpZ2h0KSB7DQogICAgICAgICAgaWYgKGxlYW5yaWdodCAhPSBsZWFubGVmdCkgew0KICAgICAgICAgICAgLy93ZSBzd2l0Y2hlZCBzaWRlcw0KICAgICAgICAgICAgaWYgKGxlYW5yaWdodCkgew0KICAgICAgICAgICAgICBpZiAobGFzdHhzcGVlZCA8IDApIHsNCiAgICAgICAgICAgICAgICB4c3BlZWQgPSAwOw0KICAgICAgICAgICAgICAgIHggPSBibG9ja1tzaWRlYm94XS54ICsgYmxvY2tbc2lkZWJveF0ud2lkdGg7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGlmIChsYXN0eHNwZWVkID4gMCkgew0KICAgICAgICAgICAgICAgIHhzcGVlZCA9IDA7DQogICAgICAgICAgICAgICAgeCA9IGJsb2NrW3NpZGVib3hdLnggLSAzMjsNCg0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgfQ0KICAgICAgLy9jaGVjayBmb3Igc3dpdGNoIGNvbGxpc2lvbg0KICAgICAgaWYgKHN3aXRjaHgpIHsNCiAgICAgICAgaWYgKHN3aXRjaHggKyA2NCA+IHgpIHsNCiAgICAgICAgICBpZiAoeCArIDMyID4gc3dpdGNoeCkgew0KICAgICAgICAgICAgaWYgKHN3aXRjaHkgKyA2NCA+IHkpIHsNCiAgICAgICAgICAgICAgaWYgKHkgKyAzMiA+IHN3aXRjaHkpIHsNCiAgICAgICAgICAgICAgICBpZiAoIXRvdWNoaW5nKSB7DQogICAgICAgICAgICAgICAgICBncmF2b2ZmID0gIWdyYXZvZmY7DQogICAgICAgICAgICAgICAgICB0b3VjaGluZyA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHRvdWNoaW5nID0gZmFsc2U7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHRvdWNoaW5nID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRvdWNoaW5nID0gZmFsc2U7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRvdWNoaW5nID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGlmIChncmVlbnkgKyAxNiA8IDMwMCB8fCBncmF2b2ZmKSB7DQogICAgICAgIGdyZWVueXNwZWVkICs9IGdyYXZpdHk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBncmVlbnlzcGVlZCAtPSBncmF2aXR5Ow0KICAgICAgfQ0KICAgICAgaWYgKHkgKyAxNiA8IDMwMCB8fCBncmF2b2ZmKSB7DQogICAgICAgIGlmIChyb3RhdGUpIHsNCiAgICAgICAgICB3ICs9IE1hdGguY29zKGFuZ2xlKSAqIGdyYXZpdHkgLyBkOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlmIChncmF2KSB7DQogICAgICAgICAgICB5c3BlZWQgKz0gZ3Jhdml0eTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlmIChyb3RhdGUpIHsNCiAgICAgICAgICB3IC09IE1hdGguY29zKGFuZ2xlKSAqIGdyYXZpdHkgLyBkOw0KDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKGdyYXYpIHsNCiAgICAgICAgICAgIHlzcGVlZCAtPSBncmF2aXR5Ow0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGRyYXcoKSB7DQogICAgICBpZiAoaW5nYW1lKSB7DQogICAgICAgIGlmICh4ID4gNDAwKSB7DQogICAgICAgICAgdmlldyA9IDQwMCAtIHg7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdmlldyA9IDA7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHkgPiA0MDApIHsNCiAgICAgICAgICB2aWV3eSA9IDQwMCAtIHk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKHkgPCAyMDApIHsNCiAgICAgICAgICAgIHZpZXd5ID0gMjAwIC0geTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdmlld3kgPSAwOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgdmlldyA9IE1hdGguZmxvb3Iodmlldyk7DQogICAgICB2aWV3eSA9IE1hdGguZmxvb3Iodmlld3kpOw0KICAgICAgaWYgKCFpbmdhbWUpIHsNCiAgICAgICAgdmlldyA9IDA7DQogICAgICAgIHZpZXd5ID0gMDsNCiAgICAgIH0NCiAgICAgIHZhciBncmVjdCA9IFtdOw0KICAgICAgdmFyIGFncmVjdCA9IFtdOw0KICAgICAgaWYgKGN0eCkgew0KDQogICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiYSgwLDAsMCwxKSI7DQogICAgICAgIGN0eC5maWxsUmVjdCgoMCkgKiBzY2FsZSwgKDApICogc2NhbGUsICg4MDApICogc2NhbGUsICg2MDApICogc2NhbGUpOw0KICAgICAgICBpZiAoIWdyYXZvZmYpIHsNCiAgICAgICAgICBjdHguZmlsbFN0eWxlID0gIndoaXRlIjsNCiAgICAgICAgICBjdHguZmlsbFJlY3QoKDApICogc2NhbGUsIDYwMCAqIHNjYWxlICsgKHZpZXd5IC0gMzAwKSAqIHNjYWxlLCAoODAwKSAqIHNjYWxlLCAtKHZpZXd5IC0gMzAwKSAqIHNjYWxlKTsNCiAgICAgICAgfQ0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvcGJsb2NrOyBpKyspIHsNCiAgICAgICAgICBpZiAoYmxvY2tbaV0ueCA8IC12aWV3ICsgODAwICYmIGJsb2NrW2ldLnggKyBibG9ja1tpXS53aWR0aCA+IC12aWV3ICYmIGJsb2NrW2ldLnkgKyBibG9ja1tpXS5oZWlnaHQgPiAtdmlld3kpIHsNCiAgICAgICAgICAgIHZhciBzdHlsZSA9ICIiOw0KICAgICAgICAgICAgdmFyIGEgPSAxMDAgLyAoMSArIE1hdGguc3FydCgoeCAtIGJsb2NrW2ldLnggLSBibG9ja1tpXS53aWR0aCAvIDIpICogKHggLSBibG9ja1tpXS54IC0gYmxvY2tbaV0ud2lkdGggLyAyKSArICh5IC0gYmxvY2tbaV0ueSAtIGJsb2NrW2ldLmhlaWdodCAvIDIpICogKHkgLSBibG9ja1tpXS55IC0gYmxvY2tbaV0uaGVpZ2h0IC8gMikpKTsNCiAgICAgICAgICAgIGEgLT0gMDsNCiAgICAgICAgICAgIGlmIChhIDwgMCkgew0KICAgICAgICAgICAgICBhID0gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBhYSA9IDE7DQogICAgICAgICAgICBpZiAoYWEgPiAxKSB7DQogICAgICAgICAgICAgIGFhID0gMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vdmFyIGEgPSAxMDAvKDErTWF0aC5zcXJ0KE1hdGgucG93KHgtYmxvY2tbaV0ueC1ibG9ja1tpXS53aWR0aC8yLDIpK01hdGgucG93KHktYmxvY2tbaV0ueS1ibG9ja1tpXS5oZWlnaHQvMiwyKSkpOw0KICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmdyYXBwbGUpIHsNCiAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gInJnYmEoMCwyNTUsMCwiICsgYWEgKyAiKSI7DQogICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiYSgwLDI1NSwwLCIgKyBhICsgIikiOw0KICAgICAgICAgICAgICBzdHlsZSA9ICJyZ2JhKDAsMjU1LDAsLjUpIjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGlmIChibG9ja1tpXS5raWxsKSB7DQogICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gInJnYmEoMjU1LDAsMCwiICsgYWEgKyAiKSI7DQogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICJyZ2JhKDI1NSwwLDAsIiArIGEgKyAiKSI7DQogICAgICAgICAgICAgICAgc3R5bGUgPSAicmdiYSgyNTUsMCwwLC41KSI7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKGJsb2NrW2ldLmljZSkgew0KICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gInJnYmEoMCwyNTUsMjU1LCIgKyBhYSArICIpIjsNCiAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiYSgwLDI1NSwyNTUsIiArIGEgKyAiKSI7DQogICAgICAgICAgICAgICAgICBzdHlsZSA9ICJyZ2JhKDAsMjU1LDI1NSwuNSkiOw0KDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS53aW4pIHsNCiAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gInJnYmEoMjU1LDI1NSwwLCIgKyBhYSArICIpIjsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICJyZ2JhKDI1NSwyNTUsMCwiICsgYSArICIpIjsNCiAgICAgICAgICAgICAgICAgICAgc3R5bGUgPSAicmdiYSgyNTUsMjU1LDAsLjUpIjsNCiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS5ib3VuY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAicmdiYSgwLDI1NSwwLCIgKyBhYSArICIpIjsNCiAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gInJnYmEoMCwyNTUsMCwiICsgYSArICIpIjsNCiAgICAgICAgICAgICAgICAgICAgICBzdHlsZSA9ICJyZ2JhKDAsMjU1LDAsLjUpIjsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0uY29udmV5b3IpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS5iYykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGNhbGNCQihibG9ja1tpXS54KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gInJnYmEoMjU1LDEyOCwwLCIgKyBhYSArICIpIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICJyZ2JhKDI1NSwxMjgsMCwiICsgYiArICIpIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGUgPSAicmdiYSgyNTUsMTI4LDAsLjUpIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gY2FsY0IoYmxvY2tbaV0ueCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICJyZ2JhKDEyOCwwLDI1NSwiICsgYWEgKyAiKSI7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiYSgxMjgsMCwyNTUsIiArIGIgKyAiKSI7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlID0gInJnYmEoMTI4LDAsMjU1LC41KSI7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICJyZ2JhKDEyOCwxMjgsMTI4LCIgKyBhYSArICIpIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiYSgxMjgsMTI4LDEyOCwiICsgYSArICIpIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlID0gInJnYmEoMTI4LDEyOCwxMjgsLjUpIjsNCg0KICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvL3ZhciB0bXAgPSBjdHguc3Ryb2tlU3R5bGU7DQogICAgICAgICAgICAvL2N0eC5zdHJva2VTdHlsZSA9IGN0eC5maWxsU3R5bGU7DQogICAgICAgICAgICAvL2N0eC5maWxsU3R5bGUgPSAicmdiYSgwLDAsMCwwKSI7DQogICAgICAgICAgICBpZiAodHJ1ZSkgew0KICAgICAgICAgICAgICBpZiAoYmxvY2tbaV0uZ3JhZGllbnQpIHsNCiAgICAgICAgICAgICAgICAvL3ZhciBncmFkID0gY3R4LmNyZWF0ZUxpbmVhckdyYWRpZW50KGJsb2NrW2ldLngrdmlldyxibG9ja1tpXS55K3ZpZXd5LCBibG9ja1tpXS54K3ZpZXcsIGJsb2NrW2ldLnkrdmlld3krYmxvY2tbaV0uaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYWcxOw0KICAgICAgICAgICAgICAgIGlmIChibG9ja1tpXS55IDwgMzAwKSB7DQogICAgICAgICAgICAgICAgICBpZiAoMzAwIC0gYmxvY2tbaV0ueSA8IGJsb2NrW2ldLmhlaWdodCkgew0KICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoKGJsb2NrW2ldLnggKyB2aWV3KSAqIHNjYWxlLCAoYmxvY2tbaV0ueSArIHZpZXd5KSAqIHNjYWxlLCAoYmxvY2tbaV0ud2lkdGgpICogc2NhbGUsICgzMDAgLSBibG9ja1tpXS55KSAqIHNjYWxlKTsNCiAgICAgICAgICAgICAgICAgICAgYWdyZWN0LnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgIHg6IChibG9ja1tpXS54ICsgdmlldykgKiBzY2FsZSwNCiAgICAgICAgICAgICAgICAgICAgICB5OiAoYmxvY2tbaV0ueSArIHZpZXd5KSAqIHNjYWxlLA0KICAgICAgICAgICAgICAgICAgICAgIHc6IChibG9ja1tpXS53aWR0aCkgKiBzY2FsZSwNCiAgICAgICAgICAgICAgICAgICAgICBoOiAoMzAwIC0gYmxvY2tbaV0ueSkgKiBzY2FsZQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGFnMjsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KChibG9ja1tpXS54ICsgdmlldykgKiBzY2FsZSwgKHZpZXd5ICsgMzAwKSAqIHNjYWxlLCAoYmxvY2tbaV0ud2lkdGgpICogc2NhbGUsIChibG9ja1tpXS5oZWlnaHQgLSAoMzAwIC0gYmxvY2tbaV0ueSkpICogc2NhbGUpOw0KICAgICAgICAgICAgICAgICAgICBncmVjdC5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICB4OiAoYmxvY2tbaV0ueCArIHZpZXcpICogc2NhbGUsDQogICAgICAgICAgICAgICAgICAgICAgeTogKDMwMCArIHZpZXd5KSAqIHNjYWxlLA0KICAgICAgICAgICAgICAgICAgICAgIHc6IChibG9ja1tpXS53aWR0aCkgKiBzY2FsZSwNCiAgICAgICAgICAgICAgICAgICAgICBoOiAoYmxvY2tbaV0uaGVpZ2h0IC0gKDMwMCAtIGJsb2NrW2ldLnkpKSAqIHNjYWxlDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KChibG9ja1tpXS54ICsgdmlldykgKiBzY2FsZSwgKGJsb2NrW2ldLnkgKyB2aWV3eSkgKiBzY2FsZSwgKGJsb2NrW2ldLndpZHRoKSAqIHNjYWxlLCAoYmxvY2tbaV0uaGVpZ2h0KSAqIHNjYWxlKTsNCiAgICAgICAgICAgICAgICAgICAgYWdyZWN0LnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgIHg6IChibG9ja1tpXS54ICsgdmlldykgKiBzY2FsZSwNCiAgICAgICAgICAgICAgICAgICAgICB5OiAoYmxvY2tbaV0ueSArIHZpZXd5KSAqIHNjYWxlLA0KICAgICAgICAgICAgICAgICAgICAgIHc6IChibG9ja1tpXS53aWR0aCkgKiBzY2FsZSwNCiAgICAgICAgICAgICAgICAgICAgICBoOiAoYmxvY2tbaV0uaGVpZ2h0KSAqIHNjYWxlDQogICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBhZzI7DQogICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoKGJsb2NrW2ldLnggKyB2aWV3KSAqIHNjYWxlLCAoYmxvY2tbaV0ueSArIHZpZXd5KSAqIHNjYWxlLCAoYmxvY2tbaV0ud2lkdGgpICogc2NhbGUsIChibG9ja1tpXS5oZWlnaHQpICogc2NhbGUpOw0KICAgICAgICAgICAgICAgICAgZ3JlY3QucHVzaCh7DQogICAgICAgICAgICAgICAgICAgIHg6IChibG9ja1tpXS54ICsgdmlldykgKiBzY2FsZSwNCiAgICAgICAgICAgICAgICAgICAgeTogKGJsb2NrW2ldLnkgKyB2aWV3eSkgKiBzY2FsZSwNCiAgICAgICAgICAgICAgICAgICAgdzogKGJsb2NrW2ldLndpZHRoKSAqIHNjYWxlLA0KICAgICAgICAgICAgICAgICAgICBoOiAoYmxvY2tbaV0uaGVpZ2h0KSAqIHNjYWxlDQogICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9ICgyKSAqIHNjYWxlOyAvLzI7DQogICAgICAgICAgICAgICAgY3R4LnN0cm9rZVJlY3QoKGJsb2NrW2ldLnggKyB2aWV3KSAqIHNjYWxlLCAoYmxvY2tbaV0ueSArIHZpZXd5KSAqIHNjYWxlLCAoYmxvY2tbaV0ud2lkdGgpICogc2NhbGUsIChibG9ja1tpXS5oZWlnaHQpICogc2NhbGUpOw0KICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdCgoYmxvY2tbaV0ueCArIHZpZXcpICogc2NhbGUsIChibG9ja1tpXS55ICsgdmlld3kpICogc2NhbGUsIChibG9ja1tpXS53aWR0aCkgKiBzY2FsZSwgKGJsb2NrW2ldLmhlaWdodCkgKiBzY2FsZSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBtYXggPSBibG9ja1tpXS53aWR0aCAqIGJsb2NrW2ldLmhlaWdodCAvIDEwMjQ7DQogICAgICAgICAgICBmb3IgKHZhciBiID0gMDsgYiA8IG1heDsgYisrKSB7DQogICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gLjk1KSB7DQogICAgICAgICAgICAgICAgLy9jcmVhdGVQYXJ0KE1hdGgucmFuZG9tKCkqYmxvY2tbaV0ud2lkdGgrYmxvY2tbaV0ueCxNYXRoLnJhbmRvbSgpKmJsb2NrW2ldLmhlaWdodCtibG9ja1tpXS55LHN0eWxlKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICAvL2NyZWF0ZVBhcnQoTWF0aC5yYW5kb20oKSpibG9ja1tpXS53aWR0aCtibG9ja1tpXS54LE1hdGgucmFuZG9tKCkqYmxvY2tbaV0uaGVpZ2h0K2Jsb2NrW2ldLnkpOw0KICAgICAgICB9DQogICAgICAgIC8qZm9yICh2YXIgaSA9IDA7IGkgPCB0b3BwYXJ0OyBpKyspDQogICAgICAgIHsNCiAgICAgICAgCWlmIChwYXJ0W2ldLm9uKQ0KICAgICAgICAJew0KICAgICAgICAJCWN0eC5maWxsU3R5bGUgPSBwYXJ0W2ldLnN0eWxlOw0KICAgICAgICAJCWlmIChwYXJ0W2ldLnggPCAtdmlldyB8fCBwYXJ0W2ldLnggPiAtdmlldyArIDgwMCB8fCBwYXJ0W2ldLnkgPCAtdmlld3kgfHwgcGFydFtpXS55ID4gLXZpZXd5ICsgNjAwIHx8IE1hdGgucmFuZG9tKCkgPiAuOTgpDQogICAgICAgIAkJew0KICAgICAgICAJCQlwYXJ0W2ldLm9uID0gZmFsc2U7DQogICAgICAgIAkJfQ0KICAgICAgICAJCWVsc2UNCiAgICAgICAgCQl7DQogICAgICAgIAkJCWN0eC5maWxsUmVjdChwYXJ0W2ldLngrdmlldy0xMyxwYXJ0W2ldLnkrdmlld3ktMTMsMjYsMjYpOw0KICAgICAgICAJCX0NCiAgICAgICAgCX0NCiAgICAgICAgfSovDQogICAgICAgIC8qDQogICAgICAgIGlmIChyb3RhdGUpDQogICAgICAgIHsNCiAgICAgICAgCWN0eC5iZWdpblBhdGgoKTsNCiAgICAgICAgCWN0eC5zdHJva2VTdHlsZSA9ICJyZ2IoMCwyNTUsMCkiOw0KICAgICAgICAJY3R4LmxpbmVXaWR0aCA9IDM7DQogICAgICAgIAljdHgubW92ZVRvKHgrMTYrdmlldyx5KzE2K3ZpZXd5KTsNCiAgICAgICAgCWN0eC5saW5lVG8oZ3JhcHBsZXgrdmlldyxncmFwcGxleSt2aWV3eSk7DQogICAgICAgIAljdHguc3Ryb2tlKCk7DQogICAgICAgIAljdHguZmlsbFN0eWxlPSJyZ2IoMCwyNTUsMCkiOw0KICAgICAgICAJY3R4LmJlZ2luUGF0aCgpOw0KICAgICAgICAJY3R4LmFyYyhncmFwcGxleCt2aWV3LGdyYXBwbGV5K3ZpZXd5LDQsMCxNYXRoLlBJKjIsdHJ1ZSk7DQogICAgICAgIAljdHguY2xvc2VQYXRoKCk7DQogICAgICAgIAljdHguZmlsbCgpOw0KICAgICAgICB9Ki8NCiAgICAgICAgaWYgKHN3aXRjaHgpIHsNCiAgICAgICAgICBpZiAoIWdyYXZvZmYpIHsNCiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2Uoc3dpdGNoMSwgKHN3aXRjaHggKyB2aWV3KSAqIHNjYWxlLCAoc3dpdGNoeSArIHZpZXd5KSAqIHNjYWxlLCBzd2l0Y2gxLmhlaWdodCAqIHNjYWxlLCBzd2l0Y2gxLndpZHRoICogc2NhbGUpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjdHguZHJhd0ltYWdlKHN3aXRjaDIsIChzd2l0Y2h4ICsgdmlldykgKiBzY2FsZSwgKHN3aXRjaHkgKyB2aWV3eSkgKiBzY2FsZSwgc3dpdGNoMi53aWR0aCAqIHNjYWxlLCBzd2l0Y2gyLmhlaWdodCAqIHNjYWxlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGxhc3RsZXZlbCkgew0KDQogICAgICAgICAgY3R4LmRyYXdJbWFnZSh0cmVhc3VyZSwgKHRyZWFzdXJleCArIHZpZXcpICogc2NhbGUsICh0cmVhc3VyZXkgKyB2aWV3eSkgKiBzY2FsZSwgdHJlYXN1cmUud2lkdGggKiBzY2FsZSwgdHJlYXN1cmUuaGVpZ2h0ICogc2NhbGUpOw0KICAgICAgICB9DQogICAgICAgIGlmIChjaGVjaykgew0KICAgICAgICAgIGlmIChjaGVjay55IDwgMzAwIC0gdmlld3kpIHsNCiAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSA0ICogc2NhbGU7DQogICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAicmdiKDEyOCwxMjgsMTI4KSI7DQogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7DQogICAgICAgICAgICBjdHguYXJjKChjaGVjay54ICsgdmlldyArIDE2KSAqIHNjYWxlLCAoY2hlY2sueSArIHZpZXd5ICsgMTYpICogc2NhbGUsICgxNSkgKiBzY2FsZSwgMCwgTWF0aC5QSSAqIDIsIHRydWUpOw0KICAgICAgICAgICAgY3R4LnN0cm9rZSgpOw0KICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOw0KICAgICAgICAgICAgY3R4LmFyYygoY2hlY2sueCArIHZpZXcgKyAxNikgKiBzY2FsZSwgKGNoZWNrLnkgKyB2aWV3eSArIDE2KSAqIHNjYWxlLCAoNSkgKiBzY2FsZSwgMCwgTWF0aC5QSSAqIDIsIHRydWUpOw0KICAgICAgICAgICAgY3R4LnN0cm9rZSgpOw0KDQogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gInJnYigyNTUsMCwwKSI7DQogICAgICAgICAgICBjdHgubGluZVdpZHRoID0gKDIpICogc2NhbGU7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmICh0cnVlKSB7DQogICAgICAgICAgZHJhd1RvcFBsYXllcigwLCAwLCA4MDAgKiBzY2FsZSwgMzAwICogc2NhbGUpOw0KICAgICAgICAgIGRyYXdQYXVzZSgwLCAwLCA4MDAgKiBzY2FsZSwgMzAwICogc2NhbGUsIGZhbHNlKTsNCiAgICAgICAgICBkcmF3Qm90UGxheWVyKDAsIDMwMCAqIHNjYWxlLCA4MDAgKiBzY2FsZSwgMzAwICogc2NhbGUpOw0KICAgICAgICAgIGRyYXdQYXVzZSgwLCA2MDAgKiBzY2FsZSArICh2aWV3eSAtIDMwMCkgKiBzY2FsZSwgKDgwMCkgKiBzY2FsZSwgLSh2aWV3eSAtIDMwMCkgKiBzY2FsZSwgdHJ1ZSk7DQoNCiAgICAgICAgICAvL2NvbnNvbGUubG9nKGdyZWN0KTsNCiAgICAgICAgICBmb3IgKHZhciBpIGluIGdyZWN0KSB7DQogICAgICAgICAgICBkcmF3VG9wUGxheWVyKGdyZWN0W2ldLngsIGdyZWN0W2ldLnksIGdyZWN0W2ldLncsIGdyZWN0W2ldLmgpOw0KICAgICAgICAgICAgZHJhd1BhdXNlKGdyZWN0W2ldLngsIGdyZWN0W2ldLnksIGdyZWN0W2ldLncsIGdyZWN0W2ldLmgsIGZhbHNlKTsNCiAgICAgICAgICB9DQogICAgICAgICAgZm9yICh2YXIgaSBpbiBhZ3JlY3QpIHsNCiAgICAgICAgICAgIGRyYXdCb3RQbGF5ZXIoYWdyZWN0W2ldLngsIGFncmVjdFtpXS55LCBhZ3JlY3RbaV0udywgYWdyZWN0W2ldLmgpOw0KICAgICAgICAgICAgZHJhd1BhdXNlKGFncmVjdFtpXS54LCBhZ3JlY3RbaV0ueSwgYWdyZWN0W2ldLncsIGFncmVjdFtpXS5oLCB0cnVlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGdyZWVueCkgew0KICAgICAgICAgIC8vaWYgKGdyZWVueSA8IDMwMCkNCiAgICAgICAgICB7DQogICAgICAgICAgICBpZiAobGFzdGxldmVsKSB7DQogICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiKDAsMCwxMDApIjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiKDAsMTAwLDApIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsNCiAgICAgICAgICAgIGN0eC5hcmMoKGdyZWVueCArIHZpZXcgKyAxNikgKiBzY2FsZSwgKGdyZWVueSArIHZpZXd5ICsgMTYpICogc2NhbGUsICgxNSkgKiBzY2FsZSwgMCwgTWF0aC5QSSAqIDIsIHRydWUpOw0KICAgICAgICAgICAgY3R4LmNsb3NlUGF0aCgpOw0KICAgICAgICAgICAgY3R4LmZpbGwoKTsNCiAgICAgICAgICAgIGlmIChsYXN0bGV2ZWwpIHsNCiAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gInJnYigwLDAsMjU1KSI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAicmdiKDAsMjU1LDApIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsNCiAgICAgICAgICAgIGN0eC5hcmMoKGdyZWVueCArIHZpZXcgKyAxNikgKiBzY2FsZSwgKGdyZWVueSArIHZpZXd5ICsgMTYpICogc2NhbGUsICgxNSkgKiBzY2FsZSwgMCwgTWF0aC5QSSAqIDIsIHRydWUpOw0KICAgICAgICAgICAgY3R4LmNsb3NlUGF0aCgpOw0KICAgICAgICAgICAgY3R4LnN0cm9rZSgpOw0KDQogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gInJnYigyNTUsMCwwKSI7DQoNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY3R4LmxpbmVXaWR0aCA9ICgyKSAqIHNjYWxlOyAvLzI7DQogICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICJyZ2IoMTI4LDEyOCwxMjgpIjsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBib3gubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBjdHguc3Ryb2tlUmVjdCgodmlldyArIGJveFtpXS54KSAqIHNjYWxlLCAodmlld3kgKyBib3hbaV0ueSkgKiBzY2FsZSwgKGJveFtpXS53aWR0aCkgKiBzY2FsZSwgKGJveFtpXS5oZWlnaHQpICogc2NhbGUpOw0KICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsNCiAgICAgICAgICBjdHgubW92ZVRvKCh2aWV3ICsgYm94W2ldLngpICogc2NhbGUsICh2aWV3eSArIGJveFtpXS55KSAqIHNjYWxlKTsNCiAgICAgICAgICBjdHgubGluZVRvKChib3hbaV0ud2lkdGggKyB2aWV3ICsgYm94W2ldLngpICogc2NhbGUsIChib3hbaV0ueSArIHZpZXd5ICsgYm94W2ldLmhlaWdodCkgKiBzY2FsZSk7DQogICAgICAgICAgY3R4Lm1vdmVUbygoYm94W2ldLndpZHRoICsgdmlldyArIGJveFtpXS54KSAqIHNjYWxlLCAodmlld3kgKyBib3hbaV0ueSkgKiBzY2FsZSk7DQogICAgICAgICAgY3R4LmxpbmVUbygodmlldyArIGJveFtpXS54KSAqIHNjYWxlLCAoYm94W2ldLnkgKyB2aWV3eSArIGJveFtpXS5oZWlnaHQpICogc2NhbGUpOw0KICAgICAgICAgIGN0eC5jbG9zZVBhdGgoKTsNCiAgICAgICAgICBjdHguc3Ryb2tlKCk7DQogICAgICAgICAgaWYgKGJveFtpXS5maXJlID4gLTEpIHsNCiAgICAgICAgICAgIGJveFtpXS5maXJlICs9IDI1Ow0KICAgICAgICAgICAgaWYgKGJveFtpXS5maXJlID49IDMwMCkgew0KICAgICAgICAgICAgICBib3hbaV0uZmlyZSA9IDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChib3hbaV0uZmlyZSA+IC0xKSB7DQogICAgICAgICAgICBzd2l0Y2ggKE1hdGguZmxvb3IoYm94W2ldLmZpcmUgLyAxMDApKSB7DQogICAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGZpcmUxLCAodmlldyArIGJveFtpXS54IC0gMTEpICogc2NhbGUsICh2aWV3eSArIGJveFtpXS55IC0gMzkpICogc2NhbGUsIGZpcmUxLndpZHRoICogc2NhbGUsIGZpcmUxLmhlaWdodCAqIHNjYWxlKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoZmlyZTIsICh2aWV3ICsgYm94W2ldLnggLSAxMSkgKiBzY2FsZSwgKHZpZXd5ICsgYm94W2ldLnkgLSAzOSkgKiBzY2FsZSwgZmlyZTEud2lkdGggKiBzY2FsZSwgZmlyZTEuaGVpZ2h0ICogc2NhbGUpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICBjYXNlIDI6DQogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShmaXJlMywgKHZpZXcgKyBib3hbaV0ueCAtIDExKSAqIHNjYWxlLCAodmlld3kgKyBib3hbaV0ueSAtIDM5KSAqIHNjYWxlLCBmaXJlMS53aWR0aCAqIHNjYWxlLCBmaXJlMS5oZWlnaHQgKiBzY2FsZSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobGFzdGxldmVsKSB7DQogICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UodHJlYXN1cmVmdWxsLCAodmlldyArIGJveFtpXS54IC0gNDApICogc2NhbGUsICh2aWV3eSArIGJveFtpXS55ICsgMikgKiBzY2FsZSwgdHJlYXN1cmVmdWxsLndpZHRoICogc2NhbGUsIHRyZWFzdXJlZnVsbC5oZWlnaHQgKiBzY2FsZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy9jdHgubGluZVdpZHRoID0gMTsNCg0KICAgICAgICAvKmlmIChncmFwcGxlb24pDQogICAgICAgIHsNCiAgICAgICAgCWN0eC5maWxsU3R5bGU9ICJyZ2IoMCwyNTUsMCkiOw0KICAgICAgICAJY3R4LmZpbGxUZXh0KCJHcmFwcGxlIFJlYWR5IiwgMCwgMTApOw0KICAgICAgICB9Ki8NCiAgICAgICAgY3R4LmZvbnQgPSAoMjQgKiBzY2FsZSkgKyAicHggU2Fucy1TZXJpZiI7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGV4dC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgIGlmICh0ZXh0W2ldLnggPCA4MDAgLSB2aWV3ICYmIHRleHRbaV0ueSArIDI0ID4gLXZpZXd5ICYmIHRleHRbaV0ueSAtIDI0IDwgNjAwIC0gdmlld3kpIHsNCiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiKDAsMCwwKSI7DQogICAgICAgICAgICBjdHguZmlsbFRleHQodGV4dFtpXS50eHQsICh0ZXh0W2ldLnggKyAxICsgdmlldykgKiBzY2FsZSwgKHRleHRbaV0ueSAtIDEgKyB2aWV3eSkgKiBzY2FsZSk7DQogICAgICAgICAgICBjdHguZmlsbFRleHQodGV4dFtpXS50eHQsICh0ZXh0W2ldLnggKyAxICsgdmlldykgKiBzY2FsZSwgKHRleHRbaV0ueSArIHZpZXd5KSAqIHNjYWxlKTsNCiAgICAgICAgICAgIGN0eC5maWxsVGV4dCh0ZXh0W2ldLnR4dCwgKHRleHRbaV0ueCArIDEgKyB2aWV3KSAqIHNjYWxlLCAodGV4dFtpXS55ICsgMSArIHZpZXd5KSAqIHNjYWxlKTsNCiAgICAgICAgICAgIGN0eC5maWxsVGV4dCh0ZXh0W2ldLnR4dCwgKHRleHRbaV0ueCArIHZpZXcpICogc2NhbGUsICh0ZXh0W2ldLnkgLSAxICsgdmlld3kpICogc2NhbGUpOw0KICAgICAgICAgICAgY3R4LmZpbGxUZXh0KHRleHRbaV0udHh0LCAodGV4dFtpXS54ICsgdmlldykgKiBzY2FsZSwgKHRleHRbaV0ueSArIHZpZXd5KSAqIHNjYWxlKTsNCiAgICAgICAgICAgIGN0eC5maWxsVGV4dCh0ZXh0W2ldLnR4dCwgKHRleHRbaV0ueCArIHZpZXcpICogc2NhbGUsICh0ZXh0W2ldLnkgKyAxICsgdmlld3kpICogc2NhbGUpOw0KICAgICAgICAgICAgY3R4LmZpbGxUZXh0KHRleHRbaV0udHh0LCAodGV4dFtpXS54IC0gMSArIHZpZXcpICogc2NhbGUsICh0ZXh0W2ldLnkgLSAxICsgdmlld3kpICogc2NhbGUpOw0KICAgICAgICAgICAgY3R4LmZpbGxUZXh0KHRleHRbaV0udHh0LCAodGV4dFtpXS54IC0gMSArIHZpZXcpICogc2NhbGUsICh0ZXh0W2ldLnkgKyB2aWV3eSkgKiBzY2FsZSk7DQogICAgICAgICAgICBjdHguZmlsbFRleHQodGV4dFtpXS50eHQsICh0ZXh0W2ldLnggLSAxICsgdmlldykgKiBzY2FsZSwgKHRleHRbaV0ueSArIDEgKyB2aWV3eSkgKiBzY2FsZSk7DQogICAgICAgICAgICBzd2l0Y2ggKHRleHRbaV0uY29sb3IpIHsNCiAgICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiKDAsMjU1LDApIjsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICJyZ2IoMCwxMjgsMjU1KSI7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjdHguZmlsbFRleHQodGV4dFtpXS50eHQsICh0ZXh0W2ldLnggKyB2aWV3KSAqIHNjYWxlLCAodGV4dFtpXS55ICsgdmlld3kpICogc2NhbGUpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjdHguZmlsbFN0eWxlID0gInJnYigwLDI1NSwwKSI7DQogICAgICAgIGN0eC5mb250ID0gKDEwICogc2NhbGUpICsgInB4IFNhbnMtU2VyaWYiOw0KICAgICAgICAvL2N0eC5maWxsVGV4dCgiRlBTOiAiKyBNYXRoLmNlaWwoYXZnZnBzKSwgMCwgOCpzY2FsZSk7DQogICAgICAgIGlmIChpbmdhbWUpIHsNCiAgICAgICAgICBjdHguZmlsbFRleHQoIkxldmVsOiAiICsgKChsZXZlbCAlIDIwKSArIDEpLCAwLCA4ICogc2NhbGUpOw0KICAgICAgICB9DQogICAgICAgIHZhciB0aW1lID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAtIHN0YXJ0dGltZTsNCiAgICAgICAgdmFyIG1pbiA9IE1hdGguZmxvb3IodGltZSAvIDYwMDAwKTsNCiAgICAgICAgdmFyIHNlYyA9IE1hdGguZmxvb3IoKHRpbWUgLSBtaW4gKiA2MDAwMCkgLyAxMDAwKTsNCiAgICAgICAgaWYgKG1pbiA8IDEwKSB7DQogICAgICAgICAgbWluID0gIjAiICsgbWluOw0KICAgICAgICB9DQogICAgICAgIGlmIChzZWMgPCAxMCkgew0KICAgICAgICAgIHNlYyA9ICIwIiArIHNlYzsNCiAgICAgICAgfQ0KICAgICAgICAvL2N0eC5maWxsVGV4dCgiVGltZTogIisgbWluKyI6IitzZWMsIDc0MCpzY2FsZSwgOCpzY2FsZSk7DQogICAgICAgIGlmIChiZXN0dGltZSAhPSAiIikgew0KICAgICAgICAgIHZhciBtaW4gPSBNYXRoLmZsb29yKGJlc3R0aW1lIC8gNjAwMDApOw0KICAgICAgICAgIHZhciBzZWMgPSBNYXRoLmZsb29yKChiZXN0dGltZSAtIG1pbiAqIDYwMDAwKSAvIDEwMDApOw0KICAgICAgICAgIGlmIChtaW4gPCAxMCkgew0KICAgICAgICAgICAgbWluID0gIjAiICsgbWluOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAoc2VjIDwgMTApIHsNCiAgICAgICAgICAgIHNlYyA9ICIwIiArIHNlYzsNCiAgICAgICAgICB9DQogICAgICAgICAgLy9jdHguZmlsbFRleHQoIkJlc3Q6ICIrIG1pbisiOiIrc2VjLCA3NDAqc2NhbGUsIDE2KnNjYWxlKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWluZ2FtZSkgew0KDQogICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gInJnYigwLDAsMCkiOw0KDQogICAgICAgICAgaWYgKHNlbGVjdGluZykgew0KICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IG1lbnVDb2xvcjsNCiAgICAgICAgICAgIGN0eC5mb250ID0gTWF0aC5yb3VuZCg0MCAqIHNjYWxlKSArICJwdCBBcmlhbCI7DQogICAgICAgICAgICBjdHgubGluZVdpZHRoID0gMjsNCiAgICAgICAgICAgIHZhciBtYXggPSBOdW1iZXIobG9jYWxTdG9yYWdlW3NldF0pOw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA5OyBpKyspIHsNCiAgICAgICAgICAgICAgaWYgKGkgPiBtYXgpIHsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjdHguZmlsbFRleHQoaSArIDEsICgyNTYgKyA4IC0gOTYgKyA5NiAqIChpICUgNSkgKyAxMCkgKiBzY2FsZSwgKDE5MiArIDUxIC0gNjQgKyA5NiAqIE1hdGguZmxvb3IoaSAvIDUpKSAqIHNjYWxlKTsNCiAgICAgICAgICAgICAgY3R4LnN0cm9rZVRleHQoaSArIDEsICgyNTYgKyA4IC0gOTYgKyA5NiAqIChpICUgNSkgKyAxMCkgKiBzY2FsZSwgKDE5MiArIDUxIC0gNjQgKyA5NiAqIE1hdGguZmxvb3IoaSAvIDUpKSAqIHNjYWxlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvciAodmFyIGkgPSA5OyBpIDwgMjA7IGkrKykgew0KICAgICAgICAgICAgICBpZiAoaSA+IG1heCkgew0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGN0eC5maWxsVGV4dChpICsgMSwgKDI1NiArIDggLSA5NiArIDk2ICogKGkgJSA1KSAtIDYpICogc2NhbGUsICgxOTIgKyA1MSAtIDY0ICsgOTYgKiBNYXRoLmZsb29yKGkgLyA1KSkgKiBzY2FsZSk7DQogICAgICAgICAgICAgIGN0eC5zdHJva2VUZXh0KGkgKyAxLCAoMjU2ICsgOCAtIDk2ICsgOTYgKiAoaSAlIDUpIC0gNikgKiBzY2FsZSwgKDE5MiArIDUxIC0gNjQgKyA5NiAqIE1hdGguZmxvb3IoaSAvIDUpKSAqIHNjYWxlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY3R4LmZvbnQgPSBNYXRoLnJvdW5kKDYwICogc2NhbGUpICsgInB0IEFyaWFsIjsNCiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiKDAsMjU1LDI1NSkiOw0KICAgICAgICAgICAgY3R4LmZpbGxUZXh0KCJQQVJUIDEiLCAoMjU2ICsgOCkgKiBzY2FsZSwgKDE5MiArIDYxIC0gNjQpICogc2NhbGUpOw0KICAgICAgICAgICAgY3R4LnN0cm9rZVRleHQoIlBBUlQgMSIsICgyNTYgKyA4KSAqIHNjYWxlLCAoMTkyICsgNjEgLSA2NCkgKiBzY2FsZSk7DQoNCiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiKDI1NSwwLDApIjsNCiAgICAgICAgICAgIGN0eC5maWxsVGV4dCgiUEFSVCAyIiwgKDI1NiArIDgpICogc2NhbGUsICgxOTIgKyA2MSAtIDY0ICsgOTYpICogc2NhbGUpOw0KICAgICAgICAgICAgY3R4LnN0cm9rZVRleHQoIlBBUlQgMiIsICgyNTYgKyA4KSAqIHNjYWxlLCAoMTkyICsgNjEgLSA2NCArIDk2KSAqIHNjYWxlKTsNCg0KICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5iZWF0T25lIHx8IGxvY2FsU3RvcmFnZS5iZWF0VHdvKSB7DQogICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiKDAsMjU1LDApIjsNCiAgICAgICAgICAgICAgY3R4LmZpbGxUZXh0KCJQQVJUIDMiLCAoMjU2ICsgOCkgKiBzY2FsZSwgKDE5MiArIDYxIC0gNjQgKyA5NiAqIDIpICogc2NhbGUpOw0KICAgICAgICAgICAgICBjdHguc3Ryb2tlVGV4dCgiUEFSVCAzIiwgKDI1NiArIDgpICogc2NhbGUsICgxOTIgKyA2MSAtIDY0ICsgOTYgKiAyKSAqIHNjYWxlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5iZWF0VGhyZWUgfHwgKGxvY2FsU3RvcmFnZS5iZWF0T25lICYmIGxvY2FsU3RvcmFnZS5iZWF0VHdvKSkgew0KICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gInJnYigyNTUsMjU1LDApIjsNCiAgICAgICAgICAgICAgY3R4LmZpbGxUZXh0KCJQQVJUIDQiLCAoMjU2ICsgOCkgKiBzY2FsZSwgKDE5MiArIDYxIC0gNjQgKyA5NiAqIDMpICogc2NhbGUpOw0KICAgICAgICAgICAgICBjdHguc3Ryb2tlVGV4dCgiUEFSVCA0IiwgKDI1NiArIDgpICogc2NhbGUsICgxOTIgKyA2MSAtIDY0ICsgOTYgKiAzKSAqIHNjYWxlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGZhZGUgPiAwKSB7DQogICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGZhZGVjb2xvciArIGZhZGUgKyAiKSI7DQogICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsICg4MDApICogc2NhbGUsICg2MDApICogc2NhbGUpOw0KICAgICAgICB9DQoNCg0KICAgICAgfQ0KICAgICAgLyoNCiAgICAgIAljdHguc2F2ZSgpOw0KICAgICAgCWN0eC5iZWdpblBhdGgoKTsNCiAgICAgIAljdHgucmVjdCgwLDAsODAwLDYwMC12aWV3eSk7DQogICAgICAJY3R4LmNsaXAoKTsNCiAgICAgIAljdHguZHJhd0ltYWdlKHBhdXNlV2hpdGUsODAwLTMyLTYsNiwzMiwzMik7DQogICAgICAJY3R4LnJlc3RvcmUoKTsNCiAgICAgICovDQogICAgICBpZiAoZmFkZSA+IDApIHsNCiAgICAgICAgZmFkZSAtPSAuMDU7DQogICAgICAgIGlmIChmYWRlIDwgLjA1KSB7DQogICAgICAgICAgZmFkZSA9IDA7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjcmVhdGVCbG9jayh4LCB5LCB3aWR0aCwgaGVpZ2h0LCBtb3ZlLCBidXR0b25tb2RlKSB7DQogICAgICBibG9ja1t0b3BibG9ja10gPSBuZXcgQmxvY2soKTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS54ID0geDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS55ID0geTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS53aWR0aCA9IHdpZHRoOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmhlaWdodCA9IGhlaWdodDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5raWxsID0gZmFsc2U7DQogICAgICBibG9ja1t0b3BibG9ja10uZ3JhcHBsZSA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmljZSA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnN0YXJ0eCA9IHg7DQogICAgICBibG9ja1t0b3BibG9ja10uc3RhcnR5ID0geTsNCiAgICAgIGlmIChtb3ZlKSB7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5tb3ZlID0gdHJ1ZTsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLmNvdW50ID0gbW92ZSAvIDI7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5tYXggPSBtb3ZlOw0KICAgICAgfQ0KICAgICAgaWYgKGJ1dHRvbm1vZGUpIHsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLmJ1dHRvbm1vZGUgPSBidXR0b25tb2RlOw0KICAgICAgfQ0KICAgICAgdG9wYmxvY2srKzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjcmVhdGVJY2UoeCwgeSwgd2lkdGgsIGhlaWdodCwgbW92ZSwgYnV0dG9ubW9kZSkgew0KICAgICAgYmxvY2tbdG9wYmxvY2tdID0gbmV3IEJsb2NrKCk7DQogICAgICBibG9ja1t0b3BibG9ja10ueCA9IHg7DQogICAgICBibG9ja1t0b3BibG9ja10ueSA9IHk7DQogICAgICBibG9ja1t0b3BibG9ja10ud2lkdGggPSB3aWR0aDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5oZWlnaHQgPSBoZWlnaHQ7DQogICAgICBibG9ja1t0b3BibG9ja10ua2lsbCA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmdyYXBwbGUgPSBmYWxzZTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5pY2UgPSB0cnVlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnN0YXJ0eCA9IHg7DQogICAgICBibG9ja1t0b3BibG9ja10uc3RhcnR5ID0geTsNCiAgICAgIGlmIChtb3ZlKSB7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5tb3ZlID0gdHJ1ZTsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLmNvdW50ID0gbW92ZSAvIDI7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5tYXggPSBtb3ZlOw0KICAgICAgfQ0KICAgICAgaWYgKGJ1dHRvbm1vZGUpIHsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLmJ1dHRvbm1vZGUgPSBidXR0b25tb2RlOw0KICAgICAgfQ0KICAgICAgdG9wYmxvY2srKzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjcmVhdGVHcmFkaWVudCh4LCB5LCB3aWR0aCwgaGVpZ2h0LCBtb3ZlLCBidXR0b25tb2RlKSB7DQogICAgICBibG9ja1t0b3BibG9ja10gPSBuZXcgQmxvY2soKTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS54ID0geDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS55ID0geTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS53aWR0aCA9IHdpZHRoOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmhlaWdodCA9IGhlaWdodDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5raWxsID0gZmFsc2U7DQogICAgICBibG9ja1t0b3BibG9ja10uZ3JhcHBsZSA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmljZSA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmdyYWRpZW50ID0gdHJ1ZTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5iID0gZmFsc2U7DQogICAgICBibG9ja1t0b3BibG9ja10uc3RhcnR4ID0geDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5zdGFydHkgPSB5Ow0KICAgICAgaWYgKG1vdmUpIHsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLm1vdmUgPSB0cnVlOw0KICAgICAgICBibG9ja1t0b3BibG9ja10uY291bnQgPSBtb3ZlIC8gMjsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLm1heCA9IG1vdmU7DQogICAgICB9DQogICAgICBpZiAoYnV0dG9ubW9kZSkgew0KICAgICAgICBibG9ja1t0b3BibG9ja10uYnV0dG9ubW9kZSA9IGJ1dHRvbm1vZGU7DQogICAgICB9DQogICAgICB0b3BibG9jaysrOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNyZWF0ZVdpbih4LCB5LCB3aWR0aCwgaGVpZ2h0LCBtb3ZlLCBidXR0b25tb2RlKSB7DQogICAgICBibG9ja1t0b3BibG9ja10gPSBuZXcgQmxvY2soKTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS54ID0geDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS55ID0geTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS53aWR0aCA9IHdpZHRoOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmhlaWdodCA9IGhlaWdodDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5raWxsID0gZmFsc2U7DQogICAgICBibG9ja1t0b3BibG9ja10uZ3JhcHBsZSA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmljZSA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLndpbiA9IHRydWU7DQogICAgICBibG9ja1t0b3BibG9ja10uc3RhcnR4ID0geDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5zdGFydHkgPSB5Ow0KICAgICAgaWYgKG1vdmUpIHsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLm1vdmUgPSB0cnVlOw0KICAgICAgICBibG9ja1t0b3BibG9ja10uY291bnQgPSBtb3ZlIC8gMjsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLm1heCA9IG1vdmU7DQogICAgICB9DQogICAgICBpZiAoYnV0dG9ubW9kZSkgew0KICAgICAgICBibG9ja1t0b3BibG9ja10uYnV0dG9ubW9kZSA9IGJ1dHRvbm1vZGU7DQogICAgICB9DQogICAgICB0b3BibG9jaysrOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNyZWF0ZUtpbGwoeCwgeSwgd2lkdGgsIGhlaWdodCwgbW92ZSwgYnV0dG9ubW9kZSkgew0KICAgICAgYmxvY2tbdG9wYmxvY2tdID0gbmV3IEJsb2NrKCk7DQogICAgICBibG9ja1t0b3BibG9ja10ueCA9IHg7DQogICAgICBibG9ja1t0b3BibG9ja10ueSA9IHk7DQogICAgICBibG9ja1t0b3BibG9ja10ud2lkdGggPSB3aWR0aDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5oZWlnaHQgPSBoZWlnaHQ7DQogICAgICBibG9ja1t0b3BibG9ja10ua2lsbCA9IHRydWU7DQogICAgICBibG9ja1t0b3BibG9ja10uZ3JhcHBsZSA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmRpciA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnN0YXJ0eCA9IHg7DQogICAgICBibG9ja1t0b3BibG9ja10uc3RhcnR5ID0geTsNCiAgICAgIGlmIChtb3ZlKSB7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5tb3ZlID0gdHJ1ZTsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLmNvdW50ID0gbW92ZSAvIDI7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5tYXggPSBtb3ZlOw0KICAgICAgfQ0KICAgICAgaWYgKGJ1dHRvbm1vZGUpIHsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLmJ1dHRvbm1vZGUgPSBidXR0b25tb2RlOw0KICAgICAgfQ0KICAgICAgdG9wYmxvY2srKzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjcmVhdGVHcmFwcGxlKHgsIHksIHdpZHRoLCBoZWlnaHQsIG1vdmUsIGJ1dHRvbm1vZGUpIHsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXSA9IG5ldyBCbG9jaygpOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnggPSB4Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnkgPSB5Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLndpZHRoID0gd2lkdGg7DQogICAgICBibG9ja1t0b3BibG9ja10uaGVpZ2h0ID0gaGVpZ2h0Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmdyYXBwbGUgPSB0cnVlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmtpbGwgPSBmYWxzZTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5kaXIgPSBmYWxzZTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5zdGFydHggPSB4Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnN0YXJ0eSA9IHk7DQogICAgICBpZiAobW92ZSkgew0KICAgICAgICBibG9ja1t0b3BibG9ja10ubW92ZSA9IHRydWU7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5jb3VudCA9IG1vdmUgLyAyOw0KICAgICAgICBibG9ja1t0b3BibG9ja10ubWF4ID0gbW92ZTsNCiAgICAgIH0NCiAgICAgIGlmIChidXR0b25tb2RlKSB7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5idXR0b25tb2RlID0gYnV0dG9ubW9kZTsNCiAgICAgIH0NCiAgICAgIHRvcGJsb2NrKys7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY3JlYXRlQm91bmNlKHgsIHksIHdpZHRoLCBoZWlnaHQsIG1vdmUsIGJ1dHRvbm1vZGUpIHsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXSA9IG5ldyBCbG9jaygpOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnggPSB4Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnkgPSB5Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLndpZHRoID0gd2lkdGg7DQogICAgICBibG9ja1t0b3BibG9ja10uaGVpZ2h0ID0gaGVpZ2h0Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmJvdW5jZSA9IHRydWU7DQogICAgICBibG9ja1t0b3BibG9ja10ua2lsbCA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmRpciA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnN0YXJ0eCA9IHg7DQogICAgICBibG9ja1t0b3BibG9ja10uc3RhcnR5ID0geTsNCiAgICAgIGlmIChtb3ZlKSB7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5tb3ZlID0gdHJ1ZTsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLmNvdW50ID0gbW92ZSAvIDI7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5tYXggPSBtb3ZlOw0KICAgICAgfQ0KICAgICAgaWYgKGJ1dHRvbm1vZGUpIHsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLmJ1dHRvbm1vZGUgPSBidXR0b25tb2RlOw0KICAgICAgfQ0KICAgICAgdG9wYmxvY2srKzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjcmVhdGVCR3JhZGllbnQoeCwgeSwgd2lkdGgsIGhlaWdodCwgbW92ZSwgYnV0dG9ubW9kZSkgew0KICAgICAgYmxvY2tbdG9wYmxvY2tdID0gbmV3IEJsb2NrKCk7DQogICAgICBibG9ja1t0b3BibG9ja10ueCA9IHg7DQogICAgICBibG9ja1t0b3BibG9ja10ueSA9IHk7DQogICAgICBibG9ja1t0b3BibG9ja10ud2lkdGggPSB3aWR0aDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5oZWlnaHQgPSBoZWlnaHQ7DQogICAgICBibG9ja1t0b3BibG9ja10ua2lsbCA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmdyYXBwbGUgPSBmYWxzZTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5pY2UgPSBmYWxzZTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5ncmFkaWVudCA9IHRydWU7DQogICAgICBibG9ja1t0b3BibG9ja10uYiA9IHRydWU7DQogICAgICBibG9ja1t0b3BibG9ja10uc3RhcnR4ID0geDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5zdGFydHkgPSB5Ow0KICAgICAgaWYgKG1vdmUpIHsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLm1vdmUgPSB0cnVlOw0KICAgICAgICBibG9ja1t0b3BibG9ja10uY291bnQgPSBtb3ZlIC8gMjsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLm1heCA9IG1vdmU7DQogICAgICB9DQogICAgICBpZiAoYnV0dG9ubW9kZSkgew0KICAgICAgICBibG9ja1t0b3BibG9ja10uYnV0dG9ubW9kZSA9IGJ1dHRvbm1vZGU7DQogICAgICB9DQogICAgICB0b3BibG9jaysrOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNyZWF0ZUNvbnZleW9yKHgsIHksIHdpZHRoLCBoZWlnaHQsIG1vdmUsIGJ1dHRvbm1vZGUpIHsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXSA9IG5ldyBCbG9jaygpOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnggPSB4Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnkgPSB5Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLndpZHRoID0gd2lkdGg7DQogICAgICBibG9ja1t0b3BibG9ja10uaGVpZ2h0ID0gaGVpZ2h0Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmtpbGwgPSBmYWxzZTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5ncmFwcGxlID0gZmFsc2U7DQogICAgICBibG9ja1t0b3BibG9ja10uaWNlID0gZmFsc2U7DQogICAgICBibG9ja1t0b3BibG9ja10uZ3JhZGllbnQgPSBmYWxzZTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5jb252ZXlvciA9IHRydWU7DQogICAgICBibG9ja1t0b3BibG9ja10uYmMgPSBmYWxzZTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5zdGFydHggPSB4Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnN0YXJ0eSA9IHk7DQogICAgICBpZiAobW92ZSkgew0KICAgICAgICBibG9ja1t0b3BibG9ja10ubW92ZSA9IHRydWU7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5jb3VudCA9IG1vdmUgLyAyOw0KICAgICAgICBibG9ja1t0b3BibG9ja10ubWF4ID0gbW92ZTsNCiAgICAgIH0NCiAgICAgIGlmIChidXR0b25tb2RlKSB7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5idXR0b25tb2RlID0gYnV0dG9ubW9kZTsNCiAgICAgIH0NCiAgICAgIHRvcGJsb2NrKys7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY3JlYXRlQkNvbnZleW9yKHgsIHksIHdpZHRoLCBoZWlnaHQsIG1vdmUsIGJ1dHRvbm1vZGUpIHsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXSA9IG5ldyBCbG9jaygpOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnggPSB4Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnkgPSB5Ow0KICAgICAgYmxvY2tbdG9wYmxvY2tdLnN0YXJ0eCA9IHg7DQogICAgICBibG9ja1t0b3BibG9ja10uc3RhcnR5ID0geTsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS53aWR0aCA9IHdpZHRoOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmhlaWdodCA9IGhlaWdodDsNCiAgICAgIGJsb2NrW3RvcGJsb2NrXS5raWxsID0gZmFsc2U7DQogICAgICBibG9ja1t0b3BibG9ja10uZ3JhcHBsZSA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmljZSA9IGZhbHNlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmdyYWRpZW50ID0gZmFsc2U7DQogICAgICBibG9ja1t0b3BibG9ja10uY29udmV5b3IgPSB0cnVlOw0KICAgICAgYmxvY2tbdG9wYmxvY2tdLmJjID0gdHJ1ZTsNCiAgICAgIGlmIChtb3ZlKSB7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5tb3ZlID0gdHJ1ZTsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLmNvdW50ID0gbW92ZSAvIDI7DQogICAgICAgIGJsb2NrW3RvcGJsb2NrXS5tYXggPSBtb3ZlOw0KICAgICAgfQ0KICAgICAgaWYgKGJ1dHRvbm1vZGUpIHsNCiAgICAgICAgYmxvY2tbdG9wYmxvY2tdLmJ1dHRvbm1vZGUgPSBidXR0b25tb2RlOw0KICAgICAgfQ0KICAgICAgdG9wYmxvY2srKzsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjcmVhdGVQYXJ0KHgsIHksIHN0eWxlKSB7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvcHBhcnQ7IGkrKykgew0KICAgICAgICBpZiAoIXBhcnRbaV0ub24pIHsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcGFydFtpXSA9IG5ldyBQYXJ0KCk7DQogICAgICBwYXJ0W2ldLm9uID0gdHJ1ZTsNCiAgICAgIHBhcnRbaV0ueCA9IHg7DQogICAgICBwYXJ0W2ldLnkgPSB5Ow0KICAgICAgcGFydFtpXS5zdHlsZSA9IHN0eWxlOw0KICAgICAgaWYgKGkgPT0gdG9wcGFydCkgew0KICAgICAgICB0b3BwYXJ0Kys7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY3JlYXRlU3Rhcih4LCB5KSB7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvcHN0YXI7IGkrKykgew0KICAgICAgICBpZiAoIXN0YXJbaV0ub24pIHsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgc3RhcltpXSA9IG5ldyBTdGFyKCk7DQogICAgICBzdGFyW2ldLm9uID0gdHJ1ZTsNCiAgICAgIHN0YXJbaV0ueCA9IHg7DQogICAgICBzdGFyW2ldLnkgPSB5Ow0KICAgICAgaWYgKGkgPT0gdG9wc3Rhcikgew0KICAgICAgICB0b3BzdGFyKys7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY3JlYXRlQ1N0YXIoeCwgeSwgZGVzdHgsIGRlc3R5KSB7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvcGNzdGFyOyBpKyspIHsNCiAgICAgICAgaWYgKCFjc3RhcltpXS5vbikgew0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBjc3RhcltpXSA9IG5ldyBDU3RhcigpOw0KICAgICAgY3N0YXJbaV0ub24gPSB0cnVlOw0KICAgICAgY3N0YXJbaV0ueCA9IHg7DQogICAgICBjc3RhcltpXS55ID0geTsNCiAgICAgIGNzdGFyW2ldLmRlc3R4ID0gZGVzdHg7DQogICAgICBjc3RhcltpXS5kZXN0eSA9IGRlc3R5Ow0KICAgICAgaWYgKGkgPT0gdG9wY3N0YXIpIHsNCiAgICAgICAgdG9wY3N0YXIrKzsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjcmVhdGVCb3goeCwgeSwgd2lkdGgsIGhlaWdodCkgew0KICAgICAgdmFyIGIgPSBib3gubGVuZ3RoOw0KICAgICAgYm94W2JdID0gbmV3IEJveCgpOw0KICAgICAgYm94W2JdLnggPSB4Ow0KICAgICAgYm94W2JdLnkgPSB5Ow0KICAgICAgYm94W2JdLndpZHRoID0gd2lkdGg7DQogICAgICBib3hbYl0uaGVpZ2h0ID0gaGVpZ2h0Ow0KICAgICAgYm94W2JdLmJvdHNwZWVkID0gMDsNCiAgICAgIGJveFtiXS5ib3Rjb3VudCA9IDA7DQogICAgfQ0KDQogICAgZnVuY3Rpb24ga2lsbCgpIHsNCiAgICAgIC8vc3RhcnR0aW1lID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsNCiAgICAgIGZhZGUgPSAxOw0KICAgICAgZmFkZWNvbG9yID0gInJnYmEoMjU1LDAsMCwiOw0KICAgICAgcm90YXRlID0gZmFsc2U7DQogICAgICB4ID0gc3RhcnR4Ow0KICAgICAgeSA9IHN0YXJ0eTsNCiAgICAgIGdyZWVueCA9IGxhc3RncmVlbng7DQogICAgICBncmVlbnkgPSBsYXN0Z3JlZW55Ow0KICAgICAgZ3JlZW54c3BlZWQgPSAwOw0KICAgICAgZ3JlZW55c3BlZWQgPSAwOw0KICAgICAgZ3JhcHBsZSA9IGZhbHNlOw0KICAgICAgeXNwZWVkID0gMDsNCiAgICAgIHhzcGVlZCA9IDA7DQogICAgICBib3ggPSBKU09OLnBhcnNlKG9sZGJveCk7DQogICAgICBmb3IgKHZhciBpIGluIGJsb2NrKSB7DQogICAgICAgIGlmIChibG9ja1tpXS5tb3ZlKSB7DQogICAgICAgICAgYmxvY2tbaV0uY291bnQgPSBibG9ja1tpXS5tYXggLyAyOw0KICAgICAgICAgIGJsb2NrW2ldLmRpciA9IGZhbHNlOw0KICAgICAgICAgIGJsb2NrW2ldLnggPSBibG9ja1tpXS5zdGFydHg7DQogICAgICAgICAgYmxvY2tbaV0ueSA9IGJsb2NrW2ldLnN0YXJ0eTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKGNoZWNrKSB7DQoNCiAgICAgICAgYm94ID0gSlNPTi5wYXJzZShjaGVjay5ib3gpOw0KICAgICAgICBmb3IgKHZhciBpIGluIGNoZWNrLmNvdW50KSB7DQogICAgICAgICAgYmxvY2tbaV0uY291bnQgPSBjaGVjay5jb3VudFtpXTsNCiAgICAgICAgICBibG9ja1tpXS5kaXIgPSBjaGVjay5kaXJbaV07DQogICAgICAgICAgYmxvY2tbaV0ueCA9IGNoZWNrLm14W2ldOw0KICAgICAgICAgIGJsb2NrW2ldLnkgPSBjaGVjay5teVtpXTsNCiAgICAgICAgfQ0KICAgICAgICB4ID0gY2hlY2sueDsNCiAgICAgICAgeSA9IGNoZWNrLnk7DQogICAgICAgIHhzcGVlZCA9IGNoZWNrLnhzcGVlZDsNCiAgICAgICAgeXNwZWVkID0gY2hlY2sueXNwZWVkOw0KICAgICAgICBjTGlnaHQgPSBjaGVjay5jTGlnaHQ7DQogICAgICB9DQoNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjaXJjbGVDb2xsaWRlKGIpIHsNCiAgICAgIEN4ID0gTWF0aC5hYnMoeCArIDE2IC0gKGIueCArIGIud2lkdGggLyAyKSk7DQogICAgICBDeSA9IE1hdGguYWJzKHkgKyAxNiAtIChiLnkgKyBiLmhlaWdodCAvIDIpKTsNCg0KICAgICAgaWYgKEN4ID4gKGIud2lkdGggLyAyICsgMTYpKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICAgIGlmIChDeSA+IChiLmhlaWdodCAvIDIgKyAxNikpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KDQogICAgICBpZiAoQ3ggPD0gKGIud2lkdGggLyAyKSkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmIChDeSA8PSAoYi5oZWlnaHQgLyAyKSkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCg0KICAgICAgY29ybmVyRGlzdGFuY2Vfc3EgPSBNYXRoLnBvdyhDeCAtIGIud2lkdGggLyAyLCAyKSArDQogICAgICAgIE1hdGgucG93KChDeSAtIGIuaGVpZ2h0IC8gMiksIDIpOw0KDQogICAgICByZXR1cm4gKGNvcm5lckRpc3RhbmNlX3NxIDw9ICgxNiAqIDE2KSk7DQoNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB3aW4oKSB7DQogICAgICAvKglsZWZ0RG93biA9IGZhbHNlOw0KICAgICAgCXJpZ2h0RG93biA9IGZhbHNlOw0KICAgICAgCXVwRG93biA9IGZhbHNlOw0KICAgICAgCWRvd25Eb3duID0gZmFsc2U7Ki8NCiAgICAgIC8vYWxlcnQoInlvdSB3aW4iKTsNCiAgICAgIGxhc3RsZXZlbCA9IGZhbHNlOw0KICAgICAgaW5pdGZpbmFsID0gdHJ1ZTsNCiAgICAgIGluaXRmaW5hbDIgPSB0cnVlOw0KICAgICAgdHJlYXN1cmV4ID0gNTAwOw0KICAgICAgdHJlYXN1cmV5ID0gMjUwOw0KICAgICAgbW92ZWZyZWQgPSBmYWxzZTsNCiAgICAgIGZpcmUgPSBmYWxzZTsNCiAgICAgIGJveCA9IFtdOw0KICAgICAgYmxvY2sgPSBbXTsNCiAgICAgIHRvcGJsb2NrID0gMDsNCiAgICAgIGxldmVsKys7DQogICAgICBpZiAobGV2ZWwgPT0gbC5sZW5ndGggfHwgbGV2ZWwgJSAyMCA9PSAwKSB7DQoNCiAgICAgICAgc3dpdGNoIChNYXRoLmZsb29yKChsZXZlbCAtIDEpIC8gMjApKSB7DQogICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmJlYXRPbmUgPSB0cnVlOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmJlYXRUd28gPSB0cnVlOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAyOg0KICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmJlYXRUaHJlZSA9IHRydWU7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlIDM6DQogICAgICAgICAgICBsb2NhbFN0b3JhZ2UuYmVhdEZvdXIgPSB0cnVlOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgbGV2ZWwgPSAtMTsNCiAgICAgICAgaW5nYW1lID0gZmFsc2U7DQogICAgICAgIHZhciB0aW1lID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAtIHN0YXJ0dGltZTsNCiAgICAgICAgaWYgKHRpbWUgPCBiZXN0dGltZSB8fCBiZXN0dGltZSA9PSAiIikgew0KICAgICAgICAgIGJlc3R0aW1lID0gdGltZTsNCiAgICAgICAgfQ0KICAgICAgICBzdGFydHRpbWUgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOw0KDQogICAgICB9IGVsc2Ugew0KICAgICAgICBzd2l0Y2ggKE1hdGguZmxvb3IobGV2ZWwgLyAyMCkpIHsNCiAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICBpZiAobGV2ZWwgJSAyMCA+IE51bWJlcihsb2NhbFN0b3JhZ2UucGFydE9uZSkpIHsNCiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnBhcnRPbmUgPSBsZXZlbCAlIDIwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICBpZiAobGV2ZWwgJSAyMCA+IE51bWJlcihsb2NhbFN0b3JhZ2UucGFydFR3bykpIHsNCiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnBhcnRUd28gPSBsZXZlbCAlIDIwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYnJlYWs7DQoNCg0KICAgICAgICAgIGNhc2UgMjoNCiAgICAgICAgICAgIGlmIChsZXZlbCAlIDIwID4gTnVtYmVyKGxvY2FsU3RvcmFnZS5wYXJ0VGhyZWUpKSB7DQogICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5wYXJ0VGhyZWUgPSBsZXZlbCAlIDIwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAzOg0KICAgICAgICAgICAgaWYgKGxldmVsICUgMjAgPiBOdW1iZXIobG9jYWxTdG9yYWdlLnBhcnRGb3VyKSkgew0KICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucGFydEZvdXIgPSBsZXZlbCAlIDIwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGdyYXZvZmYgPSBmYWxzZTsNCiAgICAgIHN3aXRjaHggPSBmYWxzZTsNCiAgICAgIHN3aXRjaHkgPSBmYWxzZTsNCiAgICAgIHRvdWNpbmcgPSBmYWxzZTsNCiAgICAgIHggPSAwOw0KICAgICAgeSA9IDA7DQogICAgICBsW2xldmVsXSgpOw0KICAgICAgc3RhcnR4ID0geDsNCiAgICAgIHN0YXJ0eSA9IHk7DQogICAgICBvbGRib3ggPSAoSlNPTi5zdHJpbmdpZnkoYm94KSk7DQogICAgICBsYXN0Z3JlZW54ID0gZ3JlZW54Ow0KICAgICAgbGFzdGdyZWVueSA9IGdyZWVueTsNCiAgICAgIGtpbGwoKTsNCiAgICAgIGZhZGVjb2xvciA9ICJyZ2JhKDI1NSwyNTUsMCwiOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNhbGNCKHh4KSB7DQoNCiAgICAgIHZhciBkID0gTWF0aC5hYnMoY0xpZ2h0IC0geHggJSAzMDApOw0KICAgICAgaWYgKGQgPiAxNTApIHsNCiAgICAgICAgZCA9IDMwMCAtIGQ7DQogICAgICB9DQogICAgICB2YXIgYiA9IC4xICsgMzAgLyAoMSArIGQpOw0KICAgICAgaWYgKGIgPiAxKSB7DQogICAgICAgIGIgPSAxOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2FsY0JCKHh4KSB7DQoNCiAgICAgIHZhciBkID0gTWF0aC5hYnMoKDMwMCAtIGNMaWdodCkgLSB4eCAlIDMwMCk7DQogICAgICBpZiAoZCA+IDE1MCkgew0KICAgICAgICBkID0gMzAwIC0gZDsNCiAgICAgIH0NCiAgICAgIHZhciBiID0gLjEgKyAzMCAvICgxICsgZCk7DQogICAgICBpZiAoYiA+IDEpIHsNCiAgICAgICAgYiA9IDE7DQogICAgICB9DQogICAgICByZXR1cm4gYjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBkcmF3VG9wUGxheWVyKHh4LCB5eSwgd3csIGhoKSB7DQogICAgICBjdHguc2F2ZSgpOw0KICAgICAgY3R4LmJlZ2luUGF0aCgpOw0KICAgICAgY3R4LnJlY3QoeHgsIHl5LCB3dywgaGgpOw0KICAgICAgY3R4LmNsaXAoKTsNCiAgICAgIHZhciBhbDsNCiAgICAgIGlmICh5IDwgMzAwKSB7DQogICAgICAgIGFsID0gKCgzMDAgLSAzMiAtIHkpIC8gMTAwMCk7DQogICAgICAgIGFsID0gMSAtIChhbCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBhbCA9ICgoeSAtIDMwMCkgLyAxMDAwKQ0KICAgICAgICBhbCA9IDEgLSAoYWwpOw0KICAgICAgfQ0KICAgICAgYWwgPSBNYXRoLnJvdW5kKDI1NSAqIGFsKTsNCiAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiKCIgKyBhbCArICIsIiArIGFsICsgIiwiICsgYWwgKyAiKSI7DQogICAgICBjdHguc3Ryb2tlU3R5bGUgPSAid2hpdGUiOw0KICAgICAgY3R4LmJlZ2luUGF0aCgpOw0KICAgICAgY3R4LmFyYygoeCArIHZpZXcgKyAxNikgKiBzY2FsZSwgKHkgKyB2aWV3eSArIDE2KSAqIHNjYWxlLCAoMTUpICogc2NhbGUsIDAsIE1hdGguUEkgKiAyLCB0cnVlKTsNCiAgICAgIGN0eC5jbG9zZVBhdGgoKTsNCiAgICAgIGN0eC5maWxsKCk7DQogICAgICBjdHguc3Ryb2tlKCk7DQoNCiAgICAgIGN0eC5maWxsU3R5bGUgPSAicmdiKDI1NSwwLDApIjsNCiAgICAgIGN0eC5yZXN0b3JlKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZHJhd1BhdXNlKHh4LCB5eSwgd3csIGhoLCBidykgew0KICAgICAgaWYgKGdyYXZvZmYpIHsNCiAgICAgICAgYncgPSBmYWxzZTsNCiAgICAgIH0NCiAgICAgIGlmIChwYXVzZWQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgY3R4LnNhdmUoKTsNCiAgICAgIGN0eC5iZWdpblBhdGgoKTsNCiAgICAgIGN0eC5yZWN0KHh4LCB5eSwgd3csIGhoKTsNCiAgICAgIGN0eC5jbGlwKCk7DQogICAgICBpZiAoYncpIHsNCiAgICAgICAgY3R4LmRyYXdJbWFnZShwYXVzZUJsYWNrLCA4MDAgKiBzY2FsZSAtIDMyICogc2NhbGUgLSA2ICogc2NhbGUsIDYgKiBzY2FsZSwgMzIgKiBzY2FsZSwgMzIgKiBzY2FsZSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjdHguZHJhd0ltYWdlKHBhdXNlV2hpdGUsIDgwMCAqIHNjYWxlIC0gMzIgKiBzY2FsZSAtIDYgKiBzY2FsZSwgNiAqIHNjYWxlLCAzMiAqIHNjYWxlLCAzMiAqIHNjYWxlKTsNCiAgICAgIH0NCiAgICAgIGN0eC5yZXN0b3JlKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZHJhd0JvdFBsYXllcih4eCwgeXksIHd3LCBoaCkgew0KICAgICAgaWYgKGdyYXZvZmYpIHsNCiAgICAgICAgcmV0dXJuIGRyYXdUb3BQbGF5ZXIoeHgsIHl5LCB3dywgaGgpOw0KICAgICAgfQ0KDQogICAgICBjdHguc2F2ZSgpOw0KICAgICAgY3R4LmJlZ2luUGF0aCgpOw0KICAgICAgY3R4LnJlY3QoeHgsIHl5LCB3dywgaGgpOw0KICAgICAgY3R4LmNsaXAoKTsNCiAgICAgIHZhciBhbDsNCiAgICAgIGlmICh5IDwgMzAwKSB7DQogICAgICAgIGFsID0gKCgzMDAgLSAzMiAtIHkpIC8gMTAwMCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBhbCA9ICgoeSAtIDMwMCkgLyAxMDAwKTsNCiAgICAgIH0NCiAgICAgIGFsID0gTWF0aC5yb3VuZCgyNTUgKiBhbCk7DQogICAgICBjdHguZmlsbFN0eWxlID0gInJnYigiICsgYWwgKyAiLCIgKyBhbCArICIsIiArIGFsICsgIikiOw0KICAgICAgY3R4LnN0cm9rZVN0eWxlID0gImJsYWNrIjsNCiAgICAgIGN0eC5iZWdpblBhdGgoKTsNCiAgICAgIGN0eC5hcmMoKHggKyB2aWV3ICsgMTYpICogc2NhbGUsICh5ICsgdmlld3kgKyAxNikgKiBzY2FsZSwgKDE1KSAqIHNjYWxlLCAwLCBNYXRoLlBJICogMiwgdHJ1ZSk7DQogICAgICBjdHguY2xvc2VQYXRoKCk7DQogICAgICBjdHguZmlsbCgpOw0KICAgICAgY3R4LnN0cm9rZSgpOw0KDQogICAgICBjdHguZmlsbFN0eWxlID0gInJnYigyNTUsMCwwKSI7DQogICAgICBjdHgucmVzdG9yZSgpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHB1cmdlQnV0dG9ucygpIHsNCiAgICAgIHZhciBiZWF0T25lID0gQm9vbGVhbihsb2NhbFN0b3JhZ2UuYmVhdE9uZSk7DQogICAgICB2YXIgYmVhdFR3byA9IEJvb2xlYW4obG9jYWxTdG9yYWdlLmJlYXRUd28pOw0KICAgICAgdmFyIGJlYXRUaHJlZSA9IEJvb2xlYW4obG9jYWxTdG9yYWdlLmJlYXRUaHJlZSk7DQogICAgICB2YXIgYmVhdEZvdXIgPSBCb29sZWFuKGxvY2FsU3RvcmFnZS5iZWF0Rm91cik7DQogICAgICB2YXIgaGFzVGhyZWUgPSAoYmVhdE9uZSB8fCBiZWF0VHdvKTsNCiAgICAgIHZhciBoYXNGb3VyID0gKChiZWF0T25lICYmIGJlYXRUd28pIHx8IGJlYXRUaHJlZSk7DQogICAgICB2YXIgaGFzRml2ZSA9IChiZWF0Rm91ciB8fCAoYmVhdE9uZSAmJiBiZWF0VHdvICYmIGJlYXRUaHJlZSkpOw0KICAgICAgZm9yICh2YXIgaSBpbiBibG9jaykgew0KICAgICAgICBpZiAoYmxvY2tbaV0uYm91bmNlICYmICFoYXNUaHJlZSkgew0KICAgICAgICAgIGJsb2NrW2ldLnggKz0gMTAwMDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoYmxvY2tbaV0ud2luICYmICFoYXNGb3VyKSB7DQogICAgICAgICAgYmxvY2tbaV0ueCArPSAxMDAwOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBmb3IgKHZhciBpIGluIGJveCkgew0KICAgICAgICBpZiAoIWhhc0ZpdmUpIHsNCiAgICAgICAgICBib3hbaV0ueCArPSAxMDAwOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0Q3Vyc29yKGMpIHsNCiAgICAgICQoJyNzY3JlZW4nKS5jc3MoImN1cnNvciIsIGMpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG1lbnUoKSB7DQoNCiAgICAgIGxhc3RsZXZlbCA9IGZhbHNlOw0KICAgICAgaW5pdGZpbmFsID0gdHJ1ZTsNCiAgICAgIGluaXRmaW5hbDIgPSB0cnVlOw0KICAgICAgdHJlYXN1cmV4ID0gNTAwOw0KICAgICAgdHJlYXN1cmV5ID0gMjUwOw0KICAgICAgbW92ZWZyZWQgPSBmYWxzZTsNCiAgICAgIGZpcmUgPSBmYWxzZTsNCiAgICAgIGJveCA9IFtdOw0KICAgICAgYmxvY2sgPSBbXTsNCiAgICAgIHRvcGJsb2NrID0gMDsNCiAgICAgIGxldmVsID0gLTE7DQoNCiAgICAgIGdyYXZvZmYgPSBmYWxzZTsNCiAgICAgIHN3aXRjaHggPSBmYWxzZTsNCiAgICAgIHN3aXRjaHkgPSBmYWxzZTsNCiAgICAgIHRvdWNpbmcgPSBmYWxzZTsNCiAgICAgIHggPSAwOw0KICAgICAgeSA9IDA7DQogICAgICBsW2xldmVsXSgpOw0KICAgICAgaW5nYW1lID0gZmFsc2U7DQogICAgICBzZWxlY3RpbmcgPSBmYWxzZTsNCiAgICAgIHN0YXJ0eCA9IHg7DQogICAgICBzdGFydHkgPSB5Ow0KICAgICAgb2xkYm94ID0gKEpTT04uc3RyaW5naWZ5KGJveCkpOw0KICAgICAgbGFzdGdyZWVueCA9IGdyZWVueDsNCiAgICAgIGxhc3RncmVlbnkgPSBncmVlbnk7DQogICAgICBraWxsKCk7DQogICAgICBmYWRlY29sb3IgPSAicmdiYSgwLDAsMjU1LCI7DQogICAgfQ0KICA8L3NjcmlwdD4NCjwvYm9keT4NCg0KPC9odG1sPg==";
