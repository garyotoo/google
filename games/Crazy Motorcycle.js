window.game = "PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbi11cyI+DQogICAgPGhlYWQ+DQogICAgICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4NCiAgICAgICAgPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiPg0KICAgICAgICA8YmFzZSBocmVmID0gImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9Db29sRHVkZTIzNDkvZXZlcnl0aGluZ0BtYWluL2NyYXp5bW90b3IvIj4NCiAgICAgICAgPHN0eWxlPg0KICAgICAgICAgICAgaHRtbCwgYm9keSB7DQogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBweDsNCiAgICAgICAgICAgICAgICBtYXJnaW46IDBweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC5mdWxsc2NyZWVuIHsNCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMzgzODM4Ow0KICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgICAgICAgICAgICAgdG9wOiAwcHg7DQogICAgICAgICAgICAgICAgbGVmdDogMHB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgI2Jhbm5lci1jb250YWluZXIgew0KICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgICAgICAgICBib3R0b206IDBweDsNCiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgICAgICBoZWlnaHQ6IDkwcHg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAjbG9hZGluZy1vdmVybGF5IHsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDIwcHg7DQogICAgICAgICAgICAgICAgei1pbmRleDogMTsNCiAgICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICNpY29uIHsNCiAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDEyMHB4Ow0KICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7DQogICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICNwcm9ncmVzcy1iYXIgew0KICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDVweDsNCiAgICAgICAgICAgICAgICB3aWR0aDogOTAlOw0KICAgICAgICAgICAgICAgIG1heC13aWR0aDogMjUwcHg7DQogICAgICAgICAgICAgICAgaGVpZ2h0OiAyMHB4Ow0KICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICMyNDI0MjQ7DQogICAgICAgICAgICAgICAgcGFkZGluZzogNXB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgI3Byb2dyZXNzLWJhci1maWxsIHsNCiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7DQogICAgICAgICAgICAgICAgd2lkdGg6IDAlOw0KICAgICAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjRkY5QTAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICA8L3N0eWxlPg0KICAgIDwvaGVhZD4NCiAgICA8Ym9keT4NCiAgICAgICAgPGNhbnZhcyBpZD0iY2FudmFzIiBjbGFzcz0iZnVsbHNjcmVlbiI+PC9jYW52YXM+DQogICAgICAgIDxkaXYgaWQ9ImJhbm5lci1jb250YWluZXIiIHN0eWxlPSJkaXNwbGF5OiBub25lIj48L2Rpdj4NCiAgICAgICAgPGRpdiBpZD0ibG9hZGluZy1vdmVybGF5IiBjbGFzcz0iZnVsbHNjcmVlbiI+DQogICAgICAgICAgICA8aW1nIGlkPSJpY29uIiBzcmM9Ii4vaWNvbi5wbmciIC8+DQogICAgICAgICAgICA8ZGl2IGlkPSJwcm9ncmVzcy1iYXIiPjxkaXYgaWQ9InByb2dyZXNzLWJhci1maWxsIj48L2Rpdj48L2Rpdj4NCiAgICAgICAgPC9kaXY+DQogICAgICAgIDxzY3JpcHQgc3JjPSIuL2luc3RhbnQtZ2FtZXMtYnJpZGdlLmpzIj48L3NjcmlwdD4NCg0KICAgICAgICA8c2NyaXB0Pg0KICAgICAgICAgICAgaWYgKC9pUGhvbmV8aVBhZHxpUG9kfEFuZHJvaWQvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7DQogICAgICAgICAgICAgICAgbGV0IG1ldGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtZXRhJykNCiAgICAgICAgICAgICAgICBtZXRhLm5hbWUgPSAndmlld3BvcnQnDQogICAgICAgICAgICAgICAgbWV0YS5jb250ZW50ID0gJ3dpZHRoPWRldmljZS13aWR0aCwgaGVpZ2h0PWRldmljZS1oZWlnaHQsIGluaXRpYWwtc2NhbGU9MS4wLCB1c2VyLXNjYWxhYmxlPW5vLCBzaHJpbmstdG8tZml0PXllcycNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKG1ldGEpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxldCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJykNCiAgICAgICAgICAgIGxldCBsb2FkaW5nT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nLW92ZXJsYXknKQ0KICAgICAgICAgICAgbGV0IHByb2dyZXNzQmFyRmlsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzcy1iYXItZmlsbCcpDQogICAgICAgICAgICBsZXQgYmFubmVyQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jhbm5lci1jb250YWluZXInKQ0KDQogICAgICAgICAgICBjb25zdCBTVE9SQUdFX0RBVEFfU0VQQVJBVE9SID0gJ3ticmlkZ2VfZGF0YV9zZXBhcmF0b3J9Jw0KICAgICAgICAgICAgY29uc3QgU1RPUkFHRV9LRVlTX1NFUEFSQVRPUiA9ICd7YnJpZGdlX2tleXNfc2VwYXJhdG9yfScNCiAgICAgICAgICAgIGNvbnN0IFNUT1JBR0VfVkFMVUVTX1NFUEFSQVRPUiA9ICd7YnJpZGdlX3ZhbHVlc19zZXBhcmF0b3J9Jw0KICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIHV0aWxzDQogICAgICAgICAgICB3aW5kb3cudW5pdHlJbnN0YW5jZSA9IG51bGwNCiAgICAgICAgICAgIGxldCBwcm9ncmVzc0JhckZpbGxpbmdJbnRlcnZhbCA9IG51bGwNCg0KICAgICAgICAgICAgZnVuY3Rpb24gc2VuZE1lc3NhZ2VUb1VuaXR5KG5hbWUsIHZhbHVlKSB7DQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy51bml0eUluc3RhbmNlICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy51bml0eUluc3RhbmNlLlNlbmRNZXNzYWdlKCdCcmlkZ2UnLCBuYW1lLCB2YWx1ZSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIG9uVW5pdHlMb2FkaW5nUHJvZ3Jlc3NDaGFuZ2VkKHByb2dyZXNzKSB7DQogICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzID09PSAwLjkpIHsNCiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVQcm9ncmVzc0JhckZpbGxpbmcoKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBwcm9ncmVzc0JhckZpbGwuc3R5bGUud2lkdGggPSBgJHsgcHJvZ3Jlc3MgKiAxMDAgfSVgDQogICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzID09PSAxICYmIHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocHJvZ3Jlc3NCYXJGaWxsaW5nSW50ZXJ2YWwpDQogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsID0gbnVsbA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZnVuY3Rpb24gY29tcGxldGVQcm9ncmVzc0JhckZpbGxpbmcoKSB7DQogICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGxldCBjdXJyZW50UGVyY2VudCA9IDkwDQogICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJGaWxsLnN0eWxlLndpZHRoID0gYCR7IGN1cnJlbnRQZXJjZW50IH0lYA0KICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGVyY2VudCsrDQogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UGVyY2VudCA+IDEwMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBlcmNlbnQgPSAxMDANCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRmlsbC5zdHlsZS53aWR0aCA9IGAkeyBjdXJyZW50UGVyY2VudCB9JWANCg0KICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFBlcmNlbnQgPj0gMTAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHByb2dyZXNzQmFyRmlsbGluZ0ludGVydmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJGaWxsaW5nSW50ZXJ2YWwgPSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sIDEwMCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJkb3duJywgKCkgPT4gew0KICAgICAgICAgICAgICAgIHdpbmRvdy5mb2N1cygpDQogICAgICAgICAgICAgICAgY2FudmFzLmZvY3VzKCkNCiAgICAgICAgICAgIH0pDQoNCg0KICAgICAgICAgICAgbGV0IGJyaWRnZU9wdGlvbnMgPSB7DQogICAgICAgICAgICAgICAgcGxhdGZvcm1zOiB7DQogICAgICAgICAgICAgICAgICAgICdnYW1lX2Rpc3RyaWJ1dGlvbic6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWVJZDogJzMwNjM3ODAxNjAzZTQ2ZWM4MmIzNDJiNzdmNTM5Y2YzJw0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gaW5pdGlhbGl6YXRpb24NCiAgICAgICAgICAgIGJyaWRnZQ0KICAgICAgICAgICAgICAgIC5pbml0aWFsaXplKGJyaWRnZU9wdGlvbnMpDQogICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBicmlkZ2UuYWR2ZXJ0aXNlbWVudC5vbignYmFubmVyX3N0YXRlX2NoYW5nZWQnLCBzdGF0ZSA9PiBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQmFubmVyU3RhdGVDaGFuZ2VkJywgc3RhdGUpKQ0KICAgICAgICAgICAgICAgICAgICBicmlkZ2UuYWR2ZXJ0aXNlbWVudC5vbignaW50ZXJzdGl0aWFsX3N0YXRlX2NoYW5nZWQnLCBzdGF0ZSA9PiBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uSW50ZXJzdGl0aWFsU3RhdGVDaGFuZ2VkJywgc3RhdGUpKQ0KICAgICAgICAgICAgICAgICAgICBicmlkZ2UuYWR2ZXJ0aXNlbWVudC5vbigncmV3YXJkZWRfc3RhdGVfY2hhbmdlZCcsIHN0YXRlID0+IHNlbmRNZXNzYWdlVG9Vbml0eSgnT25SZXdhcmRlZFN0YXRlQ2hhbmdlZCcsIHN0YXRlKSkNCiAgICAgICAgICAgICAgICAgICAgYnJpZGdlLmdhbWUub24oJ3Zpc2liaWxpdHlfc3RhdGVfY2hhbmdlZCcsIHN0YXRlID0+IHNlbmRNZXNzYWdlVG9Vbml0eSgnT25WaXNpYmlsaXR5U3RhdGVDaGFuZ2VkJywgc3RhdGUpKQ0KDQogICAgICAgICAgICAgICAgICAgIGlmIChicmlkZ2UucGxhdGZvcm0uaWQgPT09IGJyaWRnZS5QTEFURk9STV9JRC5ZQU5ERVggfHwgYnJpZGdlLnBsYXRmb3JtLmlkID09PSBicmlkZ2UuUExBVEZPUk1fSUQuR0FNRV9ESVNUUklCVVRJT04pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LnNob3dJbnRlcnN0aXRpYWwoKQ0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgbGV0IHVuaXR5TG9hZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JykNCiAgICAgICAgICAgICAgICAgICAgdW5pdHlMb2FkZXIuc3JjID0gJ0J1aWxkL0J1aWxkX01vdG9yY3ljbGUubG9hZGVyMi5qcycNCiAgICAgICAgICAgICAgICAgICAgdW5pdHlMb2FkZXIub25sb2FkID0gKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlVW5pdHlJbnN0YW5jZSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVXJsOiAnQnVpbGQvQnVpbGRfTW90b3JjeWNsZS5kYXRhLnVuaXR5d2ViJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWV3b3JrVXJsOiAnQnVpbGQvQnVpbGRfTW90b3JjeWNsZS5mcmFtZXdvcmsuanMudW5pdHl3ZWInLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlVXJsOiAnQnVpbGQvQnVpbGRfTW90b3JjeWNsZS53YXNtLnVuaXR5d2ViJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtaW5nQXNzZXRzVXJsOiAnU3RyZWFtaW5nQXNzZXRzJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFueU5hbWU6ICdBTScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3ROYW1lOiAnbnViaWstbW90b3JjeWNsZScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RWZXJzaW9uOiAnMC4yJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWF0Y2hXZWJHTFRvQ2FudmFzU2l6ZTogZmFsc2UsIC8vIFVuY29tbWVudCB0aGlzIHRvIHNlcGFyYXRlbHkgY29udHJvbCBXZWJHTCBjYW52YXMgcmVuZGVyIHNpemUgYW5kIERPTSBlbGVtZW50IHNpemUuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRldmljZVBpeGVsUmF0aW86IDEsIC8vIFVuY29tbWVudCB0aGlzIHRvIG92ZXJyaWRlIGxvdyBEUEkgcmVuZGVyaW5nIG9uIGhpZ2ggRFBJIGRpc3BsYXlzLg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Vbml0eUxvYWRpbmdQcm9ncmVzc0NoYW5nZWQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHVuaXR5SW5zdGFuY2UpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnVuaXR5SW5zdGFuY2UgPSB1bml0eUluc3RhbmNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdPdmVybGF5LnJlbW92ZSgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy5mb2N1cygpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHVuaXR5TG9hZGVyKQ0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKQ0KICAgICAgICAgICAgDQoNCiAgICAgICAgICAgIC8vIHBsYXRmb3JtDQogICAgICAgICAgICB3aW5kb3cuZ2V0UGxhdGZvcm1JZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGxhdGZvcm0uaWQNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldFBsYXRmb3JtTGFuZ3VhZ2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnBsYXRmb3JtLmxhbmd1YWdlDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRQbGF0Zm9ybVBheWxvYWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBsZXQgcGF5bG9hZCA9IGJyaWRnZS5wbGF0Zm9ybS5wYXlsb2FkDQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXlsb2FkID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGF5bG9hZA0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAnJw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldFBsYXRmb3JtVGxkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgbGV0IHRsZCA9IGJyaWRnZS5wbGF0Zm9ybS50bGQNCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRsZCA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRsZA0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAnJw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LnNlbmRNZXNzYWdlVG9QbGF0Zm9ybSA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHsNCiAgICAgICAgICAgICAgICBicmlkZ2UucGxhdGZvcm0uc2VuZE1lc3NhZ2UobWVzc2FnZSkNCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICAvLyBkZXZpY2UNCiAgICAgICAgICAgIHdpbmRvdy5nZXREZXZpY2VUeXBlID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5kZXZpY2UudHlwZQ0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAgIC8vIHBsYXllcg0KICAgICAgICAgICAgd2luZG93LmdldElzUGxheWVyQXV0aG9yaXphdGlvblN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UucGxheWVyLmlzQXV0aG9yaXphdGlvblN1cHBvcnRlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1BsYXllckF1dGhvcml6ZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnBsYXllci5pc0F1dGhvcml6ZWQudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0UGxheWVySWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBpZiAoYnJpZGdlLnBsYXllci5pZCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnBsYXllci5pZC50b1N0cmluZygpDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuICcnDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRQbGF5ZXJOYW1lID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgaWYgKGJyaWRnZS5wbGF5ZXIubmFtZSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnBsYXllci5uYW1lLnRvU3RyaW5nKCkNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gJycNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldFBsYXllclBob3RvcyA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGlmIChicmlkZ2UucGxheWVyLnBob3Rvcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShicmlkZ2UucGxheWVyLnBob3RvcykNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gJycNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmF1dGhvcml6ZVBsYXllciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgew0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGJyaWRnZS5wbGF5ZXIuYXV0aG9yaXplKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25BdXRob3JpemVDb21wbGV0ZWQnLCAndHJ1ZScpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQXV0aG9yaXplQ29tcGxldGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICAvLyBnYW1lDQogICAgICAgICAgICB3aW5kb3cuZ2V0VmlzaWJpbGl0eVN0YXRlID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5nYW1lLnZpc2liaWxpdHlTdGF0ZQ0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAgIC8vIHN0b3JhZ2UNCiAgICAgICAgICAgIHdpbmRvdy5nZXRTdG9yYWdlRGVmYXVsdFR5cGUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnN0b3JhZ2UuZGVmYXVsdFR5cGUNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldElzU3RvcmFnZVN1cHBvcnRlZCA9IGZ1bmN0aW9uKHN0b3JhZ2VUeXBlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zdG9yYWdlLmlzU3VwcG9ydGVkKHN0b3JhZ2VUeXBlKS50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1N0b3JhZ2VBdmFpbGFibGUgPSBmdW5jdGlvbihzdG9yYWdlVHlwZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc3RvcmFnZS5pc0F2YWlsYWJsZShzdG9yYWdlVHlwZSkudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0U3RvcmFnZURhdGEgPSBmdW5jdGlvbihrZXksIHN0b3JhZ2VUeXBlKSB7DQogICAgICAgICAgICAgICAgbGV0IGtleXMgPSBrZXkuc3BsaXQoU1RPUkFHRV9LRVlTX1NFUEFSQVRPUikNCg0KICAgICAgICAgICAgICAgIGJyaWRnZS5zdG9yYWdlLmdldChrZXlzLCBzdG9yYWdlVHlwZSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5cy5sZW5ndGggPiAxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlcyA9IFtdDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlID0gZGF0YVtpXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzLnB1c2godmFsdWUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCgnJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25HZXRTdG9yYWdlRGF0YVN1Y2Nlc3MnLCBgJHtrZXl9JHtTVE9SQUdFX0RBVEFfU0VQQVJBVE9SfSR7dmFsdWVzLmpvaW4oU1RPUkFHRV9WQUxVRVNfU0VQQVJBVE9SKX1gKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVswXSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFbMF0gIT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gSlNPTi5zdHJpbmdpZnkoZGF0YVswXSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25HZXRTdG9yYWdlRGF0YVN1Y2Nlc3MnLCBgJHtrZXl9JHtTVE9SQUdFX0RBVEFfU0VQQVJBVE9SfSR7ZGF0YX1gKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkdldFN0b3JhZ2VEYXRhRmFpbGVkJywga2V5KQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuc2V0U3RvcmFnZURhdGEgPSBmdW5jdGlvbihrZXksIHZhbHVlLCBzdG9yYWdlVHlwZSkgew0KICAgICAgICAgICAgICAgIGxldCBrZXlzID0ga2V5LnNwbGl0KFNUT1JBR0VfS0VZU19TRVBBUkFUT1IpDQogICAgICAgICAgICAgICAgbGV0IHZhbHVlcyA9IHZhbHVlLnNwbGl0KFNUT1JBR0VfVkFMVUVTX1NFUEFSQVRPUikNCg0KICAgICAgICAgICAgICAgIGJyaWRnZS5zdG9yYWdlLnNldChrZXlzLCB2YWx1ZXMsIHN0b3JhZ2VUeXBlKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uU2V0U3RvcmFnZURhdGFTdWNjZXNzJywga2V5KQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblNldFN0b3JhZ2VEYXRhRmFpbGVkJywga2V5KQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZGVsZXRlU3RvcmFnZURhdGEgPSBmdW5jdGlvbihrZXksIHN0b3JhZ2VUeXBlKSB7DQogICAgICAgICAgICAgICAgbGV0IGtleXMgPSBrZXkuc3BsaXQoU1RPUkFHRV9LRVlTX1NFUEFSQVRPUikNCg0KICAgICAgICAgICAgICAgIGJyaWRnZS5zdG9yYWdlLmRlbGV0ZShrZXlzLCBzdG9yYWdlVHlwZSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkRlbGV0ZVN0b3JhZ2VEYXRhU3VjY2VzcycsIGtleSkNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25EZWxldGVTdG9yYWdlRGF0YUZhaWxlZCcsIGtleSkNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICAvLyBhZHZlcnRpc2VtZW50DQogICAgICAgICAgICB3aW5kb3cuZ2V0SW50ZXJzdGl0aWFsU3RhdGUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBpZiAoYnJpZGdlLmFkdmVydGlzZW1lbnQuaW50ZXJzdGl0aWFsU3RhdGUpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5hZHZlcnRpc2VtZW50LmludGVyc3RpdGlhbFN0YXRlDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0SXNCYW5uZXJTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLmFkdmVydGlzZW1lbnQuaXNCYW5uZXJTdXBwb3J0ZWQudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICB3aW5kb3cuZ2V0TWluaW11bURlbGF5QmV0d2VlbkludGVyc3RpdGlhbCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UuYWR2ZXJ0aXNlbWVudC5taW5pbXVtRGVsYXlCZXR3ZWVuSW50ZXJzdGl0aWFsLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LnNldE1pbmltdW1EZWxheUJldHdlZW5JbnRlcnN0aXRpYWwgPSBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0geyB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LnNldE1pbmltdW1EZWxheUJldHdlZW5JbnRlcnN0aXRpYWwob3B0aW9ucykNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LnNob3dCYW5uZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0geyB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGJyaWRnZS5wbGF0Zm9ybS5pZCA9PT0gYnJpZGdlLlBMQVRGT1JNX0lELkNSQVpZX0dBTUVTIHx8IGJyaWRnZS5wbGF0Zm9ybS5pZCA9PT0gYnJpZGdlLlBMQVRGT1JNX0lELkdBTUVfRElTVFJJQlVUSU9OKSB7DQogICAgICAgICAgICAgICAgICAgIGJhbm5lckNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIG9wdGlvbnNbJ2NyYXp5X2dhbWVzJ10gPSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcklkOiAnYmFubmVyLWNvbnRhaW5lcicNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBvcHRpb25zWydnYW1lX2Rpc3RyaWJ1dGlvbiddID0gew0KICAgICAgICAgICAgICAgICAgICBjb250YWluZXJJZDogJ2Jhbm5lci1jb250YWluZXInDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgYnJpZGdlLmFkdmVydGlzZW1lbnQuc2hvd0Jhbm5lcihvcHRpb25zKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuaGlkZUJhbm5lciA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGlmIChicmlkZ2UucGxhdGZvcm0uaWQgPT09IGJyaWRnZS5QTEFURk9STV9JRC5DUkFaWV9HQU1FUyB8fCBicmlkZ2UucGxhdGZvcm0uaWQgPT09IGJyaWRnZS5QTEFURk9STV9JRC5HQU1FX0RJU1RSSUJVVElPTikgew0KICAgICAgICAgICAgICAgICAgICBiYW5uZXJDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LmhpZGVCYW5uZXIoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuc2hvd0ludGVyc3RpdGlhbCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgew0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LnNob3dJbnRlcnN0aXRpYWwob3B0aW9ucykNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LnNob3dSZXdhcmRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGJyaWRnZS5hZHZlcnRpc2VtZW50LnNob3dSZXdhcmRlZCgpDQogICAgICAgICAgICB9DQoNCg0KICAgICAgICAgICAgLy8gc29jaWFsDQogICAgICAgICAgICB3aW5kb3cuZ2V0SXNTaGFyZVN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzU2hhcmVTdXBwb3J0ZWQudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0SXNJbnZpdGVGcmllbmRzU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zb2NpYWwuaXNJbnZpdGVGcmllbmRzU3VwcG9ydGVkLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldElzSm9pbkNvbW11bml0eVN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzSm9pbkNvbW11bml0eVN1cHBvcnRlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0NyZWF0ZVBvc3RTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnNvY2lhbC5pc0NyZWF0ZVBvc3RTdXBwb3J0ZWQudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0SXNBZGRUb0hvbWVTY3JlZW5TdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnNvY2lhbC5pc0FkZFRvSG9tZVNjcmVlblN1cHBvcnRlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0FkZFRvRmF2b3JpdGVzU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5zb2NpYWwuaXNBZGRUb0Zhdm9yaXRlc1N1cHBvcnRlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1JhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLnNvY2lhbC5pc1JhdGVTdXBwb3J0ZWQudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0SXNFeHRlcm5hbExpbmtzQWxsb3dlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2Uuc29jaWFsLmlzRXh0ZXJuYWxMaW5rc0FsbG93ZWQudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuc2hhcmUgPSBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBicmlkZ2Uuc29jaWFsLnNoYXJlKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25TaGFyZUNvbXBsZXRlZCcsICd0cnVlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25TaGFyZUNvbXBsZXRlZCcsICdmYWxzZScpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5pbnZpdGVGcmllbmRzID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgYnJpZGdlLnNvY2lhbC5pbnZpdGVGcmllbmRzKCkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkludml0ZUZyaWVuZHNDb21wbGV0ZWQnLCAndHJ1ZScpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uSW52aXRlRnJpZW5kc0NvbXBsZXRlZCcsICdmYWxzZScpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5qb2luQ29tbXVuaXR5ID0gZnVuY3Rpb24ob3B0aW9ucykgew0KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgYnJpZGdlLnNvY2lhbC5qb2luQ29tbXVuaXR5KG9wdGlvbnMpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25Kb2luQ29tbXVuaXR5Q29tcGxldGVkJywgJ3RydWUnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkpvaW5Db21tdW5pdHlDb21wbGV0ZWQnLCAnZmFsc2UnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuY3JlYXRlUG9zdCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgew0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwuY3JlYXRlUG9zdChvcHRpb25zKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uQ3JlYXRlUG9zdENvbXBsZXRlZCcsICd0cnVlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25DcmVhdGVQb3N0Q29tcGxldGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmFkZFRvSG9tZVNjcmVlbiA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGJyaWRnZS5zb2NpYWwuYWRkVG9Ib21lU2NyZWVuKCkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFkZFRvSG9tZVNjcmVlbkNvbXBsZXRlZCcsICd0cnVlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25BZGRUb0hvbWVTY3JlZW5Db21wbGV0ZWQnLCAnZmFsc2UnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuYWRkVG9GYXZvcml0ZXMgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBicmlkZ2Uuc29jaWFsLmFkZFRvRmF2b3JpdGVzKCkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFkZFRvRmF2b3JpdGVzQ29tcGxldGVkJywgJ3RydWUnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkFkZFRvRmF2b3JpdGVzQ29tcGxldGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LnJhdGUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBicmlkZ2Uuc29jaWFsLnJhdGUoKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUmF0ZUNvbXBsZXRlZCcsICd0cnVlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25SYXRlQ29tcGxldGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICAvLyBsZWFkZXJib2FyZA0KICAgICAgICAgICAgd2luZG93LmdldElzTGVhZGVyYm9hcmRTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLmxlYWRlcmJvYXJkLmlzU3VwcG9ydGVkLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldElzTGVhZGVyYm9hcmROYXRpdmVQb3B1cFN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UubGVhZGVyYm9hcmQuaXNOYXRpdmVQb3B1cFN1cHBvcnRlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0xlYWRlcmJvYXJkTXVsdGlwbGVCb2FyZHNTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYnJpZGdlLmxlYWRlcmJvYXJkLmlzTXVsdGlwbGVCb2FyZHNTdXBwb3J0ZWQudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuZ2V0SXNMZWFkZXJib2FyZFNldFNjb3JlU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5sZWFkZXJib2FyZC5pc1NldFNjb3JlU3VwcG9ydGVkLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldElzTGVhZGVyYm9hcmRHZXRTY29yZVN1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UubGVhZGVyYm9hcmQuaXNHZXRTY29yZVN1cHBvcnRlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc0xlYWRlcmJvYXJkR2V0RW50cmllc1N1cHBvcnRlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBicmlkZ2UubGVhZGVyYm9hcmQuaXNHZXRFbnRyaWVzU3VwcG9ydGVkLnRvU3RyaW5nKCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmxlYWRlcmJvYXJkU2V0U2NvcmUgPSBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBicmlkZ2UubGVhZGVyYm9hcmQuc2V0U2NvcmUob3B0aW9ucykNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkU2V0U2NvcmVDb21wbGV0ZWQnLCAndHJ1ZScpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uTGVhZGVyYm9hcmRTZXRTY29yZUNvbXBsZXRlZCcsICdmYWxzZScpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5sZWFkZXJib2FyZEdldFNjb3JlID0gZnVuY3Rpb24ob3B0aW9ucykgew0KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgYnJpZGdlLmxlYWRlcmJvYXJkLmdldFNjb3JlKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgIT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZEdldFNjb3JlQ29tcGxldGVkJywgZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkR2V0U2NvcmVDb21wbGV0ZWQnLCAnJykNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZEdldFNjb3JlQ29tcGxldGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmxlYWRlcmJvYXJkR2V0RW50cmllcyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgew0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGJyaWRnZS5sZWFkZXJib2FyZC5nZXRFbnRyaWVzKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgIT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZEdldEVudHJpZXNDb21wbGV0ZWRTdWNjZXNzJywgZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPbkxlYWRlcmJvYXJkR2V0RW50cmllc0NvbXBsZXRlZFN1Y2Nlc3MnLCAnJykNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZEdldEVudHJpZXNDb21wbGV0ZWRGYWlsZWQnLCAnZmFsc2UnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cubGVhZGVyYm9hcmRTaG93TmF0aXZlUG9wdXAgPSBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9ucykNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBicmlkZ2UubGVhZGVyYm9hcmQuc2hvd05hdGl2ZVBvcHVwKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZFNob3dOYXRpdmVQb3B1cENvbXBsZXRlZCcsICd0cnVlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25MZWFkZXJib2FyZFNob3dOYXRpdmVQb3B1cENvbXBsZXRlZCcsICdmYWxzZScpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5nZXRJc1BheW1lbnRzU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5wYXltZW50cy5pc1N1cHBvcnRlZC50b1N0cmluZygpDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5wYXltZW50c1B1cmNoYXNlID0gZnVuY3Rpb24ocHVyY2hhc2VJZCkgew0KICAgICAgICAgICAgICAgIGJyaWRnZS5wYXltZW50cy5wdXJjaGFzZShwdXJjaGFzZUlkKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUGF5bWVudHNQdXJjaGFzZUNvbXBsZXRlZCcsICd0cnVlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25QYXltZW50c1B1cmNoYXNlQ29tcGxldGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LnBheW1lbnRzQ29uc3VtZVB1cmNoYXNlID0gZnVuY3Rpb24ocHVyY2hhc2VUb2tlbikgew0KICAgICAgICAgICAgICAgIGJyaWRnZS5wYXltZW50cy5jb25zdW1lUHVyY2hhc2UocHVyY2hhc2VUb2tlbikNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblBheW1lbnRzQ29uc3VtZVB1cmNoYXNlQ29tcGxldGVkJywgJ3RydWUnKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblBheW1lbnRzQ29uc3VtZVB1cmNoYXNlQ29tcGxldGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LnBheW1lbnRzR2V0Q2F0YWxvZyA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGJyaWRnZS5wYXltZW50cy5nZXRDYXRhbG9nKCkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSAhPT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZUFsbCgnaW1hZ2VVUkknLCAnaWNvbicpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUGF5bWVudHNHZXRDYXRhbG9nQ29tcGxldGVkU3VjY2VzcycsIGRhdGEpDQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlVG9Vbml0eSgnT25QYXltZW50c0dldENhdGFsb2dDb21wbGV0ZWRTdWNjZXNzJywgJycpDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUGF5bWVudHNHZXRDYXRhbG9nQ29tcGxldGVkRmFpbGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LnBheW1lbnRzR2V0UHVyY2hhc2VzID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgYnJpZGdlLnBheW1lbnRzLmdldFB1cmNoYXNlcygpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgIT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2VBbGwoJ3Byb2R1Y3RJRCcsICdpZCcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZUFsbCgncHVyY2hhc2VUb2tlbicsICd0b2tlbicpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUGF5bWVudHNHZXRQdXJjaGFzZXNDb21wbGV0ZWRTdWNjZXNzJywgZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblBheW1lbnRzR2V0UHVyY2hhc2VzQ29tcGxldGVkU3VjY2VzcycsICcnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2VUb1VuaXR5KCdPblBheW1lbnRzR2V0UHVyY2hhc2VzQ29tcGxldGVkRmFpbGVkJywgJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgd2luZG93LmdldElzUmVtb3RlQ29uZmlnU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJyaWRnZS5yZW1vdGVDb25maWcuaXNTdXBwb3J0ZWQudG9TdHJpbmcoKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cucmVtb3RlQ29uZmlnR2V0ID0gZnVuY3Rpb24ob3B0aW9ucykgew0KICAgICAgICAgICAgICAgIGlmIChvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHsgY2xpZW50RmVhdHVyZXM6IFtdIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBicmlkZ2UucmVtb3RlQ29uZmlnLmdldChvcHRpb25zKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMoZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZXMgPSBbXQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbmFtZSA9IGtleXNbaV0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSBkYXRhW25hbWVdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzLnB1c2goeyBuYW1lLCB2YWx1ZSB9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUmVtb3RlQ29uZmlnR2V0U3VjY2VzcycsIEpTT04uc3RyaW5naWZ5KHZhbHVlcykpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZVRvVW5pdHkoJ09uUmVtb3RlQ29uZmlnR2V0RmFpbGVkJywgJycpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQogICAgICAgIDwvc2NyaXB0Pg0KICAgIDwvYm9keT4NCjwvaHRtbD4NCg==";
