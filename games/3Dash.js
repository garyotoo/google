window.game = "PCFET0NUWVBFIGh0bWw+DQoNCjwhLS0gVWx0aW1hdGUgR2FtZSBTdGFzaCBmaWxlLS0+IA0KPCEtLSBGb3IgdGhlIHJlZ3VsYXJseSB1cGRhdGluZyBkb2MgZ28gdG8gaHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vZG9jdW1lbnQvZC8xX0ZtSDNCbFNCUUk3RkdnQVFMNTktWlBlOGVDeHMzNXdlbDZKVXlWYUc4US8gLS0+DQoNCg0KPGh0bWwgbGFuZz0iZW4tdXMiPg0KPGhlYWQ+DQo8bWV0YSBjaGFyc2V0PSJ1dGYtOCIvPg0KPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiLz4NCjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCB1c2VyLXNjYWxhYmxlPW5vIi8+DQo8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9idWJibHMvM2Rhc2hANzY2MTNjOWE5NDUzM2VmOWU2YmEwZTI2NmFlMTg2MTM3MDBlM2QwMi9zdHlsZS5jc3MiLz4NCjwhLS0gWWFuZGV4IEdhbWVzIFNESyAtLT4NCjxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvYnViYmxzLzNkYXNoQDc2NjEzYzlhOTQ1MzNlZjllNmJhMGUyNjZhZTE4NjEzNzAwZTNkMDIvdjIuMDJjNWI2M2Q2ODljNmJjMmY4M2MuanMiPjwvc2NyaXB0Pg0KPHN0eWxlPg0KICAgICAgICAvKiDQo9Cx0LjRgNCw0LXQvCDQstGL0LTQtdC70LXQvdC40LUg0L/QviDQvdCw0LbQsNGC0LjRjiDQutC70LDQstC40YggKi8NCiAgICAgICAgY2FudmFzOmZvY3VzIHsNCiAgICAgICAgICAgIG91dGxpbmU6IG5vbmU7DQogICAgICAgIH0NCg0KICAgICAgICBodG1sLCBib2R5IHsNCiAgICAgICAgICAgIC8qINCj0LHQuNGA0LDQtdC8INC+0YLRgdGC0YPQv9GLICovDQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgLyog0J7RgtC60LvRjtGH0LDQtdC8INGB0LrRgNC+0LvQuyDQuCDQu9C+0L3Qs9GC0LDQvyDQvdCwIElPUyAqLw0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgICAgICAgIC13ZWJraXQtdG91Y2gtY2FsbG91dDogbm9uZTsNCiAgICAgICAgICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAgICAgICAta2h0bWwtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAgICAgICAtbW96LXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgICAgICAgLW1zLXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAgICAgICAtd2Via2l0LXRhcC1oaWdobGlnaHQtY29sb3I6IHJnYmEoMCwwLDAsMCk7DQogICAgICAgICAgICAvKiDQodGC0LDQstC40Lwg0LLRi9GB0L7RgtGDINC90LAgMTAwJSAqLw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICB9DQogICAgPC9zdHlsZT4NCjwhLS0gQWRkaXRpb25hbCBoZWFkIG1vZHVsZXMgLS0+DQo8L2hlYWQ+DQo8Ym9keSBjbGFzcz0iZGFyayI+DQo8ZGl2IGlkPSJ1bml0eS1jb250YWluZXIiIGNsYXNzPSJ1bml0eS1kZXNrdG9wIj4NCjxjYW52YXMgaWQ9InVuaXR5LWNhbnZhcyIgdGFiaW5kZXg9Ii0xIj48L2NhbnZhcz4NCjwvZGl2Pg0KPGRpdiBpZD0ibG9hZGluZy1jb3ZlciIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPg0KPGRpdiBpZD0idW5pdHktbG9hZGluZy1iYXIiPg0KPGRpdiBpZD0idW5pdHktbG9nbyI+PGltZyBzcmM9IiIvPjwvZGl2Pg0KPGRpdiBpZD0idW5pdHktcHJvZ3Jlc3MtYmFyLWVtcHR5IiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPg0KPGRpdiBpZD0idW5pdHktcHJvZ3Jlc3MtYmFyLWZ1bGwiPjwvZGl2Pg0KPC9kaXY+DQo8ZGl2IGNsYXNzPSJzcGlubmVyIj48L2Rpdj4NCjwvZGl2Pg0KPC9kaXY+DQo8IS0tIEFkZGl0aW9uYWwgYm9keSBtb2R1bGVzIC0tPg0KPHNjcmlwdD4NCiAgICAgICAgY29uc3QgaGlkZUZ1bGxTY3JlZW5CdXR0b24gPSAiIjsNCiAgICAgICAgY29uc3QgYnVpbGRVcmwgPSAiIjsNCiAgICAgICAgY29uc3QgbG9hZGVyVXJsID0gYnVpbGRVcmwgKyAiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2J1YmJscy8zZGFzaEA3NjYxM2M5YTk0NTMzZWY5ZTZiYTBlMjY2YWUxODYxMzcwMGUzZDAyL0J1aWxkL0dlb21ldHJ5RGFzaC5sb2FkZXIuanMiOw0KICAgICAgICBjb25zdCBjb25maWcgPSB7DQogICAgICAgICAgICBkYXRhVXJsOiBidWlsZFVybCArICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvYnViYmxzLzNkYXNoQDc2NjEzYzlhOTQ1MzNlZjllNmJhMGUyNjZhZTE4NjEzNzAwZTNkMDIvQnVpbGQvR2VvbWV0cnlEYXNoLmRhdGEudW5pdHl3ZWIiLA0KICAgICAgICAgICAgZnJhbWV3b3JrVXJsOiBidWlsZFVybCArICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvYnViYmxzLzNkYXNoQDc2NjEzYzlhOTQ1MzNlZjllNmJhMGUyNjZhZTE4NjEzNzAwZTNkMDIvQnVpbGQvR2VvbWV0cnlEYXNoLmZyYW1ld29yay5qcy51bml0eXdlYiIsDQogICAgICAgICAgICBjb2RlVXJsOiBidWlsZFVybCArICJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvYnViYmxzLzNkYXNoQDc2NjEzYzlhOTQ1MzNlZjllNmJhMGUyNjZhZTE4NjEzNzAwZTNkMDIvQnVpbGQvR2VvbWV0cnlEYXNoLndhc20udW5pdHl3ZWIiLA0KICAgICAgICBzdHJlYW1pbmdBc3NldHNVcmw6ICJTdHJlYW1pbmdBc3NldHMiLA0KICAgICAgICAgICAgY29tcGFueU5hbWU6ICJEZWZhdWx0Q29tcGFueSIsDQogICAgICAgICAgICBwcm9kdWN0TmFtZTogIkdlb21ldHJ5RGFzaDNkIiwNCiAgICAgICAgICAgIHByb2R1Y3RWZXJzaW9uOiAiMC4xIg0KICAgICAgICB9Ow0KDQogICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN1bml0eS1jb250YWluZXIiKTsNCiAgICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3VuaXR5LWNhbnZhcyIpOw0KICAgICAgICBjb25zdCBsb2FkaW5nQ292ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjbG9hZGluZy1jb3ZlciIpOw0KICAgICAgICBjb25zdCBwcm9ncmVzc0JhckVtcHR5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3VuaXR5LXByb2dyZXNzLWJhci1lbXB0eSIpOw0KICAgICAgICBjb25zdCBwcm9ncmVzc0JhckZ1bGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjdW5pdHktcHJvZ3Jlc3MtYmFyLWZ1bGwiKTsNCiAgICAgICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zcGlubmVyJyk7DQoNCiAgICAgICAgY29uc3QgY2FuRnVsbHNjcmVlbiA9IChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBbDQogICAgICAgICAgICAgICAgJ2V4aXRGdWxsc2NyZWVuJywNCiAgICAgICAgICAgICAgICAnd2Via2l0RXhpdEZ1bGxzY3JlZW4nLA0KICAgICAgICAgICAgICAgICd3ZWJraXRDYW5jZWxGdWxsU2NyZWVuJywNCiAgICAgICAgICAgICAgICAnbW96Q2FuY2VsRnVsbFNjcmVlbicsDQogICAgICAgICAgICAgICAgJ21zRXhpdEZ1bGxzY3JlZW4nLA0KICAgICAgICAgICAgXSkgew0KICAgICAgICAgICAgICAgIGlmIChrZXkgaW4gZG9jdW1lbnQpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9KCkpOw0KDQogICAgICAgIGlmICgvaVBob25lfGlQYWR8aVBvZHxBbmRyb2lkL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgew0KICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9ICJ1bml0eS1tb2JpbGUiOw0KICAgICAgICAgICAgDQogICAgICAgIH0NCg0KICAgICAgICAvLyDQpNC+0L3QvtCy0L7QtSDQuNC30L7QsdGA0LDQttC10L3QuNC1INC/0YDQuCDQt9Cw0LPRgNGD0LfQutC1INC40LPRgNGLLiDQn9GA0Lgg0YHQsdC+0YDQutC1INCx0LjQu9C00LAg0LrQvtC0INC80LXQvdGP0LXRgtGB0Y8g0LLQt9Cw0LLQuNGB0LjQvNC+0YHRgtC4INC+0YIg0L3QsNGB0YLRgNC+0LXQuiDQv9GA0L7QtdC60YLQsC4NCiAgICAgICAgDQogICAgICAgIGxvYWRpbmdDb3Zlci5zdHlsZS5iYWNrZ3JvdW5kID0gInVybCgnaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2J1YmJscy8zZGFzaEA3NjYxM2M5YTk0NTMzZWY5ZTZiYTBlMjY2YWUxODYxMzcwMGUzZDAyL2xvZ28ucG5nJykgY2VudGVyIC8gY292ZXIiOw0KDQogICAgICAgIGxvYWRpbmdDb3Zlci5zdHlsZS5kaXNwbGF5ID0gIiI7DQoNCiAgICAgICAgLy8g0JLRi9C60LvRjtGH0LDQtdC8INC/0L7Rj9Cy0LvQtdC90LjQtSDQvNC10L3RjiDQv9GA0Lgg0L/RgNCw0LLQvtC8INC60LvQuNC60LUg0LzRi9GI0LgNCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCBldmVudCA9PiBldmVudC5wcmV2ZW50RGVmYXVsdCgpKTsNCg0KICAgICAgICAvLyDQktC+0LfQstGA0LDRidCw0LXQvCDRhNC+0LrRg9GBLCDQtdGB0LvQuCDQutC70LjQutC90YPQu9C4INC/0L4g0Y3QutGA0LDQvdGDDQogICAgICAgIGZ1bmN0aW9uIEZvY3VzR2FtZSgpIHsNCiAgICAgICAgICAgIHdpbmRvdy5mb2N1cygpOw0KICAgICAgICAgICAgY2FudmFzLmZvY3VzKCk7DQogICAgICAgIH0NCg0KICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLCAoKSA9PiB7DQogICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgfSk7DQogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgKCkgPT4gew0KICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgIH0pOw0KDQogICAgICAgIGxldCBTdGFydFVuaXR5SW5zdGFuY2U7DQogICAgICAgIGxldCBteUdhbWVJbnN0YW5jZSA9IG51bGw7DQogICAgICAgIGxldCB5c2RrID0gbnVsbDsNCiAgICAgICAgbGV0IHBsYXllciA9IG51bGw7DQogICAgICAgIGxldCBsZWFkZXJib2FyZDsNCiAgICAgICAgbGV0IHBheW1lbnRzID0gbnVsbDsNCiAgICAgICAgbGV0IGluaXRHYW1lID0gZmFsc2U7DQogICAgICAgIGxldCBub3dGdWxsQWRPcGVuID0gZmFsc2U7DQoNCiAgICAgICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7DQogICAgICAgIHNjcmlwdC5zcmMgPSBsb2FkZXJVcmw7DQogICAgICAgIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiB7DQogICAgICAgICAgICBTdGFydFVuaXR5SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgY3JlYXRlVW5pdHlJbnN0YW5jZShjYW52YXMsIGNvbmZpZywgKHByb2dyZXNzKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHNwaW5uZXIuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXJFbXB0eS5zdHlsZS5kaXNwbGF5ID0gIiI7DQogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzQmFyRnVsbC5zdHlsZS53aWR0aCA9IGAkezEwMCAqIHByb2dyZXNzfSVgOw0KICAgICAgICAgICAgICAgIH0pLnRoZW4oKHVuaXR5SW5zdGFuY2UpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UgPSB1bml0eUluc3RhbmNlOw0KICAgICAgICAgICAgICAgICAgICBsb2FkaW5nQ292ZXIuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICAgICAgICAgICAgICB9KS5jYXRjaCgobWVzc2FnZSkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIGlmIChMb2NhbEhvc3QoKSkNCiAgICAgICAgICAgICAgICBTdGFydFVuaXR5SW5zdGFuY2VfSWZVbmxvYWRlZCgpOw0KICAgICAgICB9Ow0KDQogICAgICAgIGZ1bmN0aW9uIFN0YXJ0VW5pdHlJbnN0YW5jZV9JZlVubG9hZGVkKCkgew0KICAgICAgICAgICAgaWYgKHNwaW5uZXIuc3R5bGUuZGlzcGxheSAhPT0gIm5vbmUiKQ0KICAgICAgICAgICAgICAgIFN0YXJ0VW5pdHlJbnN0YW5jZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gTG9jYWxIb3N0KCkgew0KICAgICAgICAgICAgdmFyIGhvc3QgPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWU7DQogICAgICAgICAgICBpZiAoaG9zdCA9PSAibG9jYWxob3N0IiB8fCBob3N0ID09ICIxMjcuMC4wLjEiKQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgZWxzZSByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBzZXRUaW1lb3V0KFN0YXJ0VW5pdHlJbnN0YW5jZV9JZlVubG9hZGVkLCA1MDAwKTsNCg0KICAgICAgICBJbml0WVNESygpOw0KICAgICAgICBhc3luYyBmdW5jdGlvbiBJbml0WVNESygpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgaWYgKExvY2FsSG9zdCgpKSByZXR1cm47DQoNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnSW5pdCBZYW5kZXggU0RLJyk7DQogICAgICAgICAgICAgICAgeXNkayA9IGF3YWl0IFlhR2FtZXMuaW5pdCgpOw0KDQogICAgICAgICAgICAgICAgRnVsbEFkU2hvdygpOyAvLyBGaXJzdCBhZCB0cnVlDQoNCiAgICAgICAgICAgICAgICAvLyBBZGRpdGlvbmFsIGluaXQgbW9kdWxlcw0KY2xvdWRTYXZlcyA9IGF3YWl0IExvYWRDbG91ZCgpOw0KY29uc29sZS5sb2coJ0luaXQgU3RvcmFnZSB5c2RrJyk7DQoNCnBheW1lbnRzRGF0YSA9IGF3YWl0IEdldFBheW1lbnRzKCk7DQpjb25zb2xlLmxvZygnSW5pdCBQYXltZW50cyB5c2RrJyk7DQoNCmVudmlyb25tZW50RGF0YSA9IGF3YWl0IFJlcXVlc3RpbmdFbnZpcm9ubWVudERhdGEoKTsNCmNvbnNvbGUubG9nKCdJbml0IEVudmlyIHlzZGsnKTsNCg0KcGxheWVyRGF0YSA9IGF3YWl0IEluaXRQbGF5ZXIoKTsNCmNvbnNvbGUubG9nKCdJbml0IFBsYXllciB5c2RrJyk7DQoNCg0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEluaXRpYWxpemF0aW9uIFNESzogJywgZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIFN0YXJ0VW5pdHlJbnN0YW5jZV9JZlVubG9hZGVkKCk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBJbml0R2FtZSgpIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJbml0IEdhbWUgU3VjY2VzcycpOw0KICAgICAgICAgICAgaW5pdEdhbWUgPSB0cnVlOw0KDQogICAgICAgICAgICBpZiAobm93RnVsbEFkT3BlbiA9PSB0cnVlICYmIG15R2FtZUluc3RhbmNlICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdPcGVuRnVsbEFkJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEFkZGl0aW9uYWwgc3RhcnQgbW9kdWxlcw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gRnVsbEFkU2hvdygpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgaWYgKG5vd0Z1bGxBZE9wZW4gIT09IHRydWUgJiYgeXNkayAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICB5c2RrLmFkdi5zaG93RnVsbHNjcmVlbkFkdigNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25PcGVuOiAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnT3BlbiBBZCBJbnRlcnN0aXRpYWwnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vd0Z1bGxBZE9wZW4gPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRHYW1lID09PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnT3BlbkZ1bGxBZCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiAod2FzU2hvd24pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vd0Z1bGxBZE9wZW4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbml0R2FtZSA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3YXNTaG93bikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdDbG9zZUZ1bGxBZCcsICd0cnVlJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdDbG9zZUZ1bGxBZCcsICdmYWxzZScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkVycm9yOiAoZXJyb3IpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIEFkIEludGVyc3RpdGlhbCcsIGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ0Vycm9yRnVsbEFkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggRnVsbEFkIFNob3c6ICcsIGUubWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBSZXdhcmRlZFNob3coaWQpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgeXNkay5hZHYuc2hvd1Jld2FyZGVkVmlkZW8oDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrczoNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbk9wZW46ICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09wZW5lZCBWaWRlbyBBZC4gSWQ6ICcgKyBpZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ09wZW5WaWRlbycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQ2xvc2VkIFZpZGVvIEFkLiBJZDogJyArIGlkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnQ2xvc2VWaWRlbycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uUmV3YXJkZWQ6ICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Jld2FyZCBWaWRlbyBBZC4gSWQ6ICcgKyBpZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1Jld2FyZFZpZGVvJywgaWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25FcnJvcjogKGUpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgVmlkZW8gQWQuIElkOiAnICsgaWQsIGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdFcnJvclZpZGVvJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFJld2FyZGVkIFZpZGVvIEFkIFNob3c6ICcsIGVyci5tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIFN0aWNreUFkQWN0aXZpdHkoc2hvdykgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICB5c2RrLmFkdi5nZXRCYW5uZXJBZHZTdGF0dXMoKS50aGVuKCh7IHN0aWNreUFkdklzU2hvd2luZywgcmVhc29uIH0pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0aWNreUFkdklzU2hvd2luZykgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzaG93KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXNkay5hZHYuaGlkZUJhbm5lckFkdigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlYXNvbikgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1N0aWNreSBhZCBhcmUgbm90IHNob3duLiBSZWFzb246JywgcmVhc29uKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzaG93KSB7DQogICAgICAgICAgICAgICAgICAgICAgICB5c2RrLmFkdi5zaG93QmFubmVyQWR2KCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFN0aWNreSBBY3Rpdml0eTogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIEluaXRMZWFkZXJib2FyZCgpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgeXNkay5nZXRMZWFkZXJib2FyZHMoKS50aGVuKF9sYiA9PiB7DQogICAgICAgICAgICAgICAgICAgIGxlYWRlcmJvYXJkID0gX2xiDQogICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ0luaXRpYWxpemVkTEInKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBJbml0IExlYWRlcmJvYXJkOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gU2V0TGVhZGVyYm9hcmRTY29yZXMoX25hbWUsIHNjb3JlKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHlzZGsuZ2V0TGVhZGVyYm9hcmRzKCkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4obGVhZGVyYm9hcmQgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgbGVhZGVyYm9hcmQuc2V0TGVhZGVyYm9hcmRTY29yZShfbmFtZSwgc2NvcmUpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBTZXQgTGVhZGVyIGJvYXJkIFNjb3JlczogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIEdldExlYWRlcmJvYXJkU2NvcmVzKG5hbWVMQiwgbWF4UGxheWVycywgcXVhbnRpdHlUb3AsIHF1YW50aXR5QXJvdW5kLCBwaG90b1NpemUsIGF1dGgpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgdmFyIGpzb25FbnRyaWVzID0gew0KICAgICAgICAgICAgICAgICAgICB0ZWNobm9OYW1lOiAnJywNCiAgICAgICAgICAgICAgICAgICAgaXNEZWZhdWx0OiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgaXNJbnZlcnRTb3J0T3JkZXI6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICBkZWNpbWFsT2Zmc2V0OiAwLA0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnJyAvLyAsIHRpdGxlOiAnJw0KICAgICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICAgICB5c2RrLmdldExlYWRlcmJvYXJkcygpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKGxlYWRlcmJvYXJkID0+IGxlYWRlcmJvYXJkLmdldExlYWRlcmJvYXJkRGVzY3JpcHRpb24obmFtZUxCKSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb25FbnRyaWVzLnRlY2hub05hbWUgPSBuYW1lTEI7DQogICAgICAgICAgICAgICAgICAgICAgICBqc29uRW50cmllcy5pc0RlZmF1bHQgPSByZXMuZGVmYXVsdDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb25FbnRyaWVzLmlzSW52ZXJ0U29ydE9yZGVyID0gcmVzLmRlc2NyaXB0aW9uLmludmVydF9zb3J0X29yZGVyOw0KICAgICAgICAgICAgICAgICAgICAgICAganNvbkVudHJpZXMuZGVjaW1hbE9mZnNldCA9IHJlcy5kZXNjcmlwdGlvbi5zY29yZV9mb3JtYXQub3B0aW9ucy5kZWNpbWFsX29mZnNldDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb25FbnRyaWVzLnR5cGUgPSByZXMuZGVzY3JpcHRpb24udHlwZTsgLy8g0J3QtSDQvtC/0YDQtdC00LXQu9GP0LXRgtGB0Y8g0L3QsCDQvNC+0LzQtdC90YIgMTguMDcuMjMNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vanNvbkVudHJpZXMudGl0bGUgPSByZXMudGl0bGU7IC8vINCg0LXQsNC70LjQt9GD0LnRgtC1INC/0L4g0L/RgNC10LTQv9C+0YfRgtC10L3QuNGP0LwNCg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxlYWRlcmJvYXJkLmdldExlYWRlcmJvYXJkRW50cmllcyhuYW1lTEIsIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWFudGl0eVRvcDogcXVhbnRpdHlUb3AsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZVVzZXI6IGF1dGgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHlBcm91bmQ6IHF1YW50aXR5QXJvdW5kDQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBqc29uUGxheWVycyA9IEVudHJpZXNMQihyZXMsIG1heFBsYXllcnMsIHBob3RvU2l6ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgY29tYmluZWRKc29uID0geyAuLi5qc29uRW50cmllcywgLi4uanNvblBsYXllcnMgfTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnTGVhZGVyYm9hcmRFbnRyaWVzJywgSlNPTi5zdHJpbmdpZnkoY29tYmluZWRKc29uKSk7DQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIEdldCBMZWFkZXJib2FyZDogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIEVudHJpZXNMQihyZXMsIG1heFBsYXllcnMsIHBob3RvU2l6ZSkgew0KICAgICAgICAgICAgbGV0IExlYWRlcmJvYXJkRW50cmllc1RleHQgPSAnJzsNCiAgICAgICAgICAgIGxldCBwbGF5ZXJzQ291bnQ7DQoNCiAgICAgICAgICAgIGlmIChyZXMuZW50cmllcy5sZW5ndGggPCBtYXhQbGF5ZXJzKSB7DQogICAgICAgICAgICAgICAgcGxheWVyc0NvdW50ID0gcmVzLmVudHJpZXMubGVuZ3RoOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBwbGF5ZXJzQ291bnQgPSBtYXhQbGF5ZXJzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBsZXQgcmFua3MgPSBuZXcgQXJyYXkocGxheWVyc0NvdW50KTsNCiAgICAgICAgICAgIGxldCBwaG90b3MgPSBuZXcgQXJyYXkocGxheWVyc0NvdW50KTsNCiAgICAgICAgICAgIGxldCBtYW1lcyA9IG5ldyBBcnJheShwbGF5ZXJzQ291bnQpOw0KICAgICAgICAgICAgbGV0IHNjb3JlcyA9IG5ldyBBcnJheShwbGF5ZXJzQ291bnQpOw0KICAgICAgICAgICAgbGV0IHVuaXF1ZUlEcyA9IG5ldyBBcnJheShwbGF5ZXJzQ291bnQpOw0KDQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGxheWVyc0NvdW50OyBpKyspIHsNCiAgICAgICAgICAgICAgICByYW5rc1tpXSA9IHJlcy5lbnRyaWVzW2ldLnJhbms7DQogICAgICAgICAgICAgICAgc2NvcmVzW2ldID0gcmVzLmVudHJpZXNbaV0uc2NvcmU7DQogICAgICAgICAgICAgICAgdW5pcXVlSURzW2ldID0gcmVzLmVudHJpZXNbaV0ucGxheWVyLnVuaXF1ZUlEOw0KDQogICAgICAgICAgICAgICAgaWYgKHBob3RvU2l6ZSA9PT0gJ25vbmVQaG90bycgfHwgcmVzLmVudHJpZXNbaV0ucGxheWVyLnNjb3BlUGVybWlzc2lvbnMuYXZhdGFyICE9PSAiYWxsb3ciKSB7DQogICAgICAgICAgICAgICAgICAgIHBob3Rvc1tpXSA9ICdub25lUGhvdG8nOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHBob3Rvc1tpXSA9IHJlcy5lbnRyaWVzW2ldLnBsYXllci5nZXRBdmF0YXJTcmMocGhvdG9TaXplKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAocmVzLmVudHJpZXNbaV0ucGxheWVyLnNjb3BlUGVybWlzc2lvbnMucHVibGljX25hbWUgIT09ICJhbGxvdyIpIHsNCiAgICAgICAgICAgICAgICAgICAgbWFtZXNbaV0gPSAiYW5vbnltb3VzIjsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBtYW1lc1tpXSA9IHJlcy5lbnRyaWVzW2ldLnBsYXllci5wdWJsaWNOYW1lOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIExlYWRlcmJvYXJkRW50cmllc1RleHQgKz0gcmFua3NbaV0gKyAnLiAnICsgbWFtZXNbaV0gKyAiOiAiICsgc2NvcmVzW2ldICsgJ1xuJzsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHBsYXllcnNDb3VudCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIExlYWRlcmJvYXJkRW50cmllc1RleHQgPSAnbm8gZGF0YSc7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxldCBqc29uUGxheWVycyA9IHsNCiAgICAgICAgICAgICAgICAiZW50cmllcyI6IExlYWRlcmJvYXJkRW50cmllc1RleHQsDQogICAgICAgICAgICAgICAgInJhbmtzIjogcmFua3MsDQogICAgICAgICAgICAgICAgInBob3RvcyI6IHBob3RvcywNCiAgICAgICAgICAgICAgICAibmFtZXMiOiBtYW1lcywNCiAgICAgICAgICAgICAgICAic2NvcmVzIjogc2NvcmVzLA0KICAgICAgICAgICAgICAgICJ1bmlxdWVJRHMiOiB1bmlxdWVJRHMNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIHJldHVybiBqc29uUGxheWVyczsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIFJldmlldygpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgeXNkay5mZWVkYmFjay5jYW5SZXZpZXcoKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbigoeyB2YWx1ZSwgcmVhc29uIH0pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlzZGsuZmVlZGJhY2sucmVxdWVzdFJldmlldygpLnRoZW4oKHsgZmVlZGJhY2tTZW50IH0pID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZlZWRiYWNrU2VudCAnLCBmZWVkYmFja1NlbnQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmVlZGJhY2tTZW50KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdSZXZpZXdTZW50JywgJ3RydWUnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXZpZXcgbGVmdCcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdSZXZpZXdTZW50JywgJ2ZhbHNlJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUmV2aWV3IG5vdCBsZWZ0JywgcmVhc29uKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUmV2aWV3IGNhbiBzaG93ID0gZmFsc2UnLCByZWFzb24pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvY3VzR2FtZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFJldmlldzogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIFByb21wdFNob3coKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHlzZGsuc2hvcnRjdXQuc2hvd1Byb21wdCgpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU2hvcnRjdXQgY3JlYXRlZD86JywgcmVzdWx0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQub3V0Y29tZSA9PT0gJ2FjY2VwdGVkJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9tcHQgU3VjY2VzcycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ09uUHJvbXB0U3VjY2VzcycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnT25Qcm9tcHRGYWlsJyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggUHJvbXB0IFNob3c6ICcsIGUubWVzc2FnZSk7DQogICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBBZGRpdGlvbmFsIHNjcmlwdCBtb2R1bGVzOg0KDQp2YXIgY2xvdWRTYXZlcyA9ICdub0RhdGEnOw0KDQpmdW5jdGlvbiBTYXZlQ2xvdWQoanNvbkRhdGEsIGZsdXNoKSB7DQogICAgaWYgKHBsYXllciA9PSBudWxsKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIFNhdmUgQ2xvdWQ6ICcsICdEaWRudCBoYXZlIHRpbWUgdG8gbG9hZCcpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIHRyeSB7DQogICAgICAgIHBsYXllci5zZXREYXRhKHsNCiAgICAgICAgICAgIHNhdmVzOiBbanNvbkRhdGFdLA0KICAgICAgICB9LCBmbHVzaCk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBTYXZlIENsb3VkOiAnLCBlLm1lc3NhZ2UpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gTG9hZENsb3VkKHNlbmRiYWNrKSB7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgICAgIGlmICh5c2RrID09IG51bGwpIHsNCiAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRMb2FkU2F2ZXMnLCAnbm9EYXRhJyk7DQogICAgICAgICAgICByZXNvbHZlKCdub0RhdGEnKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgeXNkay5nZXRQbGF5ZXIoeyBzY29wZXM6IGZhbHNlIH0pDQogICAgICAgICAgICAgICAgLnRoZW4oX3BsYXllciA9PiB7DQogICAgICAgICAgICAgICAgICAgIF9wbGF5ZXIuZ2V0RGF0YShbInNhdmVzIl0pLnRoZW4oZGF0YSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zYXZlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0TG9hZFNhdmVzJywgSlNPTi5zdHJpbmdpZnkoZGF0YS5zYXZlcykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoSlNPTi5zdHJpbmdpZnkoZGF0YS5zYXZlcykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VuZGJhY2spDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1NldExvYWRTYXZlcycsICdub0RhdGEnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdub0RhdGEnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTG9hZCBDbG91ZCBFcnJvciEnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRMb2FkU2F2ZXMnLCAnbm9EYXRhJyk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdub0RhdGEnKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0xvYWQgQ2xvdWQgRXJyb3IhJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbmRiYWNrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0TG9hZFNhdmVzJywgJ25vRGF0YScpOw0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdub0RhdGEnKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggTG9hZCBzYXZlcyBDbG91ZDogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRMb2FkU2F2ZXMnLCAnbm9EYXRhJyk7DQogICAgICAgICAgICByZXNvbHZlKCdub0RhdGEnKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfQ0KDQoNCnZhciBwYXltZW50c0RhdGEgPSAnbm9uZSc7DQoNCmZ1bmN0aW9uIEdldFBheW1lbnRzKHNlbmRiYWNrKSB7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgcmVzb2x2ZSgnbm9uZScpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgeXNkay5nZXRQYXltZW50cygpLnRoZW4oX3BheW1lbnRzID0+IHsNCiAgICAgICAgICAgICAgICBwYXltZW50cyA9IF9wYXltZW50czsNCg0KICAgICAgICAgICAgICAgIHBheW1lbnRzLmdldENhdGFsb2coKQ0KICAgICAgICAgICAgICAgICAgICAudGhlbihwcm9kdWN0cyA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJvZHVjdElEID0gW107DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGl0bGUgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkZXNjcmlwdGlvbiA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGltYWdlVVJJID0gW107DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJpY2VWYWx1ZSA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNvbnN1bWVkID0gW107DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRzLmdldFB1cmNoYXNlcygpLnRoZW4ocHVyY2hhc2VzID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHByb2R1Y3RzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RJRFtpXSA9IHByb2R1Y3RzW2ldLmlkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZVtpXSA9IHByb2R1Y3RzW2ldLnRpdGxlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbltpXSA9IHByb2R1Y3RzW2ldLmRlc2NyaXB0aW9uOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWFnZVVSSVtpXSA9IHByb2R1Y3RzW2ldLmltYWdlVVJJOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZVZhbHVlW2ldID0gcHJvZHVjdHNbaV0ucHJpY2VWYWx1ZTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lZFtpXSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaTIgPSAwOyBpMiA8IHB1cmNoYXNlcy5sZW5ndGg7IGkyKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwdXJjaGFzZXNbaTJdLnByb2R1Y3RJRCA9PT0gcHJvZHVjdElEW2ldKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRbaV0gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBqc29uUGF5bWVudHMgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpZCI6IHByb2R1Y3RJRCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInRpdGxlIjogdGl0bGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6IGRlc2NyaXB0aW9uLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW1hZ2VVUkkiOiBpbWFnZVVSSSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInByaWNlVmFsdWUiOiBwcmljZVZhbHVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY29uc3VtZWQiOiBjb25zdW1lZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImxhbmd1YWdlIjogeXNkay5lbnZpcm9ubWVudC5pMThuLmxhbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbmRiYWNrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdQYXltZW50c0VudHJpZXMnLCBKU09OLnN0cmluZ2lmeShqc29uUGF5bWVudHMpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKEpTT04uc3RyaW5naWZ5KGpzb25QYXltZW50cykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHVyY2hhc2VzIGFyZSBub3QgYXZhaWxhYmxlJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICByZXNvbHZlKCdub25lJyk7DQogICAgICAgICAgICB9KQ0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBJbml0IFBheW1lbnRzOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgcmVzb2x2ZSgnbm9uZScpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoNCmZ1bmN0aW9uIEJ1eVBheW1lbnRzKGlkKSB7DQogICAgdHJ5IHsNCiAgICAgICAgaWYgKHBheW1lbnRzICE9IG51bGwpIHsNCiAgICAgICAgICAgIHBheW1lbnRzLnB1cmNoYXNlKGlkKS50aGVuKCgpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHVyY2hhc2UgU3VjY2VzcycpOw0KICAgICAgICAgICAgICAgIENvbnN1bWVQdXJjaGFzZShpZCk7DQogICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdQdXJjaGFzZSBGYWlsZWQnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ09uUHVyY2hhc2VGYWlsZWQnLCBpZCk7DQogICAgICAgICAgICAgICAgRm9jdXNHYW1lKCk7DQogICAgICAgICAgICB9KQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY29uc29sZS5sb2coJ1BheW1lbnRzID09IG51bGwnKTsNCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggQnV5IFBheW1lbnRzOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICBGb2N1c0dhbWUoKTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIENvbnN1bWVQdXJjaGFzZShpZCkgew0KICAgIHRyeSB7DQogICAgICAgIGlmIChwYXltZW50cyAhPSBudWxsKSB7DQogICAgICAgICAgICBwYXltZW50cy5nZXRQdXJjaGFzZXMoKS50aGVuKHB1cmNoYXNlcyA9PiB7DQogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHB1cmNoYXNlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBpZiAocHVyY2hhc2VzW2ldLnByb2R1Y3RJRCA9PT0gaWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRzLmNvbnN1bWVQdXJjaGFzZShwdXJjaGFzZXNbaV0ucHVyY2hhc2VUb2tlbik7DQogICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdPblB1cmNoYXNlU3VjY2VzcycsIGlkKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgY29uc29sZS5sb2coJ0NvbnN1bWUgcHVyY2hhc2U6IHBheW1lbnRzIG51bGwnKTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NSQVNIIENvbnN1bWUgUHVyY2hhc2U6ICcsIGUubWVzc2FnZSk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBDb25zdW1lUHVyY2hhc2VzKCkgew0KICAgIHRyeSB7DQogICAgICAgIGlmIChwYXltZW50cyAhPSBudWxsKSB7DQogICAgICAgICAgICBwYXltZW50cy5nZXRQdXJjaGFzZXMoKS50aGVuKHB1cmNoYXNlcyA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1VucHJvY2Vzc2VkIHB1cmNoYXNlczogJywgcHVyY2hhc2VzLmxlbmd0aCk7DQogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHB1cmNoYXNlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBwYXltZW50cy5jb25zdW1lUHVyY2hhc2UocHVyY2hhc2VzW2ldLnB1cmNoYXNlVG9rZW4pOw0KICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdPblB1cmNoYXNlU3VjY2VzcycsIHB1cmNoYXNlc1tpXS5wcm9kdWN0SUQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgY29uc29sZS5sb2coJ0NvbnN1bWUgcHVyY2hhc2VzOiBwYXltZW50cyBudWxsJyk7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBDb25zdW1lIHB1cmNoYXNlczogJywgZS5tZXNzYWdlKTsNCiAgICB9DQp9DQoNCg0KdmFyIGVudmlyb25tZW50RGF0YSA9ICdudWxsJzsNCg0KZnVuY3Rpb24gUmVxdWVzdGluZ0Vudmlyb25tZW50RGF0YShzZW5kYmFjaykgew0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gew0KICAgICAgICBpZiAoeXNkayA9PSBudWxsKSB7DQogICAgICAgICAgICByZXNvbHZlKCdudWxsJyk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHZhciBwcm9tcHRDYW5TaG93ID0gZmFsc2U7DQogICAgICAgICAgICB2YXIgcmV2aWV3Q2FuU2hvdyA9IGZhbHNlOw0KDQogICAgICAgICAgICB5c2RrLmZlZWRiYWNrLmNhblJldmlldygpDQogICAgICAgICAgICAgICAgLnRoZW4oKHsgdmFsdWUgfSkgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUpDQogICAgICAgICAgICAgICAgICAgICAgICByZXZpZXdDYW5TaG93ID0gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgICAgICB5c2RrLnNob3J0Y3V0LmNhblNob3dQcm9tcHQoKS50aGVuKHByb21wdCA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvbXB0LmNhblNob3cpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbXB0Q2FuU2hvdyA9IHRydWU7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBicm93c2VyID0gbmF2aWdhdG9yLnVzZXJBZ2VudDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChicm93c2VyLmluY2x1ZGVzKCdZYUJyb3dzZXInKSB8fCBicm93c2VyLmluY2x1ZGVzKCdZYVNlYXJjaEJyb3dzZXInKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicm93c2VyID0gJ1lhbmRleCc7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChicm93c2VyLmluY2x1ZGVzKCdPcGVyYScpIHx8IGJyb3dzZXIuaW5jbHVkZXMoJ09QUicpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnT3BlcmEnOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYnJvd3Nlci5pbmNsdWRlcygnRmlyZWZveCcpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnRmlyZWZveCc7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChicm93c2VyLmluY2x1ZGVzKCdNU0lFJykpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJvd3NlciA9ICdJRSc7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChicm93c2VyLmluY2x1ZGVzKCdFZGdlJykpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJvd3NlciA9ICdFZGdlJzsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJyb3dzZXIuaW5jbHVkZXMoJ0Nocm9tZScpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnQ2hyb21lJzsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJyb3dzZXIuaW5jbHVkZXMoJ1NhZmFyaScpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnU2FmYXJpJzsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicm93c2VyID0gJ090aGVyJzsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGpzb25FbnZpciA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibGFuZ3VhZ2UiOiB5c2RrLmVudmlyb25tZW50LmkxOG4ubGFuZywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZG9tYWluIjogeXNkay5lbnZpcm9ubWVudC5pMThuLnRsZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGV2aWNlVHlwZSI6IHlzZGsuZGV2aWNlSW5mby50eXBlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpc01vYmlsZSI6IHlzZGsuZGV2aWNlSW5mby5pc01vYmlsZSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpc0Rlc2t0b3AiOiB5c2RrLmRldmljZUluZm8uaXNEZXNrdG9wKCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzVGFibGV0IjogeXNkay5kZXZpY2VJbmZvLmlzVGFibGV0KCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzVFYiOiB5c2RrLmRldmljZUluZm8uaXNUVigpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcHBJRCI6IHlzZGsuZW52aXJvbm1lbnQuYXBwLmlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJicm93c2VyTGFuZyI6IHlzZGsuZW52aXJvbm1lbnQuYnJvd3Nlci5sYW5nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwYXlsb2FkIjogeXNkay5lbnZpcm9ubWVudC5wYXlsb2FkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwcm9tcHRDYW5TaG93IjogcHJvbXB0Q2FuU2hvdywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicmV2aWV3Q2FuU2hvdyI6IHJldmlld0NhblNob3csDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgInBsYXRmb3JtIjogbmF2aWdhdG9yLnBsYXRmb3JtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJicm93c2VyIjogYnJvd3Nlcg0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRFbnZpckRhdGEnLCBKU09OLnN0cmluZ2lmeShqc29uRW52aXIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoSlNPTi5zdHJpbmdpZnkoanNvbkVudmlyKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRW52aXJvbm1lbnQgRGF0YTogIiArIEpTT04uc3RyaW5naWZ5KGpzb25FbnZpcikpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ1JBU0ggUmVxdWVzdGluZyBFbnZpcm9ubWVudCBEYXRhOiAnLCBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgcmVzb2x2ZSgnbnVsbCcpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoNCg0KdmFyIHBsYXllckRhdGEgPSAnbm9EYXRhJzsNCg0KZnVuY3Rpb24gSW5pdFBsYXllcihzZW5kYmFjaykgew0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKHlzZGsgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIE5vdEF1dGhvcml6ZWQoKTsNCiAgICAgICAgICAgICAgICBpZiAoc2VuZGJhY2spDQogICAgICAgICAgICAgICAgICAgIG15R2FtZUluc3RhbmNlLlNlbmRNZXNzYWdlKCdZYW5kZXhHYW1lJywgJ1NldEluaXRpYWxpemF0aW9uU0RLJywgTm90QXV0aG9yaXplZCgpKTsNCiAgICAgICAgICAgICAgICByZXNvbHZlKE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBsZXQgX3Njb3BlcyA9IHRydWU7DQogICAgICAgICAgICAgICAgeXNkay5nZXRQbGF5ZXIoeyBzY29wZXM6IF9zY29wZXMgfSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oX3BsYXllciA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIgPSBfcGxheWVyOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGxheWVyTmFtZSA9IHBsYXllci5nZXROYW1lKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGxheWVyUGhvdG8gPSBwbGF5ZXIuZ2V0UGhvdG8oJ3NtYWxsJyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX3Njb3Blcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllck5hbWUgPSAiYW5vbnltb3VzIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJQaG90byA9ICJudWxsIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5nZXRNb2RlKCkgPT09ICdsaXRlJykgew0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ05vdCBBdXRob3JpemVkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbmRiYWNrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRJbml0aWFsaXphdGlvblNESycsIE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShOb3RBdXRob3JpemVkKCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXV0aEpzb24gPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwbGF5ZXJBdXRoIjogInJlc29sdmVkIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBsYXllck5hbWUiOiBwbGF5ZXJOYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGxheWVySWQiOiBwbGF5ZXIuZ2V0VW5pcXVlSUQoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBsYXllclBob3RvIjogcGxheWVyUGhvdG8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnU2V0SW5pdGlhbGl6YXRpb25TREsnLCBKU09OLnN0cmluZ2lmeShhdXRoSnNvbikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoSlNPTi5zdHJpbmdpZnkoYXV0aEpzb24pKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBdXRob3JpemVkIGVycjogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRJbml0aWFsaXphdGlvblNESycsIE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDUkFTSCBpbml0IFBsYXllcjogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgIGlmIChzZW5kYmFjaykNCiAgICAgICAgICAgICAgICBteUdhbWVJbnN0YW5jZS5TZW5kTWVzc2FnZSgnWWFuZGV4R2FtZScsICdTZXRJbml0aWFsaXphdGlvblNESycsIE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgICAgICByZXNvbHZlKE5vdEF1dGhvcml6ZWQoKSk7DQogICAgICAgIH0NCiAgICB9KTsNCn0NCg0KZnVuY3Rpb24gTm90QXV0aG9yaXplZCgpIHsNCiAgICBsZXQgYXV0aEpzb24gPSB7DQogICAgICAgICJwbGF5ZXJBdXRoIjogInJlamVjdGVkIiwNCiAgICAgICAgInBsYXllck5hbWUiOiAidW5hdXRob3JpemVkIiwNCiAgICAgICAgInBsYXllcklkIjogInVuYXV0aG9yaXplZCIsDQogICAgICAgICJwbGF5ZXJQaG90byI6ICJudWxsIg0KICAgIH07DQogICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGF1dGhKc29uKTsNCn0NCg0KZnVuY3Rpb24gT3BlbkF1dGhEaWFsb2coKSB7DQogICAgaWYgKHlzZGsgIT09IG51bGwpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHlzZGsuYXV0aC5vcGVuQXV0aERpYWxvZygpLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgIEluaXRQbGF5ZXIodHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgbXlHYW1lSW5zdGFuY2UuU2VuZE1lc3NhZ2UoJ1lhbmRleEdhbWUnLCAnR2V0RGF0YUludm9rZScpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnQ1JBU0ggT3BlbiBBdXRoIERpYWxvZzogJywgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KDQogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsNCiAgICA8L3NjcmlwdD4NCjwvYm9keT4NCjwvaHRtbD4=";
